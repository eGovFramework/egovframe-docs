<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ko class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://eGovFramework.github.io/egovframe-docs/egovframe-runtime/batch-layer/><link rel=alternate type=application/rss+xml href=https://eGovFramework.github.io/egovframe-docs/egovframe-runtime/batch-layer/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/egovframe-docs/favicons/favicon.ico><link rel=apple-touch-icon href=/egovframe-docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/egovframe-docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/egovframe-docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/egovframe-docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/egovframe-docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/egovframe-docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/egovframe-docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/egovframe-docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/egovframe-docs/favicons/android-192x192.png sizes=192x192><title>배치처리 | 표준프레임워크 개발가이드</title><meta name=description content="배치처리 서비스는 일괄처리 업무 구현에 필요한 기능을 제공한다."><meta property="og:title" content="배치처리"><meta property="og:description" content="배치처리 서비스는 일괄처리 업무 구현에 필요한 기능을 제공한다."><meta property="og:type" content="website"><meta property="og:url" content="https://eGovFramework.github.io/egovframe-docs/egovframe-runtime/batch-layer/"><meta itemprop=name content="배치처리"><meta itemprop=description content="배치처리 서비스는 일괄처리 업무 구현에 필요한 기능을 제공한다."><meta name=twitter:card content="summary"><meta name=twitter:title content="배치처리"><meta name=twitter:description content="배치처리 서비스는 일괄처리 업무 구현에 필요한 기능을 제공한다."><link rel=preload href=/egovframe-docs/scss/main.min.19c9649623f11a8e1a7bf9b22db92c1b1350433f3ac8ceabd50c30ca684a2e5a.css as=style integrity="sha256-GclkliPxGo4ae/myLbksGxNQQz86yM6r1QwwymhKLlo=" crossorigin=anonymous><link href=/egovframe-docs/scss/main.min.19c9649623f11a8e1a7bf9b22db92c1b1350433f3ac8ceabd50c30ca684a2e5a.css rel=stylesheet integrity="sha256-GclkliPxGo4ae/myLbksGxNQQz86yM6r1QwwymhKLlo=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/egovframe-docs/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="60" height="25" viewBox="0 0 60 25" enable-background="new 0 0 60 25"><image id="image0" width="60" height="25" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAZCAYAAABtnU33AAAAIGNIUk0AAHomAACAhAAA+gAAAIDo AAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAAHCAAABwgAc0P m54AAAHcelRYdFJhdyBwcm9maWxlIHR5cGUgeG1wAAA4jYVUQZLjIAy86xX7BCyBBM/x2vg2VXPc 528Lj23imIypOAlI6lZLiP59fdMffywlksWyzJZ1taCrJos6cfD/umg18TNZmXXSqJuyJpn3/dN6 Y+ZAVxhs/nWXlOOaAocouhkcOYhyldA+LDXMHHyBAiO4ypw4Rop6w98PnUO2iBVkBuZm7eFqMOLa IIw3maT44o0kCGOD8V73IPgWKwgL2pZ5dQA/vrjcGcWoiUxUsFFaagUqVDD8MYAuDGwo4QwhxEug flmmXlRX6j2pxqheYuM31NMV6WZwDp4gV6Tmqn/CuqBQpQzWDwpqpRHa4bTj/Q7Xp+Ya6TPeMLkf H6/aiXevylmbXbs5elESVIle/ORBN12kxgZADSHEAmaTmqbUjDVakaXJ+THIBU099inmnAIaIsN1 QZ87fVwHT3BvEKlorAl9s1xa0u9OzwlfoH6VdKFGVXBhJwiYgDX1OIfZ3eo9OA1TKo8pCa7UC9Dh QSOXQQWPFplT9rJY4+uXiE4sa5e3JTY2H8PQDac8Ow5gOmv6jPMKE30KlSZBbD11wACAeoSR4X0O 8dZPon0QUT+J+jF6Gfsgjepne6/fJ7yf0H9Fc2ZpNW51UwAAAAFvck5UAc+id5oAAAyuSURBVFjD tZd/kFXlecc/z3vOub932R/sroKC+GuUNWOMxNq0UTDGtqZ2iHLXSttEO9GkMaBi0KBWz4yGKKBW MU0wWm20Gu9V04mGaJoWNErjTMyodRGMCkXk18ICu3vv3XvPed+nf5zLdTUSTWd8/rrz3vf5/X3e 53uEg4iCCKiGoV/N5UvWpL846tgZYc4+4qpv/KZULHoD5bLlo4kkJpEr79p4U0PNYRFBPRZPrZdq U5EH7/9a7+piseSVywMf1eb/S8xB/wlDDyDOZhfncvkvGhG68oU+8YIVAMVy2X10N5qYBMEEA5m2 7i+ZVPZiCTKXZDt6L1AvfxJA/9eL8nEme9CEVVUkDGMNw5wPC+rVmoucfXxftbo14wdzNtzy/VkC WiqWvD/E2Q2gLq5X65W9uEalro1aLaqOQlyLANY+83Gne7AOl8vJeS59GoX8oTG6pHPx5edF2pgf O0fg+58DKPav/4M6IqCIZF0cXaeWs1SjYlzbNxdTfQxg7Q18rHBuiSqiYehrKemYhqEPoLcsXam3 3Dw8sTBvLv/+T19f8YOnAA7cL5VKXqlU8hSVxJ5KGIYtnTAMjWry3+UrN7yx8I7XPvMBQUgYqglD NcWStpBTLKk3O1Q/VJ1gTw2qUiypN3uN+gfOZq9Rn6aflr427xw41+RBeddvGBptBqvLlv5al918 H8C2cFUO4M1bV/3D67fes/6Arr7PAe+z9365fOWGNxbc+dpZAMVQU8WSemGoH4y099ueUMT3Hr9P v6k3sUgHzn0B1SuuyNJrvozz3pRrw/94t8sy3Vq9C6Cyp24BnHOvOTFT7gvvy0h40TgirF7x8LyG pHNzR195kDB0K1Y8MVnEZq+8cu7bAN9c/nQ+Q6b3psWnbxIRRV3y4M0s2/LAgC0Dl6zSYLT2alfQ OaMPguN/+OX0I4jo/Ef0bAmY5Rz//vA8eQWg+IROHd/24t7sMSfPNgHd4WflgeJzOo0051Pj/rLI ULGkXihiz12vp0mKT+Yq3PuASMUHoFeuor09ZHS8pt++5lS5dukr+FEfmsp6gQwCHN09bAF8MTsw fPeiwXwE8F/LH/6CpHPldJDjUU5Oz4MftAeFeRjvTGAeQFv+sNMUWQR8/j0AKAOogGjsV3uCrpk3 K5r3M965F96nTzdSHGsCfprtg8puzv+b1frH/3a2jPiTWFhoO7mi8HW/QF/xGX1OUiyZdAwXj2ym C1hSHhBbfFlnkOLx7DS6a9s5FFhiNLyiC1jE6Kglm83iy6UApII+RKNq3W1thucAqmPb3zpm0cXX 0tyXnmcWe2Ko1WvgyRIAEXYrfKKVWBzNxNlsE1YeSAK1/n5vdrjWAzBOLS7+I+DMOMIN79ptTYqF QRYqu9iZmsRMjfgzAI3pULgMoU9jMFmuxzC3ugPU59ziOs0CSJ5LU510V7fSUI8F52zTyYa0zMHz 2omjM6jUVoH5SwCMX0BMdXRvamTifJchHgxLKYB1t5WmisjplVrlqnocXZRJZ2c8tOKJ46oavWyt y4S3r+lIcrSHW9f4bXPChdjVAMphf2NtOCcGiP2hOnF9Mi4OVHm6Z8bkADirMcpyN86nGiNUCDgF AItNF+jSmIvjOqvTBS6UmJ81xrhcLMeSZmrzjSnWhyjbKqegpFLCGQZ1c4jj5+W6O56Fxp2o69Tv fKsTKx5o9Owp08cBJAydhKELw9CVWR8nJbCnOBdXRj1z13lXnnf/WK06hO+fftnedZsQCXJeqjsp nswA2doMwuH7c7+yctP5f3/X1ku+9N0d5wNUqvkYY7rE2mUP/q2cXYuYpkpK4O4fXSDbVPmxWo5K 7FFojLD1kc/JPQKPGw8M3FqeJXeoYcSl6CgOahcRU5yw/McnyMuiPIVltg8cj2MNAI3RzWRyO8Ec iYhDiQcGEuhuCsNMLZjUORZEWqlmfGCr4vpFzEsDiwZqSSDml9a6WYThKr1zzngGexjwpjjXh3hv NoES+blJi/xGDOl2XKO+fXaoj6XsG0YlXxMv9RyASdEhhu3eyOatAGLYqMKpAEZJOeFFADyGasNU x/bwdnNF7DQWY1Ic5YSdsWNDcx5fEDjdAL3gXkm6eHcVka2Im0KMA2nRx47C5FO60unVPabjsSnt bY/oJZcEqmaKYN6Y8OoPGt+fBqCOvc7pIclMmy5PzJbkDooqB+gmzhlYi/opT1THrB3fBmCj0Vdd Lb6skj8i2e0+Qy0/BhHDFgCx1DC8k6sykpijhsE6y2HA2z85TkYB1ON/ROj2MWRxpkdvvPx4rESA Qbx2PG8IXFAqlbyBgQHre9Lb0dbxyd3jlv2x440pJ2RB2xXd0XqcjG4Toa05qztQmZb81sx4VNnS 7IAfVffdHpvMC7aytwPj718bzokvWLXNQ0zN82QM4OH57buBnwMUS9ojDS5E2JZkjGCTBNUjwjBW HhDbtO9EUevTIUBxUI82jiCK6NEMOR9LBt+sQPwKGEfg91KP/5nAWZTg0+vXB4CtxI3h4eHdG+sS jNclOPKQbE13iRac2tFW5R37LS4H4JS3ReSQS5e+0I0qLura2VxCxsCj9yyYsW4iJ/Bd1Sidsai2 6GWxpD0BXE+Gc7LdTK/u4cEWmBxRsgEAf4IhRVA8YqzfxqlRiuedjzFCHscOgxDgeVlEJoP0kk6B ZwIaOoqScZlMGqCvsv/ZadWFM0cqlTNFZF/d5lOqIqJNxwl0K5iEhqp4mx3a11Uw01DGll19XFIY FVWhkCQ0mDpADaGAINaZbGuM0sKNuT6+YQzTa8NYkfewuIMzugBUcV4GROjFMNlkyBKQ9wGlES1H vI04k2bfSBui63B+HTWpI/2gA9hfHhzUgTJuwy22HunEgr7Ls521aTV+M2C32Yj3p77I0SC7AIrF YpMje807g3bt7JluYgrGJfaK/zLaA8yv7aGhyo2aJhA4sdVFg3IQcXWctJGvD7EeuBmPSbaKMRnG fUTqiHlElqx4caKShmEXqYyN43g68L/F/n6hXKbhnC8eopmMqkpdkGwrXl8KojQSqOkW57m88fRE p7oFoL+/X/bye0QF6yedC/KF44E2tZz3UFEen/8zXai2Cd4P+UZzHk4ED58N5WPlgfeMDmgdOBZ4 URcsSNPX/gni4C0Jw2Fd9p2Kb7yTgGc59FABGDEmngR2hBHEFIaNSFcrYZVeI94YgDPRDicZ3ygn OMxLyY3TSbj0QZojkPKa6TiORNj40IA8nhSQTuTDUgUENYJxMXvF4zAAQjXnXcQRAjMMKrtReziA rFxZJx38Ezkzt1nx1yPVLwBs304A0O3au0Wksyedblhrh6zT6a0GOXeUdfFugP37h3cZ8WIDJyE2 YVl8+Be+jcYFQIQOYNeERA4X/QgJJ8XyPOUdHIfOXqM+oTiT5lTy3GkQeQvjfRpAl17ajXUnYt22 ppNfBL7/+XduuvXwKeFXqwBeynwrG6Tah4bAiWwUNTMP+DHGnGSEjQBhODAWq42DVHqauOB1gJmD g+p+93PyYNIAJrWKqcxCmuPyAcho3UsWfMqk2IRPd/dUEl4Q8yfSYLcBXYdyjl51VRu0z0U0j+HV RDv+OX7ApLRZtXnZ7Z/auuJ73875qa/WosaW/vDSMeuiV8Qz059c9vBnH13xxHGeMbOc8N/vejfb nIup22gHwPr+cvKu/x7xgow2A9+B4ehiSbvml/TkdIETEcYPwLal4L9XXwSnAekfHS1vozgR/q7Z 9aIanjeoWYvnpenkKYwsR+Q3cnW4VcPQyNXX/Tpu1J/PZ3N/kcH7paLXpIMUTu33AKan92+0qls8 P/VDMe5R51y1YeVXrXyFbXHUGB0JOnclXUdVcU4PNsRY6yVfZR68BuRShkfJ8K+NMRoqpJpttKJJ 0qKoKO++9IoVkvFDeVYM/zhvk/6n30aPGFYbuebW9Vj7JB3tn6GQ78Tq3QDs2RMA1CGs1KrkAj9X SGfYW6k8s2Hsnds0VHPMwoX12LpV3ZO6jujp6OlXdfd+ZdGfD4fhmgyAOnaKMSMrFx5Tb4VjTJsY 0+xLsRVn7ItgTBsJK+eBv5bXEH5VmMocEWYgXI9wLIB6pNWQaSLBP7DXk7miYEyz745VfgEvM5Uz 4iovlnvluabjYAH7RgW8DeWjfnsvgKxc2dAwNLJ48S/2rbi9WI/tgnpcHxwRc/1AGDZKxUEP4J2x 6m2RDM+oi1cYrlduABgcHIoAnPKkWvvWhElTQa+II/cqQLmIownxeLQxEnjRlZkev7W5NOabY9tZ rsq9keUhvy3hzy7mLt8k1NJPsb4Rc21Lx3Jd7HgJoHyc/GTe63pTVOWv1ONrAP8HnXv5+VCzqmwA AACWZVhJZk1NACoAAAAIAAUBEgADAAAAAQABAAABGgAFAAAAAQAAAEoBGwAFAAAAAQAAAFIBMQAC AAAAEQAAAFqHaQAEAAAAAQAAAGwAAAAAAAAASAAAAAEAAABIAAAAAUFkb2JlIEltYWdlUmVhZHkA AAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAA8oAMABAAAAAEAAAAZAAAAAAcgI+gAAAAldEVYdGRh dGU6Y3JlYXRlADIwMjQtMTItMTVUMDk6MjE6MTErMDA6MDDm9w0tAAAAJXRFWHRkYXRlOm1vZGlm eQAyMDI0LTEyLTE1VDA5OjIxOjExKzAwOjAwl6q1kQAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAy NC0xMi0xNVQwOToyMToxMSswMDowMMC/lE4AAAATdEVYdGV4aWY6Q29sb3JTcGFjZQAxLCCMM8Ni AAAAFXRFWHRleGlmOkV4aWZPZmZzZXQAMTA4LCDt5R1PAAAAGXRFWHRleGlmOlBpeGVsWERpbWVu c2lvbgA2MCwgoYmFBAAAABl0RVh0ZXhpZjpQaXhlbFlEaW1lbnNpb24AMjUsIJHbC1AAAAAedEVY dGV4aWY6U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkefmo5qwAAAASdEVYdHRpZmY6T3JpZW50YXRp b24AMber/DsAAAAQdEVYdHhtcDpDb2xvclNwYWNlADEFDsjRAAAAIHRFWHR4bXA6Q3JlYXRvclRv b2wAQWRvYmUgSW1hZ2VSZWFkeSr/T6AAAAAXdEVYdHhtcDpQaXhlbFhEaW1lbnNpb24AMjE2rgMn zQAAABZ0RVh0eG1wOlBpeGVsWURpbWVuc2lvbgAzMG6tL6oAAAAASUVORK5CYII="/></svg></span><span class=navbar-brand__name>표준프레임워크 개발가이드</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/egovframe-docs/egovframe-development/><span>개발환경(예정)</span></a></li><li class=nav-item><a class="nav-link active" href=/egovframe-docs/egovframe-runtime/><span>실행환경</span></a></li><li class=nav-item><a class=nav-link href=/egovframe-docs/runtime-example/><span>실행환경 예제</span></a></li><li class=nav-item><a class=nav-link href=/egovframe-docs/common-component/><span>공통컴포넌트(예정)</span></a></li><li class="td-light-dark-menu nav-item dropdown"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg><button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true><svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>이 섹션의 다중 페이지 출력 화면임.
<a href=# onclick="return print(),!1">여기를 클릭하여 프린트</a>.</p><p><a href=/egovframe-docs/egovframe-runtime/batch-layer/>이 페이지의 일반 화면으로 돌아가기</a>.</p></div><h1 class=title>배치처리</h1><div class=lead>배치처리 서비스는 일괄처리 업무 구현에 필요한 기능을 제공한다.</div><ul><li>1: <a href=#pg-18f0ccd9e323f4bf718392626f9a076c>배치 실행환경 소개</a></li><li>2: <a href=#pg-ece442966bd9fb3c4ecd7b9025213de5>SQLite</a></li><li>3: <a href=#pg-3c626b1dddf247ed2f2e18c28dae4233>Logback logging</a></li><li>4: <a href=#pg-8679912e9d194fa631292fcc55b6ec68>Job</a></li><li>5: <a href=#pg-e3751f570a0c5f821ee82d90224ed492>Job Variable</a></li><li>6: <a href=#pg-7a8ce7c18e131e0391d0607a5bb5b793>Step</a></li><li>7: <a href=#pg-2c41b1f67c47cfc62bdbaa7d872ae2b3>Step Variable</a></li><li>8: <a href=#pg-0776a6da1ef32176a0ff2388ca016dda>ItemReader</a></li><li>9: <a href=#pg-8a3407d56f67fc849c221e234f20b80b>ItemWriter</a></li><li>10: <a href=#pg-3af328036431b2fcd7b548486a878e73>Resource Variable</a></li><li>11: <a href=#pg-b8e9a19b32b8323ee153948d38a3df1f>JobRepository</a></li><li>12: <a href=#pg-29a6a08f13b48257f9335767d8c729da>JobLauncher</a></li><li>13: <a href=#pg-dc9b922fe13066044064e7a21ea74528>Remote JobLauncher</a></li><li>14: <a href=#pg-299b16588f2ac0fd7894a288bd065f93>JobRunner</a></li><li>15: <a href=#pg-48828303b6ab8a2371892ffd0e2ff144>JobRegistry</a></li><li>16: <a href=#pg-754065162d11a266c1e7027c08b3d5ef>JobExplorer</a></li><li>17: <a href=#pg-dd276042fb1062cb2f6b7d3ad29fd833>JobOperator</a></li><li>18: <a href=#pg-17d8961c4a279596a344e89dda9ee815>Skip/Retry/Repeat</a></li><li>19: <a href=#pg-d7bcd0fae5e2da92da9cf60093480782>MultiDataProcessing</a></li><li>20: <a href=#pg-61ca86acdf795fc6814810f50b4f8cab>History Management</a></li><li>21: <a href=#pg-a5832ac18c8d746299ce12e8ae6a0863>동기/비동기 처리 예제</a></li><li>22: <a href=#pg-b60eee4cc41f08c52da6c9715229a22f>Listener (Pre/Post Processing)</a></li><li>23: <a href=#pg-c25576b1a0f79a9148ddb8d832ef2f65>병행처리</a></li><li>24: <a href=#pg-0d607f548e75f85f6e0e212d1954df97>Code Base Exception</a></li><li>25: <a href=#pg-0efb14f7128c8774153dfc94d782f2cd>센터 컷(CenterCut)</a></li><li>26: <a href=#pg-8b1e813ee7c2ac9764ee0a1b24b8e85e>이벤트알림 템플릿 관리</a></li><li>27: <a href=#pg-391876b544fec8d10ba492f187cf383c>Flow Control</a></li></ul><div class=content><h1 id=배치-실행환경>배치 실행환경</h1><p>배치처리 서비스는 일괄처리 업무 구현에 필요한 기능을 제공한다.</p></div></div><div class=td-content><h1 id=pg-18f0ccd9e323f4bf718392626f9a076c>1 - 배치 실행환경 소개</h1><div class=lead>전자정부 표준프레임워크는 대용량 데이터 처리 지원을 위해 작업 수행, 결과 관리, 스케줄링 관리 기능을 제공한다.</div><h1 id=배치-실행환경-소개>배치 실행환경 소개</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크에서 대용량 데이터 처리 지원을 위해 작업 수행, 결과 관리, 스케줄링 관리 기능을 제공한다.</p><h2 id=목표>목표</h2><p>배치 실행환경은 대용량 데이터 처리를 위한 기반 환경을 제공함으로써 배치 실행에 필요한 핵심 기능을 제공한다.</p><h2 id=배치-실행환경-수행-과정>배치 실행환경 수행 과정</h2><p>전자정부 표준프레임워크 실행환경에 추가된 배치 실행환경은 3-Tier(Run, Job, Application Tier)로 구성되며, 대용량 데이터 처리를 위한 기반 환경을 제공한다.</p><p><img src=../images/batch_process.png alt="배치 실행환경 수행 과정"></p><h2 id=run-tier>Run Tier</h2><p>Run Tier는 배치 응용 프로그램의 실행을 담당한다. 실행 방식에 따라 <strong>Scheduler</strong>, <strong>Http/Web service</strong>, <strong>CommandLine</strong>으로 나눌 수 있다.</p><p>✔ Spring 배치에서는 Scheduler 실행을 위해 <strong>Quartz</strong>나 <strong>Cron</strong>을 이용하도록 권고하고 있다.</p><p>Run Tier에서의 동작 순서는 다음과 같다:</p><ol><li><strong>Job Configuration</strong>은 XML 형태로, Job을 수행하는 데 필요한 설정 정보를 담고 있다.</li><li><strong>Scheduler</strong>, <strong>Http/Web service</strong>, <strong>CommandLine</strong> 등의 외부 모듈이 <strong>JobRunner</strong>를 호출한다.</li><li><strong>JobRunner</strong>는 <strong>JobLocator</strong>(JobExplorer)를 통해 Job Configuration에 등록된 <strong>Application Context</strong> 정의를 참조하여, <strong>Job Tier</strong>의 <strong>JobLauncher</strong>가 Job을 실행할 수 있도록 정보를 전달한다.</li></ol><hr><h2 id=job-tier>Job Tier</h2><p>Job Tier는 전체적인 Job 수행을 책임지며, 각 Step을 지정된 상태와 정책에 따라 순차적으로 수행한다.</p><p>Job Tier에서의 동작 순서는 다음과 같다:</p><ol><li><strong>eGovJob</strong>과 <strong>eGovStep</strong>은 각각 Spring 배치의 Job과 Step을 참조한 것으로, XML 형태로 작성되어 있다.</li><li><strong>JobLauncher</strong>는 <strong>JobRunner</strong>로부터 전달받은 Job 설정 정보와 정의된 내용을 바탕으로 실제 Job을 수행한다.</li><li><strong>JobRepository</strong>는 수행되는 Job의 정보를 담고 있으며, Job 수행 단계에 따라 상태 정보를 저장한다.</li></ol><hr><h2 id=application-tier>Application Tier</h2><p>Application Tier는 Job과 Step을 수행하는 데 필요한 컴포넌트로 구성된다.</p><p>Application Tier에서의 동작 순서는 다음과 같다:</p><ol><li><strong>eGovStep</strong>은 Spring 배치의 Step을 참조한 것으로, XML 형태로 기술되어 있다. 하나의 Job은 하나 혹은 여러 Step으로 구성된다.</li><li><strong>eGovStepReader</strong> / <strong>eGovStepWriter</strong>는 Spring Batch의 <strong>ItemReader</strong> / <strong>ItemWriter</strong>를 참조한 것으로, 일반적인 Step 동작에 필수적이다.</li><li>Step은 <strong>ItemReader</strong>를 이용해 <strong>File/DB</strong>에서 데이터를 읽고, <strong>ItemProcessor</strong>로 데이터를 가공한 후, <strong>ItemWriter</strong>를 통해 가공된 데이터를 다시 <strong>File/DB</strong>로 쓴다.</li></ol><hr><h2 id=배치-실행환경-기술-요소-구성>배치 실행환경 기술 요소 구성</h2><p>전자정부 표준프레임워크 실행환경에 포함된 대용량 데이터 처리 계층은 Job 구조를 정의하는 <strong>Batch Core</strong>, Job 실행을 지원하는 <strong>Batch Support</strong>, 다양한 실행환경을 지원하는 <strong>Batch Execution</strong>으로 구성되어 있다. 배치 실행환경의 기술 요소와 기능은 다음 그림과 같다.</p><p><img src=../images/batch_layer_new2.png alt="배치 실행환경 기술요소 구성"></p><hr><h2 id=배치-실행환경-지원>배치 실행환경 지원</h2><ul><li><p><a href=./batch-core-sqllite.md>SQLite ↑</a><br><strong>SQLite</strong>를 사용한 경량화된 Repository 사용법을 설명한다.</p></li><li><p><a href=./batch-support-logback_logging.md>Logback logging ↑</a><br><strong>SQLite</strong>를 사용한 경량화된 로깅 처리의 기본 사용법을 설명한다.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ece442966bd9fb3c4ecd7b9025213de5>2 - SQLite</h1><div class=lead>SQLite를 이용한 경량화된 Repository를 사용하기 위한 사용법에 대해 설명한다.</div><h1 id=sqlite>SQLite</h1><h2 id=개요>개요</h2><p>배치 처리시 경량화된 Repository를 사용을 위한 SQLite 처리를 지원한다.</p><h2 id=설명>설명</h2><h3 id=sqlite-pomxml-설정>SQLite pom.xml 설정</h3><p>sqlite 라이브러리 사용을 위해 dependency를 추가 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.xerial<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>sqlite-jdbc<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;version&gt;</span>x.x.x<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=sqlite-사용>SQLite 사용</h3><p>SQLite 사용을 위해 데이터베이스 설정을 하고 repository 생성을 위한 기초데이터를 설정 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- SQLite database  설정 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DriverManagerDataSource&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.sqlite.JDBC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;jdbc:sqlite:repository.sqlite&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- SQLite 기초데이터 설정 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;jdbc:initialize-database</span> <span style=color:#c4a000>data-source=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;jdbc:script</span> <span style=color:#c4a000>location=</span><span style=color:#4e9a06>&#34;org/springframework/batch/core/schema-drop-sqlite.sql&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;jdbc:script</span> <span style=color:#c4a000>location=</span><span style=color:#4e9a06>&#34;org/springframework/batch/core/schema-sqlite.sql&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/jdbc:initialize-database&gt;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-3c626b1dddf247ed2f2e18c28dae4233>3 - Logback logging</h1><div class=lead>SQLite를 이용하여 경량화된 로깅 처리를 하는 기본 사용법에 대해 설명한다.</div><h1 id=logback-logging>Logback logging</h1><h2 id=개요>개요</h2><p>배치 처리시 로깅 처리를 위해 log4j2를 지원하고 있지만 경량화된 로깅 처리를 위해 Logback 로깅 처리를 지원한다</p><h2 id=설명>설명</h2><h3 id=logback-pomxml-설정>Logback pom.xml 설정</h3><p>log4j, commons-logging 관련 라이브러리를 exclusion 처리하고, Logback 라이브러리를 등록한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- log4j 관련 exclusion --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>egovframework.rte<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>egovframework.rte.bat.core<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;version&gt;</span>${egovframework.rte.version}<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;exclusions&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;exclusion&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>log4j-core<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.apache.logging.log4j<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/exclusion&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;exclusion&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>log4j-slf4j-impl<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.apache.logging.log4j<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/exclusion&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;exclusion&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>log4j-over-slf4j<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.slf4j<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/exclusion&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;exclusion&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>commons-logging<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>commons-logging<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/exclusion&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/exclusions&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- commons-logging 관련 exclusion --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;exclusion&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>commons-logging<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>commons-logging<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/exclusion&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- logback 관련 라이브러리 등록 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>ch.qos.logback<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>logback-core<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;version&gt;</span>1.1.7<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>ch.qos.logback<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>logback-classic<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;version&gt;</span>1.1.7<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.slf4j<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>jcl-over-slf4j<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>1.7.21<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=sqlite-사용>SQLite 사용</h3><p>logback 사용을 위해 logback.xml를 설정이 선행 되어야 한다.
설정관련 자세한 사항을 아래 링크 참고</p><ul><li><a href=https://logback.qos.ch/manual/introduction.html>logback</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 설정 예시 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;appender</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;STDOUT&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;ch.qos.logback.core.ConsoleAppender&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;encoder&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;pattern&gt;</span>[logback]%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span style=color:#204a87;font-weight:700>&lt;/pattern&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/encoder&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/appender&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;logger</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;java.sql&#34;</span> <span style=color:#c4a000>level=</span><span style=color:#4e9a06>&#34;DEBUG&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;logger</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;egovframework&#34;</span> <span style=color:#c4a000>level=</span><span style=color:#4e9a06>&#34;DEBUG&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;logger</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jdbc.sqltiming&#34;</span> <span style=color:#c4a000>level=</span><span style=color:#4e9a06>&#34;DEBUG&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;logger</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;org.springframework&#34;</span> <span style=color:#c4a000>level=</span><span style=color:#4e9a06>&#34;DEBUG&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;root</span> <span style=color:#c4a000>level=</span><span style=color:#4e9a06>&#34;DEBUG&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;appender-ref</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;STDOUT&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/root&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/configuration&gt;</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=https://logback.qos.ch/manual/introduction.html>logback introduction</a></li><li><a href=https://logback.qos.ch/manual/introduction>The logback manual</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8679912e9d194fa631292fcc55b6ec68>4 - Job</h1><div class=lead>Job은 배치 작업 전체를 캡슐화하는 개념으로, 여러 Step을 포함하며 배치 작업 실행을 의미한다. Job은 각 JobParameters에 따라 JobInstance를 생성하고, Job 시도마다 JobExecution을 생성하여 작업을 처리한다.</div><h1 id=job>Job</h1><h2 id=개요>개요</h2><p>Job은 배치작업 전체의 중심 개념으로 배치작업 자체를 의미한다. Job은 실제 프로세스가 진행되는 <a href=./batch-core-step.md>Step</a> 들을 최상단에서 포함하고 있으며, Job의 실행은 배치작업 전체의 실행을 의미한다.</p><h2 id=설명>설명</h2><ul><li>Job은 배치작업 과정 전체를 캡슐화하는 개념이며, 전체 계층 구조의 최상단이다.</li><li>특정 Job은 각각의 JobParameters에 따라 JobInstance를 생성하며, 한번의 Job 시도마다 JobExecution을 생성한다.</li><li>Job은 반드시 한개 이상의 Step으로 구성된다.</li></ul><p>아래 그림을 보면, &lsquo;EndOfDay&rsquo;라는 Job이 있고 &lsquo;2012/10/01&rsquo;이라는 JobParameter를 통해 JobInstance가 생성되었다. 그리고 &lsquo;EndOfDay&rsquo; Job의 첫번째 시도를 의미하는 JobExecution이 생성되는 것을 볼 수 있다.</p><p><img src=../images/job-structure.png alt=job-structure></p><p>Job 인터페이스의 기본적인 구현은 SimpleJob 클래스로 스프링 배치에서 제공된다. SimpleJob 클래스는 모든 Job에서 유용하게 사용할 수 있는 표준 기능을 갖고있다. Job은 아래와 같이 &lt;job> 태그를 사용하여 설정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;footballJob&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;playerload&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;gameLoad&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;gameLoad&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;playerSummarization&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;playerSummarization&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=jobinstance>JobInstance</h3><p>JobInstance는 논리적 Job 실행의 개념으로 JobInstance = Job + JobParameters로 표현할 수 있다.
다시 말해, JobInstance는 동일한 Job이 각기 다른 JobParameter를 통해 실행 된 Job의 실행 단위이다. (Job과 JobParameters가 같으면 동일한 JobInstance이다</p><p><img src=../images/jobinstance-jobparameter-description.png alt=jobinstance-jobparameter-description></p><p>위의 그림을 예로 설명하면 매일 한번씩 실행되는 &lsquo;EndOfDay&rsquo;라는 Job이 있다고 가정한다.
&lsquo;EndOfDay&rsquo;라는 Job은 하나지만 매일 실행되는 각각의 &lsquo;EndOfDay&rsquo; Job은 구별되어야 한다.
&lsquo;2012/10/01&rsquo;에 실행 된 &lsquo;EndOfDay&rsquo; Job과 &lsquo;2012/10/02&rsquo;에 실행 된 &lsquo;EndOfDay&rsquo; Job은 같은 Job이지만 JobInstance가 다르다.
이런 특성을 이용해 JobInstance는 Job의 Restart에 이용할 수 있다. JobInstance를 Restart하는 것은 해당 JobInstance의 정보(Execution Context)를 재사용하는 것이므로 새로운 JobInstance를 생성하지 않는다.(새로운 JobExecution이 생성된다.)</p><p>아래 표는 &lsquo;EndOfDay&rsquo;라는 하나의 Job이 JobParameter로 구별되어 각기 다른 JobInstance를 생성할 수 있음을 보여준다.</p><table><thead><tr><th>JobInstance ID</th><th>Job Name</th><th>JobParameters</th></tr></thead><tbody><tr><td>1</td><td>EndOfDay</td><td>2012/10/01</td></tr><tr><td>2</td><td>EndOfDay</td><td>2012/10/02</td></tr></tbody></table><h3 id=jobparameters>JobParameters</h3><p>JobParameters는 하나의 Job에 존재할 수 있는 여러개의 JobInstance를 구별하기 위한 Parameter 집합이며, Job을 시작하는데 사용하는 Parameter 집합이다.
또한 Job이 실행되는 동안에 Job을 식별하거나 Job에서 참조하는 데이터로 사용된다. 위의 그림(JobInstance 부분)으로 예를들면 &lsquo;EndOfDay&rsquo; Job으로 2개의 JobInstance가 생성됐다. 이 2개의 JobInstance는 각기 다른 JobParameters(&lsquo;2012/10/01&rsquo;, &lsquo;2012/10/02&rsquo;)를 통해 생성된 것이다.
아래 표에서 JobInstance는 각각의 JobParameters를 갖고 있음을 볼 수 있다.</p><table><thead><tr><th>JobInstance ID</th><th>JobParameters</th><th>Job Name</th></tr></thead><tbody><tr><td>1</td><td>2012/10/01</td><td>EndOfDay</td></tr><tr><td>2</td><td>2012/10/02</td><td>EndOfDay</td></tr></tbody></table><h4 id=jobparameter-구조>JobParameter 구조</h4><ul><li>JobParameter클래스에는 실제 parameter의 내용과 ParameterType이 존재한다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>JobParameter</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>Object</span> <span style=color:#000>parameter</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>ParameterType</span> <span style=color:#000>parameterType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>ParameterType은 enum 형태로 String, Date, Long, Double을 받아들일 수 있다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>ParameterType</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>STRING</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DATE</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>LONG</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DOUBLE</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>JobParameters는 Map 형태로 관리된다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>JobParameters</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>JobParameter</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>parameters</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>JobParameters</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parameters</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>LinkedHashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>JobParameter</span><span style=color:#ce5c00;font-weight:700>&gt;();</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>JobParameters</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>JobParameter</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>parameters</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        	<span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parameters</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>LinkedHashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>JobParameter</span><span style=color:#ce5c00;font-weight:700>&gt;(</span><span style=color:#000>parameters</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=jobparameter-생성-방법>JobParameter 생성 방법</h4><ul><li>JobParameterBuilder 클래스 사용</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>protected</span> <span style=color:#000>JobParameters</span> <span style=color:#000>getUniqueJobParameters</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>JobParametersBuilder</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#ce5c00;font-weight:700>())</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;data/iosample/input/delimited.csv&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/delimitedOutput.csv&#34;</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>DefaultJobParametersConverter 클래스 사용</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DefaultJobParametersConverter</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJobParameters</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>PropertiesConverter</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>stringToProperties</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;run.id(long)=1,parameter=true,run.date=20121001&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span></code></pre></div><h4 id=생성된-jobparameters는-xml에서-사용할-수-있다>생성된 JobParameters는 XML에서 사용할 수 있다.</h4><ul><li>ex) FlatFileItemReader<br>resource에 JobParameter에 &lsquo;inputFile&rsquo;이라는 Parameter 이름(Key 값)을 통해 입력 받을 수 있다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span> <span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[inputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                    (중략...)
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><ul><li>ex) FlatFileItemWriter<br>resource에 JobParameter에 &lsquo;outputFile&rsquo;이라는 Parameter 이름(Key 값)을 통해 입력 받을 수 있다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span> <span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[outputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                    (중략...)
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=jobexecution>JobExecution</h3><p>JobExecution은 한번의 Job 시도를 의미하는 기술적인 개념이다. JobExecution은 &lsquo;FAILED&rsquo; 또는 &lsquo;COMPLETED&rsquo;로 Job의 시도 결과를 나타낸다.
이외에, JobExecution은 주로 Job이 실행 중에 어떤 일이 일어났는지에 대한 속성들을 저장하는 저장 메커니즘 역할을 한다. (<a href=./batch-core-history_management.md>JobExecution 속성 자세히 보기</a>)<br>아래의 그림을 예로들면, &lsquo;EndOfDay&rsquo; Job은 2개의 JobInstance를 갖고 3개의 JobExecution이 존재하는 것을 볼 수 있다. JobInstance가 매일 한번 실행되는 Job을 구분하는 논리적인 개념이라면, JobExecution은 3번의 Job 시도 자체를 의미한다.
&lsquo;2012/10/02&rsquo;라는 JobParameter로 실행된 &lsquo;EndOfDay&rsquo; Job은 ID가 2인 JobInstance를 생성하게 된다. 첫번째 Job의 시도는 FAILED로 끝나게 됐고 두번째 시도는 COMPLETED로 완료하게 된다.
즉, &lsquo;2012/10/02&rsquo;에 &lsquo;EndOfDay&rsquo; Job은 총 2번의 Job 시도로 2개의 JobExecution이 생성됐다.
✔ Status가 COMPLETED 인 JobExecution을 가진 JobInstance는 restart를 할 수 없다.(해당 JobInstance는 정상적으로 배치작업을 완료)</p><p><img src=../images/jobexecution-description.png alt=jobexecution-description></p><p>아래의 표를 보면 &lsquo;EndOfDay&rsquo; Job이 각각 다른 &lsquo;2012/10/01&rsquo;, &lsquo;2012/10/02&rsquo; JobParameter로 두 번 실행결과 JobInstance는 2개가 생성 됐고, Job의 3번 시도에 따라 3개의 JobExecution이 생성된 것을 볼 수 있다.
여기서 중요한 점은 JobExecution은 매 시도마다 새로 생성되지만 JobInstance가 같은 JobExecution은 동일한 JobParameter로 시도 됐다는 점이다.</p><table><thead><tr><th>JobExecution ID</th><th>JobInstance ID</th><th>Start Time</th><th>End Time</th><th>Status</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>2012.10.01.12:00</td><td>2012.10.01.12:10</td><td>COMPLETED</td></tr><tr><td>2</td><td>2</td><td>2012.10.02.12:00</td><td>2012.10.02.12:10</td><td>FAILED</td></tr><tr><td>3</td><td>2</td><td>2012.10.02.12:30</td><td>2012.10.02.12:40</td><td>COMPLETED</td></tr></tbody></table><h3 id=job-configuration>Job Configuration</h3><p>일반적인 스프링 프로젝트에서 Job은 XML 설정 파일을 통해 표현되며, 의존성을 맺게 되고 이 설정 파일은 “Job 설정”이라 한다.</p><h4 id=job-필수-설정>Job 필수 설정</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;footballJob&#34;</span> <span style=color:#c4a000>job-repository=</span><span style=color:#4e9a06>&#34;specialRepository&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;playerload&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;gameLoad&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;gameLoad&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;playerSummarization&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;playerSummarization&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><ul><li>ID : Job의 식별자</li><li>&lt;step> : Job은 적어도 하나 이상의 Step을 정의해야 한다.</li><li>job-repository : 배치작업 중 JobExecution을 주기적으로 저장하기 위한 저장소 (default 설정은 &lsquo;jobRepository&rsquo;로 생략 가능)</li></ul><h4 id=상속을-이용한-설정>상속을 이용한 설정</h4><h5 id=parent>parent</h5><p>&lsquo;parent&rsquo; 속성은 Job을 상속하여 유사한 설정의 Job이 여러 개일 경우 유용하게 사용할 수 있다. Java에서 클래스 상속과 유사하게 자식 Job은 부모 Job의 속성들과 자신의 속성들을 결합한다. 또한 부모 Job의 속성을 오버라이드 하여 사용할 수도 있다.</p><h5 id=abstract>abstract</h5><p>Java의 Abstract 클래스와 동일한 개념으로 때로는 완전한 Job을 구성하지 않는 부모 Job의 정의가 필요할 때가 있다. &lsquo;abstract&rsquo; 속성은 Job 설정이 추상레벨인지 여부를 지정한다.</p><p>아래 예제에서 “baseJob”은 abstract 선언되었으며 자식 Job인 “job1”에서는 Job 설정의 필수요소인 &lsquo;&lt;step>&lsquo;을 정의해야 하며 &lsquo;Job1&rsquo;은 “baseJob”의 “listenerOne”도 상속받아 설정된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;baseJob&#34;</span> <span style=color:#c4a000>abstract=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;listenerOne&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;baseJob&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;standaloneStep&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners</span> <span style=color:#c4a000>merge=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;listenerTwo&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h4 id=restart-가능-여부-설정>Restart 가능 여부 설정</h4><h5 id=restartable>restartable</h5><p>Job은 완료되지 않은 JobInstance를 재시작할 수 있다. Job 설정 시, 해당 Job에 만들어진 JobInstance들의 재시작 가능 여부를 &lsquo;restartable&rsquo; 속성을 통해 설정할 수 있다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;footballJob&#34;</span> <span style=color:#c4a000>restartable=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h4 id=job-variable>Job Variable</h4><p>변수 선언 후 Listeners를 통해서 모든 Job에서 사용자 정의 변수를 사용할 수 있도록 EgovJobVariableListener를 통해서 지원한다.</p><p><a href=./batch-core-job_variable.md>job Variable 설정 자세히 보기</a></p><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/domain.html#domainJob>http://static.springsource.org/spring-batch/reference/html/domain.html#domainJob</a></li><li><a href=http://static.springsource.org/spring-batch/reference/html/configureJob.html#configuringAJob>http://static.springsource.org/spring-batch/reference/html/configureJob.html#configuringAJob</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e3751f570a0c5f821ee82d90224ed492>5 - Job Variable</h1><div class=lead>EgovJobVariableListener는 사용자 정의 변수를 선언하고 여러 Job에서 이를 공유하여 사용할 수 있도록 지원하는 기능을 제공한다. 이를 통해 모든 Job에서 공통 변수를 활용할 수 있다.</div><h1 id=job-variable>Job Variable</h1><h2 id=개요>개요</h2><p>변수 선언 후 Job Listeners를 통해서 모든 Job에서 사용자 정의 변수를 사용할 수 있도록 EgovJobVariableListener를 통해서 지원한다.<br>사용자가 변수를 정의하여 여러 job에서 해당 변수를 공유하여 사용 가능한 기능으로 이루어져있다.</p><p><img src=../images/job_variable_architecture6.png alt=job_variable_architecture6></p><h2 id=설명>설명</h2><h3 id=job-variable-설정>Job Variable 설정</h3><p>배치실행환경에서 제공하는 EgovJobVariableListener 사용하여 사용자 정의 변수를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;egovJobVariableListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.support.EgovJobVariableListener&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pros&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;props&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;JobVariableKey1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>JobVariableValue1<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;JobVariableKey2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>JobVariableValue2<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;JobVariableKey3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>JobVariableValue3<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/props&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=job-설정>job 설정</h3><p>job 설정시 listener를 사용하여 공유변수 서비스를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delimitedToDelimitedJob-JobVariable&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;eGovBaseJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;egovJobVariableListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;taskletJob&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=job에서-tasklet-선언시-step에서-job-variable-사용>job에서 tasklet 선언시 Step에서 Job Variable 사용</h3><p>setter 방식으로 공유변수 사용시 아래와 같이 응용하여 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskletJob&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.step.TaskletJob&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobVariable&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobExecutionContext[JobVariableKey1]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=setp-처리시-job-variable-사용>Setp 처리시 Job Variable 사용</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>TaskletJob</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Tasklet</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>InitializingBean</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>jobVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Value</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;#{jobExecutionContext[JobVariableKey2]}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>vJobVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getJobVariable</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>jobVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setJobVariable</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>jobVariable</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>jobVariable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>jobVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>RepeatStatus</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepContribution</span> <span style=color:#000>contribution</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>	               <span style=color:#000>ChunkContext</span> <span style=color:#000>chunkContext</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//Tasklelt 선언시 setter의해 선언된  Job Variable : jobVariable
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//annotation @Value 통해 선언된  Job Variable : vJobVariable
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//direct 접근을 통한 Job Variable 사용 : chunkContext.getStepContext().getJobExecutionContext().get(&#34;JobVariableKey3&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>RepeatStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FINISHED</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7a8ce7c18e131e0391d0607a5bb5b793>6 - Step</h1><div class=lead>Step은 Job 내에서 배치 작업을 정의하고 제어하는 독립적이고 순차적인 단계를 캡슐화하는 도메인 객체이다. 모든 Job은 최소 하나 이상의 Step으로 구성되며, 각 Step은 입력, 처리, 출력 자원 설정을 포함하여 작업을 처리한다. StepExecution은 JobExecution과 대응되며, 각 Step은 순차적으로 실행된다.</div><h1 id=step>Step</h1><h2 id=개요>개요</h2><p>Step은 Job 내부에 구성되어 실제 배치작업 수행을 위해 작업을 정의하고 제어한다. 즉, Step에서는 입력 자원을 설정하고 어떤 방법으로 어떤 과정을 통해 처리할지 그리고 어떻게 출력 자원을 만들 것인지에 대한 모든 설정을 포함한다.</p><h2 id=설명>설명</h2><p>Step은 Job의 독립적이고 순차적 단계를 캡슐화하는 도메인 객체다. 그러므로 모든 Job은 적어도 하나 이상의 Step으로 구성되며 Step에 실제 배치작업을 처리하고 제어하기 위해 필요한 모든 정보가 포함된다.
여러개의 Step 중 하나의 Step은 순차적으로 실행되는 과정 중 하나의 흐름으로 생각할 수 있다. Step에는 JobExecution에 대응되는 StepExecution이 있다.</p><p><img src=../images/step-structure.png alt=step-structure></p><h3 id=step-유형>Step 유형</h3><h4 id=bean-scope>Bean Scope</h4><p>스프링 빈 선언시 Bean Scope 기본 전략을 singleton를 사용하고 있지만, 스프링 배치에서는 step에서 Bean Scope에 대해 job, step 설정이 가능하다.</p><h5 id=step-scope>Step Scope</h5><p>scope step : 하나의 빈 정의에 대해 step 안에서 lifecycle이 유효하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;...&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;...&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span></code></pre></div><h5 id=job-scope>Job Scope</h5><p>scope job : 하나의 빈 정의에 대해 job 안에서 lifecycle이 유효하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;...&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;...&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;job&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span></code></pre></div><h4 id=chunk-기반-처리chunk-oriented-processing>Chunk 기반 처리(Chunk-Oriented Processing)</h4><p>Chunk 기반 처리는 스프링 배치에서 가장 일반적으로 사용하는 Step 유형이다. Chunk 기반 처리는 data를 한번에 하나씩 읽고, 트랜잭션 범위 내에서 &lsquo;Chunk&rsquo;를 만든 후 한번에 쓰는 방식이다.
즉, 하나의 item이 ItemReader를 통해 읽히고, Chunk 단위로 묶인 item들이 한번에 ItemWriter로 전달 되어 쓰이게 된다.</p><p>Chunk 단위로 Item 읽기 → 처리/변환 → 쓰기의 단계를 거치는 Chunk 기반 처리 매커니즘은 다음과 같다</p><p><img src=../images/chunk-oriendted-step.png alt=chunk-oriendted-step></p><p>아래 코드는 위의 그림과 같은 개념의 코드이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>List</span> <span style=color:#000>items</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Arraylist</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>commitInterval</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++){</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Object</span> <span style=color:#000>item</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>itemReader</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>read</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Object</span> <span style=color:#000>processedItem</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>itemProcessor</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>process</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>items</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>processedItem</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>itemWriter</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>write</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>items</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><ul><li>구성요소: ItemReader, ItemWriter, PlatformTransactionManager, JobRepository, (ItemProcessor는 옵션)</li><li>중요속성: commit-interval(하나의 트랜잭션당 처리 개수), startLimit(step의 실행 제한 횟수)</li></ul><h4 id=taskletstep>TaskletStep</h4><p>배치작업을 적용한 업무 환경에 따라 ItemReader와 ItemWriter를 활용한 구조가 맞지 않는 경우도 있을 것이다.
예를들어 단순히 DB의 프로시저 호출만으로 끝나는 배치처리가 있다면 단순히 메소드 하나로 기능을 구현하고 싶어질 것이다. 이런 경우를 위해 스프링 배치에서는 TaskletStep을 제공한다.
Tasklet은 RepeatStatus.FINISHED를 반환하거나 에러가 발생하기 전까지 계속 실행하는 execute() 하나의 메소드를 갖는 간단한 인터페이스로 저장 프로시저, 스크립트, 또는 간단한 SQL 업데이트 문을 호출 할 수 있다.</p><p>TaskletStep을 구성하기 위해서는 &lt;tasklet> 태그의 &lsquo;ref&rsquo;속성을 통해 Tasklet 객체를 참조해야한다. &lt;chunk> 태그는 &lt;tasklet> 내에서 사용되지 않는다.(&lt;Chunk> 태그는 Chunk-Oriented Processing에서 사용된다.)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;myTasklet&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h5 id=tasklet-의-execute-메소드를-implement해서-구현>Tasklet 의 execute() 메소드를 Implement해서 구현</h5><p>Tasklet 인터페이스를 구현한 SystemCommandTasklet 클래스를 이용해서 &ldquo;echo hello"라는 명령어를 5초 동안의 timeout시간을 두고 실행시키는 설정의 예</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;myTasklet&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;tasklet&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.sample.tasklet.SystemCommandTasklet&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;command&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;echo hello&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;timeout&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;5000&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h5 id=관련-예제>관련 예제</h5><p><a href=./batch-example-tasklet_mgmt.md>단순처리(Tasklet) 예제</a></p><h3 id=stepexecution>StepExecution</h3><p>Job의 JobExecution과 대응되는 단위로 Step 또한 StepExecution을 갖고 있다.
JobExecution과 마찬가지로 StepExecution은 Step을 수행하기 위한 단 한번의 Step 시도를 의미하며 매번 시도될 떄마다 생성된다.
또한, StepExecution은 주로 Step이 실행 중에 어떤 일이 일어났는지에 대한 속성들을 저장하는 저장 메커니즘 역할을 하며 commit count, rollback count, start time, end time 등의 Step 상태정보를 저장한다. (<a href=./batch-core-history_management.md>StepExecution 속성 자세히 보기</a>)</p><p>아래의 그림에서 &lsquo;Step1&rsquo;, &lsquo;Step2&rsquo; 2개의 Step을 갖는 &lsquo;EndOfDay&rsquo; Job이 두번 실행되었다고 가정하자.(두번 시도 결과 JobExecution은 2개 생성) &lsquo;EndOfDay&rsquo; Job을 시도할 때마다 &lsquo;Step1&rsquo;, &lsquo;Step2&rsquo;도 시도 되기때문에 StepExecution은 2개 씩 생성된다. 그래서 총 4개의 StepExecution이 생성된 것을 볼 수 있다.</p><p>✔ StepExecution 4번이 FAILED로 종료 됐으므로 StepExecution 3번, 4번을 포함한 JobExecution 2번은 FAILED로 종료한다.(Step이 모두 정상적으로 완료해야 Step으로 구성된 Job이 정상적으로 완료된다.)</p><p><img src=../images/stepexecution-description.png alt=stepexecution-description></p><p>위의 그림을 정리해보면 아래와 같다.</p><p>StepExecution ID Step Name JobExecution ID Status</p><table><thead><tr><th>StepExecution ID</th><th>Step Name</th><th>JobExecution ID</th><th>Status</th></tr></thead><tbody><tr><td>1</td><td>Step1</td><td>1</td><td>COMPLETED</td></tr><tr><td>2</td><td>Step2</td><td>1</td><td>COMPLETED</td></tr><tr><td>3</td><td>Step1</td><td>2</td><td>COMPLETED</td></tr><tr><td>4</td><td>Step2</td><td>2</td><td>FAILED</td></tr></tbody></table><h3 id=step-configuration>Step Configuration</h3><p>Step 구성은 개발자에 따라 간단하거나 아주 복잡하게 구성할 수 있다. 다만 구성을 쉽게하기 위해 스프링 배치 네임스페이스를 사용할 수 있다.</p><h4 id=chunk-기반-step-필수-설정>Chunk 기반 Step 필수 설정</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sampleJob&#34;</span> <span style=color:#c4a000>job-repository=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><ul><li>reader : 배치작업을 위해 item을 읽는 ItemReader</li><li>writer : ItemReader에 의해 읽힌 item을 쓰는 ItemWriter</li><li>transaction-manager : 스프링의 PlatformTransactionManager로 배치작업 중 트랜잭션을 시작하고 커밋하는데 사용 (default 설정은 “transactionManger”이며 생략 가능)</li><li>job-repository : 배치작업 중 StepExecution과 ExecutionContext을 주기적으로 저장하기 위한 저장소 (default 설정은 “jobRepository”이며 생략 가능)</li><li>commit-interval : 트랜잭션이 커밋되기 전 처리되어야할 item의 수</li></ul><p>✔ ItemProcessor 속성은 옵션이며 ItemProcessor가 없는 경우 reader에서 writer로 직접 전달된다.</p><h4 id=상속을-이용한-설정>상속을 이용한 설정</h4><h5 id=parent>parent</h5><p>&lsquo;parent&rsquo; 속성은 Step을 상속하여 유사한 설정의 Step이 여러 개일 경우 유용하게 사용할 수 있다. Java에서 클래스 상속과 유사하게 자식 Step은 부모 Step의 속성들과 자신의 속성들을 결합한다. 또한 부모 Step의 속성을 오버라이드 하여 사용할 수도 있다.
아래 예제에서 &ldquo;parentStep"을 상속받은 &ldquo;concreteStep1"은 &lsquo;itemReader&rsquo;, &lsquo;itemProcessor&rsquo;, &lsquo;itemWriter&rsquo;, startLimit=5, allowStartIfComplete=true로 설정되며, commit-interval은 5로 오버라이드하여 설정된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;parentStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>allow-start-if-complete=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;concreteStep1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;parentStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>start-limit=</span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h5 id=abstract>abstract</h5><p>Java의 Abstract 클래스와 동일한 개념으로 때로는 완전한 Step을 구성하지 않는 부모 Step의 정의가 필요할 때가 있다. &lsquo;abstract&rsquo; 속성은 Step 설정이 추상레벨인지 여부를 지정한다.
아래 예제에서 &ldquo;abstractParentStep"은 abstract 선언되었으며 자식 Step인 &ldquo;concreteStep2"에서는 Step 설정의 필수요소인 &lsquo;itemReader&rsquo;, &lsquo;itemWriter&rsquo;, &lsquo;commitInterval&rsquo;를 정의해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;abstractParentStep&#34;</span> <span style=color:#c4a000>abstract=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;concreteStep2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;abstractParentStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h5 id=merge>merge</h5><p>부모 Step을 상속받아 자식 Step에서 동일한 속성을 정의하는 경우 기본적으로 오버라이딩된다. 그러나 &lsquo;merge&rsquo; 속성을 이용해 자녀 Step이 부모 Step에 의해 정의 된 리스너에 추가 리스너를 추가 할 수 있다.(&lt;listeners>를 포함한 list 속성에서 사용 가능)
아래 예제에서 “concreteStep3” Step은 “listenerTwo”와 “listenerOne”를 모두 사용할 수 있다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;listenersParentStep&#34;</span> <span style=color:#c4a000>abstract=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;listenerOne&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;concreteStep3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;listenersParentStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners</span> <span style=color:#c4a000>merge=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;listenerTwo&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h4 id=restart를-위한-step-설정>Restart를 위한 Step 설정</h4><h5 id=start-limit>start-limit</h5><p>각 Step 실행 횟수를 설정한다. default는 SimpleStepFactoryBean 클래스에서 셋팅 되며 Integer.MAX_VALUE로 설정 되있다.</p><h5 id=allow-start-if-complete>allow-start-if-complete</h5><p>Job의 Restart 시, “COMPLETED”로 완료한 Step의 실행 여부를 설정한다. true로 설정 시, “COMPLETED”로 완료한 Step도 다시 실행되며 이전 시도의 결과를 오버라이드 한다. (false 설정 시, “COMPLETED”로 완료한 Step은 skip)</p><p>아래 예제에서 “step1” Step은 10번만 실행 가능하며 Job을 Restart 했을 시, 이전 시도와 관계없이 재실행 된다.있다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>allow-start-if-complete=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>start-limit=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h4 id=skipretryrepeat-설정>Skip/Retry/Repeat 설정</h4><h5 id=skip>Skip</h5><p><a href=./batch-core-skip_repeat_retry.md>Skip 설정 자세히 보기</a></p><h5 id=retry>Retry</h5><p><a href=./batch-core-skip-repeat-retry.md>Retry 설정 자세히 보기</a></p><h4 id=step-흐름제어>Step 흐름제어</h4><p><a href=./batch-core-flow_control.md>Step 흐름제어(Flow Control) 자세히 보기</a></p><h4 id=step-흐름제어-1>Step 흐름제어</h4><p>변수 선언 후 Listeners를 통해서 모든 Setp에서 사용자 정의 변수를 사용할 수 있도록 EgovStepVariableListener를 통해서 지원한다.</p><p><a href=./batch-core-step_variable.md>Step Variable 설정 자세히 보기</a></p><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/domain.html#domainStep>http://static.springsource.org/spring-batch/reference/html/domain.html#domainStep</a></li><li><a href=http://static.springsource.org/spring-batch/reference/html/configureStep.html>http://static.springsource.org/spring-batch/reference/html/configureStep.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-2c41b1f67c47cfc62bdbaa7d872ae2b3>7 - Step Variable</h1><div class=lead>EgovStepVariableListener를 통해 변수를 선언하고 여러 Step에서 사용자 정의 변수를 공유하여 사용할 수 있는 기능을 지원한다. 이를 통해 배치 실행 중 여러 Step에서 변수를 공유하며 사용할 수 있다.</div><h1 id=step-variable>Step Variable</h1><h2 id=개요>개요</h2><p>변수 선언 후 Listeners를 통해서 모든 Setp에서 사용자 정의 변수를 사용할 수 있도록 EgovStepVariableListener를 통해서 지원한다.
사용자가 변수를 정의하여 여러 step에서 해당 변수를 공유하여 사용 가능한 기능으로 이루어져있다.</p><p><img src=../images/step-variable-architecture6.png alt=step-variable-architecture6></p><h2 id=설명>설명</h2><h3 id=step-variable-설정>Step Variable 설정</h3><p>배치실행환경에서 제공하는 EgovJobVariableListener 사용하여 사용자 정의 변수를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;egovStepVariableListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.support.EgovStepVariableListener&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pros&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;props&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;StepVariableKey1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>StepVariableValue1<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;StepVariableKey2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>StepVariableValue2<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;StepVariableKey3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>StepVariableValue3<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/props&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=job-step-설정>job, step 설정</h3><p>step 설정시 listener를 사용하여 공유변수 서비스를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delimitedToDelimitedJob-StepVariable&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;eGovBaseJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;taskletStep&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;egovStepVariableListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=step에서-tasklet-선언시-step-variable-사용>step에서 tasklet 선언시 Step Variable 사용</h3><p>setter 방식으로 공유변수 사용시 아래와 같이 응용하여 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskletStep&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.step.TaskletStep&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;stepVariable&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{stepExecutionContext[StepVariableKey1]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=setp-처리시-step-variable-사용>Setp 처리시 Step Variable 사용</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>TaskletStep</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Tasklet</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>InitializingBean</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>stepVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Value</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;#{stepExecutionContext[StepVariableKey2]}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>		
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>vStepVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getStepVariable</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>stepVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setStepVariable</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>stepVariable</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>stepVariable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stepVariable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>RepeatStatus</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepContribution</span> <span style=color:#000>contribution</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>	               <span style=color:#000>ChunkContext</span> <span style=color:#000>chunkContext</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//Tasklelt 선언시 setter의해 선언된  Step Variable : stepVariable
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//annotation @Value 통해 선언된  Step Variable : vStepVariable
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//direct 접근을 통한 Step Variable 사용 : chunkContext.getStepContext().getStepExecutionContext().get(&#34;StepVariableKey3&#34;)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>RepeatStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FINISHED</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0776a6da1ef32176a0ff2388ca016dda>8 - ItemReader</h1><div class=lead>ItemReader는 다양한 데이터 타입(플랫 파일, XML, 데이터베이스)을 처리하며, 데이터를 한 항목씩 읽고 모두 소진되면 Null을 반환하는 인터페이스이다. 플랫 파일, XML, 데이터베이스 각각에 맞는 방식으로 데이터를 읽고 처리할 수 있도록 지원한다.</div><h1 id=itemreader>ItemReader</h1><h2 id=개요>개요</h2><p>ItemReader는 읽기 대상의 타입에 관계없이 한번에 한 항목을 읽으며 읽을 항목이 모두 소진되면 Null을 반환하는 인터페이스이다.</p><h2 id=설명>설명</h2><p>ItemReader는 여러 종류의 데이터 타입을 입력 받을 수 있다. 가장 일반적인 데이터 타입으로 플랫 파일, <acronym title="Extensible Markup Language">XML</acronym>, 데이터베이스가 있다.</p><ul><li>플랫 파일 : 플랫 파일 ItemReader는 일반적으로 고정 위치로 정의된 데이터 필드나 특수 문자에 의해 구별된 데이터의 행을 읽는다.</li><li>XML : XML ItemReader는 파싱, 매핑, 유효성 검증을 XML에서 독립적으로 작업할 수 있도록 처리해준다. 입력 데이터는 <acronym title="XML (Extensible Markup Language) Schema Definition">XSD</acronym> 스키마에 대해 XML 파일의 유효성 검증이 가능하다.</li><li>데이터베이스 : 데이터베이스 ItemReader는 데이터베이스 리소스에 객체로 맵핑 될 수 있는 resultset으로 반환하여 접근한다. 기본 <acronym title="Structured Query Language">SQL</acronym> ItemReaders는 객체를 반환하는 RowMapper를 호출한다.</li></ul><p>기본적인 ItemReader 인터페이스는 아래와 같다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>T</span> <span style=color:#000>read</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>UnexpectedInputException</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ParseException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>read() 메소드는 ItemReader의 필수적인 메소드이며 결과값으로 하나의 item을 반환하고 더이상 반환할 item이 없을 경우 null을 반환한다.
item은 플랫 파일에서의 한 라인, 데이터베이스에서의 한 행, <acronym title="Extensible Markup Language">XML</acronym> 파일에서의 엘리먼트를 나타낸다.</p><h3 id=flatfile-itemreader>FlatFile ItemReader</h3><p>플랫파일은 2차원 데이터를 포함하는 유형의 파일이다. 스프링 배치 프레임워크에서는 플랫파일을 읽고 파싱하는 기본적인 기능을 제공하는 FlatFileItemReader 클래스를 통해 플랫파일에 대한 읽기 처리를 한다.</p><h4 id=flatfileitemreader>FlatFileItemReader</h4><p>FlatFileItemReader는 Resource, LineMapper, FieldSetMapper, LineTokenizer에 기본적으로 의존성을 갖으며, LineTokenizer에 따라 구분자(Delimited)와 고정길이(Fixed Length) 방식으로 FlatFileItemReader를 사용할 수 있다.</p><p><img src=../images/flatfileitemreader_process.png alt=image></p><table><thead><tr><th>구분</th><th>데이터 형태</th><th>설명</th></tr></thead><tbody><tr><td>LineMapper</td><td>플랫파일 1 라인(String) → Object</td><td>플랫파일 데이터에서 읽은 1 라인(String)을 Object로 변환하는 총 과정(LineTokenizer, FieldSetMapper 과정을 포함한다.)</td></tr><tr><td>LineTokenizer</td><td>String → Tokens → FieldSet</td><td>플랫파일에서 읽은 1 라인(String)을 구분자 방식 또는 고정길이 방식으로 토크나이징 한 후 FieldSet 형태로 변환하는 과정<br>- <strong>DelimitedLineTokenizer (구분자)</strong> : 1 라인의 String을 구분자 기준으로 나누어 토큰화 하는 방식<br>- <strong>EgovEscapableDelimitedLineTokenizer</strong> : Escape 문자를 사용하여 Delimiter(구분자) 문자를 문자열에 추가할 수 있는 방식 (예: 1”,000원 → 1,000원 으로 인식)<br>- <strong>FixedLengthTokenizer (고정길이)</strong> : 1 라인의 String을 사용자가 설정한 고정길이 기준으로 나누어 토큰화 하는 방식</td></tr><tr><td>FieldSetMapper</td><td>FieldSet → Object</td><td>FieldSet 형태의 데이터를 원하는 Object로 변환하는 과정</td></tr></tbody></table><p>아래 Delimited(구분자), Fixed Length(고정길이) 방식으로 설정한 FlatFileItemReader의 예시를 통해 FlatFileItemReader, LineMapper, LineTokenizer, FieldSetMapper의 의존 관계를 볼 수 있다.</p><table class=inline><tbody><tr class=row0><th class="col0 centeralign">Tokenizing 방식</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>Delimited (구분자)</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
	<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
	<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.DefaultLineMapper"</span><span class=re2>&gt;</span></span>
			<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
				<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.DelimitedLineTokenizer"</span><span class=re2>&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span><span class=re2>/&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
				<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldSetMapper"</span><span class=re2>&gt;</span></span>
				<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper"</span><span class=re2>&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"targetType"</span> <span class=re0>value</span>=<span class=st0>"org.springframework.batch.CustomerCredit"</span> <span class=re2>/&gt;</span></span>	
				<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
		<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class="col0 centeralign">Tokenizing 방식</th><th class="col1 centeralign">설정</th></tr><tr class=row3><th class=col0>EscapableDelimited</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;</span><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"delimitedToDelimitedJob-EscapeCharacter-delimitedItemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>		
	<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
	<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.rte.bat.core.item.file.mapping.EgovDefaultLineMapper"</span><span class=re2>&gt;</span></span>
			<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
			<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.rte.bat.core.item.file.transform.EgovEscapableDelimitedLineTokenizer"</span><span class=re2>&gt;</span></span>
				<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span> <span class=re2>/&gt;</span></span>
				<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"escape"</span> <span class=re0>value</span>=<span class=st0>"true"</span> <span class=re2>/&gt;</span></span>
				<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"quoteCharacter"</span> <span class=re0>value</span>=<span class=st0>"&amp;quot;"</span> <span class=re2>/&gt;</span></span>						
			<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"objectMapper"</span><span class=re2>&gt;</span></span>
				<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.rte.bat.core.item.file.mapping.EgovObjectMapper"</span><span class=re2>&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"type"</span> <span class=re0>value</span>=<span class=st0>"egovframework.example.bat.domain.trade.CustomerCreditMore"</span> <span class=re2>/&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"id,name,credit,serial,tax,amount,createDate,changeDate"</span> <span class=re2>/&gt;</span></span>
				<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
		<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row4><th class=col0>Fixed Length (고정길이)</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
	<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
	<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.DefaultLineMapper"</span><span class=re2>&gt;</span></span>
			<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
				<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.FixedLengthTokenizer"</span><span class=re2>&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"columns"</span> <span class=re0>value</span>=<span class=st0>"1-9,10-11"</span> <span class=re2>/&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
				<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldSetMapper"</span><span class=re2>&gt;</span></span>
				<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper"</span><span class=re2>&gt;</span></span>
					<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"targetType"</span> <span class=re0>value</span>=<span class=st0>"org.springframework.batch.CustomerCredit"</span> <span class=re2>/&gt;</span></span>	
				<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
			<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
		<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><p>LineTokenizer와 FieldSetMapper에 아래와 같은 항목을 설정해야한다.</p><table><thead><tr><th>설정항목</th><th>내용</th></tr></thead><tbody><tr><td>targetType</td><td>VO 클래스를 나타낸다.</td></tr><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.<br><br></td></tr></tbody></table><p>✔ 사용하는 LineTokenizer에 따라 설정항목이 다르므로 주의하여 설정해야 한다.</p><table><thead><tr><th>LineTokenizer</th><th>설정항목</th><th>설명</th><th>설정 예</th></tr></thead><tbody><tr><td>DelimitedLineTokenizer</td><td>delimiter</td><td>토크나이징 할 때 기준이 되는 구분자 설정</td><td>,</td></tr><tr><td>EgovEscapableDelimitedLineTokenizer</td><td>delimiter</td><td>토크나이징 할 때 기준이 되는 구분자 설정</td><td>,</td></tr><tr><td></td><td>escape</td><td>Escape 문자 사용 설정</td><td>true 또는 false</td></tr><tr><td></td><td>quoteCharacter</td><td>사용 할 Escape 문자 설정</td><td>쌍따움표(”, ")<br>XML escape문자로 인하여 쌍따움표는 " 표시</td></tr><tr><td>FixedLengthTokenizer</td><td>columns</td><td>토크나이징 할 때 기준이 되는 고정길이 설정</td><td>1-9,10-11</td></tr></tbody></table><h3 id=xml-itemreader>XML ItemReader</h3><p>스프링 배치는 XML 레코드를 읽고 자바 객체로 매핑하는 작업에 대해 트랜잭션 인프라스트럭쳐를 제공한다.
스프링 배치에서 XML 입력과 출력이 어떻게 작동되는지 더 살펴보면 첫째로 파일 읽기 및 쓰기에 따라 차이가 있지만 스프링 배치 XML 처리 과정은 공통화 돼있다. XML 처리 과정에서 토크나이징이 필요한 레코드(FieldSets) 라인 대신 개별 레코드와 대응되는 &lsquo;fragments&rsquo;의 콜렉션으로 가정하고 있다.</p><p><img src=../images/xml_input.png alt=image></p><p>위의 시나리오에서 &rsquo;trade&rsquo; 태그는 &lsquo;루트 엘리먼트&rsquo;로 정의 되었다. &lsquo;&lt;trade>&lsquo;와 &lsquo;&lt;/trade>&rsquo; 사이의 모든 내용은 하나의 fragment로 여겨진다. 스프링 배치는 fragment를 객체로 바인드 하는데 Object/XML Mapping (OXM)을 사용한다. 하지만 스프링 배치는 특정 XML 바인딩 기술에 묶여있지 않다. 대표적인 사용방법은 가장 대중적인 OXM 기술에 대한 일관된 추상화를 제공하는 스프링 OXM에 위임하는 방법이다. 스프링 OXM에 대한 의존성은 선택적이며 만일 필요하다면 스프링 배치에서 특정 인터페이스를 구현하도록 선택할 수 있다. XML 지원 관련 기술 관계는 아래 그림과 같다.</p><p><img src=../images/xml_oxm.png alt=image></p><h4 id=staxeventitemreader>StaxEventItemReader</h4><p>StaxEventItemReader 설정은 XML 입력 스트림에서 레코드의 처리를 위한 전형적인 설정을 제공한다. 먼저, StaxEventItemReader가 처리할 수 있는 XML 레코드 집합을 검토해보자.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;records&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;trade</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://springframework.org/batch/sample/io/oxm/domain&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;isin&gt;</span>XYZ0001<span style=color:#204a87;font-weight:700>&lt;/isin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;quantity&gt;</span>5<span style=color:#204a87;font-weight:700>&lt;/quantity&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;price&gt;</span>11.39<span style=color:#204a87;font-weight:700>&lt;/price&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;customer&gt;</span>Customer1<span style=color:#204a87;font-weight:700>&lt;/customer&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/trade&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;trade</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://springframework.org/batch/sample/io/oxm/domain&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;isin&gt;</span>XYZ0002<span style=color:#204a87;font-weight:700>&lt;/isin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;quantity&gt;</span>2<span style=color:#204a87;font-weight:700>&lt;/quantity&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;price&gt;</span>72.99<span style=color:#204a87;font-weight:700>&lt;/price&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;customer&gt;</span>Customer2c<span style=color:#204a87;font-weight:700>&lt;/customer&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/trade&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;trade</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://springframework.org/batch/sample/io/oxm/domain&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;isin&gt;</span>XYZ0003<span style=color:#204a87;font-weight:700>&lt;/isin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;quantity&gt;</span>9<span style=color:#204a87;font-weight:700>&lt;/quantity&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;price&gt;</span>99.99<span style=color:#204a87;font-weight:700>&lt;/price&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;customer&gt;</span>Customer3<span style=color:#204a87;font-weight:700>&lt;/customer&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/trade&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/records&gt;</span>
</span></span></code></pre></div><p>XML 레코드를 처리하기 위해서는 다음 사항이 필요하다.</p><ul><li>루트 엘리먼트 명 : 매핑되는 객체를 구성하는 fragment의 루트 엘리먼트 명. 위의 예에서는 trade가 루트 엘리먼트 명이다.</li><li>Resource : 읽어들일 데이터의 위치를 지정(파일이나 URL 등)</li><li>FragmentDeserializer : XML fragment를 객체로 매핑하는 스프링 OXM에 의해 제공된 언마샬링 기능</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.xml.StaxEventItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fragmentRootElementName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;trade&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;data/iosample/input/input.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;unmarshaller&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;tradeMarshaller&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>아래 예제에서는 XStreamMarshaller를 사용한다. XStreamMarshaller는 fragment 명과 객체 타입을 바인드 해주기 위해 사용하는 별칭을 키와 값을 포함하는 맵으로 건내주도록 했다. 그 다음 FieldSet과 비슷하게 맵에 엘리먼트 이름과 타입이 키/값 쌍으로 들어가게 된다. 다음처럼 설정 파일에서 필요한 별칭을 기술하는데 스프링 설정 유틸리티를 사용할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;tradeMarshaller&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.oxm.xstream.XStreamMarshaller&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;aliases&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;util:map</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;aliases&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;trade&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.springframework.batch.sample.domain.Trade&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;price&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;java.math.BigDecimal&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;java.lang.String&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/util:map&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>입력 리더는 (기본적으로 태그 이름의 일치에 의해서) 새로운 프레그먼트가 시작하는 것을 인식할 때까지 XML 자원을 읽어 들인다. 리더는 프레그먼트에서 독립적으로 작동하는 XML 문서를 생성하고, XML을 자바 객체로 매핑하기 위해 deserializer에게 이 문서를 전달한다. 정리해보면,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>StaxEventItemReader</span> <span style=color:#000>xmlStaxEventItemReader</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StaxEventItemReader</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>Resource</span> <span style=color:#000>resource</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ByteArrayResource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>xmlResource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getBytes</span><span style=color:#ce5c00;font-weight:700>())</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#000>Map</span> <span style=color:#000>aliases</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>aliases</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;trade&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;org.springframework.batch.sample.domain.Trade&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>aliases</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;price&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;java.math.BigDecimal&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>aliases</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;customer&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;java.lang.String&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>Marshaller</span> <span style=color:#000>marshaller</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>XStreamMarshaller</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>marshaller</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setAliases</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>aliases</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>xmlStaxEventItemReader</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setUnmarshaller</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>marshaller</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>xmlStaxEventItemReader</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setResource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>xmlStaxEventItemReader</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setFragmentRootElementName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;trade&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>xmlStaxEventItemReader</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>open</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasNext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#000>CustomerCredit</span> <span style=color:#000>credit</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>hasNext</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>credit</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>xmlStaxEventItemReader</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>read</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>credit</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>hasNext</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>credit</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=database-itemreader>Database ItemReader</h3><p>대부분의 엔터프라이즈 애플리케이션처럼 데이터베이스는 배치 저장 메카니즘의 중심이 된다. 그러나 배치는 다른 애플리케이션 스타일과는 다르다. 만일 SQL 문이 백만 행을 반환하는 경우에 결과 집합은 모든 행을 읽을 때까지 메모리에 모든 결과를 보유한다. 스프링 배치는 이 문제를 해결하기 위해 Cursor와 Paging 데이터베이스 ItemReader를 제공한다.</p><h4 id=커서cursor-기반-itemreader>커서(Cursor) 기반 ItemReader</h4><p>커서 방식을 이용한 데이터베이스 접근 방식은 가장 기본적인 방식이다. 왜냐하면 &lsquo;streaming&rsquo; 관계형 데이터의 문제에 대한 해결책이기 때문이다.
Java의 ResultSet 클래스는 커서를 다루는 객체 지향 메커니즘의 필수적인 클래스이다. ResultSet은 데이터의 현재 행에 커서를 유지하며 다음 데이터를 호출하면 다음 행으로 커서를 이동한다.
스프링 배치에서 커서는 커서를 초기화해서 열어주는 ItemReader에 기반하며, read가 호출될 떄마다 커서를 다음 행으로 이동시키며 처리 과정 중에 사용되는 맵핑된 객체를 반환한다.</p><p>아래 그림의 예제는 커서 기반의 ItemReader의 작동을 보여준다.
&lsquo;FOO&rsquo; 테이블은 ID, NAME, BAR 세 개의 컬럼을 갖는다. SQL문을 통해 ID가 1보다 크고 7보다 작은 행의 결과를 조회한다. 커서는 ID 2에서 시작하며 read()가 호출될 떄마다 FOO 객체로 맵핑되고 커서는 다음 행으로 이동한다.</p><p><img src=../images/db_cursoritemreader.png alt=image></p><h5 id=jdbccursoritemreader>JdbcCursorItemReader</h5><p>JdbcCursorItemReader는 커서 기반 기술의 JDBC를 구현한 ItemReader이다. 아래의 JdbcCursorItemReader의 설정 예시를 보면 굉장히 쉽게할 수 있음을 알 수 있다.
dataSouce 속성으로 DB connection을 넣어올 수 있는 datasource를 지정하고, sql 속성에 실행할 쿼리, rowMapper 속성에 ResultSet에서 객체를 매핑하는 클래스로 RowMapper 인터페이스를 구현한 클래스가 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.JdbcCursorItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;select ID, NAME, CREDIT from CUSTOMER&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;rowMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.domain.trade.CustomerCreditRowMapper&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=페이징paging-기반-itemreader>페이징(Paging) 기반 ItemReader</h4><p>데이터베이스 커서를 사용하는 대신 여러번 쿼리를 실행할 수 있는데 실행되는 각 쿼리는 정해진 크기인 페이지만큼의 결과를 가져오게 된다.
실행되는 각 쿼리는 시작 행 번호를 지정하고 페이지에 반환시키고자 하는 행의 수를 지정한 후 사용한다.</p><h5 id=jdbcpagingitemreader>JdbcPagingItemReader</h5><p>페이징 ItemReader의 구현체 중 하나인 JdbcPagingItemReader는 페이지를 형성하는 행을 반환하는데 사용하는 SQL 쿼리를 제공할 책임을 지고 있는 PagingQueryProvider 인터페이스가 필요하다.
데이터베이스 유형 별로 지원하는 OraclePagingQueryProvider, HsqlPagingQueryProvider, MySqlPagingQueryProvider ,SqlServerPagingQueryProvider,SybasePagingQueryProvider 등의 구현를 사용하지만 데이터베이스를 자동으로 식별해주고 적절한 PagingQueryProvider 구현체를 적용해주는데 사용하는 SqlPagingQueryProviderFactoryBean이 있다.
SqlPagingQueryProviderFactoryBean는 환경 설정을 간단히 해주며 추천하는 구현체이다.</p><p>아래 예제는 위의 JdbcCursorItemReader 설정과 동일한 설정이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.JdbcPagingItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;queryProvider&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.support.SqlPagingQueryProviderFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;selectClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;select id, name, credit&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fromClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;from customer&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;whereClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;where status=:status&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sortKey&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;parameterValues&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;map&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;status&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;NEW&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/map&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pageSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;1000&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;rowMapper&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;customerMapper&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h5 id=ibatispagingitemreader>IbatisPagingItemReader</h5><p>iBatis를 사용해 데이터에 접근하는 경우 페이징 ItemReader를 구현한 IbatisPagingItemReader를 사용할 수 있다.
iBatis는 페이지의 행을 읽을 수 있는 직접적인 지원은 하지 않지만 여러 표준화된 변수를 이용해여 쿼리를 추가할 수 있다.</p><p>아래 설정은 위에서 설명한 JdbcCursorItemReader, JdbcCursorItemReader 설정과 같은 설정을 보여준다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.IbatisPagingItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;queryId&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;getPagedCustomerCredits&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pageSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;1000&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>위의 IbatisPagingItemReader 설정에서 사용한 queryId 속성의 “getPagedCustomerCredits”의 구성은 아래와 같다.
ex) MySQL</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;getPagedCustomerCredits&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;customerCreditResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   select id, name, credit from customer order by id asc LIMIT #_skiprows#, #_pagesize#
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id=전자정부에서-제공하는-egovflatfileitemreader>전자정부에서 제공하는 eGovFlatFileItemReader</h3><p>스프링 배치에서 제공하는 파일 기반 관련설정을 사용할 경우, 대용량 데이터 처리 시간이 상용 배치프레임워크 대비 성능이 떨어졌다.
이 문제를 해결하기 위해서 전자정부에서는 파일 ItemReader의 요소 중 성능저하 요인인 LineMapper 부분을 개선하여 제공한다.</p><p>아래 그림을 보면 전자정부에서는 FieldSet을 사용하지 않는다. 따라서 Tokens → FieldSet으로 변환하는 과정이 없다.
전자정부에서 제공하는 EgovDefaultLineMapper, EgovLineTokenizer, EgovObjectMapper를 사용하는 경우 Tokens 상태에서 Object로 직접 맵핑된다.</p><table><thead><tr><th>스프링 FlatFileItemReader 구조</th><th>전자정부 eGovFlatFileItemReader 구조</th></tr></thead><tbody><tr><td><img src=../images/flatfileitemreader_process_except_legend.png alt=image></td><td><img src=../images/egovflatfileitemreader_process.png alt=image></td></tr></tbody></table><table><thead><tr><th>개선사항</th><th>설명</th></tr></thead><tbody><tr><td>EgovDefaultLineMapper</td><td>EgovLineTokenizer와 EgovObjectMapper가 변경됨에 따라 LineMapper 총 과정을 제어하는 DefaultLineMapper를 변경하여 EgovDefaultLineMapper 제공</td></tr><tr><td>EgovLineTokenizer</td><td>전자정부에서는 FieldSet을 사용하지 않기때문에 FieldSet을 반환하는 LineTokenizer 인터페이스를 변경하여 EgovLineTokenizer 제공</td></tr><tr><td>EgovAbstractLineTokenizer</td><td>LineTokenizer 인터페이스가 EgovLineTokenizer로 변경됨에 따라 토크나이징만 관여하는 추상 클래스 EgovAbstractLineTokenizer 제공</td></tr><tr><td>EgovDelimitedLineTokenizer</td><td>스프링에서 제공하는 DelimitedLineTokenizer의 성능을 개선한 EgovDelimitedLineTokenizer 제공</td></tr><tr><td>EgovObjectMapper</td><td>전자정부에서는 FieldSet을 사용하지 않고 토크나이징 된 값들을 직접 Object에 맵핑하는 EgovObjectMapper를 제공</td></tr></tbody></table><p>아래의 XML 설정은 스프링에서 제공하는 DefaultLineMapper를 적용한 FlatFileItemReader와 전자정부에서 제공하는 EgovDefaultLineMapper를 적용한 FlatFileItemReader 설정 비교이다.</p><p><strong>✔ 주의!</strong> EgovDefaultLineMapper 사용 시, 반드시 EgovTokenizer(EgovFixedLengthTokenizer, EgovByteLengthTokenizer, EgovDelimitedTokenizer)와 EgovObjectMapper를 사용해야 한다.</p><p><strong>✔ 주의!</strong> EgovObjectMapper 사용 시, VO 필드 타입은 String, int, double, float, long, char, boolean, short, BigDecimal로 제한된다.</p><p><strong>✔ 주의!</strong> 스프링의 DefaultLineMapper 사용 시, Tokenizer에서 &rsquo;names&rsquo; 속성을 설정하지만 전자정부의 EgovDefaultLineMapper 사용 시, <strong>EgovObjectMapper</strong>에서 <strong>&rsquo;names&rsquo; 속성을 설정한다.</strong></p><h4 id=egovobjectmapper-설정항목>EgovObjectMapper 설정항목</h4><h5 id=delimited구분자-방식-설정>Delimited(구분자) 방식 설정</h5><p>읽어들인 문자열에서 구분자를 경계값으로 사용하여 필드를 분리한다.</p><table class=inline><tbody><tr class=row0><th class="col0 centeralign">구분</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>스프링 FlatFileItemReader</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
        <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.DefaultLineMapper"</span><span class=re2>&gt;</span></span>
	     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
		  <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.DelimitedLineTokenizer"</span><span class=re2>&gt;</span></span>
		       <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span><span class=re2>/&gt;</span></span>
		       <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
		  <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	     <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldSetMapper"</span><span class=re2>&gt;</span></span>
		  <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper"</span><span class=re2>&gt;</span></span>
		       <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"targetType"</span> <span class=re0>value</span>=<span class=st0>"egovframework.brte.sample.domain.trade.CustomerCredit"</span> <span class=re2>/&gt;</span></span>	
		  <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	     <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class=col0>전자정부 EgovFlatFileItemReader</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
          <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.mapping.EgovDefaultLineMapper"</span><span class=re2>&gt;</span></span>
              <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
                  <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.transform.EgovDelimitedLineTokenizer"</span><span class=re2>&gt;</span></span>
                      <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span><span class=re2>/&gt;</span></span>
                  <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
              <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
              <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"objectMapper"</span><span class=re2>&gt;</span></span>
                  <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.mapping.EgovObjectMapper"</span><span class=re2>&gt;</span></span>
                      <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"type"</span> <span class=re0>value</span>=<span class=st0>"egovframework.brte.sample.domain.trade.CustomerCredit"</span> <span class=re2>/&gt;</span></span>
                      <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
                  <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
              <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>        
          <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
     <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span> 
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><table><thead><tr><th>EgovFlatFileItemReader 설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>delimiter</td><td>필드의 경계를 구별해주는 문자를 나타낸다.</td><td>, (콤마)</td></tr><tr><td>type</td><td>VO 클래스를 나타낸다.</td><td>org.springframework.batch.CustomerCredit</td></tr><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.</td><td>name,credit</td></tr></tbody></table><h5 id=fixed-length고정길이-방식-설정>Fixed Length(고정길이) 방식 설정</h5><p>읽어들인 문자열에서 필드의 경계를 파일 내의 문자열 길이로 판단하여, 필드를 분리한다.</p><table class=inline><tbody><tr class=row0><th class="col0 centeralign">구분</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>스프링 FlatFileItemReader</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
        <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.DefaultLineMapper"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
		 <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.FixedLengthTokenizer"</span><span class=re2>&gt;</span></span>
		     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"columns"</span> <span class=re0>value</span>=<span class=st0>"1-9,10-11"</span> <span class=re2>/&gt;</span></span>
		     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
		 <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldSetMapper"</span><span class=re2>&gt;</span></span>
		 <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper"</span><span class=re2>&gt;</span></span>
		     <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"targetType"</span> <span class=re0>value</span>=<span class=st0>"egovframework.brte.sample.domain.trade.CustomerCredit"</span> <span class=re2>/&gt;</span></span>	
		 <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class=col0>전자정부 EgovFlatFileItemReader</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
        <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.mapping.EgovDefaultLineMapper"</span><span class=re2>&gt;</span></span>
            <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
                <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.transform.EgovFixedLengthTokenizer"</span><span class=re2>&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"columns"</span> <span class=re0>value</span>=<span class=st0>"1-9,10-11"</span> <span class=re2>/&gt;</span></span>
                <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
            <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
            <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"objectMapper"</span><span class=re2>&gt;</span></span>
                <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.mapping.EgovObjectMapper"</span><span class=re2>&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"type"</span> <span class=re0>value</span>=<span class=st0>"egovframework.brte.sample.domain.trade.CustomerCredit"</span> <span class=re2>/&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
                <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
            <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>        
        <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>      
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><table><thead><tr><th>EgovFlatFileItemReader 설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>column</td><td>필드 경계의 범위를 나타낸다.</td><td>1-9,10-11</td></tr><tr><td>type</td><td>VO 클래스를 나타낸다.</td><td>org.springframework.batch.CustomerCredit</td></tr><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.</td><td>name,credit</td></tr></tbody></table><h5 id=bytelength-방식-설정>ByteLength 방식 설정</h5><p>전자정부에서는 EgovFixedByteLengthTokenizer를 추가적으로 제공한다.
EgovFixedByteLengthTokenizer는 기본적으로 FixedLengthTokenizer와 유사하나, byte 문자열을 기준으로 필드의 경계값을 구해 필드를 분리한다.</p><table class=inline><tbody><tr class=row0><th class="col0 centeralign">구분</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>전자정부 EgovFlatFileItemReader</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemReader"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemReader"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[inputFile]}"</span> <span class=re2>/&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineMapper"</span><span class=re2>&gt;</span></span>
        <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.mapping.EgovDefaultLineMapper"</span><span class=re2>&gt;</span></span>
            <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineTokenizer"</span><span class=re2>&gt;</span></span>
                <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.transform.EgovFixedByteLengthTokenizer"</span><span class=re2>&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"byteEncoding"</span> <span class=re0>value</span>=<span class=st0>"utf-8"</span><span class=re2>/&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"columns"</span> <span class=re0>value</span>=<span class=st0>"1-9,10-11"</span> <span class=re2>/&gt;</span></span>
                <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
            <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
            <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"objectMapper"</span><span class=re2>&gt;</span></span>
                <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.file.mapping.EgovObjectMapper"</span><span class=re2>&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"type"</span> <span class=re0>value</span>=<span class=st0>"egovframework.brte.sample.domain.trade.CustomerCredit"</span> <span class=re2>/&gt;</span></span>
                    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
                <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
            <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>        
        <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>      
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><table><thead><tr><th>EgovFlatFileItemReader 설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>column</td><td>필드 경계의 길이를 나타낸다.</td><td>1-9,10-11</td></tr><tr><td>byteEncoding</td><td>byte 문자열의 인코딩 타입을 나타낸다.</td><td>utf-8</td></tr><tr><td>type</td><td>VO 클래스를 나타낸다.</td><td>org.springframework.batch.CustomerCredit</td></tr><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.</td><td>name,credit</td></tr></tbody></table><h3 id=전자정부에서-제공하는-egovindexfilereader>전자정부에서 제공하는 eGovIndexFileReader</h3><p>배치 Job 정의 시 Resource 엘리먼트의 shell step에 shell script에 포함된 파일명에서 일련번호(index)를 사용할 수 있는 Reader를 제공한다.</p><p>Index 파일명을 사용하면 파일의 일련번호를 기준으로 동적인 파일명 생성이 가능하다.</p><p>Index(NDX) 파일명 치환 로직</p><pre tabindex=0><code>NDX File : 파일 이름이 “[이름]_NDX_[YYYYMMDDhhmmss]” 형식으로 이루어진 파일
           ex) Sample_NDX_20121126151237

NDX 일련번호 : 파일명 끝에 14자리 수의 생성시간(년월일시분초)

NDX 파일명 치환 : “[이름]_NDX(Index)” 형식의 파일명은 해당 디렉터리의 NDX 파일에 대해 Index에 해당하는 실제 파일명으로 치환됨

(-2 ) : 일련번호 기준 마지막 파일에서 두 번째 이전 파일명으로 치환됨
(-1 ) : 일련번호 기준 마지막 파일에서 첫 번째 이전 파일명으로 치환됨
( 0 ) : 일련번호 기준 마지막 파일명으로 치환됨
(+1 ) : 일련번호 기준 마지막 파일에서 Index를 1 증가시켜 새로운 파일 생성
</code></pre><p>NDX 파일목록 중 잘못된 파일명이 존재할 경우 에러를 발생한다.</p><table><thead><tr><th>구분</th><th>예시</th><th>비고</th></tr></thead><tbody><tr><td>에러</td><td>Sample_NDX_20180104</td><td>index 자릿수가 10자리</td></tr><tr><td>에러</td><td>Sample_NDX_000A</td><td>index는 숫자만 허용함</td></tr><tr><td>무시</td><td>Sample_20180104123456</td><td>NDX 파일이 아닌 일반 파일로 인식</td></tr></tbody></table><h4 id=indexndx-reader-방식-설정>Index(NDX) Reader 방식 설정</h4><p>Property(indexResource)의 파일을 NDX파일 설정에 따라 읽어드린다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;fileIndex-delimitedItemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.EgovIndexFileReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;indexResource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:./src/main/resources/egovframework/batch/data/inputs/csvData_NDX(0)&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>EgovIndexFileReader 설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>indexResource</td><td>읽어올 index(NDX)파일을 설정한다.</td><td>Index(NDX) 파일명 치환 로직 참조</td></tr></tbody></table><h3 id=전자정부에서-제공하는-egovmybatispagingitemreader>전자정부에서 제공하는 EgovMyBatisPagingItemReader</h3><p>배치 처리시 Paging방식으로 mybatis에서 데이터를 읽기 위해 EgovMyBatisPagingItemReader 서비스를 제공합니다.(mybatis MyBatisPagingItemReader 클래스를 확장한 서비스)
실행환경 제공 Resource Variable, Step Variable, Job Variable 서비스와 함께 사용 가능하지만 parameterValues 서비스와 함께 사용은 불가능하다.</p><p><img src=../images/egovmybatispagingitemreader_architecture.png alt=image></p><h4 id=egovmybatispagingitemreader-설정항목>EgovMyBatisPagingItemReader 설정항목</h4><table><thead><tr><th>설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>sqlSessionFactory</td><td>reader에 별도로 구현한 sessionFactory</td><td>sqlSession</td></tr><tr><td>parameterValues</td><td>파라미터 전달을 위한 설정</td><td>parameterValues</td></tr><tr><td>queryId</td><td>네임스페이스를 가진 매퍼 파일을 Query Id.</td><td>EmpMapper.selectEmpList</td></tr><tr><td>scope</td><td>해당 Reader가 적용될 Bean Scope</td><td>step, job</td></tr><tr><td>pageSize</td><td>배치가 처리할 페이지 사이즈 크기</td><td>#{100}</td></tr><tr><td>resourceVariable</td><td>표준프레임워크 실행환경 Resource Variable 서비스를 사용하기 위한 설정</td><td>resourceVariable</td></tr><tr><td>jobVariable</td><td>표준프레임워크 실행환경 Step Variable 서비스를 사용하기 위한 설정</td><td>jobVariable</td></tr><tr><td>stepVariable</td><td>표준프레임워크 실행환경 Job Variable 서비스를 사용하기 위한 설정</td><td>stepVariable</td></tr></tbody></table><h4 id=egovmybatispagingitemreader-설정항목-설정>EgovMyBatisPagingItemReader 설정항목 설정</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mybatisJobStep.mybatisItemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.item.database.EgovMyBatisPagingItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlSessionFactory&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlSession&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resourceVariable&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;resourceVariable&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobVariable&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobVariable&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;stepVariable&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;stepVariable&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;queryId&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;EmpMapper.selectEmpList&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pageSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{100}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html</a></li><li><a href=http://www.mybatis.org/spring/ko/batch.html>http://www.mybatis.org/spring/ko/batch.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8a3407d56f67fc849c221e234f20b80b>9 - ItemWriter</h1><div class=lead>ItemWriter는 다양한 데이터 타입에 상관없이 한 번에 여러 항목(Chunk)을 쓰는 역할을 하며, ItemReader와 유사하지만 데이터를 쓰는 반대의 동작을 수행한다. 이를 통해 데이터를 효과적으로 처리하고 저장할 수 있다.</div><h1 id=itemwriter>ItemWriter</h1><h2 id=개요>개요</h2><p>ItemWriter는 대상 타입에 관계없이 한번에 항목의 묶음(Chunk)을 쓰는 동작의 인터페이스이다.</p><h2 id=설명>설명</h2><p>ItemWriter의 기능은 ItemReader와 유사하지만 정반대의 동작을 한다.
기본적인 ItemWriter 인터페이스는 아래와 같다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ItemWriter</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>write</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>items</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>write() 메소드는 ItemWriter의 필수적인 메소드이며 인자로 건넨 객체가 열려 있는 동안 쓰기 작업을 시도한다.</p><h3 id=flatfile-itemwriter>FlatFile ItemWriter</h3><p>FlatFileItemWriter는 Resource, LineAggregator에 기본적으로 의존성을 갖으며, LineAggregator에 따라 구분자(Delimited)와 고정길이(Fixed Length) 방식으로 쓸 수 있다.</p><p><img src=../images/flatfileitemwriter_process.png alt=image></p><table><thead><tr><th>구분</th><th>데이터 형태</th><th>설명</th></tr></thead><tbody><tr><td>LineAggregator</td><td>Item → String</td><td>ItemReader, ItemProcessor 과정을 거친 Item을 1 라인의 String으로 변환하는 총 과정(FieldExtractor 과정을 포함한다.)<br>- <strong>DelimitedLineAggregator (구분자)</strong> : Item의 Field와 Field 사이에 구분자를 삽입하여 1라인의 String으로 변환하는 과정<br>- <strong>FormatterLineAggregator(고정길이 포맷)</strong> : Item의 Field를 사용자가 설정한 포맷 기준으로 1라인의 String으로 변환하는 과정</td></tr><tr><td>FieldExtractor</td><td>Item → Fields</td><td>Item에서 Field 값들을 꺼내어 Object[]로 변환하는 과정</td></tr></tbody></table><p>아래 Delimited(구분자), Fixed Length(고정길이) 방식으로 설정한 FlatFileItemWriter의 예시를 통해 FlatFileItemWriter, LineAggregator, FieldExtractor의 의존 관계를 볼 수 있다.</p><table class=inline><tbody><tr class=row0><th class="col0 centeralign">Aggregate 방식</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>Delimited (구분자)</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemWriter"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[outputFile]}"</span> <span class=re2>/&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineAggregator"</span><span class=re2>&gt;</span></span>
	<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.DelimitedLineAggregator"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span><span class=re2>/&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldExtractor"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor"</span><span class=re2>&gt;</span></span>
		    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span><span class=re2>/&gt;</span></span>					
		<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class=col0>Fixed Length (고정길이)</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemWriter"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[outputFile]}"</span> <span class=re2>/&gt;</span></span>
    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineAggregator"</span><span class=re2>&gt;</span></span>
	<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.FormatterLineAggregator"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"format"</span> <span class=re0>value</span>=<span class=st0>"%-9s%-2s"</span> <span class=re2>/&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldExtractor"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor"</span><span class=re2>&gt;</span></span>
		    <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span><span class=re2>/&gt;</span></span>					
		<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><p>BeanWrapperFieldExtractor에 아래와 같은 항목을 설정해야한다.</p><table><thead><tr><th>설정항목</th><th>내용</th></tr></thead><tbody><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.</td></tr></tbody></table><p>✔ 사용하는 LineAggregator에 따라 설정항목이 다르므로 주의하여 설정해야 한다.</p><table><thead><tr><th>LineAggregator</th><th>설정항목</th><th>설명</th><th>설정 예</th></tr></thead><tbody><tr><td>DelimitedLineAggregator</td><td>delimiter</td><td>Item의 필드 값들을 1 Line의 String으로 만들 때 경계가 되는 구분자 지정</td><td>,(콤마)</td></tr><tr><td>FormatterLineAggregator</td><td>format</td><td>Item의 필드 값들을 1 Line의 String으로 만들 때 필드값의 형식과 고정길이 지정</td><td>%-9s%-2s</td></tr></tbody></table><h3 id=xml-itemwriter>XML ItemWriter</h3><h4 id=staxeventitemwriter>StaxEventItemWriter</h4><p>XML 쓰는 과정은 읽기 과정에 대칭적이다. StaxEventItemWriter는 Resource, marshaller, rootTagName가 필요하다.
Java 객체는 marshaller에 전달되서 OXM 도구에 의해 각 fragment마다 StartDocument와 EndDocument 이벤트를 필터링하고 커스텀 이벤트 writer를 사용해 Resource를 쓰게 된다.</p><p>아래 XStreamMarshaller를 사용한 StaxEventItemWriter 설정 예가 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.xml.StaxEventItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;outputResource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;marshaller&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;customerCreditMarshaller&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;rootTagName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;customers&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;overwriteOutput&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>marshaller가 의존성 참조를 하고 있는 customerCreditMarshaller는 다음처럼 설정하면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;customerCreditMarshaller&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.oxm.xstream.XStreamMarshaller&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;aliases&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;util:map</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;aliases&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;customer&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;credit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;java.math.BigDecimal&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;java.lang.String&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/util:map&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=database-itemwriter>Database ItemWriter</h3><p>플랫파일 및 <acronym title="Extensible Markup Language">XML</acronym> 모두 특정 ItemWriter가 있지만 데이터베이스는 다르다. 왜냐하면 트랜잭션이 필요한 모든 기능을 제공하기 때문이다.
파일은 트랜잭션이 있는 것처럼 적절한 시점에 작성된 item을 추적하고 삭제하는 작업해야 하기 때문에 ItemWriter가 필요하다. 하지만 데이터베이스는 쓰기가 이미 트랜잭션에 포함되어 있기때문에 이 기능을 필요로 하지 않는다.
사용자는 ItemWriter 인터페이스를 구현해서 DAO를 만들거나 일반적인 처리 과정 관점에서 작성된 커스텀 ItemWriter 중 하나를 사용하면 된다.</p><h4 id=jdbcbatchitemwriter>JdbcBatchItemWriter</h4><p>아래 XML 설정은 JDBC를 이용한 JdbcBatchItemWriter의 설정 예시이다.
JdbcCursorItemReader 설정과 마찬가지로 dataSouce 속성으로 DB connection을 넣어올 수 있는 datasource를 지정하고, sql 속성에 실행할 쿼리를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.JdbcBatchItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;assertUpdates&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemSqlParameterSourceProvider&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.BeanPropertyItemSqlParameterSourceProvider&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;UPDATE CUSTOMER set credit = :credit where id = :id&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=ibatisbatchitemwriter>IbatisBatchItemWriter</h4><p>아래 XML 설정은 iBatis를 이용한 IbatisBatchItemWriter의 설정 예시이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.IbatisBatchItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;statementId&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;updateCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>sqlMapClient의 참조는 아래와 같다. configLocation 속성에 iBatis를 통해 쿼리를 작성해둔 파일의 경로를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;ibatis-config.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=전자정부에서-제공하는-egovflatfileitemwriter>전자정부에서 제공하는 eGovFlatFileItemWriter</h3><p>스프링 배치에서 제공하는 파일 기반 관련설정을 사용할 경우, 대용량 데이터 처리 시간이 상용 배치프레임워크 대비 성능이 떨어졌다. 이 문제를 해결하기 위해서 전자정부에서는 파일 ItemWriter의 요소 중 성능저하 요인인 LineAggregator 부분을 개선하여 제공한다</p><p>스프링에서 제공하는 BeanWrapperFieldExtractor를 경량화 한 <strong>EgovFieldExtractor와</strong> FormatterLineAggreagotor의 기능을 경량화 한 <strong>EgovFixedLineAggregator를</strong> 제공한다.</p><table><thead><tr><th>스프링 FlatFileItemWriter 구조</th><th>전자정부 EgovFlatFileItemWriter 구조</th></tr></thead><tbody><tr><td><img src=../images/flatfileitemwriter_process_except_legend.png alt=image></td><td><img src=../images/egovflatfileitemwriter_process.png alt=image></td></tr></tbody></table><table><thead><tr><th>개선사항</th><th>설명</th></tr></thead><tbody><tr><td>EgovFieldExtractor</td><td>스프링에서 제공하는 BeanWrapperFieldExtractor를 개선하여 item에서 field 값을 추출하는 과정의 성능을 개선한 FieldExtractor 제공</td></tr><tr><td>EgovFixedLineAggregator</td><td>스프링에서 제공하는 FormatterLineAggregator는 Java의 format() 메소드를 이용하여 String을 다양한 format으로 변환할 수 있지만 가장 기본 설정인 문자열 길이만 지정할 때 성능이 떨어지는 단점이 있다.<br>따라서 사용자가 문자열 길이만 지정할 때를 고려해 경량화하여 성능의 초점을 둔 LineAggregator 제공<br>(format 지정이 필요한 경우, format을 VO에서 직접 적용하여 FormatterLineAggregator와 같은 기능이지만 성능 개선 된 EgovFixedLineAggregator 사용 가능)</td></tr></tbody></table><p>✔ 스프링에서 제공하는 FormatterLineAggregator, DelimitedLineAggregator와 EgovFieldExtractor는 동시 사용이 가능하므로 BeanWrapperFieldExtractor 대신 EgovFieldExtractor 사용 시, 보다 좋은 성능으로 write 할 수 있다.</p><p>BeanWrapperFieldExtractor, FormatterLineAggregator(or DelimitedLineAggregator)를 사용한 설정과 EgovFieldExtractor, EgovFixedLineAggregator(or DelimitedLineAggregator)를 사용한 FlatFileItemWriter 설정 비교는 아래와 같다.</p><h4 id=fixed-length고정길이-방식-설정>Fixed Length(고정길이) 방식 설정</h4><table class=inline><tbody><tr class=row0><th class="col0 centeralign">구분</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>스프링 FlatFileItemWriter</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemWriter"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[outputFile]}"</span> <span class=re2>/&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineAggregator"</span><span class=re2>&gt;</span></span>
      <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.FormatterLineAggregator"</span><span class=re2>&gt;</span></span>
         <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldExtractor"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	 <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	 <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"format"</span> <span class=re0>value</span>=<span class=st0>"%-9s%-2s"</span> <span class=re2>/&gt;</span></span>
      <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
   <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class=col0>전자정부 EgovFlatFileItemWriter</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemWriter"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[outputFile]}"</span> <span class=re2>/&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineAggregator"</span><span class=re2>&gt;</span></span>
      <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.transform.EgovFixedLengthLineAggregator"</span><span class=re2>&gt;</span></span>
         <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldExtractor"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.transform.EgovFieldExtractor"</span><span class=re2>&gt;</span></span>
	       <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span> <span class=re2>/&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	 <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
	 <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldRanges"</span> <span class=re0>value</span>=<span class=st0>"9,2"</span> <span class=re2>/&gt;</span></span>						
      <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
   <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><table><thead><tr><th>EgovFlatFileItemWriter 설정항목</th><th>설명</th></tr></thead><tbody><tr><td>fieldRanges</td><td>Item의 필드 값들을 1 Line의 String으로 만들 때 필드값의 범위(고정길이) 지정</td></tr><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.</td></tr><tr><td>padding</td><td>공백 패턴 설정</td></tr></tbody></table><h4 id=delimited구분자-방식-설정>Delimited(구분자) 방식 설정</h4><table class=inline><tbody><tr class=row0><th class="col0 centeralign">구분</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>스프링 FlatFileItemWriter</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemWriter"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[outputFile]}"</span> <span class=re2>/&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineAggregator"</span><span class=re2>&gt;</span></span>
      <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.DelimitedLineAggregator"</span><span class=re2>&gt;</span></span>
	 <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldExtractor"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor"</span><span class=re2>&gt;</span></span>
	       <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span><span class=re2>/&gt;</span></span>					
	    <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	 <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
         <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span><span class=re2>/&gt;</span></span>
      <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
    <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class=col0>전자정부 EgovFlatFileItemWriter</th><td class=col1><pre class="code xml"><span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.FlatFileItemWriter"</span> <span class=re0>scope</span>=<span class=st0>"step"</span><span class=re2>&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"resource"</span> <span class=re0>value</span>=<span class=st0>"#{jobParameters[outputFile]}"</span> <span class=re2>/&gt;</span></span>
   <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"lineAggregator"</span><span class=re2>&gt;</span></span>
      <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.file.transform.DelimitedLineAggregator"</span><span class=re2>&gt;</span></span>
	 <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"fieldExtractor"</span><span class=re2>&gt;</span></span>
	    <span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.file.transform.EgovFieldExtractor"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"names"</span> <span class=re0>value</span>=<span class=st0>"name,credit"</span><span class=re2>/&gt;</span></span>					
	    <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
	 <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
         <span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"delimiter"</span> <span class=re0>value</span>=<span class=st0>","</span><span class=re2>/&gt;</span></span>
      <span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span>
   <span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><table><thead><tr><th>EgovFlatFileItemWriter 설정항목</th><th>설명</th></tr></thead><tbody><tr><td>delimiter</td><td>Item의 필드 값들을 1 Line의 String으로 만들 때 경계가 되는 구분자 지정</td></tr><tr><td>names</td><td>VO 클래스의 필드를 나타낸다.</td></tr></tbody></table><p>사용하는 LineAggregator에 따라 설정항목이 다르다.</p><table><thead><tr><th>LineAggregator</th><th>설정항목</th><th>설명</th><th>설정 예</th></tr></thead><tbody><tr><td>DelimitedLineAggregator</td><td>delimiter</td><td>필드의 경계를 구별해주는 문자</td><td>, (콤마)</td></tr><tr><td>FormatterLineAggregator</td><td>format</td><td>필드의 형식과 필드 경계의 범위</td><td>%-9s%-2s</td></tr><tr><td>EgovFixedLengthLineAggregator</td><td>fieldRanges</td><td>필드 경계의 범위</td><td>9,2</td></tr></tbody></table><h3 id=전자정부에서-제공하는-egovdbitemwriter>전자정부에서 제공하는 eGovDBItemWriter</h3><p>스프링에서 제공하는 JdbcBatchItemWriter는 사용자가 PreparedStatement를 setter하기 위한 클래스를 직접 작성하지 않고, XML 설정시 쿼리의 파라미터값을 지정만으로 자동으로 PreparedStatement를 setter해주는 기능을 제공한다. 하지만, 이 기능을 이용하면 대용량 데이터 처리 시간이 상용 배치프레임워크과 비교하여 큰 차이가 발생한다. 이러한 차이를 개선하고자 전자정부프레임워크에서는 EgovJdbcBatchItemWriter를 제공한다.</p><table><thead><tr><th>스프링 JdbcBatchItemWriter구조</th><th>전자정부 EgovJdbcBatchItemWriter 구조</th></tr></thead><tbody><tr><td><img src=../images/jdbcbatchitemwriter.png alt=image></td><td><img src=../images/egovjdbcbatchitemwriter.png alt=image></td></tr></tbody></table><p>자동으로 PreparedStatement를 setter 할 경우 JdbcBatchItemWriter는 BeanPropertyItemSqlParameterSourceProvider클래스를 사용하고 EgovJdbcBatchItemWriter는 EgovMethodMapItemPreparedStatementSetter클래스를 사용한다. 설정은 아래와 같다.</p><table class=inline><tbody><tr class=row0><th class="col0 centeralign">구분</th><th class="col1 centeralign">설정</th></tr><tr class=row1><th class=col0>JdbcBatchItemWriter</th><td class=col1><pre class="code xml">	<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.database.JdbcBatchItemWriter"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"assertUpdates"</span> <span class=re0>value</span>=<span class=st0>"true"</span> <span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"itemSqlParameterSourceProvider"</span><span class=re2>&gt;</span></span>
			<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"org.springframework.batch.item.database.BeanPropertyItemSqlParameterSourceProvider"</span> <span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"sql"</span> <span class=re0>value</span>=<span class=st0>"UPDATE CUSTOMER set credit = :credit where id = :id"</span> <span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"dataSource"</span> <span class=re0>ref</span>=<span class=st0>"dataSource"</span> <span class=re2>/&gt;</span></span>
	<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr><tr class=row2><th class=col0>EgovJdbcBatchItemWriter</th><td class=col1><pre class="code xml">	<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>id</span>=<span class=st0>"itemWriter"</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.database.EgovJdbcBatchItemWriter"</span><span class=re2>&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"assertUpdates"</span> <span class=re0>value</span>=<span class=st0>"true"</span> <span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"itemPreparedStatementSetter"</span><span class=re2>&gt;</span></span>
			<span class=sc3><span class=re1>&lt;bean</span> <span class=re0>class</span>=<span class=st0>"egovframework.brte.core.item.database.support.EgovMethodMapItemPreparedStatementSetter"</span> <span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;/property<span class=re2>&gt;</span></span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"sql"</span> <span class=re0>value</span>=<span class=st0>"UPDATE CUSTOMER set credit =? where id =?"</span><span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"params"</span> <span class=re0>value</span>=<span class=st0>"credit,id"</span><span class=re2>/&gt;</span></span>
		<span class=sc3><span class=re1>&lt;property</span> <span class=re0>name</span>=<span class=st0>"dataSource"</span> <span class=re0>ref</span>=<span class=st0>"dataSource"</span> <span class=re2>/&gt;</span></span>
	<span class=sc3><span class=re1>&lt;/bean<span class=re2>&gt;</span></span></span></pre></td></tr></tbody></table><p>✔ EgovMethodMapItemPreparedStatementSetter에는 파라미터의 값둘을 params의 value 값으로 설정한다.</p><p>보다 자세히 설명하면,</p><table><thead><tr><th>writer</th><th>설정</th><th>설명</th></tr></thead><tbody><tr><td>JdbcBatchItemWriter</td><td>사용자가 작성한 class</td><td>사용자가 setValues 메소드를 직접 작성하여 PreparedStatement의 데이터 설정</td></tr><tr><td></td><td>BeanPropertyItemSqlParameterSourceProvider</td><td>sql에 파라미터 설정으로 PreparedStatement의 데이터 설정</td></tr><tr><td>EgovJdbcBatchItemWriter</td><td>사용자가 작성한 class</td><td>사용자가 setValues 메소드를 직접 작성하여 PreparedStatement의 데이터 설정</td></tr><tr><td></td><td>EgovMethodMapItemPreparedStatementSetter</td><td>sql과 params의 설정으로 PreparedStatement의 데이터 설정</td></tr></tbody></table><p>또한 EgovJdbcBatchItemWriter도 사용자가 직접 작성한 class를 PreparedStatementSetter로 설정할 수 있다. 클래스 작성시에는 EgovItemPreparedStatementSetter를 상속하여 사용한다. 아래의 EmployeeItemPreparedStatementSetter 클래스는 EgovItemPreparedStatementSetter를 상속받아서 사용자가 직접 작성한 것이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.EgovJdbcBatchItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemPreparedStatementSetter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.support.EmployeeItemPreparedStatementSetter&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span>  <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sql“  value=&#34;</span><span style=color:#a40000>update</span> <span style=color:#a40000>into</span> <span style=color:#a40000>UIP_EMPLOYEE</span> <span style=color:#a40000>(num,</span> <span style=color:#a40000>name,</span> <span style=color:#a40000>sex)</span> <span style=color:#a40000>values</span> <span style=color:#a40000>(?,</span> <span style=color:#a40000>?,</span> <span style=color:#a40000>?)&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=전자정부에서-제공하는-egovindexfilewriter>전자정부에서 제공하는 eGovIndexFileWriter</h3><p>배치 Job 정의 시 Resource 엘리먼트의 shell step에 shell script에 포함된 파일명에서 일련번호(index)를 사용할 수 있는 Writer를 제공한다.
Index 파일명을 사용하면 파일의 일련번호를 기준으로 동적인 파일명 생성이 가능하다.</p><p>Index(NDX) 파일명 치환 로직</p><pre tabindex=0><code>NDX File : 파일 이름이 “[이름]_NDX_[YYYYMMDDhhmmss]” 형식으로 이루어진 파일
           ex) Sample_NDX_20121126151237

NDX 일련번호 : 파일명 끝에 14자리 수의 생성시간(년월일시분초)

NDX 파일명 치환 : “[이름]_NDX(Index)” 형식의 파일명은 해당 디렉터리의 NDX 파일에 대해 Index에 해당하는 실제 파일명으로 치환됨

(-2 ) : 일련번호 기준 마지막 파일에서 두 번째 이전 파일명으로 치환됨
(-1 ) : 일련번호 기준 마지막 파일에서 첫 번째 이전 파일명으로 치환됨
( 0 ) : 일련번호 기준 마지막 파일명으로 치환됨
(+1 ) : 일련번호 기준 마지막 파일에서 Index를 1 증가시켜 새로운 파일 생성
</code></pre><p>NDX 파일목록 중 잘못된 파일명이 존재할 경우 에러를 발생한다.</p><table><thead><tr><th>구분</th><th>예시</th><th>비고</th></tr></thead><tbody><tr><td>에러</td><td>Sample_NDX_20180104</td><td>index 자릿수가 10자리</td></tr><tr><td>에러</td><td>Sample_NDX_000A</td><td>index는 숫자만 허용함</td></tr><tr><td>무시</td><td>Sample_20180104123456</td><td>NDX 파일이 아닌 일반 파일로 인식</td></tr></tbody></table><h4 id=indexndx-writer-방식-설정>Index(NDX) Writer 방식 설정</h4><p>Index Reader을 통해 읽어드린 파일을 NDX파일 설정에 따라 동적으로 새로운 파일을 생성한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;fileIndex-delimitedItemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.EgovIndexFileWriter&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;indexResource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:./src/main/resources/egovframework/batch/data/inputs/csvData_NDX(+1)&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.transform.EgovFieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>EgovIndexFileWriter 설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>indexResource</td><td>설정된 index(NDX)에 따른 동적인 파일 생성</td><td>Index(NDX) 파일명 치환 로직 참조</td></tr></tbody></table><h3 id=전자정부에서-제공하는-egovmybatisbatchitemwriter>전자정부에서 제공하는 EgovMyBatisBatchItemWriter</h3><p>배치 처리시 mybatis에서 데이터를 쓰기 위해 EgovMyBatisBatchItemWriter 서비스를 제공합니다.(mybatis MyBatisBatchItemWriter 클래스를 확장한 서비스)
실행환경 제공 Resource Variable, Step Variable, Job Variable 서비스와 함께 사용 가능하다.</p><p><img src=../images/egovmybatisbatchitemwriter_architecture.png alt=image></p><h4 id=egovmybatisbatchitemwriter-설정항목>EgovMyBatisBatchItemWriter 설정항목</h4><table><thead><tr><th>설정항목</th><th>내용</th><th>예시</th></tr></thead><tbody><tr><td>sqlSessionFactory</td><td>reader에 별도로 구현한 sessionFactory</td><td>sqlSession</td></tr><tr><td>statementId</td><td>네임스페이스를 가진 매퍼 파일을 Query Id</td><td>EmpMapper.selectEmpList</td></tr><tr><td>resourceVariable</td><td>표준프레임워크 실행환경 Resource Variable 서비스를 사용하기 위한 설정</td><td>resourceVariable</td></tr><tr><td>jobVariable</td><td>표준프레임워크 실행환경 Step Variable 서비스를 사용하기 위한 설정</td><td>jobVariable</td></tr><tr><td>stepVariable</td><td>표준프레임워크 실행환경 Job Variable 서비스를 사용하기 위한 설정</td><td>stepVariable</td></tr></tbody></table><h4 id=egovmybatisbatchitemwriter-설정항목-설정>EgovMyBatisBatchItemWriter 설정항목 설정</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mybatisJobStep.mybatisItemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.item.database.EgovMyBatisBatchItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resourceVariable&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;resourceVariable&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobVariable&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobVariable&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;stepVariable&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;stepVariable&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlSessionFactory&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlSession&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;statementId&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;EmpMapper.updateEmp&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html</a></li><li><a href=http://www.mybatis.org/spring/ko/batch.html>http://www.mybatis.org/spring/ko/batch.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3af328036431b2fcd7b548486a878e73>10 - Resource Variable</h1><div class=lead>사용자 정의 리소스 변수 선언 후 Setp에서 ItemReader, ItemWriter에서 사용자 정의 리소스를 사용할 수 있도록 EgovResourceVariable를 통해서 지원한다.</div><h1 id=resource-variable>Resource Variable</h1><h2 id=개요>개요</h2><p>사용자 정의 리소스 변수 선언 후 Setp에서 ItemReader, ItemWriter에서 사용자 정의 리소스를 사용할 수 있도록 EgovResourceVariable를 통해서 지원한다.</p><p><img src=../images/resource_variable_architecture7.png alt=image></p><h2 id=설명>설명</h2><h3 id=egovresourcevariable-설정>EgovResourceVariable 설정</h3><p>배치실행환경에서 제공하는 EgovResourceVariable 사용하여 사용자 정의 리소스를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;egovResourceVariable&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.support.EgovResourceVariable&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pros&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;props&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;input.resource&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>file:./src/main/resources/egovframework/batch/data/inputs/csvData.csv<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;prop</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;writer.resource&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>file:./target/test-outputs/csvOutput_ResourceVariable_#{new java.text.SimpleDateFormat(&#39;yyyyMMddHHmmssSS&#39;).format(new java.util.Date())}.csv<span style=color:#204a87;font-weight:700>&lt;/prop&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/props&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=step-정의-시-리소스-사용>step 정의 시 리소스 사용</h3><p>Setp에서 ItemReader, ItemWriter 사용시 사용자 정의 리소스 변수를 사용하여 resource 설정이 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delimitedToDelimitedJob-ResourceVariable.delimitedToDelimitedStep.delimitedItemReader&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{egovResourceVariable.getVariable(&#39;input.resource&#39;)}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.mapping.EgovDefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.transform.EgovDelimitedLineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;objectMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.mapping.EgovObjectMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;type&#34;</span>
</span></span><span style=display:flex><span>						<span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delimitedToDelimitedJob-ResourceVariable.delimitedToDelimitedStep.delimitedItemWriter&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{egovResourceVariable.getVariable(&#39;writer.resource&#39;)}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.core.item.file.transform.EgovFieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b8e9a19b32b8323ee153948d38a3df1f>11 - JobRepository</h1><div class=lead>JobRepository는 배치 작업 중의 정보를 저장하는 역할을 한다. 어떠한 Job이 언제 수행되었고, 언제 끝났으며, 몇 번이 실행되었고 실행에 대한 결과가 어떤지 등의 배치 작업의 수행과 관련된 모든 meta data가 저장되어 있다.</div><h1 id=jobrepository>JobRepository</h1><h2 id=개요>개요</h2><p>JobRepository는 배치 작업 중의 정보를 저장하는 역할을 한다. 어떠한 Job이 언제 수행되었고, 언제 끝났으며, 몇 번이 실행되었고 실행에 대한 결과가 어떤지 등의 배치 작업의 수행과 관련된 모든 meta data가 저장되어 있다.</p><h2 id=설명>설명</h2><p>JobRepository은 수행되는 Job에 대한 정보를 담고 있는 저장소로 배치작업의 지속성 메커니즘이다. JobRepository는 Spring Batch에서 JobExecution와 StepExecution 등과 같은 지속성을 가진 정보의 기본 CRUD작업에 사용된다. 배치작업이 처음 실행되면 JobRepository에서 JobExecution이 생성되고 배치작업이 실행되는 동안 StepExecution 및 JobExecution의 정보들이 JobRepository에 저장되고 갱신되어 지속된다.</p><p>JobRepository는 배치 네임 스페이스를 통해서나 JobRepositoryFactoryBean 클래스를 사용하여 아래와 같이 설정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job-repository</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c4a000>data-source=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c4a000>isolation-level-for-create=</span><span style=color:#4e9a06>&#34;SERIALIZABLE&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c4a000>table-prefix=</span><span style=color:#4e9a06>&#34;BATCH_&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c4a000>max-varchar-length=</span><span style=color:#4e9a06>&#34;1000&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>p:isolation-level-for-create=</span><span style=color:#4e9a06>&#34;ISOLATION_DEFAULT&#34;</span>
</span></span><span style=display:flex><span>	       <span style=color:#c4a000>p:table-prefix=</span><span style=color:#4e9a06>&#34;BATCH_&#34;</span> <span style=color:#c4a000>p:max-var-char-length=</span><span style=color:#4e9a06>&#34;1000&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h3 id=트랜잭션-설정transaction-configuration-for-the-jobrepository>트랜잭션 설정(Transaction Configuration for the JobRepository)</h3><p>네임 스페이스를 사용하는 경우, transactional advice가 자동으로 Repository 주위에 생성된다. 배치작업의 실패 후 다시 시작할 필요있는가의 상태를 포함하고 있는 메타 데이터가 제대로 지속되어 있는지 확인한다. repository이 트랜잭션 처리를 하지 않는다면 프레임 워크의 처리가 잘 정의되지 않는다. 기본적인 isolation level은 가장 격리 수준이 높은 serializable이고 재정의도 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job-repository</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#c4a000>isolation-level-for-create=</span><span style=color:#4e9a06>&#34;REPEATABLE_READ&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>네임스페이스나 Bean 정의를 사용하지 않는 경우에는 AOP를 이용하여 Repository에 대한 트랜잭션의 관리할 수 있도록 설정해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;aop:config&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:advisor</span> 
</span></span><span style=display:flex><span>           <span style=color:#c4a000>pointcut=</span><span style=color:#4e9a06>&#34;execution(* org.springframework.batch.core..*Repository+.*(..))&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;advice-ref</span><span style=color:#a40000>=&#34;txAdvice&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/aop:config&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;tx:advice</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;txAdvice&#34;</span> <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tx:attributes&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tx:method</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/tx:attributes&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/tx:advice&gt;</span>
</span></span></code></pre></div><p>위의 설정은 거의 변경없이 사용할 수 있다.다만, 네임 스페이스의 선언을 포함하고 있는지 Spring-aop, Spring-tx이 classpath에 있는지 확인하여야 한다.</p><h3 id=테이블접두사-변경changing-the-table-prefix>테이블접두사 변경(Changing the Table Prefix)</h3><p>JobRepository는 메타 데이터 테이블의 테이블 접두사 수정도 가능하다. 기본적으로 모든 데이터 테이블은 BATCH_JOB_EXECUTION 와 BATCH_STEP_EXECUTION 등과 같이 BATCH_로 시작한다.하지만 테이블명 앞에 스키마명을 추가하거나, 같은 스키마 내에서 메타 데이터 테이블의 하나 이상의 세트가 필요하면 테이블 접두사 수정이 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job-repository</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#c4a000>table-prefix=</span><span style=color:#4e9a06>&#34;SYSTEM.TEST_&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>위와 같이 설정한다면 모든 쿼리에 메타 데이터 테이블명이 SYSTEM.TEST_”로 시작된다. BATCH_JOB_EXECUTION은 SYSTEM.TEST_JOB_EXECUTION으로 변경될 것이다.</p><p>✔오직 테이블의 접두사만 변경가능하다. 테이블명과 컬럼명은 수정할 수 없다.</p><h3 id=메모리-repositoryin-memory-repository>메모리 Repository(In-Memory Repository)</h3><p>Spring 배치는 jobRepository를 데이터베이스가 아닌 메모리로 설정할 수 있다. 작업에 대한 상태를 유지하지 않아도 되는 배치작업의 도메인 개체를 데이터 베이스에 저장할 경우, 각각의 커밋 시점에 추가 시간이 걸린다. 이 경우, 메모리 Repository를 통해 잡을 실행한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.MapJobRepositoryFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>메모리는 JVM 인스턴스가 다시 시작하는 것을 허용하지 않으며, 휘발성을 가진 jobRepository이다. 또한 동일한 매개 변수 두 작업 인스턴스가 동시에 실행되는 것을 보장 할 수 없다. multi-threaded 배치작업이나 파티션 작업에 적합하지 않을 수 있다.그러므로 JobRepository는 데이터베이스을 사용하여야 한다.</p><p>하지만 repository내에서 rollback이 있으므로 트랜잭션 manager의 설정이 필요하다.그리고 테스트를 위해 많은 사람들이 비즈니스 논리상 여전히 트랜잭션이 있기 때문에 ResourcelessTransactionManager가 유용하다.</p><h3 id=비표준-데이터-베이스-타입non-standard-database-types-in-a-repository>비표준 데이터 베이스 타입(Non-standard Database Types in a Repository)</h3><p>Spring Batch에서 지원되는 데이터베이스 목록이외의 데이터베이스를 사용하는 경우,비슷하게 지원하는 하는 데이터베이스가 있다면 그것을 사용할 수 있다. 이 작업을 수행하려면 네임 스페이스 사용하는 대신에 JobRepositoryFactoryBean를 사용하여 가장 가깝게 일치하는 데이터베이스 유형을 설정 할 수 있다</p><ul><li>Spring Batch에서 지원되는 데이터베이스 타입 : DERBY, DB2, DB2ZOS, HSQL, SQLSERVER, MYSQL, ORACLE, POSTGRES, SYBASE, H2</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;databaseType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;db2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>주의</p><p>✔ <strong>altibase</strong>나 <strong>tibero</strong>는 지원되는 데이터베이스 타입이 아니다. altibase나 tibero 연결시에는 jobRepository에 databaseType으로 oracle을 추가 설정해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>p:databaseType=</span><span style=color:#4e9a06>&#34;oracle&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>p:lobHandler-ref=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li>JobRepository :http://static.springsource.org/spring-batch/reference/html/configureJob.html#configuringJobRepository</li><li><a href=../persistence-layer/transaction-declarative-transaction-management.md>declarative_transaction_management</a></li><li>Meta-Data Schema :http://static.springsource.org/spring-batch/reference/html/metaDataSchema.html</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-29a6a08f13b48257f9335767d8c729da>12 - JobLauncher</h1><div class=lead>JobLauncher는 배치작업을 실행시키는 역할을 한다. Job과 Job Parameters를 이용하여 요청된 배치 작업을 수행한 후 JobExecution을 반환한다.</div><h1 id=joblauncher>JobLauncher</h1><h2 id=개요>개요</h2><p>JobLauncher는 배치작업을 실행시키는 역할을 한다. Job과 Job Parameters를 이용하여 요청된 배치 작업을 수행한 후 JobExecution을 반환한다.</p><h2 id=설명>설명</h2><p>JobLauncher 인터페이스를 보면 Job과 Job Parameter를 이용하여 요청된 Job을 수행한 후 JobExecution을 반환되는 run메소드가 정의되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>JobLauncher</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>JobExecution</span> <span style=color:#000>run</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Job</span> <span style=color:#000>job</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>JobParameters</span> <span style=color:#000>jobParameters</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>JobExecutionAlreadyRunningException</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>			<span style=color:#000>JobRestartException</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>JobInstanceAlreadyCompleteException</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>JobParametersInvalidException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>JobLauncher 인터페이스의 기본 구현 클래스로는 SimpleJobLauncher이 제공된다. SimpleJobLauncher클래스는 JobName과 JobParameter를 이용하여 JobRepository에서 Job의 실행시도를 나타내는 JobExecution을 획득하고 작업을 수행한다.</p><p>이를 이용한 jobLauncher 설정은 아래와 같다. JobExecution을 획득하기 위한 <a href=./batch-execution-job-repository.md>jobRepository</a>의 설정이 필수이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>JobLauncher는 taskExecutor 설정을 통해 Job을 동기적, 혹은 비동기적으로 실행할 수 있다. 별도로 설정하지 않으면 syncTaskExecutor클래스가 디폴트로 설정되어 동기적으로 아래와 같이 실행된다. client에게 배치작업의 요청을 받게 되면 JobLauncher는 하나의 JobExecution을 획득하고, 그것을 배치작업을 실행하는 메소드에 전달하여 최종적으로 배치 작업 후 Client에게 JobExecution을 반환한다.</p><ul><li>동기</li></ul><p><img src=../images/joblauncher_sync.png alt=image></p><p>위의 흐름은 간단하며 스케줄러에서 실행하면 잘 동작하지만, HTTP 요청에서 시작하려고 할 때 문제가 발생한다. 배치 작업의 특성상 처리시간이 오래 걸리는 작업이 많을 것이고,그 작업시간동안 <acronym title="Hyper Text Transfer Protocol">HTTP</acronym> 응답을 계속 기다리는 것은 좋지 않다. 이 경우에는 아래와 같이 SimpleJobLauncher가 Client에게 즉시 JobExecution을 반환하는 비동기식 동작 방법이 필요하다.</p><ul><li>비동기</li></ul><p><img src=../images/joblauncher_async.png alt=image></p><p>JobLauncher 설정에서 SimpleAsyncTaskExecutor클래스를 통해 비동기로도 쉽게 설정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SimpleAsyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>Spring의 TaskExecutor 인터페이스의 모든 구현은 비동기로 실행하는 배치작업에 대한 제어의 목적으로 사용된다.</p><h2 id=참고자료>참고자료</h2><ul><li><a href=./batch-example-sync_async.md>동기/비동기 처리 예제</a></li><li><a href=http://static.springsource.org/spring-batch/reference/html/configureJob.html#configuringJobLauncher>http://static.springsource.org/spring-batch/reference/html/configureJob.html#configuringJobLauncher</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-dc9b922fe13066044064e7a21ea74528>13 - Remote JobLauncher</h1><div class=lead>Remote JobLauncher는 온라인에서 배치 서버의 Batch Job 작업을 실행하며, 클라이언트와 서버 간 요청된 배치 작업을 수행한다. 이를 위해 Hessian Binary Web Service를 사용해 간편하게 웹서비스를 구현하며, Spring의 HessianProxyFactoryBean과 HessianServiceExporter를 통해 편리한 통합을 지원한다.</div><h1 id=remote-joblauncher>Remote JobLauncher</h1><h2 id=개요>개요</h2><p>Remote JobLauncher는 온라인 상에서 별도의 배치 서버의 Batch Job작업을 실행시키는 역할을 한다.
온라인 상의 Client와 Server를 이용하여 요청된 배치 작업을 수행한다.</p><h2 id=구성>구성</h2><p>온라인상의 Remote JobLauncher를 구현하기 위하여 Hessian Binary Web Service를 사용한다.
Hessian 웹서비스는 별도의 대형 프레임워크를 설치하지 않고도 간편하게 사용할 수 있은 웹서비스이며, HTTP기반의 경량 바이러리 프로토콜로 별도의 확장없이 바이너리 데이터를 전송하는데 적합하다.
또한, 스피링의 HessianProxyFactoryBean과 HessianServiceExporter를 사용하여 편리한 Integration을 지원한다.</p><p>Hessian을 사용하기 위하여 아래와 같이 라이브러리 디펜던시를 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>com.caucho<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>hessian<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>4.0.38<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>아래의 예제는 표준프레임워크 개발환경(v3.7)의 배치 템플릿 (SAM파일 Web 기반)을 사용하여 기존의 JobLauncher를 웹서비스에 등록하여 외부(Client)에서 호출하여 실행한다.
본 가이드의 실행 예제는 <a href=https://maven.egovframe.go.kr/publist/HDD1/public/egovframework_v3.7/example/egovtest.webBatchRemote.zip class=urlextern title=https://maven.egovframe.go.kr/publist/HDD1/public/egovframework_v3.7/example/egovtest.webBatchRemote.zip rel=nofollow>RemoteJobLauncher 예제</a>에서 다운로드하여 확인할 수 있다.</p><p>Remote JobLauncher의 예제 작성 방법을 다음과 같다.</p><p><strong>Web 서비스 (Server)</strong></p><ul><li>(Step 1) 표준프레임워크 개발환경에서 배치 템플릿을 생성한다.
템플릿의 대상은 SAM파일 형식의 Web 프로젝트이다.
관련 템플릿 생성 방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2.5:imp:editor:batch_template_wizard">배치 템플릿 위저드</a>를 참조한다.</li><li>(Step 2) 생성된 배치 템플릿에 Hessain Web Service의 라이브러리를 등록한다.</li><li>(Step 3) 서버의 RemoteJobLauncher를 작성한다. (interface 및 Implement 클래스 작성)
RemoteJobLauncher의 구현체는 Template의 BatchRunController의 batchRun을 참조한다.</li><li>(Step 4) 작성된 RemoteJobLauncher를 스프링의 HessianServletExporter을 이용하여 빈생성과 새로운 Servlet을 작성한다.</li></ul><p><strong>테스트 (Client)</strong></p><ul><li>(Step 1) Client에서는 HessianProxyFactoryBean을 사용하여 서버의 웹서비스 Url을 등록한다.</li><li>(Step 2) 등록된 웹서비스를 통하여 RemoteJobLauncher를 실행한다.</li></ul><p><img src=../images/remotejoblauncher_explorer1.png alt=image></p><h2 id=설명>설명</h2><h3 id=remote-웹-서비스-sever-side>Remote 웹 서비스 (Sever-side)</h3><p><strong>Step 1</strong> 개발환경의 배치 템플릿 생성
개발환경의 “New Batch Template Project”를 이용하여 SAM파일 형식의 Web 기반 템플릿을 생성한다.
배치 템플릿 관련 자세한 사항은 배치 템플릿 위저드를 참조한다.</p><p><strong>Step 2</strong> Hessain Web Service의 라이브러리 등록
작성할 Batch JobLauncher를 온라인상에서 실행하기 위하여 바이너리 형식의 간편한 Web Service인 Hessian을 사용하며, 해당 라이브러리를 pom.xml에 등록한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>com.caucho<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>hessian<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>4.0.38<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p><strong>Step 3</strong> RemoteJobLaucher 작성
RemoteJobLauncher는 웹서비스에 호출할 수 있는 인터페이스이며 이를 통하여 작성된 배치를 실행하고, 또한 필요한 경우 결과값을 넘겨주는 역활을 한다.
작성된 RemoteJobLauncher를 HessianServiceExporter에 등록하기 위하여 인터페이스 클래스와 구현체(Implement)클래스를 작성하여야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovframework.example.bat.remote</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.HashMap</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RemoteJobLauncher</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>callRemoteBatchRunner</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>jobName</span><span style=color:#ce5c00;font-weight:700>);</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovframework.example.bat.remote</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.ArrayList</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>egovframework.rte.bat.core.launch.support.EgovBatchRunner</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>RemoteJobLauncherImpl</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>RemoteJobLauncher</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>callRemoteBatchRunner</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>jobName</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>//배치 템플릿의 BatchRunController.java의 batchRun메소드를 참조한다.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>callRemoteBatchRunner메소드는 배치 템플릿의 BatchRunController클래스의 batchRun메소드를 참조하여 작성한다.</li></ul><p><strong>Step 4</strong> RemoteJobLauncher로 빈생성 및 서블릿 등록</p><ul><li>빈등록을 위하여 HessianServiceExporter를 사용하며, 인자값으로 service와 serviceInterface를 작성한다.
HassianServiceExporter의 name(EgovJobLauncher.remote)은 요청 Url 서비스의 매핑 주소이며, 별도의 명시적 매핑 핸들러를 지정하지 않고도 DispatcherServlet의 매핑에 해당 Bean의 이름을 통하여 서비스를 제공한다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;/EgovJobLauncher.remote&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.remoting.caucho.HessianServiceExporter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;service&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;remoteJobLauncher&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;serviceInterface&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.remote.RemoteJobLauncher&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;remoteJobLauncher&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.remote.RemoteJobLauncherImpl&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><pre tabindex=0><code>** 웹서비스 호출 예시 **
http://&lt;domain_address&gt;/&lt;context_path&gt;/EgovJobLauncher.remote
</code></pre><ul><li>서블릿 설정은 web.xml에 별도로 작성한다.
본 가이드에서는 *.remote사용하여 별도의 url-pattern을 작성하였다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;servlet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;servlet-name&gt;</span>remoting<span style=color:#204a87;font-weight:700>&lt;/servlet-name&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span style=color:#204a87;font-weight:700>&lt;/servlet-class&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;init-param&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;param-name&gt;</span>contextConfigLocation<span style=color:#204a87;font-weight:700>&lt;/param-name&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;param-value&gt;</span>/WEB-INF/config/egovframework/springmvc/hessian-servlet.xml<span style=color:#204a87;font-weight:700>&lt;/param-value&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/init-param&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;load-on-startup&gt;</span>1<span style=color:#204a87;font-weight:700>&lt;/load-on-startup&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/servlet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;servlet-mapping&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;servlet-name&gt;</span>remoting<span style=color:#204a87;font-weight:700>&lt;/servlet-name&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;url-pattern&gt;</span>*.remote<span style=color:#204a87;font-weight:700>&lt;/url-pattern&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/servlet-mapping&gt;</span>
</span></span></code></pre></div><h3 id=테스트-client-side>테스트 (Client-side)</h3><p>Remote 배치 서비스를 호출하기 위하여 스프링의 HessianProxyFactoryBean을 사용하며 배치 실행 후 결과 값으로 배치 실행정보를 출력한다.</p><ul><li>본 테스트 예제는 프로젝트의 src/test영역에 자바 클래스(RemoteJobClient_test)와 빈설정(client-beans-remote)파일로 구성되어 있다.</li></ul><p><strong>Step 1</strong> HessainProxyFactoryBean에 RemoteJobLanucher를 등록한다.
인자값으로 serviceUrl을 지정할 수 있으며, serviceInterface를 지정하여 런처의 메소드를 실행할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;remoteHessianJobLauncher&#34;</span> 
</span></span><span style=display:flex><span>      <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.remoting.caucho.HessianProxyFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>		
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;serviceUrl&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;http://localhost:8080/egovframework.example.bat.template.sam.web/EgovJobLauncher.remote&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;serviceInterface&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.example.bat.remote.RemoteJobLauncher&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p><strong>Step 2</strong> 테스트 파일을 작성하여 등록된 웹서비스를 호출한다.
아래와 같이 테스트 파일을 작성하여 웹서비스를 호출하며 템플릿 예제의 “delimitedToDelimitedJob” 배치 job을 실행하여 결과로 Job Instance 및 step Info를 출력한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovtest.webBatchRemote</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.springframework.context.ApplicationContext</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>egovframework.example.bat.remote.RemoteJobLauncher</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>RemoteJobClient_test</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>main</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>ApplicationContext</span> <span style=color:#000>context</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ClassPathXmlApplicationContext</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;client-beans-remote.xml&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#000>RemoteJobLauncher</span> <span style=color:#000>remoteJobLauncher</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RemoteJobLauncher</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getBean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;remoteHessianJobLauncher&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#000>String</span> <span style=color:#000>jobName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;delimitedToDelimitedJob&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;)</span><span style=color:#000>remoteJobLauncher</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>callRemoteBatchRunner</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>jobInstances</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;)</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobInstances&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>stepsInfo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;&gt;)</span><span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;stepsInfo&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;[jobInstance] ===============================================================&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;job id = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;id&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;job name = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;parameters = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;parameters&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;startTime = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;startTime&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;endTime = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;endTime&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isRunning = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#ce5c00;font-weight:700>((</span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isRunning&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#34;Running&#34;</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Ready&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;exitStatus = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobInstances</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;exitStatus&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;[stepsInfo] ===============================================================&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>for</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>stepInfo</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>stepsInfo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;stepId = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;stepId&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;stepName = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;stepName&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;readCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;readCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;writeCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;writeCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;readSkipCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;readSkipCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;processSkipCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;processSkipCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;writeSkipCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;writeSkipCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;totalSkipCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;totalSkipCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;commitCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;commitCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;rollbackCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;rollbackCount&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>			<span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;exitStatus = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>stepInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;exitStatus&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>출력 결과</p><pre tabindex=0><code>[jobInstance] ===============================================================
job id = 0
job name = delimitedToDelimitedJob
parameters = {inputFile=classpath:/egovframework/batch/data/inputs/csvData.csv, outputFile=file:xxxxx/remote-batch-output/csvOutput_xxxx.csv, timestamp=xxxxxxxxxxx}
startTime = 201x-xx-xx xx:xx:xx.xxx
endTime = 201x-xx-xx xx:xx:xx.xxx
isRunning = Ready
exitStatus = COMPLETED
[stepsInfo] ===============================================================
stepId = 0
stepName = delimitedToDelimitedStep
readCount = 4
writeCount = 4
readSkipCount = 0
processSkipCount = 0
writeSkipCount = 0
totalSkipCount = 0
commitCount = 3
rollbackCount = 0
exitStatus = COMPLETED
</code></pre><h2 id=참고자료>참고자료</h2><ul><li><a href=https://docs.spring.io/spring-framework/docs/3.0.0.M4/reference/html/ch19s03.html>스프링의 Hessian Remotely call servcies</a></li><li><a href=http://hessian.caucho.com/>Hessian Binary Web Service Protocol</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-299b16588f2ac0fd7894a288bd065f93>14 - JobRunner</h1><div class=lead>JobRunner는 외부 실행 모듈과 JobLauncher를 연결해주는 모듈로, 용도에 맞게 구현이 필요하다. 전자정부 표준프레임워크에서는 작업실행 유형에 따라 미리 JobRunner를 미리 구현한 표준 Batch Runner를 제공한다.</div><h1 id=jobrunner>JobRunner</h1><h2 id=개요>개요</h2><p>JobRunner는 외부 실행 모듈과 JobLauncher를 연결해주는 모듈로, 용도에 맞게 구현이 필요하다. 전자정부 표준프레임워크에서는 작업실행 유형에 따라 미리 JobRunner를 미리 구현한 표준 Batch Runner를 제공한다.</p><h2 id=설명>설명</h2><p>배치작업의 실행 유형에 따라 아래와 같이 3가지의 Batch Runner를 제공한다.</p><ul><li>EgovBatchRunner: Web, Java Application 등을 이용하여 범용적으로 실행되는 일괄처리 작업에 사용한다.</li><li>EgovCommandLineRunner: 외부 프로그램(Windows: / Unix/Linux: crontab 등)이나 명령 프롬프트(Windows: bat / Unix/Linux: Shell)에서 독립적으로 실행되는 배치작업에 사용한다.</li><li>EgovSchedulerRunner: 주기적으로 실행되어야 하는 일괄처리 작업에 사용한다.</li></ul><p>각 Batch Runner가 제공하는 기능은 아래와 같다.</p><table><thead><tr><th>Batch Runner 종류</th><th>Java Application 실행</th><th>Web 실행</th><th>Job 상태 모니터링</th><th>Scheduling 기능</th><th>명령 프롬프트 연동 지원</th></tr></thead><tbody><tr><td>EgovBatchRunner</td><td>O</td><td>O</td><td>O</td><td>X</td><td>△</td></tr><tr><td>EgovCommandLineRunner</td><td>O</td><td>X</td><td>O</td><td>X</td><td>O</td></tr><tr><td>EgovSchedulerRunner</td><td>O</td><td>O</td><td>X</td><td>O</td><td>△</td></tr></tbody></table><p>✔ EgovBatchRunner, EgovSchedulerRunner에서 명령 프롬프트 연동을 위해서는 추가적인 구현이 필요하다.</p><h3 id=egovbatchrunner>EgovBatchRunner</h3><h4 id=구조>구조</h4><p>EgovBatchRunner를 이용하여 Job Operator 및 Job Explorer를 이용하여 Job Config에 등록된 Job을 실행하고, 실행 상태를 변경할 수 있다. 또한 Job Repository에 접근할 수 있는 기능을 제공한다.</p><p><img src=../images/egov_batch_runner.png alt=image></p><h4 id=설정방법>설정방법</h4><p>EgovBatchRunner를 사용하기 위해서는 XML 파일에 JobOperator, JobExplorer 그리고 JobRepository가 정의되어야 한다. 그리고 JobOperator를 생성하기 위해서는 JobLauncher와 JobRegistry의 정의가 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobOperator&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobOperator&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>p:jobLauncher-ref=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>p:jobExplorer-ref=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>p:jobRepository-ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>p:jobRegistry-ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>p:lobHandler-ref=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.explore.support.JobExplorerFactoryBean&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.MapJobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>EgovBatchRunner의 생성자에 JobOperator, JobExplorer, JobRepository를 전달한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobBatchRunner&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.launch.support.EgovBatchRunner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobOperator&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=제공기능>제공기능</h4><p>EgovBatchRunner에서는 Job Operator, Job Explorer에서 제공하는 주요 메소드를 기반으로 하여 Job Config에 등록된 Job 이름 조회, Job 시작, 재시작, 정지 등의 기능을 제공한다. Job Repository는 메소드를 직접 제공하지 않는 대신, 필요에 따라 Job Repository 객체에 접근할 수 있도록 하였다.</p><table><thead><tr><th>메소드명</th><th>설명</th><th>파라미터</th></tr></thead><tbody><tr><td>start</td><td>각각 문자열 형태의 Job 이름, Job Parameter를 이용하여 Job을 시작한다. 이 때, Job Parameter는 기존에 실행했던 Job Parameter와 다른 고유한 값을 가져야 한다.</td><td>Job 이름, Job Parameter</td></tr><tr><td>restart</td><td>Job의 Execution ID를 이용하여, 정지되었거나 이미 종료 된 Job 중 재실행 가능한 Job 을 재시작한다.</td><td>Job의 Execution ID</td></tr><tr><td>stop</td><td>Job의 Execution ID를 이용하여, 실행 중인 Job을 정지시킨다.</td><td>Job의 Execution ID</td></tr></tbody></table><h4 id=job-parameter의-생성>Job Parameter의 생성</h4><p>EgovBatchRunner에서 사용할 Job Parameter를 생성하기 위해서 제공하는 메소드로, Job Parameter를 문자열 형태로 생성한다.</p><table><thead><tr><th>메소드명</th><th>설명</th><th>파라미터</th></tr></thead><tbody><tr><td>createUniqueJobParameters</td><td>Timestamp를 이용하여 유일한 값을 지니는 Job Parameter 문자열을 생성한다.</td><td>없음</td></tr><tr><td>addJobParameter</td><td>이미 생성된 Job Parameter 문자열에 Job Parameter 문자열을 추가한다.</td><td>기존 Job Parameter 변수 ,추가할 Job Parameter 이름(키), 값 ,</td></tr></tbody></table><p>Job Parameter 생성 예제는 아래와 같다.</p><ol><li>Job Parameter를 생성한다. 이 때, 생성되는 Job Parameter는 Timestamp 값을 지니고 있어 유일성이 보장된다.</li><li>생성한 Job Parameter 변수에 “inputFile”이라는 Job Parameter 이름을 지닌 Job Parameter를 추가하고, ”/egovframework/batch/data/inputs/csvData.csv”라는 값을 할당한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#000>String</span> <span style=color:#000>jobParameters</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>egovBatchRunner</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createUniqueJobParameters</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>jobParameters</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>egovBatchRunner</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addJobParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>jobParameters</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;/egovframework/batch/data/inputs/csvData.csv&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>이렇게 생성된 JobParameters는 XML에서 사용할 수 있다. 자세한 내용은 <a href=./batch-core-job#jobparameters>Job Parameters</a> 항목을 참조한다.</p><h4 id=사용방법>사용방법</h4><p>EgovBatchRunner 예제</p><h3 id=egovcommandlinerunner>EgovCommandLineRunner</h3><h4 id=구조-1>구조</h4><p>EgovCommandLineRunner는 Job Launcher 및 Job Explorer를 이용하여 Job Config에 등록된 Job을 실행할 수 있으며, 실행할 수 있도록 하는 기능을 제공한다.</p><p><img src=../images/egov_commandline_runner.png alt=image></p><h4 id=제공기능-1>제공기능</h4><p>EgovCommandLineRunner에서는 start 메소드를 이용하여 Job을 시작한다. start 메소드에 필요한 파라미터는 아래와 같으며, 배치실행을 위해서는 Job Path와 Job Identifier는 반드시 필요하다.</p><table><thead><tr><th>파라미터</th><th>설명</th></tr></thead><tbody><tr><td>Job Path</td><td>Job 실행에 필요한 context 정보가 들어있는 xml</td></tr><tr><td>Job Identifier</td><td>실행할 Job의 이름, 혹은 Job의 Execution ID</td></tr><tr><td>Parameters</td><td>Job Parameter</td></tr><tr><td>Option</td><td>실행옵션</td></tr></tbody></table><p>실행옵션을 지정하지 않았을 경우 Job을 시작한다. 그리고 실행옵션을 지정했을 경우 해당하는 동작을 수행하며, Job Identifier의 지정 방식도 달라진다. 실행옵션의 종류 및 Job Identifier 지정방식은 아래와 같다.</p><table><thead><tr><th>실행옵션</th><th>설명</th><th>Job Identifier</th></tr></thead><tbody><tr><td>미지정</td><td>Job을 시작한다.</td><td>Job의 이름</td></tr><tr><td>-restart</td><td>정지되었거나 이미 종료 된 Job 중 재실행 가능한 Job 을 재시작한다.</td><td>Job의 Execution ID</td></tr><tr><td>-stop</td><td>실행 중인 Job을 정지시킨다.</td><td>Job의 Execution ID</td></tr><tr><td>-next</td><td>Job을 JobParameter만 변경하여 실행한다.</td><td>Job의 Execution ID</td></tr><tr><td>-abandon</td><td>정지된 Job의 상태를 “ABANDONED”으로 변경한다.</td><td>Job의 Execution ID</td></tr></tbody></table><h4 id=사용방법-1>사용방법</h4><p><a href=batch-core-egov_commandline_runner_template.md>배치 템플릿을 이용한 EgovCommandLineRunner 예제</a></p><h3 id=egovschedulerrunner>EgovSchedulerRunner</h3><h4 id=구조-2>구조</h4><p>기존의 Batch Runner와는 다르게, EgovSchedulerRunner는 Job을 직접 실행하는 것이 아니라 Scheduler를 실행한다. 이 Scheduler가 설정되어 있는 시간 및 주기 간격으로 Job을 실행하게 된다. Scheduler는 Quartz를 사용하고 있으며, Quartz의 자세한 사용법 및 설정 방법은 <a href=../foundation-layer/scheduling-service.md>Scheduling</a> 서비스를 참고한다.</p><p><img src=../images/egov_scheduler_runner.png alt=image></p><h4 id=설정-및-사용방법>설정 및 사용방법</h4><p><a href=batch-core-egov_scheduler_runner_template.md>배치 템플릿을 이용한 EgovSchedulerRunner 예제</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-48828303b6ab8a2371892ffd0e2ff144>15 - JobRegistry</h1><div class=lead>JobRegistry는 생성된 Job을 자동으로 Map형태로 저장하여 관리한다. JobRegistry는 context에서 Job을 추적하거나 다른 곳에서 생성된 Job을 application context의 중앙에 모을 때 유용하게 사용할 수 있다. 등록된 Job의 이름과 속성들을 조작할 수 있으며, job name과 job instance의 Map의 형태로 이루워져 있다.</div><h1 id=jobregistry>JobRegistry</h1><h2 id=개요>개요</h2><p>JobRegistry는 생성된 Job을 자동으로 Map형태로 저장하여 관리(추가, 삭제 등)한다.</p><h2 id=설명>설명</h2><p>JobRegistry는 필수는 아니지만 context에서 Job을 추적하거나 다른 곳에서 생성된 Job을 application context의 중앙에 모을 때 유용하다. 등록된 Job의 이름과 속성들을 조작할 수 있으며 job name과 job instance의 Map의 형태로 이루워져 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.MapJobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>JobRegistry에 Job을 자동으로 등록하는 방법은 두 가지가 있다.</p><ul><li>JobRegistryBeanPostProcessor 사용</li><li>AutomaticJobRegistrar 사용</li></ul><h3 id=jobregistrybeanpostprocessor>JobRegistryBeanPostProcessor</h3><p>이것은 Bean post-processor으로 Application Context가 올라가면서 bean 등록 시, 자동으로 JobRegistry에 Job을 등록 시켜준다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRegistryBeanPostProcessor&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.JobRegistryBeanPostProcessor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=automaticjobregistrar>AutomaticJobRegistrar</h3><p>부모 context에서 자식 contexts에 생성된 Job들을 사용하기 위해 자동으로 부모 context의 JobRegistry에 Job들을 등록시킨다. AutomaticJobRegistrar을 사용하기 위해서는 아래와 같이 ApplicationContextFactory와 JobLoader의 설정은 필수이다. ApplicationContextFactory는 ClassPathXmlApplicationContextFactory를 이용하여 자식 context를 생성하고 JobLoader는 자식 context를 관리하고 JobRegistry에 Job 등록을 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...AutomaticJobRegistrar&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;applicationContextFactories&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...ClasspathXmlApplicationContextsFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resources&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath*:/config/job*.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobLoader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...DefaultJobLoader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/configureJob.html#d0e2232>http://static.springsource.org/spring-batch/reference/html/configureJob.html#d0e2232</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-754065162d11a266c1e7027c08b3d5ef>16 - JobExplorer</h1><div class=lead>JobExplorer는 실행 중인 Job 및 Step을 검색하기 위한 시작지점으로서, Repository에 접근하여 배치의 정보를 얻는다.</div></div><div class=td-content style=page-break-before:always><h1 id=pg-dd276042fb1062cb2f6b7d3ad29fd833>17 - JobOperator</h1><div class=lead>JobOperator는 Job을 제어하는 모니터링 작업을 위해 사용된다. JobOperator는 JobRegistry, JobExplorer, JobLauncher, JobRepository 클래스의 설정이 필수적이며, Job의 InstanceId, ExecutionId, JobName을 이용하여 Job을 제어한다.</div></div><div class=td-content style=page-break-before:always><h1 id=pg-17d8961c4a279596a344e89dda9ee815>18 - Skip/Retry/Repeat</h1><div class=lead>Skip, Retry, Repeat은 효율적인 배치수행을 위해 필요한 기능들이다. Repeat 정책에 따라 Step과 Chunk가 반복적으로 수행되면서 데이터 Read, Process, Write 과정이 일어나는데, 여기서 Skip과 Retry 이용해 배치작업을 효율적으로 수행할 수 있다. 각 기능이 쓰이는 위치는 다음 그림을 참고한다.</div><h1 id=skipretryrepeat>Skip/Retry/Repeat</h1><h2 id=개요>개요</h2><p>Skip, Retry, Repeat은 효율적인 배치수행을 위해 필요한 기능들이다. Repeat 정책에 따라 Step과 Chunk가 반복적으로 수행되면서 데이터 Read, Process, Write 과정이 일어나는데, 여기서 Skip과 Retry 이용해 배치작업을 효율적으로 수행할 수 있다. 각 기능이 쓰이는 위치는 다음 그림을 참고한다.</p><p><img src=../images/batch_core-skip_retry_repeat_all.png alt=image></p><h2 id=설명>설명</h2><h3 id=skip>Skip</h3><p>Skip은 데이터를 처리하는 동안 설정된 Exception이 발생했을 경우, 해당 데이터 처리를 건너뛰는 기능이다. 데이터의 사소한 오류에 대해 Step의 실패처리 대신 Skip을 함으로써, 배치수행의 빈번한 실패를 줄일 수 있게 한다.</p><h4 id=skip-로직-구성configuring-skip-logic>Skip 로직 구성(Configuring Skip Logic)</h4><p>Skip설정은 Job설정파일의 &lt;chunk> 내부에서 이루어진다. 일반 chunk 설정(reader, processor, writer, commit-interval)에 추가로 skip-limit 을 지정한다. 또한 &lt;skippable-exception-classes>를 지정할 수 있으며 (이것은 옵션?) 상세설명은 다음 표를 참고한다.</p><table><thead><tr><th>항목</th><th>설명</th><th></th></tr></thead><tbody><tr><td>skip-limit</td><td>Skip 할 수 있는 최대 횟수를 지정<br>default=0 이므로 꼭 지정해줘야 Skip기능 사용 할 수 있음 (확인필요)</td><td></td></tr><tr><td>&lt;skippable-exception-classes></td><td>&lt;include></td><td>skip 해야하는 Exception 범위를 지정</td></tr><tr><td>&lt;skippable-exception-classes></td><td>&lt;exclude></td><td>include로 지정한 exception의 하위 exception 중, Skip하지 않을 Exception 지정</td></tr></tbody></table><p>✔ &lt;skippable-exception-classes> 항목의 Exception 범위 지정은 데이터 성격에 대해 잘 알고 있는 사람이 결정해야 한다.<br>예를 들어 공급업체의 데이터 처리는 Skip 하도록 설정할 수 있지만 금융거래에서 데이터 처리는 Skip이 되어선 안되기 때문이다.</p><p>다음 예시는 FlatFileItemReader로 데이터를 읽는 과정에서 &lt;include> 로 설정된 FlatFileParseException 발생 시 Skip이 일어나도록 설정이 되어 있고, 이렇게 발생한 Skip은 10번까지만 허용한다. 그 이상의 Skip이 발생한다면 Step을 실패처리한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;flatFileItemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;10&#34;</span> <span style=color:#c4a000>skip-limit=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileParseException&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><p>✔ 내부적으로 Skip의 횟수를 관리하는 Counter가 있는데 read, process, write 별로 분리되어 있으며, skip-limit에는 각 Counter의 합계가 적용된다. 데이터 성격에 따라 Skip관리를 위해 Counter를 유용하게 사용할 수 있다.</p><p>위 예시에서 한가지 문제가 있는데 FlatFileItemReader을 제외한 Exception이 발생하는 경우 Job을 실패로 처리하는 것이다. 이러한 처리가 옳을 수도 있지만, 다음예시 처럼 &lt;exclude>를 설정하여 지정한 Exception클래스와 그 하위에러가 발생할 경우에 Skip하지 않고, 에러를 발생시키도록 표현하는 것이 명확하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;flatFileItemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;10&#34;</span> <span style=color:#c4a000>skip-limit=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;java.lang.Exception&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;exclude</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;java.io.FileNotFoundException&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h4 id=관련예제>관련예제</h4><p><a href=../../runtime-example/individual-example/batch-layer/batch-example-skip_mgmt.md>건너뛰기(Skip) 기능 예제</a></p><h3 id=retry>Retry</h3><p>Retry는 데이터를 Processing, Writing 하는 동안 설정된 Exception이 발생했을 경우, 지정한 정책에 따라 데이터 처리를 재시도하는 기능이다. Skip 과 마찬가지로 Retry를 함으로써, 배치수행의 빈번한 실패를 줄일 수 있게 한다.</p><h4 id=retry-로직-구성-configuring-retry-logic>Retry 로직 구성 (Configuring Retry Logic)</h4><p>Retry설정은 Job설정파일의 &lt;chunk> 내부에서 이루어진다. 일반 chunk 설정(reader, processor, writer, commit-interval)에 추가로 retry-limit 을 지정한다. 또한 &lt;retryable-exception-classes>를 지정할 수 있으며 상세설명은 하단 표를 참고한다.</p><table><thead><tr><th>항목</th><th></th><th>설명</th></tr></thead><tbody><tr><td>retry-limit</td><td></td><td>Retry 할 수 있는 최대 횟수를 지정</td></tr><tr><td>&lt;retryable-exception-classes></td><td>&lt;include></td><td>Retry 해야하는 Exception 범위를 지정</td></tr><tr><td>&lt;retryable-exception-classes></td><td>&lt;exclude></td><td>include로 지정한 exception의 하위 exception 중, Retry하지 않을 Exception 지정</td></tr></tbody></table><p>✔ Item Processing과 Item Writing 과정에서만 Retry 된다.</p><p>데이터를 처리하는 Read과정에서 주로 발생하는 FlatFileParseException 대한 문제는 대부분 Skip에서 처리가 된다.<br>반면에, Process 과정과 Write과정에서 발생하는 데이터 선점에 대한 DeadlockLoserDataAccessException 등은 Retry를 통해 해결할 수 있다. 즉, 다른 프로세스에서 처리중인 데이터에 새로운 프로세스가 접근하는 경우 Lock이 걸려 있어 에러가 발생하는데 잠시 후 재시도 하면 성공할 수 있는 것이다.</p><p>✔ Read과정까지 성공한 데이터는 캐쉬에 저장된다. 그러므로 재시도가 일어날 경우 캐쉬의 데이터를 가져와 Process 과정부터 다시 수행한다.</p><p>✔ retryable exception은 기본적으로 rollback을 유발하므로 너무 많은 Retry는 성능을 저하시킬 수 있으므로 주의해야 한다.</p><p>다음 예시는 데이터를 처리하는 과정에서 &lt;include> 로 설정된 DeadlockLoserDataAccessException 발생 시 Retry가 일어나도록 설정이 되어 있고, 이렇게 발생한 Retry는 3번까지만 허용한다. 그 이상의 Retry가 발생한다면 Step을 실패처리한다. 최초 데이터를 읽는 것부터 한번의 시도로 취급하므로, 예제에서는 두번의 시도를 더 할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#c4a000>retry-limit=</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;retryable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.dao.DeadlockLoserDataAccessException&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/retryable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><h4 id=기타-설정>기타 설정</h4><ul><li>retry-policy : <chunk>에서 retry-limit등을 직접 입력하지 않고, 사용자가 상세하게 작성한 Retry 정책을 적용</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;retryPolicyJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;retryPolicyStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;100&#34;</span> <span style=color:#c4a000>retry-policy=</span><span style=color:#4e9a06>&#34;retryPolicy&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;retryPolicy&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.retrypolicy.SimpleRetryPolicy&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;maxAttempts&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span> 							
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><ul><li>backOffPolicy : 다시 Retry를 시도하기까지의 지연시간 (단위:ms), 처리시간이 긴 데이터가 있을 경우 backOffPolicy로 재시도의 시간간격을 조절하여 Retry 설정 변경 가능</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job1&#34;</span> <span style=color:#c4a000>job-repository=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> 
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;stepParent&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> 
</span></span><span style=display:flex><span>     ... 
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepParent&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.step.item.FaultTolerantStepFactoryBean&#34;</span> <span style=color:#c4a000>abstract=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> 
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;backOffPolicy&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.retry.backoff.FixedBackOffPolicy&#34;</span> 
</span></span><span style=display:flex><span>   <span style=color:#a40000>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;backOffPolicy&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;2000&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span> 
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=retry-템플릿retrytemplate>Retry 템플릿(RetryTemplate)</h4><p>조금 더 견고하게 실패를 처리하고, 바로 이어서 시도해서 데이터 처리를 성공할 수 있다고 생각되는 경우, 자동으로 실패한 연산을 재시도하는 것이 도움이 된다. 예를 들어, 네트웍 문제로 실패한 웹 서비스나 ROM 서비스나 데이터베이스 갱신에서 발생한 DeadLockLoserException을 예로 들 수 있다. 스프링 배치에서는 이러한 연산을 자동으로 재시도 하기 위한 RestryOperations 전략을 갖고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RetryOperations</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>retryCallback</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>retryCallback</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RecoveryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>recoveryCallback</span><span style=color:#ce5c00;font-weight:700>)</span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>retryCallback</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RetryState</span> <span style=color:#000>retryState</span><span style=color:#ce5c00;font-weight:700>)</span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ExhaustedRetryException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>T</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>retryCallback</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RecoveryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>recoveryCallback</span><span style=color:#ce5c00;font-weight:700>,</span> 
</span></span><span style=display:flex><span>        <span style=color:#000>RetryState</span> <span style=color:#000>retryState</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>콜백은 재시도하는 비즈니스 로직을 넣을 수 있는 간단한 인터페이스다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>T</span> <span style=color:#000>doWithRetry</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Throwable</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>콜백이 실행되고 예외가 발생해서 실패하는 경우, 성공할때까지 재시도 하게 된다. 또는 구현 여부에 따라 취소 여부를 결정한다.<br>가장 간단한 일반적으로 목적의 RetryOperations의 구현은 RetryTemplate이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>RetryTemplate</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RetryTemplate</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRetryPolicy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TimeoutRetryPolicy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>30000L</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#000>Foo</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>&gt;()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Foo</span> <span style=color:#000>doWithRetry</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Do stuff that might fail, e.g. webservice operation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>});</span>
</span></span></code></pre></div><p>위 예제에서는 웹 서비스 호출을 실행하고 결과를 사용자에게 반환한다. 만약 호출이 실패하면 타임아웃이 될 때까지 재시도한다.</p><h5 id=retrycontext>RetryContext</h5><p>RetryCallback의 파라메터로 RetryContext가 있다. 콜백에서는 이 context를 무시하지만, 만약 필요하다면 반복되는 동안에 데이터를 저장하는 속성 가방(Attribute Bag)으로 사용할 수 있다.</p><h5 id=recoverycallback>RecoveryCallback</h5><p>Retry가 모두 사용되면, RetryOperation 은 다른 콜백(RecoveryCallback)에게 콜백 제어권을 넘길 수 있다. 이런 기능을 사용하려면 같은 방법으로 콜백에 전달하면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Foo</span> <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>&gt;()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Foo</span> <span style=color:#000>doWithRetry</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// business logic here
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#ce5c00;font-weight:700>},</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RecoveryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>&gt;()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Foo</span> <span style=color:#000>recover</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// recover logic here
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>});</span>
</span></span></code></pre></div><p>비즈니스로직이 템플릿 중단을 결정하기 전에 성공되지 못한다면, 클라이언트는 RecoveryCall을 통해 다른 처리를 할 기회가 주어진다.</p><h5 id=stateless-retry>Stateless Retry</h5><p>단순한 Retry 방법은 RetryTemplate이 성공이나 실패를 할때까지 계속 시도하는 루프이다. RetryContext는 재시도 할건지 취소할 건지를 결정하는데 사용하는 상태를 포함하지만, 이 상태는 스택에 저장되고, 어디서나 접근하도록 글로벌하게 저장할 필요는 없다. 그러므로 우리는 이 방법을 무상태 재시도(Stateless Retry)라고 부른다. 무상태 재시도와 상태 유지 재시도 사이의 차이는RetryPolicy의 구현여부이다. (RetryTemplate은 둘 다 제어할 수 있다.) 무상태 재시도에서 Retry가 실패될 때, 콜백은 항상 동일한 쓰레드에서 수행된다.</p><h5 id=stateful-retry>Stateful Retry</h5><p>트랜잭션 처리하는 자원을 무효화 시키는 실패는 몇가지 고려사항이 있다. (일반적으로)트랜잭션 처리가 없기 때문에 간단한 원격호출에 적용될 뿐만아니라 하이버네이트를 사용처럼 데이터베이스 갱신에도 적용된다. 이럴 경우 트랜잭션이 롤백되서, 다시 유효한 트랜잭션으로 시작할 수 있도록 실패가 되자마자 예외를 다시 던지는게 상황에 맞다.</p><p>예외를 다시 던지고(re-throw) 롤백하는 것은 남겨진 RetryOperations.execute메소드와 잠재적으로 스택에 있는 context를 손실하게 되기 때문에, 이런경우 무상태 재시도는 좋은 방법이 아니다. 이 손실을 피하기 위해서는 스택에서 context를 빼내서, 힙 저장 영역에 넣어두는 저장 전략을 도입해야 한다. 이러한 목적으로 스프링 배치는 RetryContextCache를 제공한다. RetryContextCache의 기본 구현은 단순하게 Map을 사용해서 메모리에 저장한다. (비록 클러스터 환경에서는 지나칠지라도) 클러스터 환경에서 다수의 프로세스를 처리하는 고급 사용법은 여러 종류의 클러스터 캐시를 사용하는 RetryContextCache 구현을 고려하자.</p><p>RetryOperations의 책임의 일부는 새로운 실행 (그리고 일반적으로 새 트랜잭션에 싸여)에 돌아 왔을 때 실패한 작업을 인식하는 것이다. 이 원할히 하기 위해, 스프링 배치는 RetryState 추상화를 제공한다. 실패한 작업을 인식하는 방법은 재시도의 여러 호출에 대한 상태를 식별하는 것이다. 상태를 확인하기 위해, 사용자는 Item을 식별하는 고유키를 리턴하는 RetryState객체를 제공해야 한다. 식별자는 RetryContextCache에서 키로 사용된다.</p><h5 id=-주의>✔ 주의</h5><p>RertyState에 이해 리턴되는 키에서 Object.equals()와 Object.hashCode() 구현은 매우 조심해야 한다. 가장 추천하고 싶은 것은 Item을 구분할 수 있는 비즈니스키를 사용하는 것이다. JMS 메시지 경우에 messageID 가 사용될 수 있다.</p><h4 id=retry-정책retry-policies>Retry 정책(Retry Policies)</h4><p>RetryTemplate에서 execute 메소드의 재시도나 실패를 결정하는건 RetryPolicy에 의해서 결정된다. RetryPolicy는 RetryContext의 팩토리가 되기도 한다. RetryTemplate은 RetryContext를 만들기 위해서 현재 정책을 사용해야 할 책임을 갖으며, 시도마다 RetryCallback에 이를 전달한다. 콜백이 실패한 후에 RetryTemplate은 상태를 갱신하려고 RetryPolicy를 호출하며(RetryContext에 저장된다), 그 다음으로 또 다른 시도를 할 수 있는 경우에 RetryPolicy를 호출해서 정책을 문의하게 된다. (예를 들어, 제한에 걸렸거나 타입아웃이 되버린 것처럼) 또 다른 시도를 하지 못하게 되면, 정책은 다 사용된 상태를 관리하는 책임을 진다. 단순히 구현하자면 RetryExhastedException을 던지게 되고, 관련된 트랜잭션은 롤백된다. 좀 더 정교하게 구현하자면,트랜잭션을 손상하지 않고 유지할 수 있는 경우에 복구 행동을 시도할 수 있다.</p><h5 id=-tip>✔ Tip</h5><p>실패는 태생적으로 재시도 여부가 결정된다. 일부 예외에서는 언제나 비지니스 로직 문제로 던져지므로 재시작 하는데 전혀 도움이 되지 못한다. 그러므로 모든 예외 타입에 대해서 재시도를 하면 안된다. 오로지 재시도를 할 수 있는 예외에만 집중해야 한다. 일반벅으로 더 공격적으로 재시도를 처리하는 것은 비즈니스 로직에 해가 되지는 않지만, 미리 실패를 알고 있는 것을 재시도하면서 시간을 소비하는 경우라면 비경제적이다.</p><p>스프링 배치는 범용목적의 statelses RetryPolicy의 구현을 제공한다. 예를 들어 SimpleRetryPolicy,TimeoutRetryPolicy 가 아래의 예에서 사용된다. SimpleRetryPolicy는 정해진 최대횟수만큼 예외유형의 리스트에 있는 재시도를 허락한다. SimpleRetryPolicy는 재시도되면 안되는 “치명적”예외 목록을 가지고 있으며, 재시도 동작 그 이상의 미세한 제어를 사용할 수 있도록 재시도가능한 목록에 덮어쓰기된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>SimpleRetryPolicy</span> <span style=color:#000>policy</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleRetryPolicy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Retry on all exceptions (this is the default)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>policy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRetryableExceptions</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// ... but never retry IllegalStateException
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>policy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setFatalExceptions</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#000>IllegalStateException</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Use the policy...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>RetryTemplate</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RetryTemplate</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRetryPolicy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>policy</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Foo</span><span style=color:#ce5c00;font-weight:700>&gt;()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Foo</span> <span style=color:#000>doWithRetry</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// business logic here
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>});</span>
</span></span></code></pre></div><p>사용자는 더 많은 재정의된 결정에 자신의 재시도 정책을 구현해야 할 수도 있다.</p><h4 id=backoff-정책backoff-policies>Backoff 정책(Backoff Policies)</h4><p>일시적인 실패 후에 재시도되 때, 실패의 원인이 되는 일부 문제들은 단지 잠시 기다리기만 해도 해결되는 경우가 있기 때문에, 많은 경우 다시 시도하기 전에 잠시 기다리는게 도움이 되기도 한다. RetryCallback이 실패한 경우,</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>BackoffPolicy</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>BackOffContext</span> <span style=color:#000>start</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>backOff</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BackOffContext</span> <span style=color:#000>backOffContext</span><span style=color:#ce5c00;font-weight:700>)</span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>BackOffInterruptedException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>BackoffPolicy 는 자유롭게 방법을 선택해 구현하면 된다. 스프링 배치에서 제공되는 정책은 특별히 Object.waite()를 사용한다. 공통적인 사용은 두 재시도가 락에 걸리고 둘다 실패하는 것을 피하기 위해 긴 기다림이 증가하는 BackOff가 있다. 이러한 목적으로 스프링배치에서 ExponentialBackoffPolicy를 제공한다.</p><h4 id=리스너listeners>리스너(Listeners)</h4><p>종종 서로 다른 다수의 반복에서 공통으로 걸리는하는 추가적인 콜백을 받아오는 것이 유용할 때가 있다. 이러한 목적으로 스프링 배치는 RetryListener 인터페이스를 제공한다. RetryTemplate은 사용자가 RetryListener를 등록하도록 해주며, 반복 동안에 이용할 수 있는 RetryContext와 Throwable 와 함께 콜백에 전해진다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RetryListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>callback</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>callback</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Throwable</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>close</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RetryContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RetryCallback</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>callback</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Throwable</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>open과 close콜백이 모든 재시도 전후에 호출되며, onError()는 개별적인 RetryCallback 호출에 적용된다. 또한 close메소드는 RetryCallback에 의해서 마지막에 던저진 에러가 있는 경우에 Throwable을 받아올 수 있다. 다수의 리스너를 리스트로 갖으며 이는 순서가 있다. open메소드의 경우 동일한 순서로 호출되며,onError()와 close()는 역순으로 호출된다.</p><h4 id=선언적-retrydeclarative-retry>선언적 Retry(Declarative Retry)</h4><p>때때로 발생할 때마다 재시작하고 싶은 비즈니스 처리과정이 있다. 고전적인 예로 원격 서비스 호출이 있다. 스프링 배치는 이러한 목적에 딱 맞는 RetryOperations에서 호출되는 메소드를 감싸는 AOP 인터셉터를 제공한다.RetryOperationsInterceptor는 가로챈 메소드를 실행하고, 제공된 RetryTemplate에 있는 RetryPolicy에 따라서 실패를 재시도 한다.<br>아래는 remoteCall을 호출하는 메소드 서비스 호출을 재시도 하는데 스프링 AOP 네임스페이스를 사용하는 선언적인 재시도의 예제다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;aop:config&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:pointcut</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactional&#34;</span> <span style=color:#c4a000>expression=</span><span style=color:#4e9a06>&#34;execution(* com..*Service.remoteCall(..))&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:advisor</span> <span style=color:#c4a000>pointcut-ref=</span><span style=color:#4e9a06>&#34;transactional&#34;</span> <span style=color:#c4a000>advice-ref=</span><span style=color:#4e9a06>&#34;retryAdvice&#34;</span> <span style=color:#c4a000>order=</span><span style=color:#4e9a06>&#34;-1&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/aop:config&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;retryAdvice&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.retry.interceptor.RetryOperationsInterceptor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>이 예에서는 인터셉터 내에 있는 기본 RetryTemplate을 사용한다. 리스너나 정책을 변경하기 위해 인터셉터에 RetryTemplate을 적용하는 것이 필요하다.</p><h4 id=관련예제-1>관련예제</h4><p><a href=../../runtime-example/individual-example/batch-layer/batch-example-retry_mgmt.md>재시도(Retry) 예제</a></p><h3 id=repeat>Repeat</h3><p>배치는 작업의 구성요소인 Step과 그 하위의 Chunk의 지속적인 반복수행으로 이루어진다. 여기서 반복수행은 Repeat정책을 따르며 구성요소별로 반복을 발생시킴으로써 배치를 수행하는 기능이다.</p><h4 id=repeat-템플릿repeattemplate>Repeat 템플릿(RepeatTemplate)</h4><p>배치 처리 과정은 단순하게 최적화되거나 Job의 일부요소의 반복적인 행동이다. 스프링 배치는 반복을 전략적으로 일반화하고, iterator 프레임워크를 제공하기 위해 RepeatOperations 인터페이스를 가지고 있다.<br>RepeatOperations 인터페이스는 다음과 같다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RepeatOperations</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>RepeatStatus</span> <span style=color:#000>iterate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatCallback</span> <span style=color:#000>callback</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>RepeatException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>콜백은 반복되는 비즈니스 로직을 추가하도록 해주는 간단한 인터페이스다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RepeatCallback</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>RepeatStatus</span> <span style=color:#000>doInIteration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>콜백은 반복이 끝났다고 결정될 때까지 반복적으로 실행된다. 이 인터페이스에서 반환하는 값은 RepeatStatus.CONTINUABLE 또는 RepeatStatus.FINISHED 이다. RepeatStatus는 더 수행할 작업이 있는지에 대한 repeat 수행 호출정보를 전달한다. 일반적으로 RepeatOperations의 구현은 RepeatStatus를 확인하고, 이것을 이용해 수행을 종료할지 반복할지에 대한 결정을 내린다. 호출자에게 더 이상 할 일이 없다는 신호를 보내고자 하는 모든 콜백은 ExistStatus.FINISHED를 반환하면 된다.<br>RepeatOperations의 가장 간단하고 일반적인 구현은 RepeatTemplate이다. 다음처럼 사용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>RepeatTemplate</span> <span style=color:#000>template</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RepeatTemplate</span><span style=color:#ce5c00;font-weight:700>();</span> 
</span></span><span style=display:flex><span><span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCompletionPolicy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FixedChunkSizeCompletionPolicy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>));</span> 
</span></span><span style=display:flex><span><span style=color:#000>template</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>iterate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>RepeatCallback</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExitStatus</span> <span style=color:#000>doInIteration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>// Do stuff in batch...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>ExitStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>CONTINUABLE</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>}</span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>});</span>
</span></span></code></pre></div><p>이 예에서는 계속 할 일이 있다는 것을 보여주는 ExitStatus.CONTINUABLE을 반환한다. 더 이상 수행할 것이 없다는 요청을 보내고 싶다면 ExitStatus.FINISHED 을 반환한다.</p><ul><li>RepeatContext</li></ul><p>RepeatContext는 RepeatCallback의 메소드 인자다. 많은 콜백들은 단순하게 context를 무시하지만, 반복 하는 동안에 일시적으로 사용할 필요가 있는 데이터를 저장하는 속성 가방 (Attribute Bag)으로서 사용될 수 있다. iterate 메소드가 결과 를 반환한 후에, context는 더 이상 존재하지 않게 된다. RepeatContext는 처리 과정에서 내제된 반복이 필요한 경우 부모 context를 갖게 된다. 종종 부모 context는 반복되는 호출 사이에 공유할 필요가 있는 데이터를 저장하는데 유용하다.</p><ul><li>RepeatStatus</li></ul><p>ExitStatus는 스프링 배치에서 처리 과정이 끝났고, 처리가 성공인지 아닌지를 지정하는 목적으로 사용한다. 또는 배치나 반복의 종료 상태에 대한 정보(textual information)를 전달하는데 사용된다. 이 정보는 종료 코드의 형태와 자유로운 형식의 문자상태에 대한 설명이 된다.</p><table><thead><tr><th>프로퍼티 이름</th><th>설명</th></tr></thead><tbody><tr><td>CONTINUABLE</td><td>작업이 남아 있음</td></tr><tr><td>FINISHED</td><td>더 이상의 반복 없음</td></tr></tbody></table><p>RepeatStatus 값은 and 메소드를 사용해 논리 AND수행과 결합될 수 있다. 즉, 어떤 수행의 상태가 FINISHED 면 결과는 FINISHED 다.</p><h4 id=완료-정책completion-policies>완료 정책(Completion Policies)</h4><p>RepeatTemplate 내에서 iterate 메소드에 있는 루프의 종료는 CompletionPolicy에 의해서 결정된다. CompletionPolicy 는 RepeatContext에 대한 팩토리도 된다. RepeatTemplate은 RepeatContext를 생성하는 정책을 이용해 반복 중 모든 단계에서 RepeatCallback에게 전달해야 하는 책임을 가지고 있다. 콜백이 완료된 후에 RepeatTemplate의 doInIteration는 상태를 갱신해야 하는지(RepeatContext에 저장될 것인지) 여부를 CompletionPolicy에게 물어보게 된다. 그 다음으로 반복이 완료된 경우에 정책을 요청하게 된다.</p><p>스프링 배치는 일반적인 목적으로 사용되는 간단한 CompletionPolicy 구현체를 제공한다. 위 예에서 사용한 SimpleCompletionPolicy을 예로 들 수 있다. SimpleCompletionPolicy는 고정된 시간만큼만 실행을 허용한다. (ExistStatus.FINISHED로 정해진 시간보다 강제적으로 일찍 완료할 수 있다.)</p><h4 id=예외-핸들링exception-handling>예외 핸들링(Exception Handling)</h4><p>RepeatCallback 내에서 예외가 던져지는 경우, RepeatTemplate은 예외를 다시 던져야 하는지를 결정하는데 ExceptionHandler에게 의견을 묻게 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ExceptionHandler</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>handleException</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Throwable</span> <span style=color:#000>throwable</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>RuntimeException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>일반적인 사용방법은 주어진 타입의 예외발생 횟수를 세고, 한도에 도달했을때 실패한다. 이러한 목적에 맞게 스프링 배치는 SimpleLimitExceptionHandler와 조금 더 유연한 RethrowOnThresholdExceptionHandler를 제공한다. SimpleLimitExceptionHandler는 limit 프로퍼티와 현재 예외를 비교하는 예외 타입을 가지고 있다. 이 때 제공된 타입의 모든 하위 클래스들도 처리에 포함시킨다. 주어진 타입의 예외는 한계에 도달할 때까지는 무시되었다가 다시 던져지게 된다. 이러한 다른 예외 타입들도 항상 다시 던진다.<br>SimpleLimitExceptionHandler의 선택 가능한 중요한 프로퍼티는 useParent boolean 표시다. 기본값은 false기 때문에, 한계는 현재 RepeatContext에서만 설명된다. true로 설정되었을 때 한계는 내제된 반복(nested iteration)에서 형제context에 걸쳐 유지된다.</p><h4 id=리스너listeners-1>리스너(Listeners)</h4><p>종종 서로 다른 다수의 반복에서 공통으로 걸리는 추가 콜백을 받아오는 것이 유용한 경우가 있다. 이러한 목적으로 스프링 배치는 RpeatListener 인터페이스를 제공한다. RepeatTemplate은 사용자가 RepeatListener를 등록할 수 있게 해준다. 그리고 콜백 반복 중에 이용할 수 있도록 RepeatContext와 RepeatStatus를 전달한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>RepeatListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>before</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>after</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RepeatStatus</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>open</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Throwable</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>close</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>RepeatContext</span> <span style=color:#000>context</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>open과 close 콜백은 개별적언 RepeatCallback 호출에 적용되어 before, after, onError 전후에 호출된다. 또한 다수의 리스너를 리스트로 갖으며 이는 순서가 있다. open과 before는 동일한 순서로 호출되며 after(), onError(), close()는 역순으로 호출된다.</p><h4 id=병렬처리parallel-processing>병렬처리(Parallel Processing)</h4><p>RepeatOperations의 구현은 순차적으로 콜백을 실행하도록 제한하지 못한다. 구현은 동시에 콜백이 실행할 수 있도록 하는 건 제일 중요하다. 이 때문에 스프링 배치는 RepeatCallback을 실행하는데 TaskExecutor 전략을 사용하는 TaskExecutorRepeatTemplate을 제공한다. 기본적으로 (일반 RepeatTemplate과 같은) 동일한 쓰레드에 있는 전체반복을 수행하는 SynchronousTaskExecutor를 사용한다.</p><h4 id=선언적-반복declarative-iteration>선언적 반복(Declarative Iteration)</h4><p>때때로 발생할 때마다 반복하고 싶은 비즈니스 처리과정이 있다. 고전적인 예제로 메세지 파이프라인의 최적화가 있다.메세지를 자주 받게 되는 경우, 매세지 마다 개별적인 트랜잭션으로 처리하는 비용을 참기 보다는 메세지를 배치로 처리 하는게 좀더 효율적이다. 스프링 배치는 이 목적에 맞게 RepeatOperations에서 메소드 호출을 감싸는 AOP 인터셉터를 제공한다. RepeatOperationsInterceptor는 가로챈 메소드를 실행해여 제공된 RepeatTemplate의 CompetionPolicy에 따라서 반복하게 된다.<br>여기서는 스프링 AOP 네임스페이스를 사용해서 호출되는 processMessage 메소드를 호출하는 서비스를 반복하는데 선언적인 반복의 예를 보자.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> <span style=color:#204a87;font-weight:700>&lt;aop:config&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:pointcut</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactional&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>expression=</span><span style=color:#4e9a06>&#34;execution(* com..*Service.processMessage(..))&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:advisor</span> <span style=color:#c4a000>pointcut-ref=</span><span style=color:#4e9a06>&#34;transactional&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>advice-ref=</span><span style=color:#4e9a06>&#34;retryAdvice&#34;</span> <span style=color:#c4a000>order=</span><span style=color:#4e9a06>&#34;-1&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/aop:config&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;retryAdvice&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...RepeatOperationsInterceptor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>이 예에서는 인터셉터 내에 있는 기본 RetryTemplate을 사용한다. 리스너나 정책을 변경하기 위해 인터셉터에 RetryTemplate을 적용하는 것이 필요하다.<br>가로챈 메소드가 void 반환 타입이라면, 인터셉터는 언제나 ExistStatus.CONTINUABLE을 반환한다. (그렇기 때문에 CompletionPolicy가 한정된 종료 지점이 없는 경우라면 무한 반복의 위험이 있다.) 만약 그렇지 않다면 가로챈 메소드에서 ExitStatus.FINISHED를 반환하는 지점이 되는 null을 반환할 때까지 ExitStatus.CONTINUABLE을 반환한다. 그래서 대상 메소드 내에 있는 비즈니스 로직은 null을 반환하거나 RepeatTemplate에서 제공하는 ExceptionHandler에 의해서 다시 던진 예외를 던져서 더 할 일이 없다는 신호를 보낼 수 있다.</p><h2 id=참고자료>참고자료</h2><p>Skip : <a href=http://static.springsource.org/spring-batch/reference/html/configureStep.html#configuringSkip>http://static.springsource.org/spring-batch/reference/html/configureStep.html#configuringSkip</a><br>Retry : <a href=http://static.springsource.org/spring-batch/reference/html/configureStep.html#retryLogic>http://static.springsource.org/spring-batch/reference/html/configureStep.html#retryLogic</a> <a href=http://static.springsource.org/spring-batch/reference/html/retry.html>http://static.springsource.org/spring-batch/reference/html/retry.html</a><br>Repeat : <a href=http://static.springsource.org/spring-batch/reference/html/repeat.html>http://static.springsource.org/spring-batch/reference/html/repeat.html</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-d7bcd0fae5e2da92da9cf60093480782>19 - MultiDataProcessing</h1><div class=lead>배치 수행 시 여러 리소스를 처리해야 할 경우, 전자정부 배치 프레임워크는 MultiData Processing을 통해 다수의 리소스를 읽고 다수(N→N) 또는 하나(N→1)의 결과로 처리하는 기능을 제공한다. MultiResourceItem은 여러 리소스를 읽어 각각의 결과를 생성하고, CompositeItem은 여러 리소스를 하나의 결과로 처리한다.</div><h1 id=multidataprocessing>MultiDataProcessing</h1><h2 id=개요>개요</h2><p>배치 수행시 다수의 리소스를 처리하고자 할 경우에는 일반적인 Job설정으로 처리할 수 없다. 전자정부 배치프레임워크에서는 MultiData Processing을 통해 다수의 리소스를 읽어 다수의 결과로 처리하거나 다수의 리소스를 읽어 하나의 결과로 처리하는 기능을 제공한다.</p><h2 id=설명>설명</h2><p>다수(N개)의 리소스를 처리하는 방식은 N→1, N→N으로 구분된다.</p><ul><li>MultiResourceItem처리: N개의 대상을 읽은 후, 읽은 개수만큼의 결과물을 만들어낸다.</li><li>CompositeItem처리: N개의 대상을 읽은 후, 하나의 결과물을 만들어낸다.</li></ul><p>두 방식을 개념적으로 비교하면 아래와 같다.</p><p><img src=../images/batch_core-multiresource_vs_composite2.png alt=image></p><h3 id=multiresourceitem-처리>MultiResourceItem 처리</h3><p>다수의 파일을 대상으로 동일한 유형의 Batch처리를 하고자 할 경우 MultiResourceItemReader를 사용하면 편리하다.<br>예를 들어, 아래와 같이 &lsquo;file~&lsquo;로 시작하는 파일명을 가진 파일들에 대해 일괄 변경을 수행하고자 할 경우에도 적용 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>file-1.txt  file-2.txt  ignored.txt
</span></span></code></pre></div><h4 id=job-설정>Job 설정</h4><p>Job수행에 사용되는 Reader및 Writer설정은 일반적인 Job과 동일하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;multiResourceIoJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;multiResourceIoStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>		
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>	    <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>	
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h4 id=reader-설정>Reader 설정</h4><p>MultiResourceItemReader를 통해 여러 개의 리소스를 읽어온 다음, 1개의 리소스를 처리하는 Reader에게 데이터처리를 위임한다.<br>이 때, input resource경로에 *를 사용하여 다수의 파일을 처리 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.MultiResourceItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delegate&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>		    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> 
</span></span><span style=display:flex><span>                               <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>         	    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		 <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	     <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	 <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resources&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:data/input/file-*.txt&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=writer-설정>Writer 설정</h4><p>MultiResourceItemWriter를 통해 출력파일의 개수를 지정한 다음, 1개의 리소스를 처리하는 Writer에게 데이터처리를 위임한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.MultiResourceItemWriter&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[&#39;output.file.path&#39;]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemCountLimitPerResource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;6&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delegate&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateWriter&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		 <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=compositeitem처리>CompositeItem처리</h3><p>스프링 배치에서는 Composite처리와 관련하여 CompositeWriter만을 제공하고 있다. 이에 전자정부 배치프레임워크에서는 CompositeReader를 추가적으로 제공한다.</p><h4 id=처리-프로세스>처리 프로세스</h4><p>CompositeReader의 일반적인 처리 프로세스는 아래와 같다.</p><p><img src=../images/batch_core-batch_composite_reader.png alt=image></p><p>✔ <strong>주의!</strong> CompositeReader는 등록된 모든 Reader로부터 데이터를 한 라인씩 순서대로 읽어와서 배열에 넣어주는 역할까지 수행한다.따라서,Writer를 바로 사용하면 안되고 Processor에서 배열을 읽어서 처리하는 과정이 반드시 필요하다.</p><h4 id=처리-유형>처리 유형</h4><p>CompositeReader에는 Reader에서 리소스를 처리해서 Processor로 VO를 전달하는 유형과 Reader자체를 그대로 Processor로 전달하는 유형으로 나뉘며,<br>Processor에서는 전달된 데이터 타입에 맞게 비즈니스 로직을 구현할 수 있다.</p><table><thead><tr><th>유형 I - VO(ValueObject)를 Processor에 전달하는 유형</th><th>유형 II - Reader를 Processor에 전달하는 유형</th></tr></thead><tbody><tr><td><img src=../images/batch_core-batch_composite_vo.png alt=image></td><td><img src=../images/batch_core-batch_composite_read.png alt=image></td></tr><tr><td></td><td></td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemReader&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.item.composite.reader.EgovCompositeFileReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemsMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span>
</span></span><span style=display:flex><span>           <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.item.composite.EgovCompositeItemMapper&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;returnType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;vo&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemReaderList&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;itemReader1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;itemReader2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>``` | 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>```xml
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemReader&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.item.composite.reader.EgovCompositeFileReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemsMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span>
</span></span><span style=display:flex><span>           <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.item.composite.EgovCompositeItemMapper&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;returnType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemReaderList&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;itemReader1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;itemReader2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>``` |
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#### Job 설정
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> CompositeItem처리를 위한 Job설정은 reader에 compositeItemReader를 설정하고, processor를 지정해야 한다.  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>```xml
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>	    <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;compositeItemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span>
</span></span><span style=display:flex><span>	       <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h4 id=reader-설정-1>Reader 설정</h4><p>ComposteItemReader를 설정하기 위해서는 Reader로 사용할 Class, returnType, itemReaderList 항목을 작성해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemReader&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.item.composite.reader.EgovCompositeFileReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemsMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span>
</span></span><span style=display:flex><span>           <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.core.item.composite.EgovCompositeItemMapper&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;returnType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;vo&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemReaderList&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;itemReader1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;itemReader2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader1&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[inputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.FixedLengthTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;columns&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;1-9,10-11&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader2&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[inputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>✔ CompositeItemReader에서 사용가능한 Class는 총 3개가 존재하며 각 Class별 특징은 다음과 같다.</p><table><thead><tr><th>종류</th><th>설명</th></tr></thead><tbody><tr><td>EgovCompositeFileReader</td><td>FlatFile(FixedLength,Delimited), XMLFile 등 파일처리를 위한 용도로 사용</td></tr><tr><td>EgovCompositeCursorReader</td><td>JdbcCursorItemReader를 통해 DB리소스 처리를 하고자 할 경우에 사용</td></tr><tr><td>EgovCompositePagingReader</td><td>JdbcPagingItemReader, IbatisPagingItemReader 등 Paging단위로 DB리소스 처리를 하고자 할 경우에 사용</td></tr></tbody></table><h4 id=processor-설정>Processor 설정</h4><p>CompositeItemReader를 통해 넘어온 VO 또는 Reader를 Processor에서 꺼내와서 처리하는 로직을 구현해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>FileItemProcessor</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>ItemProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>EgovCompositeDataProvider</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>TargetVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>TargetVO</span> <span style=color:#000>process</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EgovCompositeDataProvider</span> <span style=color:#000>eprovider</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>obj</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>eprovider</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMapItems</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>//배열에서 항목을 꺼내오는 로직	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>CustomerCredit</span> <span style=color:#000>vo1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>obj</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>];</span>
</span></span><span style=display:flex><span>        <span style=color:#000>CustomerCredit</span> <span style=color:#000>vo2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>obj</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>];</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>//비즈니스 로직 처리 가능 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>TargetVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TargetVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo1</span> <span style=color:#ce5c00;font-weight:700>!=</span><span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getId</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo2</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>✔ <strong>주의!</strong></p><ul><li>배열에서 object를 꺼내오는 순서는 ItemList에 설정한 순서이며, 꺼내올 때 Object의 타입에 주의한다.</li><li>Processor에서 Writer로 넘겨줄 VO타입을 작성하는 부분에 주의한다.</li><li>ItemReader에서 읽어온 데이터의 길이가 항상 같지는 않기 때문에 읽어온 VO가 null이 아닐 때까지 처리되도록 null체크를 위한 분기문을 넣어준다.</li><li>결과 VO는 반드시 1개가 되어야 하므로 위와 같이 처리할 수 없는 비즈니스 로직은 다른 방식으로 처리해야 한다.</li></ul><h2 id=참고자료>참고자료</h2><ul><li><a href="https://www.egovframe.go.kr//wiki/doku.php?id=egovframework:rte2:brte:batch_example:composite_item">CompositItem 예제</a></li><li><a href="https://www.egovframe.go.kr//wiki/doku.php?id=egovframework:rte2:brte:batch_example:multi_resource">MultiResource예제</a></li><li>MultiItemReader<a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#multiFileInput>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#multiFileInput</a></li><li>CompositeItemWriter<a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#delegatePatternAndRegistering>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#delegatePatternAndRegistering</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-61ca86acdf795fc6814810f50b4f8cab>20 - History Management</h1><div class=lead>배치작업 처리 중의 정보는 JobRepository의 JobInstance, JobParams, JobExecution, StepExecution, key-value 쌍으로 값을 보관할 수 있는 공간인 ExecutionContext에 저장 및 갱신되어 history를 관리한다.</div><h1 id=history-management>History Management</h1><h2 id=개요>개요</h2><p>배치작업 처리 중의 정보는 JobRepository의 JobInstance, JobParams, JobExecution, StepExecution, key-value 쌍으로 값을 보관할 수 있는 공간인 ExecutionContext에 저장 및 갱신되어 history를 관리한다.</p><h2 id=설명>설명</h2><p>JobInstance, JobParams, JobExecution, StepExecution, ExecutionContext 의 각각의 속성에 대해서 정리하였다.</p><h3 id=batch_job_instance>BATCH_JOB_INSTANCE</h3><table><thead><tr><th>JobInstance 속성</th><th>설명</th></tr></thead><tbody><tr><td>jobInstanceId</td><td>JobInstance를 식별하는 ID</td></tr><tr><td>version</td><td>JobInstance 의 수정 횟수</td></tr><tr><td>jobName</td><td>Job의 이름</td></tr><tr><td>jobKey</td><td>JobInstance를 구분 짓는 JobParameters의 serialization</td></tr></tbody></table><h3 id=batch_job_execution>BATCH_JOB_EXECUTION</h3><table><thead><tr><th>JobExecution 속성</th><th>설명</th></tr></thead><tbody><tr><td>status</td><td>BatchStatus는 실행 상태를 나타내는 객체이다, 실행하는 동안에는 BatchStatus,STARTED, 실행이 실패한 경우 BatchStatus.FAILED, 실행이 성공적으로 종료됐을 경우 BatchStatus.COMPLETED가 된다.</td></tr><tr><td>startTime</td><td>Execution이 시작되는 현재 시스템 시간을 java.Util.Data로 저장</td></tr><tr><td>endTime</td><td>Execution의 성공/실패 여부와 관계없이 종료되는 현재 시스템 시간을 java.Util.Data로 저장</td></tr><tr><td>exitStatus</td><td>ExitStatus는 실행의 결과를 나타낸다. 호출자에게 반환될 exit code를 포함한다.</td></tr><tr><td>createTime</td><td>JobExecution이 최초 생성 된 현재 시스템 시간을 java.Util.Data로 저장</td></tr><tr><td>lastUpdated</td><td>JobExecution이 마지막으로 생성 된 현재 시스템 시간을 java.Util.Data로 저장</td></tr><tr><td>executionContext</td><td>execution간 지속돼야 할 모든 데이터를 포함하는 &lsquo;프로퍼티 백&rsquo;</td></tr><tr><td>failureExceptions</td><td>Job이 실행되는 동안 발생한 익셉션 리스트</td></tr></tbody></table><h3 id=batch_job_params>BATCH_JOB_PARAMS</h3><table><thead><tr><th>JobParams 속성</th><th>설명</th></tr></thead><tbody><tr><td>jobInstanceId</td><td>BATCH_JOB_INSTANCE 테이블의 jobInstanceId를 외래키로 지정</td></tr><tr><td>typeCd</td><td>파라마터의 형식을 String으로 저장,null일 될 수 없음</td></tr><tr><td>keyName</td><td>파라미터의 키</td></tr><tr><td>stringVal</td><td>String타입의 파마미터 값</td></tr><tr><td>dateVal</td><td>Date타입의 파마미터 값</td></tr><tr><td>longVal</td><td>Long타입의 파마미터 값</td></tr><tr><td>doubleVal</td><td>Double타입의 파마미터의 값</td></tr></tbody></table><h3 id=batch_step_execution>BATCH_STEP_EXECUTION</h3><table><thead><tr><th>StepExecution 속성</th><th>설명</th></tr></thead><tbody><tr><td>status</td><td>BatchStatus는 실행 상태를 나타내는 객체이다, 실행하는 동안에는 BatchStatus,STARTED, 실행이 실패한 경우 BatchStatus.FAILED, 실행이 성공적으로 종료됐을 경우 BatchStatus.COMPLETED가 된다.</td></tr><tr><td>startTime</td><td>Execution이 시작되는 현재 시스템 시간을 java.Util.Data로 저장</td></tr><tr><td>endTime</td><td>Execution의 성공/실패 여부와 관계없이 종료되는 현재 시스템 시간을 java.Util.Data로 저장</td></tr><tr><td>exitStatus</td><td>ExitStatus는 실행의 결과를 나타낸다. 호출자에게 반환될 exit code를 포함한다.</td></tr><tr><td>executionContext</td><td>execution간 지속돼야 할 모든 데이터를 포함하는 &lsquo;프로퍼티 백&rsquo;</td></tr><tr><td>readCount</td><td>성공적으로 읽은 item 갯수</td></tr><tr><td>writeCount</td><td>성공적으로 쓰인 item 갯수</td></tr><tr><td>commitCount</td><td>해당 execution에서 커밋된 트랜젝션 횟수</td></tr><tr><td>rollbackCount</td><td>롤백된 Step에 의해서 제어된 비즈니스 트랜젝션의 갯수</td></tr><tr><td>readSkipCount</td><td>읽기 과정에서 실패 후, 스킵된 item 갯수</td></tr><tr><td>processSkipCount</td><td>프로세스 과정에서 실패 후, 스킵된 item 갯수</td></tr><tr><td>filterCount</td><td>ItemProcessor에 의해 필터링 된 item 갯수</td></tr><tr><td>writeSkipCount</td><td>쓰기 과정에서 실패 후, 스킵된 item 갯수</td></tr></tbody></table><h3 id=batch_job_execution_context>BATCH_JOB_EXECUTION_CONTEXT</h3><table><thead><tr><th>JobExecutionContext 속성</th><th>설명</th></tr></thead><tbody><tr><td>jobExecutionId</td><td>BATCH_JOB_EXECUTION 테이블의 jobExecutionId를 외래키로 지정</td></tr><tr><td>shortContext</td><td>SERIALIZED_CONTEXT의 문자열 버전</td></tr><tr><td>serializedContext</td><td>전체 Context</td></tr></tbody></table><h3 id=batch_step_execution_context>BATCH_STEP_EXECUTION_CONTEXT</h3><table><thead><tr><th>StepExecutionContext 속성</th><th>설명</th></tr></thead><tbody><tr><td>stepExecutionId</td><td>BATCH_STEP_EXECUTION 테이블의 stepExecutionId를 외래키로 지정</td></tr><tr><td>shortContext</td><td>SERIALIZED_CONTEXT의 문자열 버전</td></tr><tr><td>serializedContext</td><td>전체 Context</td></tr></tbody></table><h2 id=참고자료>참고자료</h2><ul><li>Meta-Data Schema :<a href=http://static.springsource.org/spring-batch/reference/html/metaDataSchema.html>http://static.springsource.org/spring-batch/reference/html/metaDataSchema.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a5832ac18c8d746299ce12e8ae6a0863>21 - 동기/비동기 처리 예제</h1><div class=lead>일괄(배치)처리 작업 수행 시, 작업처리가 종료될 때까지 대기하는 동기방식 처리와 작업처리의 종료를 Callback매커니즘을 이용하여 전달받는 비동기처리에 대한 예제를 보여준다.</div><h1 id=동기비동기-처리-예제>동기/비동기 처리 예제</h1><h2 id=개요>개요</h2><p>일괄(배치)처리 작업 수행 시, 작업처리가 종료될 때까지 대기하는 동기방식 처리와 작업처리의 종료를 Callback매커니즘을 이용하여 전달받는 비동기처리에 대한 예제를 보여준다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=launcher-설정>Launcher 설정</h4><h5 id=동기비동기-처리-예제의-launcher-설정파일인-skipsample-job-launcher-contextxml-을-확인한다>동기/비동기 처리 예제의 Launcher 설정파일인 skipSample-job-launcher-context.xml 을 확인한다.</h5><p>Job 수행시, 동기와 비동기 방식으로 데이터를 처리할 수 있으며, 이 예제에서는 동기 처리가 기본값으로 설정되어 있다. 설정위치는 Launcher 설정파일의 jobLauncher 빈에서 taskExecutor 프로퍼티이며, 참조하는 값으로 다음 두 가지를 설정할 수 있다.</p><ul><li>sync : 동기처리시 사용할 클래스 설정</li><li>async : 비동기처리시 사용할 클래스 설정</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sync&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>  <span style=color:#8f5902;font-style:italic>&lt;!-- 비동기시 ref=&#34;async&#34; --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 동기 처리시  sync --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sync&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 비동기  처리시 async --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;async&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SimpleAsyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=job-설정>Job 설정</h4><h5 id=동기비동기-처리-예제의-job-설정-파일인-delegatingjobxml을-확인한다>동기/비동기 처리 예제의 Job 설정 파일인 delegatingJob.xml을 확인한다.</h5><p>동기/비동기 처리 예제를 위해 특별히 Job을 설정하는 내용은 없다. 이 예제에서 제공하는 Job의 상세 내용은 <a href=./batch-example-job-reuse.md>기존 업무 재사용 예제</a>의 Job 설정과 같으므로 이를 참고한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.adapter.ItemReaderAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;getData&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.adapter.PropertyExtractingDelegatingItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;processPerson&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldsUsedAsTargetMethodArguments&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;value&gt;</span>firstName<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;value&gt;</span>address.city<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.person.PersonService&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h3 id=async-item-processor-구성>Async Item Processor 구성</h3><p>Item Processor를 비동기 처리하기 위해 Spring Batch에서 AsyncItemProcessor 서비를 지원한다.<br>AsyncItemProcessor 서비스를 이용한 설정은 아래와 같다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;task:executor</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>pool-size=</span><span style=color:#4e9a06>&#34;100&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemProcessorAsync&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.integration.async.AsyncItemProcessor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- delegate통해 실제 동작 할 Item Processor를 설정한다. --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delegate&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;fixedLengthToFixedLengthJob.fixedLengthToFixedLengthStep.itemProcessor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- Executor를 설정한다. --&gt;</span>	
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><h4 id=sync-job-launcher-context설정과-delegatingjob설정으로-구성된-junit-test를-수행한다-이-때-배치가-수행되고-관련된-내용을-확인할-수-있다>sync-job-launcher-context설정과 delegatingJob설정으로 구성된 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</h4><p>✔ JunitTest 클래스의 구조는 <a href=../../runtime-example/individual-example/batch-layer/batch-example-run-junit_test.md>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ Thread.sleep(4000) : 비동기로 배치를 수행 시, DB에 배치상태(UNKNOWN)를 셋팅하고 DB연결이 종료되어 Job이 정상적으로 수행되더라도 종료상태(COMPLETED,FAILED)를 확인할 수 없다. 예제에서는 Job결과를 확인하기 위해 Thread를 적정시간동안 정지시켜 인위적으로 종료상태를 확인하도록 설정하였다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>locations</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#34;/egovframework/batch/sync-job-launcher-context.xml&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> 
</span></span><span style=display:flex><span>			<span style=color:#4e9a06>&#34;/egovframework/batch/jobs/delegatingJob.xml&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> 
</span></span><span style=display:flex><span>			<span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span> <span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSyncDelegatingJobFunctionalTests</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testLaunchJob</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>			   <span style=color:#000>jobExecution</span> <span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>			   <span style=color:#8f5902;font-style:italic>//Async 로 수행되는 경우 Exit Status는 UNKNOWN으로 설정 됨
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>			   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;UNKNOWN&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>			   <span style=color:#000>Thread</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4000</span><span style=color:#ce5c00;font-weight:700>);</span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		   <span style=color:#ce5c00;font-weight:700>}</span><span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>InterruptedException</span> <span style=color:#000>ie</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>			   <span style=color:#000>ie</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>		   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>		 <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		 <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>personService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getReceivedCount</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>		 <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;COMPLETED&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#ce5c00;font-weight:700>());</span>	
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><h5 id=asyncitemwriter>AsyncItemWriter</h5><p>수행방법은 <a href="https://www.egovframe.go.kr//wiki/doku.php?id=egovframework:dev2:tst:test_case#test_case_%EC%8B%A4%ED%96%89">JunitTest 실행</a>을 참고한다.</p><h2 id=참고자료>참고자료</h2><ul><li><a href=../../runtime-example/individual-example/batch-layer/batch-example-sync-async.md>동기/비동기 예제</a></li><li><a href=./batch-execution-job-launcher.md>JobLauncher</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b60eee4cc41f08c52da6c9715229a22f>22 - Listener (Pre/Post Processing)</h1><div class=lead>Listener는 배치 작업의 각 단계(Job, Step, Chunk 등)에서 이벤트 설정을 통해 추가 구성을 할 수 있으며, 설정된 이벤트를 실행 중에 처리한다. JobListener는 Job의 라이프사이클 동안 다양한 이벤트를 감지하고, 사용자 정의 코드를 실행할 수 있도록 지원한다.</div><h1 id=listener-prepost-processing>Listener (Pre/Post Processing)</h1><h2 id=개요>개요</h2><p>배치 수행시 Job을 구성하는 각 단계(Job, Step, Chunk, Read, Process, Write)에서 이벤트설정을 통해 다양한 추가구성을 할 수 있다. 이벤트는 Listener를 활용하여 설정하고, 배치 수행중 설정한 Listener를 접하게 되면 관련된 이벤트를 수행하게 된다.</p><h2 id=설명>설명</h2><h3 id=joblistenerintercepting-job-execution>JobListener(Intercepting Job Execution)</h3><p>Job 실행 과정에서, 사용자가 정의한 코드가 실행 될 수 있도록 Job의 라이프사이클에서 다양한 이벤트로 알려주는 것은 유용하다.SimpleJob는 적절한 시간에 JobListener를 호출하도록 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>JobExecutionListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>JobListeners는 Job의 리스너들을 통해 SimpleJob에 추가 될 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;footballJob&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;playerload&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;gameLoad&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;gameLoad&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;playerSummarization&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;playerSummarization&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sampleListener&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><p>Job의 성공, 실패에 관계없이 afterJob이 호출되어야한다. 만약 성공과 실패의 결정이 필요하다면 JobExecution에서 얻을 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>if</span><span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>BatchStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span> <span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//job success
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>BatchStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FAILED</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>//job failure
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>✔ JobExecutionListener 인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@BeforeJob</td><td>Job수행 전에 호출</td></tr><tr><td>@AfterJob</td><td>Job수행 후에 호출</td></tr></tbody></table><h3 id=steplistenerintercepting-step-execution>StepListener(Intercepting Step Execution)</h3><h4 id=stepexecutionlistener>StepExecutionListener</h4><p>StepExecutionListener는 Step 실행에서 가장 일반적인 리스너이다. Step에 대한 정보를 Step 시작전과 종료후에 알려준다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>StepExecutionListener</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeStep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>ExitStatus</span> <span style=color:#000>afterStep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>afterStep의 반환 리턴타입인 ExitStatus는 청리스너에게 단계 완료시 반환되는 exit-code를 수정 할 수있는 기회를 준다.</p><p>이 인터페이스에 해당하는 주석입니다</p><p>✔ StepExecutionListener 인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@BeforeStep</td><td>Step 수행 전에 호출</td></tr><tr><td>@AfterStep</td><td>Step 수행 후에 호출</td></tr></tbody></table><h4 id=chunklistener>ChunkListener</h4><p>Chunk는 트랜잭션 범위 내에서 아이템을 처리하는 것이다. 트랙잭션을 커밋하고, commit interval 단위로 Chunk를 커밋한다. ChunkListener는 Chunk 처리를 시작하기 전에 또는 성공적으로 완료 한 후 구현로직을 수행한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ChunkListener</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeChunk</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterChunk</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>beforeChunk 메소드는 트랜잭션이 시작해서 ItemReader의 read 수행되기전에 불린다. 반대로, afterChunk 메소드는 rollback이 일어나지 않고 Chunk가 커밋된 후에 불린다.</p><p>✔ ChunkListener 인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@BeforeChunk</td><td>Chunk 수행 전에 호출</td></tr><tr><td>@AfterChunk</td><td>Chunk 수행 후에 호출</td></tr></tbody></table><p>✔ TaskletStep 수행같은 Chunk 선언이 없는 경우에는 ChunListener을 적용할 수 없다.</p><h4 id=itemreadlistener>ItemReadListener</h4><p>Skip 로직 설명에서, 나중에 처리 할 수 있도록 Skip로그를 기록할 수 있다고 언급했다. read 오류의 경우, ItemReaderListener 가 이 작업을 수행한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ItemReadListener</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeRead</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterRead</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onReadError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>ex</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>beforeRead 메소드는 ItemReader에서 read 수행 전에 호출된다.<br>afterRead 메소드는 read 수행이 성공했을때 호출되고, 읽은 item을 전달한다.<br>Read 수행중 오류가 발생하는 경우 onReadError 메서드가 호출된다. 기록을 위해 발생한 예외정보가 전달된다.</p><p>✔ ItemReadListener인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@BeforeRead</td><td>Read수행 전에 호출</td></tr><tr><td>@AfterRead</td><td>Read수행 후에 호출</td></tr><tr><td>@OnReadError</td><td>Read 수행중 오류발생시 호출</td></tr></tbody></table><h4 id=itemprocesslistener>ItemProcessListener</h4><p>ItemReadListener 처럼, item 처리에서도 리스너가 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ItemProcessListener</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeProcess</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterProcess</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>S</span> <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onProcessError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>beforeProcess 메소드는 ItemProcessor의 process 과정 이전에 호출이 되고, 처리되는 item 을 전달한다.<br>afterProcess 메소드는 item 이 성공적으로 처리된 후에 호출된다.<br>만약 처리과정에서 에러가 발생한다면, onProcessError가 호출되는데 예외정보와 item을 전달하므로 기록을 남길 수 있다.</p><p>✔ ItemProcessListener 인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@BeforeProcess</td><td>Process 수행 전에 호출</td></tr><tr><td>@AfterProcess</td><td>Process 수행 후에 호출</td></tr><tr><td>@OnProcessError</td><td>Process 수행중 오류발생시 호출</td></tr></tbody></table><h4 id=itemwritelistener>ItemWriteListener</h4><p>ItemWriteListener로 item을 쓰는 과정에서 리스너를 호출할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>ItemWriteListener</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeWrite</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>items</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterWrite</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>items</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onWriteError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>exception</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>items</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>beforeWrite 메소드는 ItemWriter에서 write 수행 전에 호출되고 쓰여진 item을 전달한다.<br>afterWrite 메소드는 write 수행이 성공했을때 호출되고, 읽은 아이템을 전달한다.<br>write 수행중 오류가 발생하는 경우 onWriteError 메소드가 호출된다. 기록을 위해 발생한 예외정보와 item들이 리스트형식으로 전달된다.</p><p>✔ ItemWriteListener 인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@BeforeWrite</td><td>Write 수행 전에 호출</td></tr><tr><td>@AfterWrite</td><td>Write 수행 후에 호출</td></tr><tr><td>@OnWriteError</td><td>Write 수행중 오류 발생시 호출</td></tr></tbody></table><h4 id=skiplistener>SkipListener</h4><p>itemReadListener, ItemProcessListener, ItemWriteListner 에서 에러발생을 알려주는 메카니즘을 제공하지만, item 처리가 Skip 될 경우에는 아무도 알려주지 않는다. 이를 위해 Skip된 item을 추적하는 인터페이스가 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>SkipListener</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onSkipInRead</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Throwable</span> <span style=color:#000>t</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onSkipInProcess</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Throwable</span> <span style=color:#000>t</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onSkipInWrite</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>S</span> <span style=color:#000>item</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Throwable</span> <span style=color:#000>t</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>onSkipInRead 메소드는 read 수행중 Skip 발생할경우 언제나 호출된다. 주의할 점은 한 번 이상 Skip 되었기에 롤백은 동일한 항목이 등록될 수 있다는 것을 알려야 한다.<br>onSkipInWrite 메소드는 write 수행중 Skip 이 발생한 경우 호출되는데, 여기서 해당 item은 성공적으로 read 되었기 때문에 item 그 자체를 인수로 제공한다.</p><p>✔ SkipListener 인터페이스에 해당하는 Annotations</p><table><thead><tr><th>Annotations</th><th>설명</th></tr></thead><tbody><tr><td>@OnSkipInRead</td><td>Read 수행중 Skip 발생시 호출</td></tr><tr><td>@OnSkipInWrite</td><td>Write 수행중 Skip 발생시 호출</td></tr><tr><td>@OnSkipInProcess</td><td>Process 수행중 Skip 발생시 호출</td></tr></tbody></table><h5 id=skiplisteners-and-transactions>SkipListeners and Transactions</h5><p>SkipListener에 대한 가장 일반적인 사용 사례 중 하나는 다른 일괄 처리나 사람이 직접 처리할 때 사용할 수 있도록 Skip된 item을 기록하는 것이다.</p><p>✔ 트랜잭션에서 롤백 될 수 있는 경우가 많기 때문에 스프링에서는 다음 두가지를 보장한다.</p><p>1. 적절한 Skip 방법은(오류에 따라) 항목 당 한 번만 호출된다.<br>2. SkipListener는 항상 트랜잭션 커밋 전에 호출된다. 그러므로 리스너에 의해 호츨된 트랜잭션 자원은 ItemWriter에서 실패하여 롤백되지 않는다.</p><h4 id=관련-예시>관련 예시</h4><ul><li>어노테이션 사용</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EventNoticeListener</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#5c35cc;font-weight:700>@Autowired</span>
</span></span><span style=display:flex><span>	<span style=color:#000>EgovEmailEventNoticeTrigger</span> <span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Job 수행완료 후 수행
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#5c35cc;font-weight:700>@AfterJob</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExitStatus</span> <span style=color:#000>sendJobNotice</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	 <span style=color:#8f5902;font-style:italic>// Step 수행완료 후 수행
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#5c35cc;font-weight:700>@AfterStep</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExitStatus</span> <span style=color:#000>sendStepNotice</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Read 중 Error 발생시 수행
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#5c35cc;font-weight:700>@OnReadError</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>sendErrorNotice</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=작업-전후처리-관리-egovprepostprocessor>작업 전후처리 관리 (EgovPre/PostProcessor)</h3><p>전자정부 표준프레임워크에서는 스프링에서 제공하는 다양한 Listener를 배치작업의 구성요소(Job, Step, Chunk)별로 나누고 각 단계의 전/후로 나누어, 클래스 이름만으로 독립적인 역할을 명확히 알 수 있는 Processor를 제공한다. Processor 들은 Job 설정파일의 &lt;listener>가 호출하며, 각각의 Processor가 호출되는 위치는 다음 그림을 참조한다.</p><p>✔ 그림의 EgovSampleXXXProcessor는 예시 클래스이며, 전자정부 표준프레임워크에서 제공하는 Processor를 상속받아 구현된 클래스이다.</p><p><img src=../images/batch_core-processor_gmgt_structure.png alt=image></p><h4 id=job-processor>Job Processor</h4><h5 id=종류>종류</h5><table><thead><tr><th>클래스명</th><th>제공메소드명</th><th>파라미터</th><th>설명</th></tr></thead><tbody><tr><td>EgovJobPreProcessor</td><td>beforeJob()</td><td>JobExecution</td><td>Job 단계 이전에 호출</td></tr><tr><td>EgovJobPostProcessor</td><td>afterJob()</td><td>JobExecution</td><td>Job 단계 이후에 호출</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovJobPreProcessor</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>JobExecutionListenerSupport</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * Job 수행 이전에 호출되는 부분
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovJobPostProcessor</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>JobExecutionListenerSupport</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * Job 수행 이후에 호출되는 부분 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=설정>설정</h5><p>위 클래스를 상속받아 사용자가 정의한 Job Processor는 설정파일에서 &lt;listeners>를 이용해 다음과 같은 위치에 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;ProcessorJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;ProcessorStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;사용자가 정의한 Job Processor 클래스&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=step-processor>Step Processor</h4><h5 id=종류-1>종류</h5><table><thead><tr><th>클래스명</th><th>제공메소드명</th><th>파라미터</th><th>설명</th></tr></thead><tbody><tr><td>EgovStepPreProcessor</td><td>beforeStep()</td><td>StepExecution</td><td>Step 단계 이전에 호출</td></tr><tr><td>EgovStepPostProcessor</td><td>afterStep()</td><td>StepExecution</td><td>Step 단계 이후에 호출</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovStepPreProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListenerSupport</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * Step 수행 이전에 호출되는 부분
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeStep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovStepPostProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepListenerSupport</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * Step 수행 이후에 호출되는 부분
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExitStatus</span> <span style=color:#000>afterStep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=설정-1>설정</h5><p>위 클래스를 상속받아 사용자가 정의한 Step Processor는 설정파일에서 &lt;listeners> 를 이용해 다음과 같은 위치에 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;ProcessorJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;ProcessorStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;stepListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;사용자가 정의한 Step Processor 클래스&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=chunk-processor>Chunk Processor</h4><h5 id=종류-2>종류</h5><table><thead><tr><th>클래스명</th><th>제공메소드명</th><th>파라미터</th><th>설명</th></tr></thead><tbody><tr><td>EgovChunkPreProcessor</td><td>beforeChunk()</td><td>없음</td><td>Chunk 단계 이전에 호출</td></tr><tr><td>EgovChunkPostProcessor</td><td>afterChunk()</td><td>없음</td><td>Chunk 단계 이후에 호출</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovChunkPreProcessor</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>ChunkListenerSupport</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * Chunk 수행 이전에 호출되는 부분
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>beforeChunk</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovChunkPostProcessor</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>ChunkListenerSupport</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * Chunk 수행 이후에 호출되는 부분
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>afterChunk</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=설정-2>설정</h5><p>위 클래스를 상속받아 사용자가 정의한 Chunk Processor는 설정파일에서 &lt;listeners> 를 이용해 다음과 같은 위치에 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;ProcessorJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;ProcessorStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;chunkListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>	
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;chunkListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;사용자가 정의한 Chunk Processor 클래스&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=사용예시>사용예시</h4><p><a href=./batch-example-pre-post-process-mgmt.md>작업 전후처리 예제</a></p><h2 id=참고자료>참고자료</h2><p><a href=http://static.springsource.org/spring-batch/reference/html/configureJob.html#interceptingJobExecution>http://static.springsource.org/spring-batch/reference/html/configureJob.html#interceptingJobExecution</a><br><a href=http://static.springsource.org/spring-batch/reference/html/configureStep.html#interceptingStepExecution>http://static.springsource.org/spring-batch/reference/html/configureStep.html#interceptingStepExecution</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-c25576b1a0f79a9148ddb8d832ef2f65>23 - 병행처리</h1><div class=lead>배치 작업에서 병렬처리를 통해 Job의 구성요소들을 여러 쓰레드로 분산 실행하여 빠르고 효율적으로 작업을 완료할 수 있다. 스프링 배치에서는 멀티쓰레드, Parallel 방식, 파티셔닝 방식 등 다양한 병렬처리 방식을 지원하며, 멀티쓰레드는 Step의 <tasklet>에 TaskExecutor를 추가해 간단히 구현할 수 있다.</div><h1 id=병행처리>병행처리</h1><h2 id=개요>개요</h2><p>대용량 데이터를 처리하는 배치수행에서 병렬처리를 이용하면, Job의 구성요소들이 여러 쓰레드 분산수행되어 빠른 시간 내에 효율적으로 작업을 완료할 수 있다.
스프링 배치에서 병렬처리 방식은 실행 유형별로 멀티쓰레드 방식, Parallel 방식, 파티셔닝 방식 등이 있다.</p><h2 id=설명>설명</h2><h3 id=멀티쓰레드multi-threaded-step>멀티쓰레드(Multi-threaded Step)</h3><p>병렬처리를 시작하는 간단한 방법은 Step 구성요소중 &lt;tasklet> 속성에 TaskExecutor를 추가하는 것이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;loading&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>...<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><p>TaskExecutor 예제에서 TaskExecutor 인터페이스를 구현하기 위해 빈을 정의한다. TaskExecutor 는 스프링 인터페이스 표준이므로 상세한 내용은 스프링 가이드를 참고한다. 가장 간단한 멀티쓰레드 TaskExecutor 는 SimpleAsyncTaskExecutor 이다. 위 Step 구성으로 수행한 결과 각 청크단위의 reading, processing, writing 과정이 분리된 쓰레드에서 수행된다. 즉, 처리시 순서를 보장하지 않으며 Chunk는 단일 쓰레드 수행과 비교해 item 들이 연속적이지 않다.(commit-Interval의 영향으로 Chunk 내의 순서는 같을 수 있다.)</p><p>✔ 쓰레드 수는 기본값으로 4가 설정되어 있으나, 필요하다면 다음처럼 증가시켜 사용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;loading&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>throttle-limit=</span><span style=color:#4e9a06>&#34;20&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		...
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><p>✔ DataSource 처럼 Step에서 사용되는 풀이 리소스들에 의해 대체될 수 있다. 그러므로 Step에서 병행처리 되는 쓰레드 수를 원하는 만큼 최대한 풀을 설정해야 한다.</p><h4 id=관련-예제>관련 예제</h4><p><a href=./batch-example-multi_process.md>멀티쓰레드 예제</a></p><h3 id=parallel-steps>Parallel Steps</h3><p>병행처리가 필요한 응용프로그램 로직은 서로 다른 책임으로 분할될 뿐만 아니라, 각 단계에서 할당되면 그것이 한 프로세스에서 병행처리가 될 수 있다. Parallel Step 수행은 사용하고 구성하기 쉽다.
예를 들어, step3 와 병행처리할 스텝들(step1, step2)은 다음처럼 흐름을 설정하면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;split</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;split1&#34;</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step4&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;flow&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;flow&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/split&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step4&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s4&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;beans:bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...SimpleAsyncTaskExecutor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>task-executor 속성은 각각의 흐름을 실행하는데 필요한 TaskExecutor 구현을 지정하기 위해 사용한다. 기본 설정은 SyncTaskExecutor 이고, 비동기로 실행하려면 이 설정을 AsyncTaskExecutor 로 변경해 주어야 한다.</p><p>✔ 각 작업 분할은 최종 종료 상태로 통합되기 전에 모두 완료하도록 구성해야 한다. 아래 그림처럼 분리된 flow들이 모두 완료해야만 다음 step으로 진행가능하다.</p><p><img src=../images/parallelstep1.png alt=parallelstep1></p><h4 id=관련-예제-1>관련 예제</h4><p><a href=./batch-example-multi_process.md>Parallel 예제</a></p><h3 id=파티셔닝partitioning>파티셔닝(Partitioning)</h3><p>스프링배치는 Step의 파티셔닝 수행을 원격으로 파티셔닝하기 위하여 SPI를 제공한다. 다음 수행 패턴을 그림으로 표현했다.</p><p><img src=../images/partition-overview.png alt=partition-overview></p><p>Job은 왼쪽부터 Step의 흐름대로 진행된다. Step들 중에서 하나는 마스터 라벨로 지정되어 있다. 이 그림에서 슬레이브 라벨들은 Step의 인스턴스로 식별되고, 그 결과가 마스터의 결과로 귀속된다. 슬레이브는 전형적으로 원격서비스로 이루어지며 로칼쓰레드로 전달된다. JobRepository 의 스프링배치 meta-data에서 각각의 슬레이브가 Job에서 각각 한번 수행되는 것을 보장한다.</p><p>스프링배치의 SPI는 Step의 특별한 구현(PartitionStep)으로 구성되어있다. PartitionHandler와 StepExecutionSplitter 라는 두개의 인터페이스가 있고 이 역할은 아래 그림을 참고한다.</p><p><img src=../images/partition-flow.png alt=partition-flow></p><p>오른쪽의 Step은 잠재적으로 여러 객체를 갖고 있고 각 역할을 수행하는 remote 슬레이브이다. Partition Step은 다음과 같이 구성되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1.master&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;partition</span> <span style=color:#c4a000>step=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>partitioner=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;handler</span> <span style=color:#c4a000>grid-size=</span><span style=color:#4e9a06>&#34;10&#34;</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/partition&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><p>✔ 멀티쓰레드 스텝의 throttle-limit 속성과 유사하게 grid-size 속성이 있어서, 이것이 각 Step의 요청이 포화상태가 되는 것을 방지한다.</p><h4 id=partitionhandler>PartitionHandler</h4><p>PartitionHandler 는 Remote 환경이나 Grid 환경의 구조를 알고있는 컴포넌트이다.
이것은 DTO 같은 포맷으로 감싸 StepExecution을 원격에 있는 Step에 보낼 수 있다. 여기에서는 입력데이터들이 어떻게 나누어지는지, 멀티 Step 수행결과들이 어떻게 합쳐지는지 알 필요가 없다.
하지만 스프링 배치는 TaskExecutor 전략을 이용하여 분리된 쓰레드에서 Step들을 수행시키는 유용한 PartitionHandler 도 제공한다. 이런 구현체를 TaskExecutorPartitionHandler라고 하는데 XML 로 구성된 Step에 기본값으로 정해져 있다. 또한, 다음처럼 구성할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1.master&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;partition</span> <span style=color:#c4a000>step=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>handler=</span><span style=color:#4e9a06>&#34;handler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...TaskExecutorPartitionHandler&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;step&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;gridSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;10&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>✔ gridSize는 새로 생성할 분리된 Step의 수를 의미하는데, TaskExecutor에서 쓰레드풀 갯수와 같다. gridSize는 사용가능한 쓰레드 수 이상으로 설정이 될 수 있는데, 이 경우 작은 수가 적용이 된다.</p><h4 id=partitioner>Partitioner</h4><p>Partitioner는 새로운 Step Execution을 위한 입력 파라미터와 같은 유사한 역할을 한다.(재시작에 대해 걱정할 필요가 없다.) 아래와 같은 인터페이스가 있으며 메소드는 partition 메소드 하나뿐이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>Partitioner</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>partition</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>gridSize</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>여기서 메소드의 리턴값은 ExecutionContext 타입과 String 타입의 유일한 이름인 stepExecution이다. 여기서 이름은 파티션된 StepExecution의 Step 이름으로 이후에 배치의 meta data에서 보여준다. ExecutionContext 는 이름, 값으로 구성된 여러 쌍들이 담긴 가방이며 기본키, line 수, 입력 파일의 위치등의 정렬을 포함할 수도 있다.</p><p>StepExecution 들의 이름은 Job의 StepExecution이 서로 달라야 한다. 가장좋은 방법은 prefix+suffix 의 형태로 사용자를 위한 의미있는 이름을 만드는 것이다. 여기서 prefix는 실행되는 Step의 이름이고, suffix는 카운터이다. SimplePartitioner가 이와 같은 형태의 StepExecution 이름을 지정한다.</p><h4 id=step에-입력리소스-등록하기binding-input-data-to-steps>Step에 입력리소스 등록하기(Binding Input Data to Steps)</h4><p>Step이 동일한 구성을 갖는 것은 PartitionHandler에 의해 실행하는 Step과 ExecutionContext에서 런타임에 바인딩하기 위한 입력 매개 변수에 매우 효율적이다. 이것은 스프링 배치의 기능인 <a href=http://static.springsource.org/spring-batch/trunk/reference/html/configureStep.html#step-scope>Step Scope</a>기능과 비슷하다.</p><p>예를 들어, Partitioner 가 fileName 키 속성을 갖고 있는 ExecutionContext 인스턴스를 생성한다면, 각 Step들은 서로다른 파일들을 바라보게 되고 출력결과는 다음처럼 다.</p><table><thead><tr><th>Step Execution Name (key)</th><th>ExecutionContext (value)</th></tr></thead><tbody><tr><td>filecopy:partition0</td><td>fileName=/home/data/one</td></tr><tr><td>filecopy:partition1</td><td>fileName=/home/data/two</td></tr><tr><td>filecopy:partition2</td><td>fileName=/home/data/three</td></tr></tbody></table><h4 id=관련-예제-2>관련 예제</h4><p><a href=../../runtime-example/individual-example/batch-layer/batch-example-multi_process.md>파티셔닝 예제</a></p><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/scalability.html>http://static.springsource.org/spring-batch/reference/html/scalability.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0d607f548e75f85f6e0e212d1954df97>24 - Code Base Exception</h1><div class=lead>배치 처리 시 EgovBatchException을 통해 Code 기반으로 에러를 처리할 수 있으며, 이를 사용하려면 먼저 데이터베이스 에러 코드 관리 테이블과 에러 코드 데이터를 등록해야 한다. 이 서비스를 통해 에러 처리의 효율성을 높일 수 있다.</div><h1 id=code-base-exception>Code Base Exception</h1><h2 id=개요>개요</h2><p>배치 처리시 Code 기반으로 에러를 처리 할 수 있도록 EgovBatchException를 통해서 지원한다.
데이터베이스 에러코드관리 테이블을 등록과 에러코드 데이터를 등록이 선행 되야지만 해당 서비스를 사용가능하다.</p><h2 id=설명>설명</h2><h3 id=code-base-exception-데이터베이스-설정>Code Base Exception 데이터베이스 설정</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>C REATE TABLE BATCH_EXCEPTION_MESSAGE  <span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>	EX_ID BIGINT NOT NULL PRIMARY KEY,
</span></span><span style=display:flex><span>	EX_KEY VARCHAR<span style=color:#ce5c00;font-weight:700>(</span>255<span style=color:#ce5c00;font-weight:700>)</span> NOT NULL,
</span></span><span style=display:flex><span>	EX_MESSAGE VARCHAR<span style=color:#ce5c00;font-weight:700>(</span>2500<span style=color:#ce5c00;font-weight:700>)</span> NOT NULL
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>I NSERT INTO BATCH_EXCEPTION_MESSAGE VALUES<span style=color:#ce5c00;font-weight:700>(</span>1,<span style=color:#4e9a06>&#39;EGOVBATCH000001&#39;</span>,<span style=color:#4e9a06>&#39;배치실행 중 업무 관련 에러가 발생 하였습니다.&#39;</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>I NSERT INTO BATCH_EXCEPTION_MESSAGE VALUES<span style=color:#ce5c00;font-weight:700>(</span>2,<span style=color:#4e9a06>&#39;EGOVBATCH000002&#39;</span>,<span style=color:#4e9a06>&#39;배치실행 중 알수 없는 오류가 발생 하였습니다.&#39;</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><ul><li>방화벽 정책상 [C REATE] 문자를 space 처리 하였습니다. space 문자를 제거 하시면 됩니다.</li><li>방화벽 정책상 [I NSERT] 문자를 space 처리 하였습니다. space 문자를 제거 하시면 됩니다.</li><li>방화벽 정책상 [I NTO] 문자를 space 처리 하였습니다. space 문자를 제거 하시면 됩니다.</li></ul><h3 id=code-base-exception-사용>Code Base Exception 사용</h3><p>에러처리 생성자 생성자 파리미터 데이터베이스소스, 에러코드를 사용하여 에러처리를 할 수 있습니다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>try<span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>catch<span style=color:#ce5c00;font-weight:700>(</span>Exception e<span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>	throw new EgovBatchException<span style=color:#ce5c00;font-weight:700>(</span>dataSource,<span style=color:#4e9a06>&#34;EGOVBATCH000001&#34;</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        //Sql 설정시 EgovBatchException 생성자 파리미터 추가
</span></span><span style=display:flex><span>        //throw new EgovBatchException<span style=color:#ce5c00;font-weight:700>(</span>dataSource,<span style=color:#4e9a06>&#34;EGOVBATCH000001&#34;</span>,<span style=color:#4e9a06>&#34;SELECT EX_MESSAGE FROM BATCH_EXCEPTION_MESSAGE WHERE EX_KEY = ?&#34;</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0efb14f7128c8774153dfc94d782f2cd>25 - 센터 컷(CenterCut)</h1><div class=lead>전자정부 표준프레임워크에서의 큐(Queue)를 사용하여 대용량 데이터 처리를 위해 센터 컷 방식의 배치 작업수행을 위한 가이드를 제공한다.</div><h1 id=센터-컷centercut-소개>센터 컷(CenterCut) 소개</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크에서의 큐(Queue)를 사용하여 대용량 데이터 처리를 위해 센터 컷 방식의 배치 작업수행을 위한 가이드를 제공한다.</p><h2 id=센터컷-가이드-구조>센터컷 가이드 구조</h2><ul><li><p>Unordered List Item기본적으로 센터컷의 구조는 큐(Queue)를 이용하는 부분을 제외하고는 배치 프로그램과 유사하다.</p></li><li><p>Unordered List Item처음 ItemReader를 사용하여 데이터를 읽고 큐에 넣은 Center-Cut Reading Step과, 읽어온 데이터를 가공 후 QueueSender를 통해 Queue에 넣는 구조이다.</p><p><img src=../images/centercut-explain1.png alt=centercut-explain1></p></li><li><p>Center-Cut Process Step은 큐에서 들어온 데이터를 읽고 처리 모듈(Busineess Proc)를 활용하여 데이터를 처리하는 구조이다.</p><p><img src=../images/centercut-queueproc1.png alt=centercut-queueproc1></p></li></ul><p>[참고] QueueSender, QueueReciever만 센터컷을 위해 추가되는 모듈을 가이드하며, 나머지는 배치와 동일하다.</p><h3 id=센터-컷의-가이드-기본-구성>센터 컷의 가이드 기본 구성</h3><ol><li><p>Queue를 사용한 센터 컷 배치 처리를 위하여 Apache ActiveMQ를 활용한다.
현재 가이드의 ActiveMQ의 버전은 apache-activemq-5.15.1이며, 관련 프로그램 및 활용 방법은 아래의 ActiveMQ에서 확인할 수 있다. <a href=http://activemq.apache.org/>Apache ActiveMQ</a>
ActiveMQ를 설치 및 실행 후, http:localhost:8161에서 실행 확인을 할 수 있으며, 관리자 계정(admin/admin) 로그인 후 Queue 메뉴에서 현재 큐의 사황을 확인 할 수 있다.</p><p><img src=../images/activemq_queue_monitor1.png alt=activemq></p></li><li><p>구성 된 ActiveMQ를 활용하여 1개의 배치 Job과 2개의 Step(QueueSender, QueueProc)를 처리하는 가이드 예제를 활용한다.</p></li></ol><p>가이드 예제의 기본 구성</p><ul><li>큐서버(ActiveMQ)의 접속 Url 등록 : batch.properties에 batch.queue.url에 기술 (예:127.0.0.1:61616)</li><li>배치 Job 설정 : centerCutJob.xml에 1개의 Job과 2개의 Step의 빈 설정</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;centerCutJob&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;eGovBaseJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepQueueSender&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;stepQueueProc&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;taskletQueueSender&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepQueueProc&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;taskletQueueProc&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskletQueueSender&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.centercut.TaskletQueueSender&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskletQueueProc&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.bat.centercut.TaskletQueueProc&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><ul><li>테스트 파일 : EgovCenterCutJobRunnerTest.java파일을 실행하여 테스트를 진행한다.</li></ul><h3 id=queuesender>QueueSender</h3><p>TaskletQueueSender를 통하여 10,000개의 임의 데이터를 전송하고 endSender를 통하여 end message를 전송한다.
(총 전송되는 메시지는 10,000개 메시지와 1개의 end message를 전송)</p><ul><li>10,000개 임의 데이터 전송</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>RepeatStatus</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepContribution</span> <span style=color:#000>contribution</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>			<span style=color:#000>ChunkContext</span> <span style=color:#000>chunkContext</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;TaskletQueueSender execute START ===&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>QueueSenderFactory</span> <span style=color:#000>qf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>QueueSenderFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_queue&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>TextMessage</span> <span style=color:#000>txMessage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>	<span style=color:#000>MessageProducer</span> <span style=color:#000>sender</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSender</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>	<span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRemove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>for</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#0000cf;font-weight:700>10000</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++){</span>
</span></span><span style=display:flex><span>		<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Send Value : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#000>txMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setText</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>valueOf</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>		<span style=color:#000>sender</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>send</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>txMessage</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#000>senderCount</span><span style=color:#ce5c00;font-weight:700>++;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>endSender</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sender</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// * 오류로 주석처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>close</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// LOGGER를 사용하는 것과 달리 MessageFormatter를 사용할 경우 Log 레벨과 상관 없이 결과를 로그에 기록함.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#8f5902;font-style:italic>// 따라서 개발/운영계에 로그레벨이 달라지는 경우에도 출력을 보장함
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;########## Center-Cut Result ##########&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;## Sender  Count : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>senderCount</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;########################################&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>RepeatStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FINISHED</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>qf.endSender를 통하여 end message 전송</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>endSender</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>MessageProducer</span> <span style=color:#000>sender</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#000>TextMessage</span> <span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createTextMessage</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>	<span style=color:#000>setRemove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setText</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;End Of QUEUE&#34;</span><span style=color:#ce5c00;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>//end message
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>sender</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>send</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>전송 결과 (console출력)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9989
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9990
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9991
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9992
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9993
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9994
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9995
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,566 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9996
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,567 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9997
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,567 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9998
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,567 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] Send Value : 9999
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:16,570 DEBUG [org.apache.activemq.transport.tcp.TcpTransport] Stopping transport tcp:///127.0.0.1:61616
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,574 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; amqJmxUrl = service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,725 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; init MBeanServerConnection connection = javax.management.remote.rmi.RMIConnector$RemoteMBeanServerConnection@3bcd426c
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,725 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; queue remove - clientServiceName = org.apache.activemq:type=Broker,brokerName=localhost
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,728 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; ConsumerCount = 0
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,728 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; queue remove - clientServiceName = org.apache.activemq:type=Broker,brokerName=localhost
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,728 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; queue remove - queueName = test_queue
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,728 DEBUG [egovframework.rte.bat.queue.QueueRemover] &gt;&gt;&gt;&gt;&gt; queue remove - operationName = removeQueue
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,738 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] ########## Center-Cut Result ##########
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,738 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] ## Sender  Count : 10000
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:20:26,738 DEBUG [egovframework.rte.bat.centercut.TaskletQueueSender] ########################################
</span></span></span></code></pre></div><h3 id=queue-process>Queue Process</h3><p>또한, 전자정부 표준프레임워크는 TaskletQueueProc를 통하여 10,000개의 데이터를 전송받아 처리하면서, end message를 통하여 배치 처리를 종료한다.
(총 10,000개 메시지를 처리하고 1개의 end message를 통하여 완료한다.)</p><ul><li>10,000개를 Queue에서 받기</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>RepeatStatus</span> <span style=color:#000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepContribution</span> <span style=color:#000>contribution</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#000>ChunkContext</span> <span style=color:#000>chunkContext</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;TaskletQueueProc execute START ===&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>QueueReceiverFactory</span> <span style=color:#000>qf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>QueueReceiverFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test_queue&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>MessageConsumer</span> <span style=color:#000>receiver</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getReceiver</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;=====&gt;&gt;&gt;&gt;&gt; Start&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>		<span style=color:#000>textMessage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TextMessage</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>receiver</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>receive</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>if</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>textMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getText</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>equals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;End Of QUEUE&#34;</span><span style=color:#ce5c00;font-weight:700>)){</span>
</span></span><span style=display:flex><span>			<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;**********Receive End Message: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>textMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getText</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>			<span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sessionCommit</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>break</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>		<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Receive Message: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>textMessage</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getText</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>		<span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sessionCommit</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>		<span style=color:#000>recieveCount</span><span style=color:#ce5c00;font-weight:700>++;</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>	<span style=color:#000>qf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>close</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;########## Center-Cut Result ##########&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;## Recieve  Count : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>recieveCount</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;########################################&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>RepeatStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FINISHED</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>전송 결과 (console출력)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,042 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] Receive Message: 9997
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,042 DEBUG [org.apache.activemq.ActiveMQSession] ID:DESKTOP-NV1780L-60402-1518144303940-3:1:1 Transaction Commit :TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:9998
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,042 DEBUG [org.apache.activemq.TransactionContext] Commit: TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:9998 syncCount: 1
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,043 DEBUG [org.apache.activemq.TransactionContext] Begin:TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:9999
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,043 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] Receive Message: 9998
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,043 DEBUG [org.apache.activemq.ActiveMQSession] ID:DESKTOP-NV1780L-60402-1518144303940-3:1:1 Transaction Commit :TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:9999
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,043 DEBUG [org.apache.activemq.TransactionContext] Commit: TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:9999 syncCount: 1
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,044 DEBUG [org.apache.activemq.TransactionContext] Begin:TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:10000
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,044 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] Receive Message: 9999
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,044 DEBUG [org.apache.activemq.ActiveMQSession] ID:DESKTOP-NV1780L-60402-1518144303940-3:1:1 Transaction Commit :TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:10000
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,044 DEBUG [org.apache.activemq.TransactionContext] Commit: TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:10000 syncCount: 1
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,045 DEBUG [org.apache.activemq.TransactionContext] Begin:TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:10001
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,045 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] **********Receive End Message: End Of QUEUE
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,045 DEBUG [org.apache.activemq.ActiveMQSession] ID:DESKTOP-NV1780L-60402-1518144303940-3:1:1 Transaction Commit :TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:10001
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,045 DEBUG [org.apache.activemq.TransactionContext] Commit: TX:ID:DESKTOP-NV1780L-60402-1518144303940-3:1:10001 syncCount: 1
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,050 DEBUG [org.apache.activemq.ActiveMQMessageConsumer] remove: ID:DESKTOP-NV1780L-60402-1518144303940-3:1:1:1, lastDeliveredSequenceId:60066
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,052 DEBUG [org.apache.activemq.transport.tcp.TcpTransport] Stopping transport tcp:///127.0.0.1:61616
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,052 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] ########## Center-Cut Result ##########
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,052 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] ## Recieve  Count : 10000
</span></span></span><span style=display:flex><span><span style=color:#000;font-style:italic>xxxx-xx-xx 11:45:27,052 DEBUG [egovframework.rte.bat.centercut.TaskletQueueProc] ########################################
</span></span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=http://activemq.apache.org/>Apache ActiveMQ</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8b1e813ee7c2ac9764ee0a1b24b8e85e>26 - 이벤트알림 템플릿 관리</h1><div class=lead>전자정부 표준프레임워크의 배치 수행중 특정시점에 이벤트가 발생하는 경우 EventNoticeTrigger 인터페이스를 활용하여 SMS, Email 등을 통해 정보를 전달할 수 있는 추상화된 외부알림 access 관리기능이다.</div><h1 id=이벤트알림-템플릿-관리>이벤트알림 템플릿 관리</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크의 배치 수행중 특정시점에 이벤트가 발생하는 경우 EventNoticeTrigger 인터페이스를 활용하여 SMS, Email 등을 통해 정보를 전달할 수 있는 추상화된 외부알림 access 관리기능이다.</p><h2 id=설명>설명</h2><h3 id=eventnoticetrigger>EventNoticeTrigger</h3><p>EventNoticeTrigger 는 이벤트 알림 기능을 사용하도록 추상화된 인터페이스이다.</p><p>메소드는 트리거를 호출하는 invoke 메소드를 파라메터 타입별로 구성하였고, 모든 메소드의 리턴타입은 void 이다.</p><table><thead><tr><th>메소드</th><th>파라메터</th><th>설명</th></tr></thead><tbody><tr><td>invoke()</td><td>없음</td><td>파라메터 없이 이벤트호출 ‌로직 구현</td></tr><tr><td>invoke(StepExecution)</td><td>StepExecution</td><td>파라메터인 StepExecution 정보를 활용하는 로직 구현</td></tr><tr><td>invoke(JobExecution)</td><td>JobExecution</td><td>파라메터인 JobExecution 정보를 활용하는 로직 구현</td></tr><tr><td>invoke(Exception)</td><td>Exception</td><td>파라메터인 Execption 정보를 활용하는 로직 구현</td></tr></tbody></table><h3 id=egoveventnoticetrigger>EgovEventNoticeTrigger</h3><p>EgovEventNoticeTrigger 클래스는 EventNoticeTrigger 인터페이스를 상속받은 형태로, 파라메터 타입별로 이벤트 알림 기능(Email전송, SMS전송)을 호출하기 위한 invoke 메소드를 갖고 있다. 모든 메소드의 리턴타입은 void로 로직수행 후 반환해야 하는 값이 없고, 이는 배치 고유의 수행과정과 별도로 동작하는 부분이다.</p><p>사용자는 EgovEventNoticeTrigger 를 상속받아 각각의 파라메터 타입별로 재정의하여 사용한다.</p><p><img src=../images/eventnotice_interface.png alt=eventnotice_interface></p><h4 id=설정>설정</h4><p>&lsquo;프로세서(리스너) 설정&rsquo; 부분과 &lsquo;트리거 설정&rsquo; 부분으로 나뉜다.</p><ul><li>프로세서(리스너) 설정</li></ul><ol><li>Job 설정에서 이벤트를 호출할 수 있도록 리스너 설정을 하고 관련 클래스를 빈으로 등록한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;eventNoticeTriggerJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;eventNoticeTriggerStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;EventNoticeCallListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;EventNoticeCallListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovEventNoticeCallProcessor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><ol start=2><li>위에서 설정한 프로세서를 구현한다. <a href=./batch-core-listener.md#%EC%9E%91%EC%97%85-%EC%A0%84%ED%9B%84%EC%B2%98%EB%A6%AC-%EA%B4%80%EB%A6%AC-egovprepostprocessor>작업 전후처리 관리</a>의 프로세서를 상속받아 사용자가 원하는 시점 (아래 예시는 Step수행 후에 호출되는 메소드)에서 invoke 메소드를 호출하도록 구현한다.
메소드에 invoke 메소드는 EgovEventNoticeTrigger을 상속받아 재정의한 클래스(&lsquo;트리거 설정&rsquo; 2 에서 구현)를 사용할 수 있다.</li></ol><p>✔ 이때 사용자가 정의한 클래스는 Job 설정파일에 빈으로 등록되어 있으므로 어노테이션을 활용한다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovEventNoticeCallProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>EgovStepPostProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>//EgovEventNoticeTrigger을 상속받아 재정의한 클래스	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#5c35cc;font-weight:700>@Autowired</span>
</span></span><span style=display:flex><span>	<span style=color:#000>EgovEmailEventNoticeTrigger</span> <span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExitStatus</span> <span style=color:#000>afterStep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>		<span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>트리거 설정</li></ul><ol><li>실제 Email 전송 혹은 SMS 전송을 수행하는 트리거 기능의 클래스를 작성한다. (전자정부 프레임워크 공통컴포넌트 활용 가능)</li><li>EgovEventNoticeTrigger 클래스 상속받아 invoke 메소드를 구현한다. 파라메터(JobExecution, StepExecution, Exception 등)에 대한 알림 내용을 작성한 뒤, 위 클래스(&lsquo;트리거 설정&rsquo; 1 에서 구현) 트리거 메소드의 파라메터로 전달하며 호출한다.</li></ol><p>아래 예시에서는 StepExecution 파라메터를 활용하였다.</p><p>✔ 이때 사용자가 정의한 클래스는 설정파일에서 빈으로 등록되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovEmailEventNoticeTrigger</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>EgovEventNoticeTrigger</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>invoke</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>// StepExecution 을 활용하여 알림내용 작성
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// &#39;트리거 설정&#39; 1에서 구현한 트리거를 통해 메시지 전송 수행
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;--</span> <span style=color:#a40000>프로세서(리스너)</span> <span style=color:#a40000>설정</span> <span style=color:#a40000>1</span> <span style=color:#a40000>의</span> <span style=color:#a40000>Job</span> <span style=color:#a40000>설정파일</span> <span style=color:#a40000>(계속)</span> <span style=color:#a40000>--</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;EmailEventNoticeTrigger&#34;</span>
</span></span><span style=display:flex><span> 	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.event.EgovEmailEventNoticeTrigger&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>위 기능을 활용하여 실제 Email을 전송하는 예제를 제공하므로 아래를 참고한다.</p><h4 id=사용예시>사용예시</h4><ul><li><a href=../../runtime-example/individual-example/batch-layer/batch-example-event_notice_template_mgmt.md>이벤트알림 템플릿(Template) 예제</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-391876b544fec8d10ba492f187cf383c>27 - Flow Control</h1><div class=lead>Job 내부에는 여러 Step 들이 존재할 수 있고, 각 Step 사이의 흐름을 관리할 필요가 있다. Step 내의 next 설정과 Desision 설정으로 Job을 수행하다 한 Step의 처리결과에 따라 다른 Step을 선택하여 수행할 수 있고, 특정 Step의 실패가 Job 전체의 실패로 이어지지 않도록 구성할 수 있다.</div><h1 id=flow-control>Flow Control</h1><h2 id=개요>개요</h2><p>Job 내부에는 여러 Step 들이 존재할 수 있고, 각 Step 사이의 흐름을 관리할 필요가 있다. Step 내의 next 설정과 Desision 설정으로 Job을 수행하다 한 Step의 처리결과에 따라 다른 Step을 선택하여 수행할 수 있고, 특정 Step의 실패가 Job 전체의 실패로 이어지지 않도록 구성할 수 있다.</p><h2 id=설명>설명</h2><h3 id=흐름-처리controlling-step-flow>흐름 처리(Controlling Step Flow)</h3><h4 id=sequential-flow>Sequential Flow</h4><p>가장 간단한 시나리오의 Job은 모든 Step을 순서대로 실행 하는 것이다.</p><p><img src=../images/sequential-flow.png alt=sequential-flow></p><p>위와 같은 Job의 실행은 Step 엘리먼트의 &rsquo;next&rsquo; 어트리뷰트를 이용해서 설정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepA&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;stepB&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepB&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;stepC&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepC&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><p>위 시나리오를 실행 하면 Job 설정의 가장 상단에 위치한 &lsquo;stepA&rsquo;가 먼저 실행 된다. &lsquo;stepA&rsquo;가 실행 완료 되면 &lsquo;stepB&rsquo;, &lsquo;stepC&rsquo;의 순서로 실행되게 된다. 하지만 만약 &lsquo;stepA&rsquo;의 실행이 실패하게 된다면 전체 Job의 실행은 실패하게 되며 &lsquo;stepB&rsquo;는 실행 되지 않는다.</p><ul><li>Note : 스프링 배치의 XML 설정은 Job 설정의 가장 상단 Step이 최초로 실행되게 되며, 그 후의 Step 실행 순서는 XML 설정 순서와는 관계가 없다.</li></ul><h4 id=conditional-flow>Conditional Flow</h4><p>위 Sequential Flow의 실행 결과는 다음 2가지로 나뉘게 된다.</p><ol><li>Step이 성공적으로 실행되고, 다음 Step이 실행 된다.</li><li>Step의 실행이 실패하며 그로인해 Job의 실행 또한 실패한다.</li></ol><p>많은 케이스가 위의 내용에 해당하게 된다. 하지만 Step의 실패가 Job의 실패를 유발하는 것이 아니고 다른 Step을 실행하는 경우를 생각해 보자.</p><p><img src=../images/conditional-flow.png alt=conditional-flow></p><p>스프링 배치에서는 다양한 경우의 시나라오를 설정 할 수 있도록 Step 엘리먼트내에 사용할 수 있는 transition 엘리먼트를 제공 해준다. 그중의 한 엘리먼트로 &rsquo;next&rsquo; 엘리먼트가 있다. &rsquo;next&rsquo; 엘리먼트는 &rsquo;next&rsquo; 어트리뷰트와 마찬가지로 Job 실행에서 다음에 실행될 Step에 대해 알려준다. 하지만 &rsquo;next&rsquo; 어트리뷰트와 다르게 &rsquo;next&rsquo; 엘리먼트는 사용 횟수에 제한이 없으며, Step의 실패에 대한 default 설정이 없다. 그러므로 transition 엘리먼트를 사용할 때에는 모든 Step의 Behavior 설정을 충분히 해줘야 한다.</p><p>✔ 싱글 Step의 경우 &rsquo;next&rsquo; 어트리뷰트와 transition 엘리먼트를 사용할 수 없다.</p><p>다음은 &rsquo;next&rsquo; 엘리먼트를 사용하는 기본 패턴이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepA&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;stepB&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;stepC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepB&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;stepC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepC&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><p>&rsquo;next&rsquo; 엘리먼트의 &lsquo;on&rsquo; 어트리뷰트를 이용해서 Step 실행 결과(ExitStatus)에 따라 다음 Step을 설정 할 수 있다.&lsquo;on&rsquo; 어트리뷰트에 패턴으로 사용 될 수 있는 특수 문자는 다음 2가지만이 가능하다.</p><ul><li>&lsquo;*&rsquo; : 0 또는 그 이상의 문자.</li><li>&lsquo;?&rsquo; : 하나의 문자.</li></ul><p>예를 들면 &lsquo;c*t&rsquo;는 &lsquo;cat&rsquo;과 &lsquo;count&rsquo;와 모두 매칭 된다. 반면에, &lsquo;c?t&rsquo;는 &lsquo;cat&rsquo;과 매칭 되지만 &lsquo;count&rsquo;와 매칭 되지 않는다. Step 설정에 transition 엘리먼트의 사용 횟수에는 제한이 없지만, Step의 실행 결과(ExitStatus)가 Step 설정에 정의 되지 않은 경우에는 스프링 배치 프레임워크는 예외를 던지게 되며 Job의 실행은 실패하게 된다. 스프링 배치 프레임워크는 &lsquo;on&rsquo; 어트리뷰트 설정 값을 상세한 설정을 우선해서 먼저 적용한다. 위 설정을 예로 들면 Step의 실행 결과로 &lsquo;FAILED&rsquo; ExitStatus를 갖게 되면 &lsquo;StepA&rsquo;가 아닌 &lsquo;StepC&rsquo;로 전이 하게 된다.</p><h5 id=batch-status-vs-exit-status>Batch Status vs. Exit Status</h5><p>Conditional flow를 사용하는 Job을 설정할때에는 BatchStatus과 ExitStatus의 차이를 아는것이 중요하다. BatchStatus는 Job 또는 Step 의 실행 결과를 스프링 프레임워크에서 기록할 때 사용하는 Property의 집합니다. BatchStatus로 사용 되는 값은 COMPLETED, STARTING, STARTED, STOPPING, STOPPED, FAILED, ABANDONED, UNKNOWN 이다. 대부분의 값들은 단어와 같은 뜻으로 해석하여 이해하면 된다.</p><p>다음의 &rsquo;next&rsquo; 엘리먼트를 사용하는 예제를 보자.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;stepB&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>위 예제에서 &lsquo;on&rsquo; 어트리뷰트가 BatchStatus를 참조하는 것으로 생각되기 쉽지만 실제 참조되는 값은 Step의 ExitStatus이다. ExitStatus의 이름에서 알 수 있듯이 ExitStatus는 Step의 실행 후 상태를 알려주는 값이다. 위 예제를 좀더 쉽게 풀이 하자면 &rsquo;exit 코드가 FAILED로 끝나게 되면 StepB로 가라&rsquo;는 뜻이 된다. 스프링 배치 프레임워크는 디폴트 설정으로 ExitStatus의 exit 코드는 Step의 BatchStatus와 같도록 설정이 되어 있다. 하지만 만약에 exit 코드가 BatchStatus와 달라야 한다면</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;end</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;COMPLETED WITH SKIPS&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;errorPrint1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><p>위 Step의 실행 결과는 다음 3가지가 될 수 있다.</p><ul><li>Step이 실패하며, Job 또한 실패하게 된다.</li><li>Step이 성공적으로 완료된다.</li><li>Step이 성공적으로 완료되며, &lsquo;COMPLETED WITH SKIPS&rsquo;의 exit 코드로 종료 된다. 이 경우 별도의 Step이 에러를 처리하기 위해 실행 되어져야만 한다.</li></ul><p>위 예제의 사용에는 에러가 없지만, 사용자의 의도대로 처리되기 위해서는&rsquo;COMPLETED WITH SKIPS&rsquo; exit 코드를 반환하는 별도의 로직이 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SkipCheckingListener</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>StepExecutionListenerSupport</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ExitStatus</span> <span style=color:#000>afterStep</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>String</span> <span style=color:#000>exitCode</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>exitCode</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>equals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ExitStatus</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FAILED</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getExitCode</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> 
</span></span><span style=display:flex><span>              <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSkipCount</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ExitStatus</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;COMPLETED WITH SKIPS&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위코드를 설명하면 StepExecutionListener 에서는 먼저 Step이 성공적으로 수행되었는지 체크한다. 그 후 StepExecution의 skip 횟수가 0.1f보다 클경우 &lsquo;COMPLETED WITH SKIPS&rsquo;의 exit 코드를 갖는 ExitStatus를 반환한다.</p><h4 id=configuring-for-stop>Configuring for Stop</h4><p>BatchStatus와 ExitStatus가 어떻게 결정되는지 알아 보았다. Step의 Status는 코드의 실행 결과에 의해 결정 되는 반면에 Job의 Status는 스프링 배치 설정에 의해 결정 되어 진다. 모든 Job 설정은 최소 하나의 &rsquo;transition이 없는 final Step&rsquo; 을 갖게 된다.
다음의 예는 Step이 실행 되어 진 후에 Job이 종료 되게 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepC&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>transition이 정의 되지 않은 Step의 경우 Job의 Status는 다음과 같이 결정 되게 된다.</p><ul><li>Step의 ExitStatus가 FAILED 일 경우 Job의 BatchStatus와 ExitStatus는 모두 FAILED 가 된다.</li><li>위 경우와 반대로 Step의 ExitStatus가 COMPLETED 일 경우 Job의 BatchStatus와 ExitStatus는 모두 COMPLETED 가 된다.</li></ul><p>단순 Sequential Step의 Job의 경우에는 위 방법만으로도 Job을 설정하기에 충분하지만, 별도의 Job의 중단을 위한 시나리오가 필요한 경우도 존재한다. 이같은 경우를 위해 스프링 배치 프레임워크에서는 Job을 중단시키기 위한 transition 엘리먼트를 제공한다. 이 엘리먼트들은 Job을 특정 BatchStatus와 함께 종료 시킨다.</p><p>Stop transition 엘리먼트는 Step의 BatchStatus 또는 ExitStatus에는 영향을 미칠수 없으며, 오로지 Job의 마지막 상태에만 영향을 미칠수 있다. 예를 들어, Job의 모든 Step의 결과가 FAILED이지만 Job의 Status는 COMPLETED가 될 수 있으며 ,그반대 또한 가능하다.</p><h5 id=the-end-element>The &lsquo;End&rsquo; Element</h5><p>&rsquo;end&rsquo; 엘리먼트는 Job을 COMPLETED BatchStatus와 함께 종료 시킨다. COMPLETED 상태로 종료된 Job은 재실행이 불가능하다(스프링 배치 프레임워크에서 JobInstanceAlreadyCompleteException이 발생됨). &rsquo;end&rsquo; 엘리먼트에는 추가적으로 &rsquo;exit-code&rsquo; 어트리뷰트를 사용하면 커스텀 ExitStatus의 정의가 가능하다. &rsquo;exit-code&rsquo; 정의가 없는 경우에는 디폴트 코드로 COMPLETED가 적용되게 된다.</p><p>다음의 예제는 Step2가 실패하기 되면 Job은 COMPLETED BatchStatus로 종료되며 Step3은 실행 되지않는다. 이경우 Job이 COMPLETED BatchStatus로 종료 되었기 때문에 재시작이 불가능 하다.(Step2가 성공하는 경우에는 Step3이 실행되게 된다)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;end</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;step3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span></code></pre></div><h5 id=the-fail-element>The &lsquo;Fail&rsquo; Element</h5><p>&lsquo;fail&rsquo; 엘리먼트는 Job을 FAILED BatchStatus와 함께 종료 시킨다. &rsquo;end&rsquo;엘리먼트와 다르게 &lsquo;fail&rsquo; 엘리먼트를 사용한 경우에는 Job의 재시작이 가능하다. &lsquo;fail&rsquo; 엘리먼트 또한 커스텀 ExitStatus의 정의를 위한 &rsquo;exit-code&rsquo; 어트리뷰트를 사용 할 수 있다. &rsquo;exit-code&rsquo; 정의가 없는 경우에는 디폴트 코드로 FAILED가 적용되게 된다.</p><p>다음의 예제는 Step2가 실패하기 되면 Job은 FAILED BatchStatus와 EARLY TERMINATION ExitStatus로 종료되며 Step3은 실행 되지 않는다. 이경우 Job의 재시작이 가능하며, 실행은 Step2부터 시작된다.(Step2가 성공하는 경우에는 Step3이 실행되게 된다)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;fail</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>exit-code=</span><span style=color:#4e9a06>&#34;EARLY TERMINATION&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;step3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span></code></pre></div><h5 id=the-stop-element>The &lsquo;Stop&rsquo; Element</h5><p>&lsquo;stop&rsquo; 엘리먼트는 Job을 STOPPED BatchStatus와 함께 종료 시킨다. Job이 중단 되면 Job이 재시작 되기전에 오퍼레이터는 추가적인 작업을 수행 할 수 있다. &lsquo;stop&rsquo; 엘리먼트는 다음 Job의 재실행 지점의 설정을 위해 &lsquo;restart&rsquo; 어트리뷰트의 정의가 요구된다.</p><p>다음의 예제에서는 Step1이 COMPLETED 상태로 종료가 되면 Job은 정지 되게 되며, 정지된 Job의 재실행 지점은 Step2이</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;stop</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;COMPLETED&#34;</span> <span style=color:#c4a000>restart=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=programmatic-flow-decisions>Programmatic Flow Decisions</h4><p>경우에 따라서는 다음에 실행될 Step을 결정하기 위해 ExitStatus 보다 더 많은 정보가 필요할 경우가 있다. 이때에 다음 Step을 결정하기 위해 JobExecutionDecider를 이용 할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>MyDecider</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>JobExecutionDecider</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>FlowExecutionStatus</span> <span style=color:#000>decide</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>JobExecution</span> <span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>StepExecution</span> <span style=color:#000>stepExecution</span><span style=color:#ce5c00;font-weight:700>)</span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>someCondition</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;FAILED&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;COMPLETED&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Job 설정을 위한 &lsquo;decision&rsquo; 태그를 다음과 같이 사용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;decision&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;decision</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;decision&#34;</span> <span style=color:#c4a000>decider=</span><span style=color:#4e9a06>&#34;decider&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;COMPLETED&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/decision&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;beans:bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;decider&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;com.MyDecider&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=split-flows>Split Flows</h4><p>앞에서 설명한 모드 시나리에서는 Job내의 Step들의 실행이 순서대로 이루어지고 있다. 스프링 배치프레임워크에서는 이외에도 parallel flow를 지원하기 위한 &lsquo;split&rsquo; 엘리먼트를 제공한다.</p><p>아래의 코드를 보면 &lsquo;split&rsquo; 엘리먼트는 하나 이상의 &lsquo;flow&rsquo; 엘리먼트를 갖을 수 있으며, &lsquo;flow&rsquo; 엘리먼트는 분리된 flow를 정의한다. &lsquo;split&rsquo; 엘리먼트는 앞에서 설명한 &rsquo;next&rsquo; 어트리뷰트, &rsquo;next&rsquo; 엘리먼트, &rsquo;end&rsquo; 엘리먼트, &lsquo;fail&rsquo; 엘리먼트, &lsquo;pause&rsquo; 엘리먼트들을 포함 할 수 있다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;split</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;split1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step4&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;flow&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;flow&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/split&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step4&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s4&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=externalizing-flow-definitions-and-dependencies-between-jobs>Externalizing Flow Definitions and Dependencies Between Jobs</h4><p>Job의 flow중 일부는 별도의 bean 설정으로 분리 될 수 있으며, 재사용이 가능하다. 이러한 설정 방법에는 3가지가 있으면 그중 첫 번째는 아래와 같이 별도로 설정된 flow를 참조하는 방법이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;flow</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job1.flow1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;flow1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;flow</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;flow1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span></code></pre></div><p>위와 같이 flow를 설정하게 되면 간단하게 별도의 Step을 추가 할 수 있다. 이런 방법으로 여러 Job에서 같은 flow 템플릿을 참조 할 수 있으며, flow 템플릿의 조합으로 다른 로직의 flow 설정을 할 수 있다. 위 방법은 통합 테스트를 별도의 flow로 분리하는 데에도 유용하게 사용 될 수 있다.</p><p>두번째 flow의 분리 방법은 FlowStep을 사용하는 방법이다. FlowStep은 flow의 처리를 &lt;flow/> 엘리먼트로 위임하는 Step 인터페이스의 구현체이다.
아래의 FlowStep 설정 예제를 보자.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job1.flow1&#34;</span> <span style=color:#c4a000>flow=</span><span style=color:#4e9a06>&#34;flow1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;flow</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;flow1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;s2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span></code></pre></div><p>실제 로직의 수행은 이전 예제와 동일하나, Job Repository에 저장되는 데이터가 다르게 된다. 이러한 설정 방법은 모니터링 과 리포팅 목적으로 유용하게 사용될 수 있으며 partitioned step의 구조를 더욱 다양하게 해줄 수 있다.</p><p>세번째 flow의 분리 방법은 JobStep을 사용하는 방법이다. JobStep은 FlowStep과 유사하지만 분리된 Step의 실행을 위해 별도의 Job Execution을 생성하게 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobStepJob&#34;</span> <span style=color:#c4a000>restartable=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobStepJob.step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>job-launcher=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> 
</span></span><span style=display:flex><span>          <span style=color:#c4a000>job-parameters-extractor=</span><span style=color:#4e9a06>&#34;jobParametersExtractor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>restartable=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>...<span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobParametersExtractor&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.spr...DefaultJobParametersExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;keys&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;input.file&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>위 예제를 보자. job parameters extractor 설정에서 Job이 실행 될때 Step의 ExecutionContext에서 JobParameters를 얻는 방법에 대해 정의한다. JobStep은 Job과 Step의 모니터링을 할때 좀더 세밀한 옵션을 주고 싶을 때 유용하다. JobStep은 &ldquo;Job 사이의 dependencies를 어떻게 생성하느냐?&ldquo;의 질문에 대한 좋은 답이 될 수 있다. 위와 같은 설정은 큰 시스템을 작은 모듈로 분리하고 Job의 flow를 컨트롤하는데 유용하게 사용될 수 있다.</p><h4 id=관련예제>관련예제</h4><p><a href=../../runtime-example/individual-example/batch-layer/batch-example-skip_mgmt.md>Flow Control 활용한 건너뛰기(Skip) 기능 예제</a></p><h2 id=참고자료>참고자료</h2><ul><li><a href=http://activemq.apache.org/>Apache ActiveMQ</a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/eGovFramework/egovframe-docs aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2016&ndash;2024
<span class=td-footer__authors>eGovFrame | <a href="https://www.egovframe.go.kr/home/sub.do?menuNo=23">Apache 2.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href="https://www.egovframe.go.kr/home/sub.do?menuNo=77" target=_blank rel=noopener>개인정보 보호 정책</a></span></div></div></div></footer></div><script src=/egovframe-docs/js/main.min.4eb19af2236072614b7d308c10176f918f1b447443492377d98b5b2c5e44aac3.js integrity="sha256-TrGa8iNgcmFLfTCMEBdvkY8bRHRDSSN32YtbLF5EqsM=" crossorigin=anonymous></script>
<script defer src=/egovframe-docs/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script>
<script src=/egovframe-docs/js/tabpane-persist.js></script></body></html>