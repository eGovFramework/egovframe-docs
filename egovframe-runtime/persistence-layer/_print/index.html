<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ko class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://eGovFramework.github.io/egovframe-docs/egovframe-runtime/persistence-layer/><link rel=alternate type=application/rss+xml href=https://eGovFramework.github.io/egovframe-docs/egovframe-runtime/persistence-layer/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/egovframe-docs/favicons/favicon.ico><link rel=apple-touch-icon href=/egovframe-docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/egovframe-docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/egovframe-docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/egovframe-docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/egovframe-docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/egovframe-docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/egovframe-docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/egovframe-docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/egovframe-docs/favicons/android-192x192.png sizes=192x192><title>데이터처리 | 표준프레임워크 개발가이드</title><meta name=description content="데이터처리 서비스는 데이터베이스에 대한 연결 및 영속성 처리, 선언적인 트랜잭션 관리를 지원한다."><meta property="og:title" content="데이터처리"><meta property="og:description" content="데이터처리 서비스는 데이터베이스에 대한 연결 및 영속성 처리, 선언적인 트랜잭션 관리를 지원한다."><meta property="og:type" content="website"><meta property="og:url" content="https://eGovFramework.github.io/egovframe-docs/egovframe-runtime/persistence-layer/"><meta itemprop=name content="데이터처리"><meta itemprop=description content="데이터처리 서비스는 데이터베이스에 대한 연결 및 영속성 처리, 선언적인 트랜잭션 관리를 지원한다."><meta name=twitter:card content="summary"><meta name=twitter:title content="데이터처리"><meta name=twitter:description content="데이터처리 서비스는 데이터베이스에 대한 연결 및 영속성 처리, 선언적인 트랜잭션 관리를 지원한다."><link rel=preload href=/egovframe-docs/scss/main.min.7cb61f458a74a1330f233190743332282dda27b055efc935bc0fc018f7e27288.css as=style integrity="sha256-fLYfRYp0oTMPIzGQdDMyKC3aJ7BV78k1vA/AGPficog=" crossorigin=anonymous><link href=/egovframe-docs/scss/main.min.7cb61f458a74a1330f233190743332282dda27b055efc935bc0fc018f7e27288.css rel=stylesheet integrity="sha256-fLYfRYp0oTMPIzGQdDMyKC3aJ7BV78k1vA/AGPficog=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/egovframe-docs/><span class="navbar-brand__logo navbar-logo"><svg width="130" height="29" viewBox="0 0 130 29" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.125 28.2578C5.83594 28.2578 4.71875 27.9922 3.77344 27.4609 2.83594 26.9297 2.11328 26.1719 1.60547 25.1875c-.50781-.9922-.76172-2.1563-.76172-3.4922.0-1.3047.25-2.4531.75-3.4453.50781-1 1.22656-1.7734 2.15625-2.3203s2.00781-.8203 3.23438-.8203C8.125 15.1094 9.14453 15.3516 10.043 15.8359 10.9492 16.3125 11.6602 17.0352 12.1758 18.0039 12.6992 18.9727 12.9609 20.1562 12.9609 21.5547V22.5391H4.26562c0 .6328.11719 1.1836.35157 1.6523C4.85938 24.6602 5.19922 25.0234 5.63672 25.2812c.445309999999999.25.96484.375 1.55859.375C7.76562 25.6562 8.25781 25.543 8.67188 25.3164 9.08594 25.082 9.38281 24.7656 9.5625 24.3672h3.3047C12.7031 25.1484 12.3672 25.832 11.8594 26.418 11.3516 27.0039 10.6914 27.457 9.87891 27.7773 9.07422 28.0977 8.15625 28.2578 7.125 28.2578zm2.55469-7.8984C9.67969 19.8516 9.56641 19.3984 9.33984 19 9.12109 18.5938 8.8125 18.2773 8.41406 18.0508 8.01562 17.8242 7.5625 17.7109 7.05469 17.7109c-.51563.0-.98438.1172-1.40625.351600000000001C5.23438 18.2969 4.90234 18.6172 4.65234 19.0234 4.41016 19.4297 4.28125 19.875 4.26562 20.3594H9.67969zM26.4844 16.4922C26.25 15.6875 25.8164 15.0586 25.1836 14.6055 24.5586 14.1445 23.7891 13.9141 22.875 13.9141c-.875.0-1.6445.2187-2.3086.6562C19.9023 15.0078 19.3867 15.6484 19.0195 16.4922 18.6523 17.3281 18.4688 18.3281 18.4688 19.4922 18.4688 20.6719 18.6484 21.6836 19.0078 22.5273 19.375 23.3711 19.8906 24.0156 20.5547 24.4609 21.2188 24.8984 22 25.1172 22.8984 25.1172 23.6953 25.1172 24.3828 24.9766 24.9609 24.6953 25.5469 24.4062 25.9961 23.9961 26.3086 23.4648 26.6289 22.9336 26.7969 22.3125 26.8125 21.6016H23.1328V18.9531h7.0781v2.1094c0 1.4609-.3125 2.7344-.9375 3.8203-.6172 1.0781-1.4804 1.9063-2.5898 2.4844C25.5742 27.9453 24.3047 28.2344 22.875 28.2344 21.2969 28.2344 19.9023 27.8828 18.6914 27.1797 17.4883 26.4688 16.5508 25.4609 15.8789 24.1562c-.6641-1.3124-.9961-2.8515-.9961-4.6171.0-1.7891.3438-3.3438 1.0313-4.6641C16.6016 13.5547 17.5469 12.5469 18.75 11.8516 19.9531 11.1484 21.3047 10.7969 22.8047 10.7969c1.2578.0 2.4062.242199999999999 3.4453.7265C27.2969 12 28.1523 12.6719 28.8164 13.5391 29.4805 14.3984 29.8906 15.3828 30.0469 16.4922H26.4844zM38.4375 28.2578c-1.2656.0-2.3672-.273399999999999-3.3047-.8203S33.4727 26.1211 32.9648 25.1289C32.457 24.1289 32.2031 22.9766 32.2031 21.6719s.25-2.4531.75-3.4453C33.4609 17.2344 34.1836 16.4688 35.1211 15.9297 36.0664 15.3828 37.1719 15.1094 38.4375 15.1094S40.8086 15.3828 41.7539 15.9297C42.6992 16.4688 43.4258 17.2344 43.9336 18.2266 44.4414 19.2188 44.6953 20.3672 44.6953 21.6719S44.4414 24.1289 43.9336 25.1289C43.4258 26.1211 42.6992 26.8906 41.7539 27.4375 40.8086 27.9844 39.7031 28.2578 38.4375 28.2578zM38.4609 25.5625C39.0391 25.5625 39.5312 25.3984 39.9375 25.0703 40.3438 24.7344 40.6484 24.2734 40.8516 23.6875 41.0547 23.1016 41.1562 22.4297 41.1562 21.6719S41.0547 20.2422 40.8516 19.6562C40.6484 19.0625 40.3438 18.5977 39.9375 18.2617 39.5312 17.9258 39.0391 17.7578 38.4609 17.7578 37.875 17.7578 37.375 17.9258 36.9609 18.2617 36.5547 18.5977 36.2461 19.0625 36.0352 19.6562 35.8242 20.2422 35.7188 20.9141 35.7188 21.6719 35.7188 22.4219 35.8242 23.0938 36.0352 23.6875 36.2461 24.2734 36.5547 24.7344 36.9609 25.0703 37.375 25.3984 37.875 25.5625 38.4609 25.5625zM53.7891 28H49.8984L45.4453 15.2734H49.1016l2.6718 9.1407H51.9141l2.6718-9.1407h3.6797L53.7891 28zM60.0234 11.0312H71.2031v2.9063H63.5391v4.125H70.4766v2.9063H63.5391V28H60.0234V11.0312zm13.2188 4.2422H76.5938v2.2032H76.7344C76.9609 16.7031 77.3477 16.1133 77.8945 15.707 78.4414 15.293 79.0781 15.0859 79.8047 15.0859 80.2031 15.0859 80.5703 15.125 80.9062 15.2031v3.0938C80.7344 18.25 80.5039 18.207 80.2148 18.168 79.9258 18.1289 79.6641 18.1094 79.4297 18.1094 78.9141 18.1094 78.4492 18.2227 78.0352 18.4492 77.6211 18.6758 77.2969 18.9922 77.0625 19.3984 76.8281 19.7969 76.7109 20.25 76.7109 20.7578V28H73.2422V15.2734zM81.6328 24.4375C81.6328 23.125 82.0742 22.1641 82.957 21.5547 83.8398 20.9453 84.9766 20.6016 86.3672 20.5234 87.2266 20.4688 88.2812 20.4141 89.5312 20.3594V19.3281C89.5156 18.7969 89.332 18.3828 88.9805 18.0859 88.6289 17.7891 88.1328 17.6406 87.4922 17.6406 86.9141 17.6406 86.4414 17.7656 86.0742 18.0156 85.707 18.2656 85.4766 18.6094 85.3828 19.0469H82.0781C82.1484 18.2969 82.4062 17.625 82.8516 17.0312 83.3047 16.4375 83.9336 15.9688 84.7383 15.625 85.543 15.2812 86.4922 15.1094 87.5859 15.1094 88.5547 15.1094 89.4453 15.2617 90.2578 15.5664 91.0781 15.8711 91.7344 16.3477 92.2266 16.9961c.5.640600000000003.75 1.4492.75 2.4258V28H89.6953V26.2422H89.6016C89.2656 26.8594 88.7852 27.3477 88.1602 27.707 87.543 28.0586 86.7812 28.2344 85.875 28.2344 85.0469 28.2344 84.3125 28.0938 83.6719 27.8125 83.0391 27.5234 82.5391 27.0938 82.1719 26.5234 81.8125 25.9531 81.6328 25.2578 81.6328 24.4375zM84.9609 24.3438C84.9609 24.8203 85.1328 25.1914 85.4766 25.457 85.8281 25.7148 86.2891 25.8438 86.8594 25.8438 87.375 25.8438 87.8359 25.7383 88.2422 25.5273 88.6562 25.3164 88.9766 25.0273 89.2031 24.6602 89.4297 24.293 89.5391 23.8906 89.5312 23.4531V22.5273C89.1641 22.5352 88.7109 22.5547 88.1719 22.5859 87.6328 22.6172 87.2188 22.6484 86.9297 22.6797 86.3203 22.7422 85.8398 22.9141 85.4883 23.1953 85.1367 23.4766 84.9609 23.8594 84.9609 24.3438zM95.625 15.2734h3.3047V17.5H99.0703C99.3438 16.7578 99.7891 16.1758 100.406 15.7539 101.023 15.3242 101.758 15.1094 102.609 15.1094 103.484 15.1094 104.227 15.3242 104.836 15.7539 105.453 16.1758 105.867 16.7578 106.078 17.5H106.195C106.469 16.7656 106.945 16.1836 107.625 15.7539 108.305 15.3242 109.109 15.1094 110.039 15.1094 110.828 15.1094 111.523 15.2812 112.125 15.625 112.734 15.9609 113.207 16.457 113.543 17.1133 113.879 17.7617 114.047 18.5391 114.047 19.4453V28H110.578V20.125C110.578 19.4219 110.395 18.8867 110.027 18.5195 109.668 18.1523 109.188 17.9688 108.586 17.9688 107.938 17.9688 107.43 18.1758 107.062 18.5898 106.703 18.9961 106.523 19.5391 106.523 20.2188V28h-3.375V20.0312C103.148 19.4062 102.969 18.9062 102.609 18.5312 102.25 18.1562 101.773 17.9688 101.18 17.9688 100.789 17.9688 100.434 18.0703 100.113 18.2734 99.8008 18.4688 99.5508 18.7461 99.3633 19.1055 99.1836 19.4648 99.0938 19.8828 99.0938 20.3594V28H95.625V15.2734zm26.859 12.9844C121.195 28.2578 120.078 27.9922 119.133 27.4609 118.195 26.9297 117.473 26.1719 116.965 25.1875 116.457 24.1953 116.203 23.0312 116.203 21.6953c0-1.3047.25-2.4531.75-3.4453C117.461 17.25 118.18 16.4766 119.109 15.9297 120.039 15.3828 121.117 15.1094 122.344 15.1094 123.484 15.1094 124.504 15.3516 125.402 15.8359 126.309 16.3125 127.02 17.0352 127.535 18.0039 128.059 18.9727 128.32 20.1562 128.32 21.5547V22.5391H119.625C119.625 23.1719 119.742 23.7227 119.977 24.1914 120.219 24.6602 120.559 25.0234 120.996 25.2812 121.441 25.5312 121.961 25.6562 122.555 25.6562 123.125 25.6562 123.617 25.543 124.031 25.3164 124.445 25.082 124.742 24.7656 124.922 24.3672H128.227C128.062 25.1484 127.727 25.832 127.219 26.418 126.711 27.0039 126.051 27.457 125.238 27.7773 124.434 28.0977 123.516 28.2578 122.484 28.2578zM125.039 20.3594C125.039 19.8516 124.926 19.3984 124.699 19 124.48 18.5938 124.172 18.2773 123.773 18.0508 123.375 17.8242 122.922 17.7109 122.414 17.7109 121.898 17.7109 121.43 17.8281 121.008 18.0625 120.594 18.2969 120.262 18.6172 120.012 19.0234 119.77 19.4297 119.641 19.875 119.625 20.3594h5.414z" fill="#fff"/><path d="M8.39844 7.91211H.263672V6.91602H2.28516V5.22656H.9375V4.2207H2.12891v-2.5H.898438V.724609H7.71484V1.7207h-1.25v2.5H7.67578V5.22656H6.33789V6.91602H8.39844V7.91211zM5.23438 4.2207v-2.5H3.37891v2.5H5.23438zM5.08789 6.91602V5.22656H3.53516V6.91602H5.08789zM16.2793 1.36914H13.8281C13.8802 1.62305 14.0186 1.86556 14.2432 2.09668c.2278.23112.5452.43131.9521.60059.4069.16601.8919.27994 1.4551.34179l-.459.97656C15.3809 3.92448 14.6973 3.72103 14.1406 3.40527 13.584 3.08626 13.1868 2.69076 12.9492 2.21875c-.2409.47201-.638.86751-1.1914 1.18652-.5534.31576-1.2337.51921-2.041.61035L9.26758 3.03906C9.82747 2.97721 10.3092 2.86165 10.7129 2.69238c.4069-.16927.7226-.36946.9473-.60058C11.888 1.86068 12.028 1.61979 12.0801 1.36914H9.64844V.392578H16.2793V1.36914zM17.0312 5.43164H13.6816v1.5332H12.4512V5.43164H8.89648V4.43555H17.0312v.99609zM16.1328 8.74219H9.85352V6.17383H11.0938V7.74609h5.039V8.74219zM25.6836 7.86328H17.5488V6.82812h8.1348V7.86328zM25 1.78906H23.75V4.48438h1.2109v.97656H18.2227V4.48438h1.1914V1.78906H18.1836V.792969H25V1.78906zM22.5195 4.48438V1.78906H20.6641V4.48438h1.8554zm7.0703-.21485H27.6367V5.7832C28.1315 5.77669 28.5824 5.75879 28.9893 5.72949 29.3994 5.69694 29.8177 5.63997 30.2441 5.55859L30.3516 6.57422C29.8275 6.67188 29.3229 6.73535 28.8379 6.76465 28.3529 6.79395 27.7637 6.81185 27.0703 6.81836h-.625V3.2832h1.9434V1.88672H26.4355V.900391h3.1543V4.26953zM33.877 8.89844H32.6953V.0117188H33.877V8.89844zM32.0312 8.46875H30.8691V4.05469H29.9609V3.04883H30.8691V.177734h1.1621V8.46875zM42.2754 5.04102h-1.25V.0214844h1.25V5.04102zm0 3.75976h-5.957V5.44141h5.957V8.80078zm-4.7266-.99609h3.5059V6.42773H37.5488V7.80469zM37.4023.421875C37.8613.421875 38.2747.513021 38.6426.695312 39.0137.877604 39.305 1.13151 39.5166 1.45703 39.7282 1.78255 39.834 2.15365 39.834 2.57031 39.834 2.9707 39.7282 3.33203 39.5166 3.6543 39.305 3.97656 39.0137 4.23047 38.6426 4.41602 38.2715 4.59831 37.8581 4.68945 37.4023 4.68945 36.9466 4.68945 36.5332 4.59831 36.1621 4.41602 35.791 4.23047 35.4997 3.97656 35.2881 3.6543 35.0765 3.33203 34.9707 2.9707 34.9707 2.57031 34.9707 2.15365 35.0765 1.78255 35.2881 1.45703S35.7894.877604 36.1572.695312C36.5283.513021 36.9434.421875 37.4023.421875zm0 1.044925C37.1647 1.4668 36.9531 1.51074 36.7676 1.59863 36.5853 1.68652 36.4421 1.81348 36.3379 1.97949 36.237 2.14551 36.1882 2.34245 36.1914 2.57031 36.1882 2.78841 36.237 2.97884 36.3379 3.1416 36.4421 3.30111 36.5853 3.4248 36.7676 3.5127 36.9531 3.60059 37.1647 3.64453 37.4023 3.64453 37.6335 3.64453 37.8402 3.60059 38.0225 3.5127 38.2048 3.4248 38.3464 3.30111 38.4473 3.1416 38.5514 2.97884 38.6035 2.78841 38.6035 2.57031 38.6035 2.34245 38.5514 2.14551 38.4473 1.97949 38.3464 1.81348 38.2048 1.68652 38.0225 1.59863S37.6335 1.4668 37.4023 1.4668zM51.0645 8.89844H49.7949V6.93555H47.9883v-.9375h1.8066V.0214844h1.2696V8.89844zm-7.627-4.375C44.5898 4.52344 45.6315 4.50716 46.5625 4.47461 47.4935 4.44206 48.3822 4.37044 49.2285 4.25977L49.2969 5.16797C48.5807 5.29818 47.7897 5.39258 46.9238 5.45117v3.1836H45.6641V5.51465C45.0488 5.53092 44.3587 5.53906 43.5938 5.53906L43.4375 4.52344zM46.3477.373047c.429599999999994.0.817.078125 1.1621.234375C47.8581.763672 48.1315.981771 48.3301 1.26172 48.5286 1.53841 48.6296 1.85091 48.6328 2.19922 48.6296 2.55729 48.5286 2.87467 48.3301 3.15137 48.1348 3.4248 47.863 3.63802 47.5146 3.79102 47.1696 3.94076 46.7806 4.01562 46.3477 4.01562 45.9082 4.01562 45.5143 3.94076 45.166 3.79102 44.821 3.63802 44.5508 3.4248 44.3555 3.15137 44.1602 2.87467 44.0625 2.55729 44.0625 2.19922 44.0625 1.84766 44.1602 1.53353 44.3555 1.25684 44.5508.980143 44.8226.763672 45.1709.607422 45.5192.451172 45.9115.373047 46.3477.373047zm0 .947263C46.1263 1.32031 45.931 1.35612 45.7617 1.42773 45.5957 1.49935 45.4655 1.60189 45.3711 1.73535 45.2799 1.86882 45.2344 2.02344 45.2344 2.19922 45.2344 2.47266 45.3353 2.68587 45.5371 2.83887 45.7389 2.99186 46.0091 3.06836 46.3477 3.06836 46.6764 3.06836 46.9417 2.99186 47.1436 2.83887 47.3454 2.68587 47.4479 2.47266 47.4512 2.19922 47.4479 2.02344 47.3991 1.86882 47.3047 1.73535 47.2103 1.60189 47.0801 1.49935 46.9141 1.42773 46.7513 1.35612 46.5625 1.32031 46.3477 1.32031zm13.0468.50781C59.3945 2.39779 59.388 2.88118 59.375 3.27832 59.362 3.6722 59.3245 4.12142 59.2627 4.62598 59.2041 5.13053 59.1113 5.68229 58.9844 6.28125l-1.2403-.11719C57.8971 5.52279 58.0094 4.85872 58.0811 4.17188l-5.1514.2539L52.7734 3.42969l5.3711-.19531C58.151 3.07487 58.1559 2.8877 58.1592 2.67285 58.1657 2.45801 58.1706 2.25456 58.1738 2.0625V1.82812 1.78906H53.0469V.792969h6.3476V1.82812zM60.2246 7.83398H52.1191V6.81836h8.1055V7.83398zm11.084 1.06446H70.1074V4.37695H69.2969V8.50781H68.1348V.246094h1.1621V3.38086H70.1074V.0117188h1.2012V8.89844zM67.5098 1.10547C67.5065 1.97786 67.404 2.77214 67.2021 3.48828 67.0003 4.20117 66.6602 4.86035 66.1816 5.46582 65.7064 6.06803 65.0651 6.60352 64.2578 7.07227l-.7226-.85938C64.4206 5.69206 65.0798 5.10124 65.5127 4.44043 65.9456 3.77637 66.2061 2.99674 66.2939 2.10156H63.9844V1.10547h3.5254zM73.7891 1.4668h1.8164V.412109h1.25V4.28906H72.5488V.412109h1.2403V1.4668zm1.8164 1.8457V2.4043H73.7891v.9082h1.8164zM79.3359 1.74023h1.2012V2.74609H79.3359V4.5332h-1.25V.0117188h1.25V1.74023zm0 5.53711H74.6777v.57618h4.9121v.98632H73.457V6.38867h4.6387V5.83203H73.4375V4.86523h5.8984V7.27734zm8.6036-3.85742H89.1992V4.44531H87.9395v4.4336h-1.25V.0117188h1.25V3.41992zM85.5664.919922C85.5599 2.33594 85.2409 3.58757 84.6094 4.6748 83.9811 5.75879 82.9557 6.64909 81.5332 7.3457L80.8301 6.38867C81.888 5.85807 82.7002 5.22982 83.2666 4.50391 83.8363 3.77799 84.1797 2.92188 84.2969 1.93555H81.3379V.919922h4.2285zM97.0117 8.91797H95.752V.0117188H97.0117V8.91797zM92.1875.636719C92.6335.636719 93.0322.766927 93.3838 1.02734 93.7386 1.28776 94.0169 1.65723 94.2188 2.13574 94.4206 2.61426 94.5215 3.16927 94.5215 3.80078 94.5215 4.4388 94.4206 4.9987 94.2188 5.48047 94.0169 5.95898 93.7386 6.32845 93.3838 6.58887 93.0322 6.84603 92.6335 6.97461 92.1875 6.97461 91.7318 6.97461 91.3249 6.84603 90.9668 6.58887 90.6087 6.32845 90.3288 5.95898 90.127 5.48047 89.9284 4.9987 89.8307 4.4388 89.834 3.80078 89.8307 3.16927 89.9284 2.61426 90.127 2.13574 90.3288 1.65723 90.6087 1.28776 90.9668 1.02734 91.3249.766927 91.7318.636719 92.1875.636719zm0 1.123051C91.9564 1.75977 91.7529 1.83952 91.5771 1.99902 91.4046 2.15527 91.2712 2.38639 91.1768 2.69238S91.0352 3.36784 91.0352 3.80078C91.0352 4.23698 91.0824 4.60807 91.1768 4.91406 91.2712 5.22005 91.4046 5.45117 91.5771 5.60742 91.7529 5.76367 91.9564 5.8418 92.1875 5.8418 92.4154 5.8418 92.6139 5.76367 92.7832 5.60742 92.9525 5.44792 93.0843 5.21517 93.1787 4.90918 93.2731 4.60319 93.3203 4.23372 93.3203 3.80078 93.3203 3.37109 93.2731 3.00326 93.1787 2.69727 93.0843 2.38802 92.9508 2.15527 92.7783 1.99902 92.609 1.83952 92.4121 1.75977 92.1875 1.75977zM105.459 5.11914H99.1699V.753906H105.391V1.75977H100.4V4.12305h5.059v.99609zM106.348 7.81445H98.2129V6.78906H106.348V7.81445z" fill="#fff"/></svg></span><span class=navbar-brand__name>표준프레임워크 개발가이드</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/egovframe-docs/egovframe-development/><span>개발환경(예정)</span></a></li><li class=nav-item><a class="nav-link active" href=/egovframe-docs/egovframe-runtime/><span>실행환경</span></a></li><li class=nav-item><a class=nav-link href=/egovframe-docs/runtime-example/><span>실행환경 예제</span></a></li><li class=nav-item><a class=nav-link href=/egovframe-docs/common-component/><span>공통컴포넌트(예정)</span></a></li><li class="td-light-dark-menu nav-item dropdown"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg><button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false><svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true><svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>이 섹션의 다중 페이지 출력 화면임.
<a href=# onclick="return print(),!1">여기를 클릭하여 프린트</a>.</p><p><a href=/egovframe-docs/egovframe-runtime/persistence-layer/>이 페이지의 일반 화면으로 돌아가기</a>.</p></div><h1 class=title>데이터처리</h1><div class=lead>데이터처리 서비스는 데이터베이스에 대한 연결 및 영속성 처리, 선언적인 트랜잭션 관리를 지원한다.</div><ul><li>1: <a href=#pg-ad1a520a76309efbce8281aa39e89e1a>DataSource 서비스</a></li><li>2: <a href=#pg-41de6d3f926b41dc4740da2a2c6a1a1e>Data Access 서비스</a></li><li>3: <a href=#pg-04681b163ef8070cbd2689ed4522e34a>iBATIS Configuration</a></li><li>4: <a href=#pg-f6fd856e6da30d011828a30bd5ca3658>Spring-iBATIS Integration</a></li><li>5: <a href=#pg-db3ade4f9f54ea25eb36c2a565082e57>iBATIS에서의 Data Type 매핑</a></li><li>6: <a href=#pg-709d3cacdff0820d97286730b198030a>iBATIS parameterMap</a></li><li>7: <a href=#pg-8df8aa47e3e435721c33243ea852dd0a>Inline Parameters</a></li><li>8: <a href=#pg-49d0958be1675a1cd07380605a368e58>resultMap</a></li><li>9: <a href=#pg-426f2185ff6bb6e3c057f56220644dea>iBATIS Dynamic SQL 사용</a></li><li>10: <a href=#pg-b0625eb5b34c13083c128310e5f8f842>MyBatis</a></li><li>11: <a href=#pg-793d7e9a4bdd43ff70f99a1ae6bdd6cd>MyBatis 주요 변경점</a></li><li>12: <a href=#pg-a2c5dd6fe956a5bc7c9f004b8cd06f2b>MyBatis 시작하기</a></li><li>13: <a href=#pg-c6dabd11eb456c4aaacfca3fe688ebda>MyBatis Configuration XML File</a></li><li>14: <a href=#pg-fe45f7e46b285ea79bc285f3f358415f>Mapper XML Files</a></li><li>15: <a href=#pg-d233086ba0d691c7d9c53da8180a8660>Mapper Dynamic SQL</a></li><li>16: <a href=#pg-189b1937088aa7587b87d5c96ecac5ea>MyBatis 적용 가이드</a></li><li>17: <a href=#pg-11609d1e6bd3df169129f7edb67885a9>Spring Data</a></li><li>18: <a href=#pg-b207d213a0a6f6f402a4e71513881924>Spring Data Repository</a></li><li>19: <a href=#pg-f286d06cdc87230486623dd1dfce6c5e>Query Method</a></li><li>20: <a href=#pg-5a66a59a43ca1f67154af011561e3276></a></li><li>21: <a href=#pg-caaedd7111ee911b289122f959e225fe>MongoDB support</a></li><li>22: <a href=#pg-f9c74007eee02f02d8d76bb3bf93b68c>MongoDB Repositories</a></li><li>23: <a href=#pg-9af2e60bb419e6a09feeb9f67531ff01>ORM 서비스</a></li><li>24: <a href=#pg-476bcaf52f3100270c9cab5ee0a05356>Entities</a></li><li>25: <a href=#pg-fc3aaef6e1ed1ca361fad2fc6909769b>Entity Operation</a></li><li>26: <a href=#pg-babd23700ecbe8799cc4dabe3da884ec>Association Mapping</a></li><li>27: <a href=#pg-b324c47affbdf84bb67655467c3c7d94>JPA Query Language</a></li><li>28: <a href=#pg-81d786dd7e57e3b8b129ac69079ef6c5>Native SQL</a></li><li>29: <a href=#pg-fda5691520f3a24830db2e5724582e02>Concurrency</a></li><li>30: <a href=#pg-10fba63d32009815621876b85000ad65>Cache Handling</a></li><li>31: <a href=#pg-6f400a309d9330ce4780aec9a709641b>Fetch Strategy</a></li><li>32: <a href=#pg-601a807baad20bd70afd8a322ff52d87>Spring과 JPA 통합</a></li><li>33: <a href=#pg-8d50b52d2822868b4f7ed0f541314106>JPA Configuration</a></li><li>34: <a href=#pg-4d382722195aa50fe41772f984d91b0a>Transaction 서비스</a></li><li>35: <a href=#pg-032282c342bc4b7273d1026b001f454f>선언적 Transaction 관리</a></li><li>36: <a href=#pg-872036067b899e847ab82d5662739e4a>프로그래밍 방식의 Transaction 관리</a></li><li>37: <a href=#pg-a7cf39ebb6d7f307603008511f9ac2e3>Spring Data - Reactive</a></li><li>38: <a href=#pg-78a8d1019dfc38342808d17a2d018a74>R2DBC</a></li><li>39: <a href=#pg-69b177967de51129d841ccbb03dc7514>MongoDB</a></li><li>40: <a href=#pg-19e5c7e551bfe26f47d2680ecc30f088>Cassandra</a></li><li>41: <a href=#pg-1a8028e2da9a5dfe75b15e537b4e1e39>Redis</a></li></ul><div class=content><h1 id=데이터처리>데이터처리</h1><p>데이터처리 서비스는 데이터베이스에 대한 연결 및 영속성 처리, 선언적인 트랜잭션 관리를 지원한다.</p></div></div><div class=td-content><h1 id=pg-ad1a520a76309efbce8281aa39e89e1a>1 - DataSource 서비스</h1><div class=lead>DataSource 서비스는 데이터베이스 연결을 제공하며, 추상화 계층을 통해 업무 로직과 데이터베이스 연결 방식 간의 종속성을 제거한다. 이를 통해 다양한 방식의 데이터베이스 연결을 지원하고 유연성을 제공한다.</div><h1 id=datasource-서비스>DataSource 서비스</h1><h2 id=개요>개요</h2><p>데이터베이스에 대한 연결을 제공하는 서비스이다. 다양한 방식의 데이터베이스 연결을 제공하고,이에 대한 추상화계층을 제공함으로써, 업무 로직과 데이터베이스 연결 방식 간의 종속성을 배제한다.</p><h2 id=설명>설명</h2><h3 id=connection-provider-별-datasource-implementions>Connection Provider 별 DataSource implementions</h3><p>Connection Provider별 Connection 객체를 얻기 위한 로직을 구현한 DataSource 구현체를 사용한다.</p><h4 id=jdbcdatasource>JDBCDataSource</h4><p>JDBC driver를 이용하여 Database Connection을 생성한다.</p><h5 id=configuration>Configuration</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DriverManagerDataSource&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${driver}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${dburl}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${username}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${password}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>driverClassName</td><td>JDBC driver class name설정</td></tr><tr><td>url</td><td>Database에 접근하기 위한 JDBC URL</td></tr><tr><td>username</td><td>Database 접근하기 위한 사용자명</td></tr><tr><td>password</td><td>Database 접근하기 위한 암호</td></tr></tbody></table><h5 id=sample-source>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbcProperties&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Properties</span> <span style=color:#000>jdbcProperties</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>isHsql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testJdbcDataSource</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DriverManagerDataSource&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> 
</span></span><span style=display:flex><span>                                                        <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>Connection</span> <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Statement</span> <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ResultSet</span> <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getConnection</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createStatement</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stmt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select &#39;x&#39; as x from dual&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>next</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>           <span style=color:#ce5c00;font-weight:700>........</span>
</span></span><span style=display:flex><span>    
</span></span></code></pre></div><h4 id=dbcpdatasource>DBCPDataSource</h4><p>JDBC driver를 이용한 Database Connection 구현체이다.<a href=http://commons.apache.org/dbcp/>Commons DBCP</a>라 불리는 Jakarta의 Database Connection Pool이다.</p><h5 id=configuratioin>Configuratioin</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.apache.commons.dbcp2.BasicDataSource&#34;</span> <span style=color:#c4a000>destroy-method=</span><span style=color:#4e9a06>&#34;close&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${driver}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${dburl}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${username}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${password}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;defaultAutoCommit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;poolPreparedStatements&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>driverClassName</td><td>jdbc driver의 class name 설정</td></tr><tr><td>url</td><td>Database url을 설정</td></tr><tr><td>username</td><td>Database 접근하기 위한 사용자명</td></tr><tr><td>password</td><td>Database 접근하기 위한 암호</td></tr><tr><td>defaultAutoCommit</td><td>datasource로부터 리턴된 connection에 대한 auto-commit 여부를 설정</td></tr><tr><td>poolPreparedStatements</td><td>PreparedStatement 사용여부</td></tr><tr><td>initialSize</td><td>Connection pool에 생성될 초기 connection size 설정</td></tr><tr><td>maxTotal<br>(1.x에서는 maxActive)</td><td>동시에 할당할 수 있는 active connection 최대 갯수를 설정</td></tr><tr><td>maxIdle</td><td>pool에 남겨놓을 수 있는 idle connection 최대 갯수를 설정</td></tr><tr><td>minIdle</td><td>최소한으로 유지할 connection 갯수를 설정</td></tr><tr><td>maxWaitMillis<br>(1.x에서는 maxWait)</td><td>모든 Connection이 사용중일 경우 최대 대기 시간을 설정</td></tr><tr><td>defaultReadOnly</td><td>Connection Pool에 의해 생성된 Connection에 read-only 속성 부여</td></tr><tr><td>defaultTransactionIsolation</td><td>리턴된 connection에 대한 transaction isolation 속성 부여</td></tr><tr><td>defaultCatalog</td><td>Connection의 catlog 설정</td></tr><tr><td>testOnBorrow</td><td>Connection pool에서 객체를 가지고 오기 전에 그 객체의 유효성을 확인할 것인지 결정</td></tr><tr><td>testOnReturn</td><td>객체를 return하기 전에 객체의 유효성을 확인할 것인지 결정</td></tr><tr><td>validationQuery</td><td>validationQuery를 설정</td></tr><tr><td>loginTimeout</td><td>Database에 연결하기 위한 login timeout(in seconds)을 설정</td></tr><tr><td>timeBetweenEvictionRunsMillis</td><td>놀고 있는 connection을 pool에서 제거하는 시간기준(기본 -1) 단위 1/1000초</td></tr></tbody></table><h5 id=sample-source-1>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbcProperties&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Properties</span> <span style=color:#000>jdbcProperties</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>isHsql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDbcpDataSource</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;org.apache.commons.dbcp.BasicDataSource&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#000>Connection</span> <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Statement</span> <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>ResultSet</span> <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>try</span> 
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getConnection</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createStatement</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stmt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select &#39;x&#39; as x from dual&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>next</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>fail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Jdbc DataSource Test Failed! : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span> 
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>........</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=c3p0datasource>C3P0DataSource</h4><p>JDBC driver를 이용한 Database Connection를 생성하는 구현체. C3P0 Library에 관련 사항은 <a href=http://www.mchange.com/projects/c3p0/index.html#c3p0-config.xml>C3P0 Configuration</a>에서 확인할 수 있다.</p><h5 id=configuration-1>Configuration</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>destroy-method=</span><span style=color:#4e9a06>&#34;close&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClass&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${driver}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jdbcUrl&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${dburl}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;user&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${username}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${password}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;initialPoolSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;minPoolSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;maxPoolSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;50&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- &lt;property name=&#34;timeout&#34; value=&#34;0&#34; /&gt; --&gt;</span>   <span style=color:#8f5902;font-style:italic>&lt;!-- 0 means: no timeout --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;idleConnectionTestPeriod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;200&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;acquireIncrement&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;maxStatements&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;0&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>  <span style=color:#8f5902;font-style:italic>&lt;!-- 0 means: statement caching is turned off.  --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- c3p0 is very asynchronous. Slow JDBC operations are generally performed 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                by helper threads that don&#39;t hold contended locks. 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		Spreading these operations over multiple threads can significantly improve performance 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		by allowing multiple operations to be performed simultaneously --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;numHelperThreads&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>  <span style=color:#8f5902;font-style:italic>&lt;!-- 3 is default --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>driverClass</td><td>jdbc driver</td></tr><tr><td>jdbcUrl</td><td>DB URL</td></tr><tr><td>user</td><td>사용자명</td></tr><tr><td>password</td><td>패스워드</td></tr><tr><td>initialPoolSize</td><td>풀 초기값</td></tr><tr><td>minPoolSize</td><td>풀 최소값</td></tr><tr><td>maxPoolSize</td><td>풀 최대값</td></tr><tr><td>idleConnectionTestPeriod</td><td>idle상태 점검시간</td></tr><tr><td>acquireIncrement</td><td>증가값</td></tr><tr><td>maxStatements</td><td>캐쉬유지여부</td></tr><tr><td>numHelperThreads</td><td>HelperThread 개수</td></tr></tbody></table><h5 id=sample-source-2>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbcProperties&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Properties</span> <span style=color:#000>jdbcProperties</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testC3p0DataSource</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;com.mchange.v2.c3p0.ComboPooledDataSource&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>Connection</span> <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Statement</span> <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ResultSet</span> <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getConnection</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createStatement</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stmt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select &#39;x&#39; as x from dual&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>next</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>fail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Jdbc DataSource Test Failed! : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>...................</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=jndidatasource>JNDIDataSource</h4><p>JNDIDataSource는 JNDI Lookup을 이용하여 Database Connection을 생성한다. JNDIDataSource는 대부분 Enterprise application server에서 제공되는 JNDI tree로 부터 DataSource를 가져온다.</p><h5 id=configuration-2>Configuration</h5><p>jee tag를 사용하기 위해서는 Spring XML Configuration 파일의 머릿말에 namespace와 schemaLocation를 추가해야 한다.</p><ul><li>namespace : xmlns:jee=&ldquo;<a href=http://www.springframework.org/schema/jee%22>http://www.springframework.org/schema/jee"</a></li><li>schemaLocation : <a href=http://www.springframework.org/schema/jee>http://www.springframework.org/schema/jee</a> <a href=http://www.springframework.org/schema/jee/spring-jee-2.5.xsd>http://www.springframework.org/schema/jee/spring-jee-2.5.xsd</a></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;beans</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xmlns:xsi=</span><span style=color:#4e9a06>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xmlns:jee=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/jee&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xsi:schemaLocation=</span><span style=color:#4e9a06>&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.5.xsd&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;!-- &lt;bean/&gt; definitions here --&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/beans&gt;</span>
</span></span></code></pre></div><p>Jeus 설정</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;jee:jndi-lookup</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>jndi-name=</span><span style=color:#4e9a06>&#34;${jndiName}&#34;</span> <span style=color:#c4a000>resource-ref=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#204a87;font-weight:700>&lt;jee:environment&gt;</span>
</span></span><span style=display:flex><span>	  java.naming.factory.initial=${jeus.java.naming.factory.initial}
</span></span><span style=display:flex><span>	  java.naming.provider.url=${jeus.java.naming.provider.url}
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/jee:environment&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/jee:jndi-lookup&gt;</span>
</span></span></code></pre></div><p>Weblogic 설정</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;util:properties</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jndiProperties&#34;</span> <span style=color:#c4a000>location=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/spring/jndi.properties&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;jee:jndi-lookup</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>jndi-name=</span><span style=color:#4e9a06>&#34;${jndiName}&#34;</span> <span style=color:#c4a000>resource-ref=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>environment-ref=</span><span style=color:#4e9a06>&#34;jndiProperties&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>jndiTemplate</td><td>JNDI 검색을 위해 JNDI 템플릿을 설정</td></tr><tr><td>jndiEnvironment</td><td>JNDI를 검색하기 위해 JNDI 환경을 설정</td></tr><tr><td>resourceRef</td><td>J2EE 컨테이너에서 검색할 수 있는지 설정</td></tr><tr><td>expectedType</td><td>JNDI 객체의 타입을 지정</td></tr><tr><td>jndiName</td><td>검색을 위해 JNDI 이름을 설정</td></tr><tr><td>proxyInterface</td><td>JNDI 객체를 사용하기 위해 proxy 인터페이스를 설정</td></tr><tr><td>lookupOnStartup</td><td>starup시에 JNDI object를 검색할 지 여부를 설정</td></tr><tr><td>cache</td><td>JNDI 객체를 캐싱할 것인지 설정</td></tr><tr><td>defaultObject</td><td>JNDI lookup에 실패하였을 경우 전달할 default object를 지정</td></tr></tbody></table><h5 id=sample-source-3>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbcProperties&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Properties</span> <span style=color:#000>jdbcProperties</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testJndiJeusDataSource</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;jeus.jdbc.connectionpool.DataSourceWrapper&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>Connection</span> <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Statement</span> <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ResultSet</span> <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getConnection</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createStatement</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stmt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select &#39;x&#39; as x from dual&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>next</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>fail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Jdbc DataSource Test Failed! : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> 
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>...................</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>Jeus5.0 datasource : jeus.jdbc.driver.oracle.OracleConnectionPool</li><li>Jeus6.0 datasource : jeus.jdbc.connectionpool.DataSourceWrapper</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdbcProperties&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>Properties</span> <span style=color:#000>jdbcProperties</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testJndiDataSource</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;weblogic.jdbc.common.internal.RmiDataSource_922_WLStub&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>Connection</span> <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Statement</span> <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ResultSet</span> <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>con</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getConnection</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>stmt</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>con</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createStatement</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>rs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stmt</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select &#39;x&#39; as x from dual&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>next</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;x&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>rs</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>fail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Jdbc DataSource Test Failed! : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> 
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>...................</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>Weblogic datasource</li></ul><h2 id=참고자료>참고자료</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-41de6d3f926b41dc4740da2a2c6a1a1e>2 - Data Access 서비스</h1><div class=lead>Data Access 서비스는 다양한 데이터베이스 솔루션과 접근 기술에 일관된 방식으로 대응하며, 데이터 조회, 입력, 수정, 삭제 기능을 단순화한다. 또한 데이터베이스와의 접점을 추상화하여 변경 시 시스템 수정 최소화를 지원하고, 템플릿 방식으로 개발 효율을 높인다.</div><h1 id=data-access-서비스>Data Access 서비스</h1><h2 id=개요>개요</h2><p>Data Access 서비스는 다양한 데이터베이스 솔루션 및 데이터베이스 접근 기술에 일관된 방식으로 대응하기 위한 서비스로서,데이터를 조회하거나 입력, 수정, 삭제하는 기능을 수행하는 메커니즘을 단순화한다. 또한 데이터베이스 솔루션이나 접근 기술이 변경될 경우에도 데이터를 다루는 시스템 영역의 변경을 최소화할 수 있도록 데이터베이스와의 접점을 추상화하며, 추상화된 데이터 접근 방식을 템플릿(Template)으로 제공함으로써, 개발자들의 업무 효율을 향상시킨다.</p><h3 id=ibatis-프레임워크>iBATIS 프레임워크</h3><p>전자정부 프레임워크에서는 JDBC 를 사용한 Data Access 를 추상화하여 간편하고 쉽게 사용할 수 있는 Data Mapper framework 인 iBATIS 를 Data Access 기능의 기반 오픈 소스로 채택하였다. iBATIS 를 사용하면 관계형 데이터베이스에 억세스하기 위해 필요한 일련의 자바 코드 사용을 현저히 줄일 수 있으며 간단한 XML 기술을 사용하여 SQL 문을 JavaBeans (또는 Map) 에 간편하게 맵핑할 수 있다.</p><ul><li>추상화된 접근 방식 제공 : JDBC 데이터 억세스에 대한 추상화된 접근 방식으로 간편하고 쉬운 API, 자원 연결/해제, 공통 에러 처리 등을 통합 지원한다.</li><li>코드로부터 SQL 분리 지원 : 소스코드로부터 SQL 문을 분리하여 별도의 repository(의미있는 문법의 XML)에 유지하고 이에 대한 빠른 참조구조를 내부적으로 구현하여 관리/유지보수/튜닝의 용이성을 보장한다.</li><li>쿼리 실행의 입/출력 객체 바인딩/맵핑 지원 : 쿼리문의 입력 파라메터에 대한 바인딩과 실행결과 resultset 의 가공(맵핑) 처리시 객체(VO, Map, List) 수준의 자동화를 지원한다.</li><li>Dynamic SQL 지원 : 코드 작성, API 직접 사용없이 입력 조건에 따른 동적인 쿼리문 변경을 지원한다.</li><li>다양한 DB 처리 지원 : 기본 질의 외에 Batch SQL, Paging, Callable Statement, BLOB/CLOB 등 다양한 DB처리를 지원한다.</li></ul><h4 id=세부-사항-설명>세부 사항 설명</h4><ul><li><a href=./dataaccess-ibatis_configuration.md>iBATIS Configuration</a></li><li><a href=./dataaccess-spring_ibatis_integration.md>Spring iBATIS Integration</a></li><li><a href=./dataaccess-data_type.md>Data Type</a></li><li><a href=./dataaccess-parametermap.md>parameterMap</a></li><li><a href=./dataaccess-inline_parameters.md>Inline parameters</a></li><li><a href=./dataaccess-resultmap.md>resultMap</a></li><li><a href=./dataaccess-dynamic_sql.md>Dynamic SQL</a></li></ul><p>iBATIS Data Mapper API 는 XML을 사용하여 SQL 문에 대한 객체 맵핑을 간편하게 기술할 수 있도록 지원하며, 자바빈즈 객체와 Map 구현체, 다양한 원시 래퍼 타입(String, Integer..) 등을 PreparedStatement 의 파라메터나 ResultSet에 대한 결과 객체로 쉽게 맵핑해준다.</p><p><img src=../images/psl-ibatis_architecure.png alt=image></p><ul><li>파라메터 객체를 제공한다. (마찬가지로 자바빈즈, Map 또는 원시 래퍼 일 수 있다.) 파라메터 객체는 update 문, 쿼리의 where 절의 input 변수로 세팅될 것이다.</li><li>mapped statement 를 실행한다. Data Mapper 프레임워크는 PreparedStatement 의 인스턴스를 생성하여 위에서 제공된 파라메터 객체를 이용해 파라메터를 세팅하고(바인드 변수처리),쿼리문을 실행하고 결과를 ResultSet 으로 부터 결과 객체로 작성한다.</li><li>update 문의 경우에는 변경 반영된 rows 수를 리턴하고, 조회의 경우 단건 조회 용 single 객체 또는 여러건 조회를 위한 Collection (객체의 List) 을 리턴하게 된다. 파라메터 객체와 마찬가지로 결과 객체의 JavaBean 이나 Map, primitive type wrapper 또는 XML 문서가 될 수 있다.</li></ul><h2 id=설명>설명</h2><p>Data Access 서비스에 대한 자세한 설명에 앞서 간단하게 Data Access 서비스를 시작하는데 필요한 것에 대한 설명을 하고자 한다.</p><h3 id=step1-사전-준비>Step1. 사전 준비</h3><h4 id=필요-library>필요 Library</h4><p>본 서비스를 활용하기 위해서 필요한 Library 목록과 설명은 아래와 같다.</p><table><thead><tr><th>라이브러리</th><th>설 명</th><th>연관 라이브러리</th></tr></thead><tbody><tr><td>ibatis-sqlmap-2.3.4.726.jar</td><td>iBATIS 라이브러리(필수)</td><td></td></tr><tr><td>commons-dbcp-1.2.2.jar</td><td>database connection pooling 지원 라이브러리(선택)</td><td></td></tr><tr><td>commons-logging-1.1.1.jar</td><td>commons 로깅(선택)</td><td></td></tr><tr><td>log4j-1.3alpha-8.jar</td><td>log4j(선택)</td><td></td></tr><tr><td>oscache-2.4.jar</td><td>중앙집중 또는 분산 캐슁 지원(선택)</td><td></td></tr><tr><td>cglib-nodep-2.1_3.jar</td><td>Runtime Bytecode Enhancing 필요 시(선택)</td><td></td></tr></tbody></table><p>ibatis-sqlmap-2.3.4.726.jar 만이 필수 라이브러리이다. 그러나 일반적으로 commons-dbcp 와 같은 커넥션풀링 라이브러리 및 로깅 처리를 위한 라이브러리는 반드시 필요로 하며, 추가적으로 iBATIS 에서 지원하는 개선된 기능으로 cache 지원 이나 Runtime Bytecode Enhancement 관련 기능을 쓰고자 할 경우는 위의 참조 라이브러리를 추가로 설정할 수 있다. 또한 우리는 Spring-iBATIS 연동 형태의 어플리케이션 개발을 선호하므로 Spring 관련 라이브러리 및 이에 대한 dependency 라이브러리가 일반적으로 함께 포함될 것이다. 여기에 덧붙여 실제 Data Access 처리의 대상의 되는 DBMS(Oracle, Mysql, Hsqldb, Tibero ..) 에 따라 적절한 jdbc 드라이버에 대한 라이브러리가 추가적으로 필요하다.</p><h3 id=step2-sql-map-configxml-설정-및-기본-spring-설정>Step2. sql-map-config.xml 설정 및 기본 Spring 설정</h3><p>Spring 프레임워크 기반 어플리케이션에서 iBATIS 를 연동하여 사용하고자 하는 경우 Spring의 SqlMapClientFactoryBean 에 대한 설정이 필요하며 여기서는 실제 대상 sql-map-config 설정 파일과 iBATIS 에 제공될 dataSource 에 대한 설정을 지시한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- SqlMap setup for iBATIS Database Layer --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/sqlmap/sql-map-config.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><ul><li>Spring 연동 기능을 사용하면 iBATIS 의 SqlMapClient(a thread safe client for SQL Maps) 를 별도의 iBATIS API 없이도 얻을 수 있게 된다.</li><li>실행환경 3.5 부터는 Spring 4 변경에 따라 org.springframework.orm.ibatis.SqlMapClientFactoryBean 클래스가 egovframework.rte.psl.orm.ibatis.SqlMapClientFactoryBean 로 변경된다.</li></ul><p>아래는 주된 iBATIS 의 SQL Map XML Configuration 파일(sql-map-config.xml 설정 파일)이다. iBATIS 단독으로 쓰일 때는 transactionManager, dataSource 설정 등을 추가로 포함해야 하지만 Spring 연동 환경에서는 이 부분은 Spring 이 넘겨주는 dataSource 를 자동으로 사용하게 되고 transaction 관리는 비즈니스 서비스 영역에 선언적으로 설정하여 iBATIS 관련 모듈에서는 고민할 필요가 없게 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMapConfig PUBLIC &#34;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&#34; 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    &#34;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMapConfig&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;settings</span> <span style=color:#c4a000>useStatementNamespaces=</span><span style=color:#4e9a06>&#34;false&#34;</span> 
</span></span><span style=display:flex><span>		  <span style=color:#a40000>..</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeHandler</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;java.util.Calendar&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;TIMESTAMP&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>callback=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.typehandler.CalendarTypeHandler&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;META-INF/sqlmap/mappings/testcase-basic.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#a40000>..</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMapConfig&gt;</span>
</span></span></code></pre></div><ul><li>sqlMapConfig : iBATIS 설정 파일의 root 태그</li><li>settings : 다양한 옵션 설정을 지시할 수 있는 태그 (ex. cacheModel 사용여부, Runtime Bytecode Enhance 사용여부, 쿼리문에 대한 Namespace 사용여부 등의 옵션 설정 가능. cf. transaction/dataSource 연결 관련한 설정은 Spring 연동 환경에서는 필요 없음.)</li><li>typeHandler : javaType ↔ jdbcType 간의 type 변환 처리가 별도로 필요한 경우 typeHandler 를 구현하고 이를 sql-map-config 에 등록함.</li><li>typeAlias : global 하게 사용할 typeAlias (클래스 풀 패키지명에 대한 간략한 별칭) 를 지정할 수 있음.</li><li>sqlMap : 각 SQL Mapping XML 파일을 등록함. classpath 나 url 로부터 해당 자원을 stream 형식으로 로딩하게 됨. resource 속성은 기본으로 classpath 경로를 바라본다.</li></ul><p>Spring 2.5.5 이상, iBATIS 2.3.2 이상 인 경우에는 iBATIS 연동을 위한 SqlMapClientFactoryBean 정의 시 mappingLocations 속성으로 Sql 매핑 파일에 대한 패턴 표현식으로 일괄 지정도 가능하다. mappingLocations 속성 사용 예는 다음과 같다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- SqlMap setup for iBATIS Database Layer --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/sqlmap/sql-map-config.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!-- Java 1.5 or higher and iBATIS 2.3.2 or higher REQUIRED --&gt;</span>
</span></span><span style=display:flex><span>     		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;mappingLocations&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/sqlmap/mappings/**/*.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>이 경우는 “configLocation” 속성이 필요하지 않지만, 현재 해당 속성이 없는 경우 SqlMapClientFactoryBean의 초기화되지 않기 때문에 “configLocation” 속성을 유지하셔야 한다. 이 때 해당 sql-map-config.xml은 다음과 같이 dummy.xml query를 갖도록 처리하여야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMapConfig PUBLIC &#34;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&#34; 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&#34;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMapConfig&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;sqlmap/sql/common/dummy.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMapConfig&gt;</span>
</span></span></code></pre></div><p>dummy.xml은 다음과 같이 처리한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMap PUBLIC &#34;-//iBATIS.com//DTD SQL Map 2.0//EN&#34; &#34;http://www.ibatis.com/dtd/sql-map-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;Dummy&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMap&gt;</span>
</span></span></code></pre></div><h3 id=step3-sql-mapping-xml-설정>Step3. sql mapping xml 설정</h3><p>iBATIS 에서 정의한 SQL Map 문서 구조 내에서 다양한 옵션 설정과 Mapped statement 정의를 작성하게 된다. 아래는 부서정보에 대한 CRUD 와 관련한 쿼리와 이에 대한 In/Out 객체 맵핑을 포함하는 간략한 매핑 파일이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMap PUBLIC &#34;-//iBATIS.com//DTD SQL Map 2.0//EN&#34; &#34;http://www.ibatis.com/dtd/sql-map-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;Dept&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.DeptVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertDept&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		insert into DEPT
</span></span><span style=display:flex><span>		           (DEPT_NO,
</span></span><span style=display:flex><span>		            DEPT_NAME,
</span></span><span style=display:flex><span>		            LOC)
</span></span><span style=display:flex><span>		values     (#deptNo#,
</span></span><span style=display:flex><span>		            #deptName#,
</span></span><span style=display:flex><span>		            #loc#)
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  DEPT_NO = #deptNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;update</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;updateDept&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		update DEPT
</span></span><span style=display:flex><span>		set    DEPT_NAME = #deptName#,
</span></span><span style=display:flex><span>		       LOC = #loc#
</span></span><span style=display:flex><span>		where  DEPT_NO = #deptNo#
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/update&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;delete</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deleteDept&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		delete from DEPT
</span></span><span style=display:flex><span>		where       DEPT_NO = #deptNo#
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/delete&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDeptList&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  1 = 1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;isNotNull</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;and&#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			DEPT_NO = #deptNo#
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/isNotNull&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;isNotNull</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;and&#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			DEPT_NAME LIKE &#39;%&#39; || #deptName# || &#39;%&#39;
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/isNotNull&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMap&gt;</span>
</span></span></code></pre></div><ul><li>typeAlias : 현재 매핑 파일내에서 객체에 대한 간략한 alias 명을 지정함.</li><li>resultMap : DB 의 칼럼명과 객체의 Attribute 명에 대한 매핑을 작성함. javaType, jdbcType, columnIndex, typeHandler 등 다양한 추가 옵션 지정이 가능함.</li><li>insert : 입력 쿼리(insert 문)에 대한 Mapped Statement 정의 태그</li><li>select : 조회 쿼리에 대한 Mapped Statement 정의 태그</li><li>update : 수정 쿼리(update 문)에 대한 Mapped Statement 정의 태그</li><li>delete : 삭제 쿼리(delete 문)에 대한 Mapped Statement 정의 태그</li></ul><p>위의 CRUD 관련 매핑 파일에서는 기본으로 DeptVO 라는 JavaBeans 객체를 Parameter/Result 객체로 사용하고 있으며 이를 typeAlias 로 간략하게 지정하여 사용하고 있다. 위에서는 주로 parameterClass 로 지정하여 파라메터 객체에 대한 명시적 사용을 지시하고 있으며, 실제 바인드 변수 처리 시에는 #attribute명# 과 같이 Inline Parameter 형식을 사용하였다. 또한 resultMap 정의를 통하여 ResultSet 에 따른 결과 칼럼정보에 대한 결과 객체(DeptVO)의 필드별 매핑을 별도로 정의하였고 이를 select 문의 resultMap 속성에 명시하여 select 의 결과를 resultMap 을 통해 처리하고 있다. 이러한 방식 외에 다양한 방식으로 Mapped Statement 처리를 정의할 수 있으나, 위와 같이 JavaBeans 객체를 사용하고 또 resultMap 을 정의하여 결과객체 처리를 하며 Inline Parameter 방식으로 바인드 변수 처리하는 스타일로 사용하기를 권고하는 바이다.</p><h3 id=step4-dao-클래스-생성>Step4. DAO 클래스 생성</h3><p>간단한 형태의 DAO 클래스를 생성한다. 아래의 DAO 에서 상속하고 있는 EgovAbstractDAO 에서는 SqlMapClientDaoSupport 를 extends 하고 있으며 iBATIS SQL Map 상호 작용을 위한 기본 클래스인 SqlMapClient (위에서 “sqlMapClient” 로 정의한 iBATIS 연동 FactoryBean 에 의해 제공됨) 에 대한 injection 처리가 내부적으로 적용되어 있고, 기본 CRUD 에 대한 iBATIS 실행을 위해서는 간략한 메서드 래핑도 제공한다. 상세 API 를 사용하고자 하는 경우 getSqlMapClientTemplate() 를 통해(ex. getSqlMapClientTemplate().queryWithRowHandler(“selectEmpListToOutFileUsingRowHandler”, paramObject, rowHandler); ) 사용할 수 있다.</p><h4 id=dao-클래스>DAO 클래스</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Repository</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deptDAO&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DeptDAO</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>EgovAbstractDAO</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>insertDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertDept&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>updateDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;updateDept&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>deleteDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deleteDept&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>DeptVO</span> <span style=color:#000>selectDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>selectByPk</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectDept&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectDeptList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>searchVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectDeptList&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>searchVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>@Repository : DAO 에 대한 @Repository 스테레오 타입 Annotation 을 사용한 Spring Bean 정의</li></ul><p>각 CRUD 에 관련한 메서드에서는 queryId 와 파라메터 객체(여기서는 DeptVO) 를 인자로 iBATIS 의 Mapped Statement 을 실행하고 있으며, 조회의 경우에는 단건 조회는 DeptVO 객체로, 리스트 조회는 DeptVO 에 대한 List 를 돌려주도록 하고 있다. iBATIS 내부적으로는 java 1.5 이상의 Generics (type 이 정의된 Collection 처리) 로 처리하지 않으나 sql 매핑 파일에 따라 실제 데이터는 List&lt;DeptVO> 로 처리가 될 것이므로 @SuppressWarnings(“unchecked”) 을 지시하여 호출 이전 모듈에서는 불필요한 Type Casting 을 최소화하고 있다. 만약 sql-map-config.xml 의 settings 옵션으로 useStatementNamespaces=“true” 를 설정한 경우라면 위의 queryId 는 “Dept.insertDept” 와 같이 sql 맵핑 파일에 지정한 Namespace prefix 을 포함하는 형태여야 함에 유의한다.</p><h3 id=step5-테스트-클래스-생성>Step5. 테스트 클래스 생성</h3><p>위에서 정의한 설정 파일 및 DAO 를 이용하여 간단한 입력,조회 처리에 대한 JUnit TestCase 형태(JUnit 4 스타일)로 구성하였다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>locations</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;classpath*:META-INF/spring/context-*.xml&#34;</span> <span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@TransactionConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>transactionManager</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;txManager&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>defaultRollback</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Transactional</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>BasicDataAccessTest</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;deptDAO&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>DeptDAO</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Before</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onSetUp</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 외부에 sql file 로부터 DB 초기화 (기존 테이블 삭제/생성)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeSqlScript</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleJdbcTemplate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ClassPathResource</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;META-INF/testdata/sample_schema_ddl_hsql.sql&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>DeptVO</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>90</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test 부서&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setLoc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test 위치&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DeptVO</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLoc</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLoc</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testBasicInsert</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>DeptVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testBasicUpdate</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// data change
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;upd Dept&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setLoc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;upd loc&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// update
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>effectedRows</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>effectedRows</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>DeptVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testBasicDelete</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// delete
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>effectedRows</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>deleteDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>effectedRows</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>DeptVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// null 이어야 함
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testBasicSelectList</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 검색조건으로 key 설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>DeptVO</span> <span style=color:#000>searchVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>searchVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>90</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// selectList
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDeptList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>searchVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// key 조건에 대한 결과는 한건일 것임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 검색조건으로 name 설정 - &#39;%&#39; || #deptName# || &#39;%&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>DeptVO</span> <span style=color:#000>searchVO2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>searchVO2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#ce5c00;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>// &#39;%&#39; || &#39;&#39; || &#39;%&#39; --&gt; &#39;%%&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// selectList
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDeptList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>searchVO2</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// like 조건에 대한 결과는 한건 이상일 것임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList2</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>기본적으로 Annotation 형식 Bean 생성 및 Dependency Injection 을 적용한 Spring 기반의 어플리케이션으로 구성하였으며, dataSource, transactionManager 등의 Spring Bean 이 함께 사용되고 있고, 테스트 케이스는 JUnit 4 형식으로 Spring 설정 파일 로딩 및 transactionManager, dataSource(DB 초기화를 위해 SimpleJdbcTemplate 사용 시 참조)를 얻을 수 있도록 되어 있음을 참고한다. 테스트 편의를 위해 매 테스트 메서드에 우선하여 @Before 로 정의된 메서드에서 기존 테이블 삭제 및 재생성 처리를 하고 있으며, makeVO 라는 별도 메서드로 테스트용 VO 작성 부분을 분리하고, checkResult 라는 메서드로 original VO 와 조회 결과 resultVO 에 대한 assert 비교 로직을 분리하여 재사용하고 있다. @Test 로 지시한 각 메서드가 테스트 메서드이고 입력-조회-결과체크, 입력-변경-조회-결과체크, 입력-삭제-조회-null체크, 검색조건 설정-조회-결과체크 의 flow 에 대한 검증으로 DeptDAO 에 대한 기본 CRUD 테스트 로직을 구성하였다.</p><h3 id=step6-실-행>Step6. 실 행</h3><ul><li>파일을 다운로드 받아서 압축을 푼다.</li><li>이클립스에서 압축 푼 폴더를 선택하여 프로젝트를 Import 한다.</li><li>프로젝트내 src 폴더에 DeptVO.java, DeptDAO.java, BasicDataAccessTest.java, Spring, iBATIS 설정파일 및 Sql 맵핑파일, 테스트 데이터용 초기화 스크립트 파일 및 log4j.xml 가 정상적으로 있는지 확인한다.</li><li>lib에 라이브러리 파일이 있는지 확인한다.</li><li>BasicDataAccessTest.java를 선택하여 마우스 오른쪽 클릭하여 Run As > JUnit Test 실행한다.</li><li>JUnit 결과창에서 정상적으로 수행된 것을 확인한다.</li></ul><p>※ 해당 프로젝트는 Hsqldb (현재 메모리구동 방식)을 사용하고 있으나 다른 DBMS 를 쓰고자 하는 경우 jdbc.properties 에 관련 접속정보를 추가하고 JDBC 드라이버 jar 파일을 라이브러리로 추가하여 테스트 해 볼 수 있다.</p><h2 id=참고-자료>참고 자료</h2><ul><li><a href=http://ibatis.apache.org>http://ibatis.apache.org</a></li><li><a href=https://ibatis.apache.org/docs/java/pdf/iBATIS-SqlMaps-2_en.pdf>iBATIS-SqlMaps-2 Developer Guide</a></li><li><a href=https://ibatis.apache.org/docs/java/pdf/iBATIS-SqlMaps-2_ko.pdf>iBATIS-SqlMaps-2 개발자 가이드 (이동국님 번역)</a></li><li><a href=http://static.springframework.org/spring/docs/2.5.6/reference/orm.html#orm-ibatis>Spring Framework - Reference Documentation</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-04681b163ef8070cbd2689ed4522e34a>3 - iBATIS Configuration</h1><div class=lead>iBATIS 의 메인 설정 파일인 SQL Map XML Configuration 파일(이하 sql-map-config.xml 설정 파일) 작성과 상세한 옵션 설정에 대해 알아본다.</div><h1 id=ibatis-configuration>iBATIS Configuration</h1><p>iBATIS 의 메인 설정 파일인 SQL Map XML Configuration 파일(이하 sql-map-config.xml 설정 파일) 작성과 상세한 옵션 설정에 대해 알아본다.</p><h2 id=sql-map-configxml>sql-map-config.xml</h2><p>SqlMapClient 설정관련 상세 내역을 제어할 수 있는 메인 설정 파일로 주로 transaction 관리 관련 설정 및 다양한 옵션 설정, Sql Mapping 파일들에 대한 path 설정 등을 포함한다.</p><h4 id=sample-configuration>Sample Configuration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMapConfig PUBLIC &#34;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&#34;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMapConfig&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;properties</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;META-INF/spring/jdbc.properties&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;settings</span> <span style=color:#c4a000>cacheModelsEnabled=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>enhancementEnabled=</span><span style=color:#4e9a06>&#34;true&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>lazyLoadingEnabled=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>maxRequests=</span><span style=color:#4e9a06>&#34;128&#34;</span> <span style=color:#c4a000>maxSessions=</span><span style=color:#4e9a06>&#34;10&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>maxTransactions=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#c4a000>useStatementNamespaces=</span><span style=color:#4e9a06>&#34;false&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>defaultStatementTimeout=</span><span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeHandler</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;java.util.Calendar&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;TIMESTAMP&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>callback=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.typehandler.CalendarTypeHandler&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;transactionManager</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;JDBC&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;dataSource</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;DBCP&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${driver}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${dburl}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${username}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${password}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#8f5902;font-style:italic>&lt;!-- OPTIONAL PROPERTIES BELOW --&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;maxActive&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;10&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;maxIdle&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;maxWait&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;60000&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#8f5902;font-style:italic>&lt;!-- validation query --&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#8f5902;font-style:italic>&lt;!--&lt;property name=&#34;validationQuery&#34; value=&#34;select * from DUAL&#34; /&gt;--&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;logAbandoned&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;removeAbandoned&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;removeAbandonedTimeout&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;50000&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;Driver.DriverSpecificProperty&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;SomeValue&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/dataSource&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/transactionManager&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;META-INF/sqlmap/mappings/testcase-basic.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#a40000>..</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMapConfig&gt;</span>
</span></span></code></pre></div><ul><li>properties : 표준 java properties (key=value 형태)파일에 대한 연결을 지원하며 설정 파일내에서 ${key} 와 같은 형태로 properties 형태로 외부화 해놓은 실제의 값(여기서는 DB 접속 관련 driver, url, id/pw)을 참조할 수 있다. resource 속성으로 classpath, url 속성으로 유효한 URL 상에 있는 자원을 지정 가능하다.</li><li>settings : 이 설정 파일을 통해 생성된 SqlMapClient instance 에 대하여 다양한 옵션 설정을 통해 최적화할 수 있도록 지원한다. 모든 속성은 선택사항(optional) 이다.</li></ul><table><thead><tr><th>속성</th><th>설명</th><th>Example, Default</th></tr></thead><tbody><tr><td>maxRequests</td><td>같은 시간대에 SQL 문을 실행한 수 있는 thread 의 최대 갯수 지정.</td><td>maxRequests=“256”, 512</td></tr><tr><td>maxSessions</td><td>주어진 시간에 활성화될 수 있는 session(또는 client) 수 지정.</td><td>maxSessions=“64”, 128</td></tr><tr><td>maxTransactions</td><td>같은 시간대에 SqlMapClient.startTransaction() 에 들어갈 수 있는 최대 갯수 지정.</td><td>maxTransactions=“16”, 32</td></tr><tr><td>cacheModelsEnabled</td><td>SqlMapClient 에 대한 모든 cacheModel 에 대한 사용 여부를 global 하게 지정.</td><td>cacheModelsEnabled=“true”, true (enabled)</td></tr><tr><td>lazyLoadingEnabled</td><td>SqlMapClient 에 대한 모든 lazy loading 에 대한 사용 여부를 global 하게 지정.</td><td>lazyLoadingEnabled=“true”, true (enabled)</td></tr><tr><td>enhancementEnabled</td><td>runtime bytecode enhancement 기술 사용 여부 지정.</td><td>enhancementEnabled=“true”, false (disabled)</td></tr><tr><td>useStatementNamespaces</td><td>mapped statements 에 대한 참조 시 namespace 조합 사용 여부 지정. true 인 경우 queryForObject(“sqlMapName.statementName”); 과 같이 사용함.</td><td>useStatementNamespaces=“false”, false (disabled)</td></tr><tr><td>defaultStatementTimeout</td><td>모든 JDBC 쿼리에 대한 timeout 시간(초) 지정, 각 statement 의 설정으로 override 가능함. 모든 driver가 이 설정을 지원하는 것은 아님에 유의할 것.</td><td>지정하지 않는 경우 timeout 없음(cf. 각 statement 설정에 따라)</td></tr><tr><td>classInfoCacheEnabled</td><td>introspected(java 의 reflection API에 의해 내부 참조된) class의 캐쉬를 유지할지에 대한 설정</td><td>classInfoCacheEnabled=“true”, true (enabled)</td></tr><tr><td>statementCachingEnabled</td><td>prepared statement 의 local cache 를 유지할지에 대한 설정</td><td>statementCachingEnabled=“true”, true (enabled)</td></tr></tbody></table><ul><li>typeHandler : javaType ↔ jdbcType 간의 변환(prepared statement 의 파라메터 세팅/resultSet 의 값 얻기)을 처리하는 typeHandler 구현체를 등록할 수 있다.</li><li>transactionManager : 트랜잭션 관리 서비스를 설정할 수 있다. type 속성으로 어떤 트랜잭션 관리자를 사용할지 지시할 수 있는데, JDBC, JTA, EXTERNAL 의 세가지 트랜잭션 관리자가 프레임워크에 포함되어 있다. 위에서는 일반적인 Connection commit()/rollback() 메서드를 통해 트랜잭션을 관리하는 JDBC 타입으로 설정하였다.</li><li>dataSource : transactionManager 설정의 일부 영역으로 DataSource 에 대한 설정이다. type 속성으로 어떤 DataSourceFactory 를 사용할지 지시할 수 있는데, SIMPLE, DBCP, JNDI 의 세가지 설정이 가능하다. 위에서는 Apache Commons DBCP(Database Connection Pool) 를 사용하는 DBCP 타입으로 설정하였다. iBATIS 는 DBCP 속성에 대한 설정을 직접 명시할 수 있도록 지원하고 있다. iBATIS 2 버전 이후로는 단일 dataSource 만 지원한다.</li><li>sqlMap : 명시적으로 각 SQL Map XML 파일을 포함하도록 설정한다. classpath (resource 속성으로 지정) 나 url(url 속성으로 지정) 상의 자원을 stream 형태로 로딩하게 된다. 위에서는 classpath 상에 존재하는 sql 매핑 파일을 지정하였다.</li></ul><p>이 외에도 typeAlias(global 한 type 별명-풀패키지명에 비해 간략히), resultObjectFactory (SQL 문의 실행에 의한 결과 객체의 생성을 iBATIS 의 ResultObjectFactory 인터페이스를 구현한 factory 클래스를 통해 처리할 수 있도록 지원) 에 대한 설정이 가능하다. DTD 상 sqlMap 설정은 하나 이상이 필요하고 다른 설정은 선택사항 이다.</p><h2 id=sql-map-xml-파일-sql-매핑-파일>SQL Map XML 파일 (sql 매핑 파일)</h2><p>sql 매핑 파일은 iBATIS 의 mapped statement 형태로 처리될 수 있도록 SQL Map 문서 구조에 따라 다양한 옵션 설정 및 매핑 정의, sql 문을 외부화하여 저장하는 파일이다.</p><h4 id=sample-sql-map-xml>Sample SQL Map XML</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMapConfig PUBLIC &#34;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&#34; &#34;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;Dept&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.DeptVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertDept&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		insert into DEPT
</span></span><span style=display:flex><span>		           (DEPT_NO,
</span></span><span style=display:flex><span>		            DEPT_NAME,
</span></span><span style=display:flex><span>		            LOC)
</span></span><span style=display:flex><span>		values     (#deptNo#,
</span></span><span style=display:flex><span>		            #deptName#,
</span></span><span style=display:flex><span>		            #loc#)
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  DEPT_NO = #deptNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMap&gt;</span>
</span></span></code></pre></div><ul><li>typeAlias : 현재 매핑 파일내에서 객체에 대한 간략한 alias 명을 지정함. (cf. 매우 자주 쓰이는 class 의 경우 sql-map-config.xml 에 global 하게 등록하는 것이 좋음)</li><li>resultMap : DB 칼럼명(select 문의 칼럼 alias) 과 결과 객체의 attribute 에 대한 매핑 및 추가 옵션을 정의함.</li><li>insert, select : 각 statement 타입에 따른 mapped statement 정의 요소 예시. 유형에 따라 insert/update/delete/select/procedure/statement 요소 사용 가능</li></ul><p>이 외에도 parameterMap, resultMap 에 대한 상세 정의, cacheModel 설정, sql 문 재사용을 위한 sql 요소 설정이 나타날 수 있다. 각각에 대한 상세 사항은 관련 가이드를 참고한다.</p><h5 id=mapped-statement>Mapped Statement</h5><p>Data Mapper 사상의 핵심으로 Mapped Statement 는 parameter 매핑(input) 과 result 매핑(output) 을 가질 수 있는 어떤 SQL 문이라도 될 수 있다. 단순하게는 파라메터나 결과에 대한 class 를 직접적으로 설정할 수 있으며(권고하지 않는 방법이지만 아예 설정하지 않고 프레임워크에서 제공하는 자동 맵핑 처리도 가능), in/out 매핑, 결과의 cache 유지 등에 대한 상세한 설정이 가능하다.</p><ul><li>statement 구문</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;statement</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;statementName&#34;</span>
</span></span><span style=display:flex><span>	   <span style=color:#a40000>[</span><span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;some.class.Name&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>	   <span style=color:#a40000>[</span><span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;some.class.Name&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>	   <span style=color:#a40000>[</span><span style=color:#c4a000>parameterMap=</span><span style=color:#4e9a06>&#34;nameOfParameterMap&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>	   <span style=color:#a40000>[</span><span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;nameOfResultMap&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>	   <span style=color:#a40000>[</span><span style=color:#c4a000>cacheModel=</span><span style=color:#4e9a06>&#34;nameOfCache&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>	   <span style=color:#a40000>[</span><span style=color:#c4a000>timeout=</span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#a40000>]</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	select * from PRODUCT where PRD_ID = [?|#propertyName#]
</span></span><span style=display:flex><span>	order by [$simpleDynamic$]
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/statement&gt;</span>
</span></span></code></pre></div><ul><li>위 statement 요소 위치에는 sql 문 유형에 따라 insert, update, delete, select, procedure 가 올 수 있다. 위에서 대괄호[] 내에 있는 속성은 선택 사항이다.</li><li>parameterClass 나 resultClass 속성으로 In/Out 에 대한 객체를 직접 지정할 수 있다. 이는 일반적으로 표준 JavaBeans 객체 또는 Map (result 인 경우에는 Map 구현체 명시할 것) 이 될수 있으며, 단일 변수인 경우에는 primitive 래퍼 클래스로 지정할 수도 있다.</li><li>prepared statement 에 대한 바인드 변수 맵핑을 위한 맵핑 정의를 별도의 parameterMap 태그로 따로 지정한 경우 위의 parameterMap 속성으로 해당 id 를 지정한다. parameterMap 을 지정한 경우 sql 문의 바인드 변수 영역은 ? 로 작성하며 parameterMap 매핑 설정의 순서와 갯수가 맞아야 함에 유의한다.</li><li>parameterMap 을 쓰지 않고 Inline Parameter 로 쓰는 것을 더 선호하며 #속성명# 과 같은 형태로 간략히 기술할 수 있다.</li><li>resultSet 에 대한 결과 객체 매핑을 위해 별도의 resultMap 태그로 따로 지정한 경우 위의 resultMap 속성으로 해당 id 를 지정한다. resultMap 의 사용은 성능상, 상세 옵션의 적용 기능성 측면에서 추천하는 바이다.</li><li>한번 조회 한 결과를 캐슁하기 위해 별도의 cacheModel 태그로 관련 설정을 한 경우, 대상 statement 에 해당 cacheModel id 를 위의 cacheModel 속성과 같이 지시한다. DB 데이터의 변경 시 cache 를 갱신할 수 있도록 cacheModel 설정의 flush 관련 설정에 유의해야 한다.</li><li>사용 DBMS 와 JDBC 드라이버가 지원하는 경우 timeout 을 명시할 수 있으며 이는 sql-map-config.xml 의 defaultStatementTimeout 에 우선한다.</li><li>위의 order by 절에 쓰인 $변수명$ 은 replaced Text 처리로 input 객체에 해당 변수에 대한 값으로 전달된 String 을 SQL 의 동적 변경 요소로 대치(replace)하여 처리한다. 바인드 변수로 처리할 수 없는 order by 절이나 from 절, 혹은 전체 sql 문의 동적 변경 등을 위해 사용될 수 있으나, SQL Injection 의 보안 위험이 있고, 테이블이나 칼럼이 변경되는 경우 내부적으로 자동 매핑된 결과 객체에 대한 resultSet metadata 의 캐슁내역과 맞지 않아 오류를 일으킬 수 있으므로 유의한다.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f6fd856e6da30d011828a30bd5ca3658>4 - Spring-iBATIS Integration</h1><div class=lead>Spring은 iBATIS와의 통합을 통해 IoC 및 예외 계층 구조를 활용한 템플릿 스타일 프로그래밍을 지원하며, Spring의 유연한 트랜잭션 처리와 DataSource 설정을 그대로 사용할 수 있다. SqlMapClientFactoryBean은 iBATIS의 SqlMapClient를 생성하고 Spring 컨텍스트에 설정하는 데 사용된다.</div><h1 id=spring-ibatis-integration>Spring-iBATIS Integration</h1><p>Spring 프레임워크는 iBATIS SQL Map 을 이미 잘 통합하고 있으며, JDBC/Hibernate 에 대한 연동과 동일하게 template 스타일 프로그래밍이 가능토록 지원한다. 이러한 지원으로 Spring 의 특징인 IoC 의 장점과 Exception 계층 구조의 처리가 iBATIS 통합 환경에서도 쉽게 사용되고 있으며, iBATIS 단독 사용 시에 트랜잭션 관리 및 DataSource 에 대한 설정 및 관리가 별도로 필요했던 것에 비해 Spring-iBATIS 통합 환경에서는 Spring 의 유연한 트랜잭션 처리와 dataSource 를 그대로 사용할 수 있다.</p><h2 id=spring-의-sqlmapclientfactorybean-설정>Spring 의 SqlMapClientFactoryBean 설정</h2><p>SqlMapClientFactoryBean 은 iBATIS 의 SqlMapClient 를 생성하는 FactoryBean 구현체로, Spring 의 context 에 iBATIS 의 SqlMapClient 를 셋업하는 일반적인 방법으로 사용된다. 여기서 얻어진 SqlMapClient 는 iBATIS 기반 DAO 에 dependency injection 을 통해 넘겨지게 된다.</p><h3 id=sample-configuration>Sample Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- dataSource 설정 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.apache.commons.dbcp.BasicDataSource&#34;</span> <span style=color:#c4a000>destroy-method=</span><span style=color:#4e9a06>&#34;close&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${driver}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${dburl}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${username}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${password}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;defaultAutoCommit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;poolPreparedStatements&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- SqlMap setup for iBATIS Database Layer --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/sqlmap/sql-map-config.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><ul><li>dataSource : 데이터베이스 연결 추상화를 제공하는 DataSource 설정. 위에서는 Apache Commons DBCP 를 사용하였으며 DB 접속과 관련된 설정은 property-placeholder 를 사용하여 외부화 하였다.</li><li>sqlMapClient : Spring의 iBATIS 연동을 위한 SqlMapClientFactoryBean 설정으로 configLocation 속성을 통해 지정한 iBATIS 메인 설정 파일인 sql-map-config.xml 에 대해 iBATIS 의 SqlMapClient instance 를 생성하여 Spring 환경에서 사용 가능토록 한다. Spring 의 dataSource 를 iBATIS 에 넘길 수 있도록 injection 을 지시하고 있으며 이로 인해 iBATIS 설정 파일 자체에서는 dataSource 및 transaction 설정 필요없이(Spring 환경에서는 iBATIS 기반 DAO 호출 이전에 서비스 단에서 선언적인 트랜잭션 처리를 해주었을 것임) Spring 이 제공하는 유연한 dataSource 및 트랜잭션 처리를 사용하게 된다.</li></ul><p>Spring 현재 버전에서는 configLocations 속성을 추가하여 sql-map-config.xml 에 대한 패턴 표현식이나 복수 연동(런타임에 하나의 통합 설정으로 merge 됨)도 지원하고 있다. useTransactionAwareDataSource 속성으로 SqlMapClient 에 대해 Spring 이 관리하는 transaction timeout 을 함께 적용할 수 있는 transaction-aware DataSource 를 사용하도록 설정 가능하며(default), lobHandler 속성을 통해 Spring 의 lobHandler 를 설정할 수도 있다.</p><h4 id=mappinglocations-지원>mappingLocations 지원</h4><p>또한 iBATIS 사용 환경에서의 중요한 개선 사항으로 mappingLocations 속성을 통해 기존에 iBATIS 메인 설정 파일 내에서 sqlMap 태그로 일일이 지정하여야만 했던 sql 매핑 파일에 대해 Spring 의 SqlMapClientFactoryBean 빈 설정파일에서 Spring 의 유연한 리소스 추상화를 적용하여 리소스 패턴 형태로 일괄 지정이 가능하다. 이 경우 sql 매핑 파일들의 위치는 sql-map-config 설정 파일과 런타임에 merge 되도록 세팅된다. 이 방법은 <strong>Spring 2.5.5 이상, iBATIS 2.3.2 이상</strong>에서만 지원됨에 유의한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- SqlMap setup for iBATIS Database Layer --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/sqlmap/sql-map-config.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;mappingLocations&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/META-INF/sqlmap/mappings/testcase-*.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>단 위와 같이 일괄 sql 매핑 파일 지정을 Spring 설정 파일에 지시하였더라도 iBATIS 의 sql-map-config.xml 의 DTD(<a href=http://ibatis.apache.org/dtd/sql-map-config-2.dtd>http://ibatis.apache.org/dtd/sql-map-config-2.dtd</a>) 에 sqlMap 태그가 최소 1개 이상이 나타나야 하도록 지정되어 있으므로 아래와 같이 dummy sql 매핑 파일 하나를 지정하는 sql-map-config.xml 로 작성하면 편할 것이다.</p><h2 id=ibatis-의-설정-변경>iBATIS 의 설정 변경</h2><ul><li>sqlMap 설정을 제거한(dummy 하나는 설정 필요) sql-map-config.xml</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMapConfig PUBLIC &#34;-//ibatis.apache.org//DTD SQL Map Config 2.0//EN&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&#34;http://ibatis.apache.org/dtd/sql-map-config-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMapConfig&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;settings</span> <span style=color:#c4a000>useStatementNamespaces=</span><span style=color:#4e9a06>&#34;false&#34;</span> 
</span></span><span style=display:flex><span>				<span style=color:#c4a000>defaultStatementTimeout=</span><span style=color:#4e9a06>&#34;10&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeHandler</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;java.util.Calendar&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;TIMESTAMP&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>callback=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.typehandler.CalendarTypeHandler&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- Spring 2.5.5 이상, iBATIS 2.3.2 이상에서는 iBATIS 연동을 위한 SqlMapClientFactoryBean 정의 시 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>               mappingLocations 속성으로 Sql 매핑 파일의 일괄 지정이 가능하다. 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	    (&#34;sqlMapClient&#34; bean 설정 시  
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                       mappingLocations=&#34;classpath:/META-INF/sqlmap/mappings/testcase-*.xml&#34; 로 지정하였음)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	    단, sql-map-config-2.dtd 에서 sqlMap 요소를 하나 이상 지정하도록 되어 있으므로 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              아래의 dummy 매핑 파일을 설정하였다.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	--&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;META-INF/sqlmap/mappings/testcase-dummy.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMapConfig&gt;</span>
</span></span></code></pre></div><ul><li>testcase-dummy.xml</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE sqlMap PUBLIC &#34;-//iBATIS.com//DTD SQL Map 2.0//EN&#34; &#34;http://www.ibatis.com/dtd/sql-map-2.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;Dummy&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h2 id=ibatis-based-dao>iBATIS-based DAO</h2><p>Spring 의 SqlMapClientDaoSupport 클래스는 iBATIS 의 SqlMapClient data access object 를 위한 편리한 수퍼 클래스로 이를 extends 하는 서브 클래스에 SqlMapClientTemplate 를 제공한다. SqlMapClientTemplate 는 iBATIS 를 통한 data access 를 단순화하는 헬퍼 클래스로 SQLException 을 Spring dao 의 exception Hierarchy 에 맞게 unchecked DataAccessException 으로 변환해 주며 Spring 의 JdbcTemplate 과 동일한 처리 구조의 SQLExceptionTranslator 를 사용할 수 있게 해준다. 또한 iBATIS 의 SqlMapExecutor 의 실행 메서드에 대한 편리한 mirror 메서드를 다양하게 제공하므로 일반적인 쿼리나 insert/update/delete 처리에 대해 편리하게 사용할 수 있도록 권고된다. 그러나 batch update 와 같은 복잡한 수행에 대해서는 Spring 의 SqlMapClientCallback 에 대한 명시적인 구현(보통 anonymous inner class 로 작성)이 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SqlMapAccountDao</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>SqlMapClientDaoSupport</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>AccountDao</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Account</span> <span style=color:#000>getAccount</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>DataAccessException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Account</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;getAccountByEmail&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>insertAccount</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Account</span> <span style=color:#000>account</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>DataAccessException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertAccount&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>account</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>iBATIS 연동 DAO 는 SqlMapClientDaoSupport 를 extends 하고 있으며, getSqlMapClientTemplate() 를 통해 SqlMapClientTemplate 를 얻어 iBATIS 의 data access 처리를 래핑하여 실행토록 처리하고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;accountDao&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;example.SqlMapAccountDao&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>iBATIS 연동 DAO 에 sqlMapClient 빈을 주입해 주어야 한다.</p><p>위의 처리는 Annotation 을 사용한 빈 생성 및 dependency 처리 시 sqlMapClient 의 DAO 주입 설정에 어려움이 존재한다. 이의 손쉬운 해결을 위해 전자정부 프레임워크는 EgovAbstractDAO 를 확장하여 제공하고 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-db3ade4f9f54ea25eb36c2a565082e57>5 - iBATIS에서의 Data Type 매핑</h1><div class=lead>Java 애플리케이션에서 데이터베이스와 상호작용할 때, Java 타입과 DBMS의 JDBC 타입 간의 정확한 매핑이 중요하다. iBATIS는 JavaBeans 객체의 속성과 DB 테이블의 컬럼 타입을 매핑하여 데이터 바인딩 및 매핑을 처리하며, 이를 통해 다양한 데이터 타입에 대한 적절한 사용 방법을 제공한다.</div><h1 id=data-type>Data Type</h1><p>어플리케이션을 작성할 때 Data Type 에 대한 올바른 사용과 관련 처리는 매우 중요하다. 특히 데이터베이스를 이용하여 데이터를 저장하고 조회할 때 Java 어플리케이션에서의 Type 과 DBMS 에서 지원하는 관련 매핑 jdbc Type 의 정확한 사용이 필요하며, 여기에서는 iBATIS 환경에서 javaType 과 특정 DBMS 의 jdbcType 의 적절한 매핑 사용예를 중심으로 일반적인 Data Type 의 사용 가이드를 참고할 수 있도록 한다.</p><h2 id=기본-data-type-사용-방법>기본 Data Type 사용 방법</h2><p>iBATIS SQL Mapper 프레임워크는 Java 어플리케이션 영역의 표준 JavaBeans 객체(또는 Map 등)의 각 Attribute 에 대한 Java Type 과 JDBC 드라이버에서 지원하는 각 DBMS의 테이블 칼럼에 대한 Data Type 의 매핑을 기반으로 parameter / result 객체에 대한 바인딩/매핑 을 처리한다. 각 javaType 에 대한 매칭되는 jdbcType 은 일반적인 Ansi SQL 을 사용한다고 하였을 때 아래에서 대략 확인할 수 있을 것이다. 특정 DBMS 벤더에 따라 추가적으로 지원/미지원 하는 jdbcType 이 다를 수 있고, 또한 같은 jdbcType 을 사용한다 하더라도 타입에 따른 사용 가능한 경계값(boundary max/min value)은 다를 수 있다.</p><p>아래에서는 다양한 primitive 타입과 숫자 타입, 문자 타입, 날짜 타입에 대한 기본 insert/select 를 통해 iBATIS 사용 환경에서의 data type 에 대한 사용 예를 알아보겠다.</p><h3 id=sample-type-vo>Sample Type VO</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>TypeTestVO</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3653247402772333834L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>bigdecimalType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>booleanType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000>byteType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>charType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>doubleType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>floatType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>intType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>longType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>short</span> <span style=color:#000>shortType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>stringType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>dateType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Date</span> <span style=color:#000>sqlDateType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Time</span> <span style=color:#000>sqlTimeType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Timestamp</span> <span style=color:#000>sqlTimestampType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Calendar</span> <span style=color:#000>calendarType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getId</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>getBigdecimalType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>bigdecimalType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setBigdecimalType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>bigdecimalType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>bigdecimalType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>bigdecimalType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>isBooleanType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>booleanType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setBooleanType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>booleanType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>booleanType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>booleanType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000>getByteType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>byteType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setByteType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>byte</span> <span style=color:#000>byteType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>byteType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>byteType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getCharType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>charType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setCharType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>charType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>charType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>charType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>getDoubleType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>doubleType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setDoubleType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>double</span> <span style=color:#000>doubleType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>doubleType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>doubleType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>getFloatType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>floatType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setFloatType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>float</span> <span style=color:#000>floatType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>floatType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>floatType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getIntType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>intType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setIntType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>intType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>intType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>intType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>getLongType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>longType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setLongType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>longType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>longType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>longType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>short</span> <span style=color:#000>getShortType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>shortType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setShortType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>short</span> <span style=color:#000>shortType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>shortType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>shortType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getStringType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>stringType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setStringType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>stringType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>stringType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stringType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Date</span> <span style=color:#000>getDateType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>dateType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setDateType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Date</span> <span style=color:#000>dateType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>dateType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dateType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Date</span> <span style=color:#000>getSqlDateType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>sqlDateType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setSqlDateType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Date</span> <span style=color:#000>sqlDateType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sqlDateType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sqlDateType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Time</span> <span style=color:#000>getSqlTimeType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>sqlTimeType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setSqlTimeType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Time</span> <span style=color:#000>sqlTimeType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sqlTimeType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sqlTimeType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Timestamp</span> <span style=color:#000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>sqlTimestampType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Timestamp</span> <span style=color:#000>sqlTimestampType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sqlTimestampType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sqlTimestampType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Calendar</span> <span style=color:#000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>calendarType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setCalendarType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Calendar</span> <span style=color:#000>calendarType</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>calendarType</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>calendarType</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위 TypeTestVO 의 각 attribute 는 다양한 data Type 에 대한 사용예의 샘플이며 이에 대한 매핑 jdbc 타입은 아래의 각 DBMS 별 DDL 을 통해 일차적으로 살펴보자.</p><h3 id=sample-typetest-table-hsqldb-ddl-script>Sample TYPETEST Table Hsqldb DDL script</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>create</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>table</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TYPETEST</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>not</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>bigdecimal_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>19</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>boolean_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>boolean</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>byte_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tinyint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>char_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>char</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>double_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>double</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>float_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>float</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>int_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>integer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>long_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>bigint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>short_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>smallint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>string_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>datetime</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_time_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>time</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_timestamp_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>calendar_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>primary</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>위 create sql 문의 hsqldb 의 예이며, 실제로 Ansi SQL 의 Data Type 에 대한 표준을 잘 따르는 예이다. boolean 타입을 직접 지원하고 있으며 tinyint, double, date, time 등 다양한 jdbcType 에 대하여 사용에 특별한 무리가 없음을 아래의 테스트 케이스로 알 수 있을 것이다.</p><h3 id=sample-sql-mapping-xml>Sample SQL Mapping XML</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;TypeTest&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;typeTestVO&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.TypeTestVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- CalendarTypeHandler 는 sql-map-config.xml 에 등록하였음 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;calendarTypeHandler&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.typehandler.CalendarTypeHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;typeTestResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;typeTestVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;id&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;ID&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;bigdecimalType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;BIGDECIMAL_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;booleanType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;BOOLEAN_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;byteType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;BYTE_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;charType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;CHAR_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;doubleType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DOUBLE_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;floatType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;FLOAT_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;intType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;INT_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;longType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LONG_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;shortType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SHORT_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;stringType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;STRING_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;dateType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DATE_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sqlDateType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SQL_DATE_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sqlTimeType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SQL_TIME_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sqlTimestampType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SQL_TIMESTAMP_TYPE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;calendarType&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;CALENDAR_TYPE&#34;</span> <span style=color:#c4a000>typeHandler=</span><span style=color:#4e9a06>&#34;calendarTypeHandler&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertTypeTest&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;typeTestVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			insert into TYPETEST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			           (ID,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            BIGDECIMAL_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            BOOLEAN_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            BYTE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            CHAR_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            DOUBLE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            FLOAT_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            INT_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            LONG_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            SHORT_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            STRING_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            DATE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            SQL_DATE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            SQL_TIME_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            SQL_TIMESTAMP_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            CALENDAR_TYPE)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			values     (#id#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #bigdecimalType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #booleanType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #byteType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #charType:CHAR#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #doubleType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #floatType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #intType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #longType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #shortType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #stringType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #dateType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #sqlDateType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #sqlTimeType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #sqlTimestampType#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #calendarType,handler=calendarTypeHandler#)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectTypeTest&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;typeTestVO&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;typeTestResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select ID,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       BIGDECIMAL_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       BOOLEAN_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       BYTE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       CHAR_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DOUBLE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       FLOAT_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       INT_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       LONG_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SHORT_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       STRING_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DATE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SQL_DATE_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SQL_TIME_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SQL_TIMESTAMP_TYPE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       CALENDAR_TYPE
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   TYPETEST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  ID = #id#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMap&gt;</span>
</span></span></code></pre></div><p>TypeTestVO JavaBeans 객체를 통해 insert/select 를 처리하는 sql 매핑 xml 이다. resultMap 을 정의하여 select 결과 객체 매핑을 처리하고 있으며, 입력 및 조회 조건 의 파라메터 바인딩을 Inline Parameter 방법을 통해 처리하고 있다. resultMap 이나 parameterMap(Inline Parameter 도 마찬가지) 에서는 javaType=“string”, jdbcType=“VARCHAR” 와 같이 명시적으로 java/jdbc type 에 대한 지시를 할 수도 있다. (성능상으로는 추천, 그러나 실제와 맞지 않는 type 지시는 런타임에 오류 발생) 또한, 위의 Inline parameter 처리 시 calendar 속성에 대해 handler=calendarTypeHandler 로 지시한 것과 resultMap 처리 시 typeHandler=“calendarTypeHandler” 로 지시한 것에서 확인할 수 있듯이 일반적인 java-jdbc 매핑으로 커버하지 못하는 부분에 대하여 사용자가 typeHandler 를 구현하여 타입 컨버전에 대한 로직 처리를 제공함으로써 위와 같이 calendar type ↔ TIMESTAMP 변환이 가능한 것처럼 확장할 수도 있다.</p><p>위에서 TypeTestVO 와 SQL Mapping XML 은 아래의 추가적인 DBMS 테스트 시 변경없이 재사용하였고, 일부 Data Type 의 미지원/DBMS 별 매핑타입 사용/경계값 상이함 등에 대해서는 DDL / TestCase 에서 약간의 로직 분기나 회피를 통해 문제되는 부분을 피하고 전체적인 관점에서 재사용 할 수 있도록 테스트 하였으므로 참고하기 바란다.</p><h3 id=sample-testcase>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>locations</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;classpath*:META-INF/spring/context-*.xml&#34;</span> <span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@TransactionConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>transactionManager</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;txManager&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>defaultRollback</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Transactional</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DataTypeTest</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>TestBase</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;typeTestDAO&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>TypeTestDAO</span> <span style=color:#000>typeTestDAO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Before</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onSetUp</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 외부에 sql file 로부터 DB 초기화 (TypeTest 기존 테이블 삭제/생성)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeSqlScript</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleJdbcTemplate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ClassPathResource</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;META-INF/testdata/sample_schema_ddl_typetest_&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>usingDBMS</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;.sql&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>TypeTestVO</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>TypeTestVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TypeTestVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setBigdecimalType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;99999999999999999.99&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setBooleanType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setByteType</span><span style=color:#ce5c00;font-weight:700>((</span><span style=color:#204a87;font-weight:700>byte</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#0000cf;font-weight:700>127</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// VO 에서 String 으로 선언했음. char 로 하고자 하는 경우 TypeHandler 작성 필요
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCharType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;A&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Oracle 10g 에서 double precision 타입은 Double.MAX_VALUE 를 수용하지 못함.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// oracle jdbc driver 에서 Double.MAX_VALUE 를 전달하면 Overflow Exception trying to bind 1.7976931348623157E308 에러 발생
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// mysql 5.0 에서 테스트 시 Double.MAX_VALUE 입력은 가능하나 조회 시 Infinity 로 되돌려짐
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// tibero - Double.MAX_VALUE 입력 시 Exception 발생
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDoubleType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isHsql</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#000>Double</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MAX_VALUE</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>7976931348623157d</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// mysql 5.0 에서 테스트 시 Float.MAX_VALUE 를 입력할 수 없음
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setFloatType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isMysql</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>float</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>40282</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>Float</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MAX_VALUE</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setIntType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Integer</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MAX_VALUE</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setLongType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MAX_VALUE</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setShortType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Short</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MAX_VALUE</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setStringType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;abcd가나다라あいうえおｶｷｸｹｺ&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDateType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;2009-02-18&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>currentTime</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Date</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSqlDateType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Date</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentTime</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSqlTimeType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Time</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentTime</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Timestamp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentTime</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setCalendarType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Calendar</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getInstance</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TypeTestVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>TypeTestVO</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getId</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getId</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getBigdecimalType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getBigdecimalType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getByteType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getByteType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// mysql 인 경우 timestamp 칼럼에 null 을 입력하면 현재 시각으로 insert 됨에 유의
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>null</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// mysql 인 경우 java 의 timestamp 에 비해 3자리 정밀도 떨어짐
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>String</span> <span style=color:#000>orgSeconds</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>String</span> <span style=color:#000>mysqlSeconds</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>orgSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>substring</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>orgSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>                <span style=color:#000>mysqlSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>substring</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>mysqlSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCharType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCharType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDateType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDateType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// double 에 대한 delta 를 1e-15 로 주었음.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDoubleType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDoubleType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>isMysql</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>14</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// float 에 대한 delta 를 1e-7 로 주었음.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getFloatType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getFloatType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getIntType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getIntType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLongType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLongType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getShortType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getShortType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// java.sql.Date 의 경우 Date 만 비교
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlDateType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlDateType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlDateType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// mysql 인 경우 timestamp 칼럼에 null 을 입력하면 현재 시각으로 insert 됨에 유의
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>null</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCalendarType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>String</span> <span style=color:#000>orgSeconds</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>String</span> <span style=color:#000>mysqlSeconds</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>orgSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>substring</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>orgSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>                <span style=color:#000>mysqlSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>substring</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>mysqlSeconds</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>-</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimestampType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// java.sql.Time 의 경우 Time 만 비교
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>((</span><span style=color:#000>isHsql</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>isOracle</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>isTibero</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimeType</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimeType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimeType</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimeType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlTimeType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getStringType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getStringType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isBooleanType</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isBooleanType</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDataTypeTest</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 값을 세팅하지 않고 insert 해 봄 - id 는 int 의 초기값에 따라 0 임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>TypeTestVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TypeTestVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>typeTestDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertTypeTest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertTypeTest&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>TypeTestVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>typeTestDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectTypeTest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectTypeTest&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// duplication 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>typeTestDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertTypeTest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertTypeTest&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>            <span style=color:#000>fail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;키 값 duplicate 에러가 발생해야 합니다.&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>DataIntegrityViolationException</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>SQLException</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// DataType 테스트 데이터 입력 및 재조회
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>typeTestDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertTypeTest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertTypeTest&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>typeTestDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectTypeTest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectTypeTest&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서는 TypeTestVO 의 각 속성에 값을 세팅하지 않고 입력/조회, 키 값 중복 시 spring 의 DataIntegrityViolationException 이 발생하는지, 각 속성에 테스트 데이터(경계값 또는 의미있는 사용예 로써의 값)를 세팅하여 입력/조회 에 대한 처리를 확인해 봄으로써 java ↔ DBMS 의 타입 매핑의 예를 확인해 보았다. 특히 위의 makeVO 메서드 에서는 특정 javaType 에 대한 DBMS 의 db type 에 따라 경계값의 max value 가 달라질 수 있음을 확인할 수 있으며, checkResult 메서드에서는 특히 날짜 처리 타입과 관련하여 DBMS 에 따라 null 입력일 때 초기값 이나, 지원하는 정밀도(입력시 java 의 Date 류에서는 년월일시분초 를 넘어 상세하게 표현한 입력값 javaType 에 대해 jdbcType 의 결과 조회 시 날짜, 또는 시각 정보만으로 제한된다던지, 초 레벨의 정밀도가 java 에 비해 낮다던지)의 차이가 있음을 확인할 수 있다. java-jdbc type 에 대한 일반적인 매핑은 위 Hsqldb 의 예를 기본으로 이해하면 적합할 것으로 보며, 아래에서 특정 DBMS 의 DDL 예를 통해 각 데이터베이스 환경에서 Data Type 사용의 참고가 될 수 있기 바란다.</p><h3 id=sample-typetest-table-oracle-10gr2-기준-테스트-ddl-script>Sample TYPETEST Table Oracle (10gR2 기준 테스트) DDL script</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>create</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>table</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TYPETEST</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>not</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>bigdecimal_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>19</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>boolean_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>byte_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>char_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>char</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>double_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>double</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>precision</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>float_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>float</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>int_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>long_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>19</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>short_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>string_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>varchar2</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_time_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_timestamp_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>calendar_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>primary</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=sample-typetest-table-mysql-5x-ddl-script>Sample TYPETEST Table Mysql (5.X) DDL script</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>create</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>table</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TYPETEST</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>not</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>bigdecimal_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>19</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>boolean_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>boolean</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>byte_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tinyint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>char_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>char</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>double_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>double</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>float_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>float</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>int_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>integer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>long_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>bigint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>short_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>smallint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>string_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>datetime</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_time_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>time</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_timestamp_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>calendar_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>primary</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=sample-typetest-table-tibero3x-ddl-script>Sample TYPETEST Table Tibero(3.x) DDL script</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>create</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>table</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>TYPETEST</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>id</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>numeric</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>not</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>bigdecimal_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>19</span><span style=color:#000;font-weight:700>,</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>boolean_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>byte_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>number</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>char_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>char</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>double_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>double</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>precision</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>float_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>float</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>int_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>integer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>long_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>integer</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>/* integer 가 bigint 의 범위까지 포함함 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>short_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>smallint</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>string_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>varchar</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>255</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_date_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_time_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87>date</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/* time, timestamp 으로 설정 시 문제발생 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>sql_timestamp_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>calendar_type</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>timestamp</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>primary</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-709d3cacdff0820d97286730b198030a>6 - iBATIS parameterMap</h1><div class=lead>parameterMap은 Java 객체의 속성에 대한 매핑을 설정하여 SQL 바인드 변수를 처리하는 요소로, 기술적인 매핑이 필요한 경우에 사용되지만, Dynamic 요소와 함께 사용할 수 없고 바인드 변수의 순서를 맞춰야 하는 제한이 있어 일반적으로 추천되지 않는다. 대신 parameterClass나 Inline Parameter 방식이 더 자주 사용된다.</div><h1 id=parametermap>parameterMap</h1><p>parameterMap 은 해당 요소로 SQL 문 외부에 정의한 입력 객체의 속성에 대한 name 및 javaType, jdbcType 을 비롯한 옵션을 설정할 수 있는 매핑 요소이다. 이를 통해 JavaBeans 객체(또는 Map 등)에 대한 prepared statement 에 대한 바인드 변수 매핑을 처리할 수 있다. 유사한 기능을 처리하는 parameterClass 나 Inline Parameter 에 비해 많이 사용되지 않지만 더 기술적인(descriptive) parameterMap(예를 들어 stored procedure 를 위한) 이 필요하거나, XML 의 일관된 사용과 순수성을 지키고자 할때 좋은 접근법이 될 수도 있다. 그러나 Dynamic 요소와 함께 사용될 수 없고 바인드 변수의 갯수와 순서를 정확히 맞춰야 하는 불편이 있는 등 일반적으로 사용을 추천하지 않는다.</p><h2 id=기본-parametermap-사용-방법>기본 parameterMap 사용 방법</h2><p>아래의 샘플 parameterMap 정의를 참고하라.</p><h3 id=sample-parametermap>Sample parameterMap</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;parameterMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;empParam&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empName&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;string&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;VARCHAR&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;blank&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;string&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;VARCHAR&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;mgr&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;hireDate&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;date&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;DATE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sal&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;comm&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;-99999&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;parameter</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/parameterMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertEmpUsingParameterMap&#34;</span> <span style=color:#c4a000>parameterMap=</span><span style=color:#4e9a06>&#34;empParam&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			insert into EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			           (EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            DEPT_NO)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			values     (?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            ?)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 parameterMap 요소로 empParam 이라는 id 를 부여하고 대상 입력 객체는 EmpVO 를 지정하고 있다. EmpVO 에 대한 상세 attribute (속성) 들에 대해 parameter 하위 요소로 매핑 정의를 하고 있는데 이때 추가적으로 javaType, jdbcType 에 대해 위에서는 명시하였다. (java 의 reflection 기술을 사용하여 대상 클래스의 개별 속성에 대한 type 을 구하는 것보다 직접 type 에 대한 지시를 설정으로 명시하므로 약간의 성능상 이점이 있을 수 있다.) 위에서는 동일한 property 가 중복으로 사용되는 경우가 없으나 parameterMap 은 아래의 insertEmpUsingParameterMap mapped statement 예에서 보듯이 ? 에 대한 순서대로 매핑되므로 만약 중복으로 사용되는 경우가 필요하다면 parameterMap 정의부터 순서를 맞추어 동일한 property 의 중복 정의가 필요할 수 있다. 또한 nullValue 속성을 지정한 property 에 대해서는 해당 값이 nullValue 에 지정된 값으로 전달되는 경우 데이터베이스에는 null 로 처리가 이 외에도 typeName, resultMap, mode, typeHandler, numericScale 에 대한 속성 정의가 가능하다.</p><h3 id=sample-testcase>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>locations</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>{</span><span style=color:#4e9a06>&#34;classpath*:META-INF/spring/context-*.xml&#34;</span> <span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@TransactionConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>transactionManager</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;txManager&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>defaultRollback</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Transactional</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ParameterMapTest</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>TestBase</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;empDAO&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>EmpDAO</span> <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Before</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>onSetUp</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// DB 초기화
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EmpVO</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>ParseException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test Emp&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test Job&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7839,&#39;KING&#39;,&#39;PRESIDENT&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setMgr</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7839</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setHireDate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;2009-02-09&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// mysql 5.0.X에서는 소숫점 자릿수 만큼 .00 이 달려 나와 테스트 편의상 소숫점 자리수가 없도록 칼럼 선언 하였음.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;12345&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setComm</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;12345.67&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setComm</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>00</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 10,&#39;ACCOUNTING&#39;,&#39;NEW YORK&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EmpVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testParameterMapInsert</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertEmpUsingParameterMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectEmp&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testParameterMapInsertWithNullValue</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// key 설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// parameterMap nullValue test
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;blank&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// cf.) -99999.99 는 NumberFormatException 임을
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 확인하였음!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setComm</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;-99999&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertEmpUsingParameterMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectEmp&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// parameterMap 설정에서 nullValue=&#34;blank&#34; .. 에 따라
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 해당값이 null 로 입력되었을 것임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 parameterMap 을 이용한 파라메터 객체 바인딩을 처리하는 insertEmpUsingParameterMap 쿼리문에 대해 입력객체를 세팅 후 입력/조회 처리하고 있는 테스트 케이스이다. 실제로 매핑 파일 내에서 parameterMap 을 사용하는 경우와 Inline parameter 또는 parameterClass 를 그대로 쓰는 경우에서도 어플리케이션 영역은 동일한 형태의 입력 객체를 인자로 iBATIS API 를 호출하게 된다. 위의 testParameterMapInsertWithNullValue 테스트 메서드에서는 parameterMap 에 nullValue 속성으로 지정한 특정한 값을 세팅 하므로써 DB 에 null 로 입력이 된 결과를 조회하여 assertNull 로 확인하고 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8df8aa47e3e435721c33243ea852dd0a>7 - Inline Parameters</h1><div class=lead>Inline Parameters는 #property# 노테이션을 사용해 간편하게 바인드 변수 매핑을 처리하며, 별도의 parameterMap 선언 없이 입력 객체의 속성을 SQL에 직접 매핑할 수 있다. Dynamic 요소와 함께 사용 가능하며, 필요한 경우 JDBC 타입과 null 값을 추가 노테이션으로 지정할 수 있다.</div><h1 id=inline-parameters>Inline Parameters</h1><p>이전에 살펴본 prepared statement 에 대한 바인드 변수 매핑 처리를 위한 parameterMap 요소(SQL 문 외부에 정의한 입력 객체 property name 및 javaType, jdbcType 을 비롯한 옵션을 설정 매핑 요소) 와 동일한 기능을 처리하는 간편한 방법을 Inline Parameters 방법으로 제공한다. 보통 parameterClass 로 명시된 입력 객체에 대해 바인드 변수 영역을 간단한 #property# 노테이션으로 나타내는 Inline Parameter 방법은 기존 parameterMap 에서의 ? 와 이의 순서를 맞춘 외부 parameterMap 선언으로 처리하는 방법에 비해 많이 사용되고 일반적으로 추천하는 방법이다. 이는 Dynamic 요소와 함께 사용될 수 있고 별도의 외부 매핑 정의 없이 바인드 변수 처리가 필요한 위치에 해당 property 를 직접 사용 가능하며, 필요한 경우 jdbcType 이나 nullValue 를 간단한 추가 노테이션(ex. #empName:VARCHAR:blank# ) 와 같이 지정할 수 있고, 상세한 옵션이 필요한 경우에는 (ex. #comm,javaType=decimal,jdbcType=NUMERIC,nullValue=-99999# ) 와 같이 ,(comma) 로 구분된 필요한 속성=값 을 상세하게 기술할 수도 있다.</p><h2 id=기본-inline-parameters-사용-방법>기본 Inline Parameters 사용 방법</h2><p>아래의 샘플 Inline Parameters 사용 쿼리문을 참고하라.</p><h3 id=sample-inline-parameters>Sample Inline Parameters</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertEmptUsingInLineParam&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			insert into EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			           (EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            DEPT_NO)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			values     (#empNo:NUMERIC#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #empName:VARCHAR:blank#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #job:VARCHAR:&#34;&#34;#,	/* inline parameter 에서는 empty String 을 nullValue로 대체할 수 없음 - cf.) oracle인 경우는 &#34;&#34; 가 null 임 */
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #mgr:NUMERIC#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #hireDate:DATE#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #sal:NUMERIC#,	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #comm,javaType=decimal,jdbcType=NUMERIC,nullValue=-99999#,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			            #deptNo:NUMERIC#)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 별도의 parameterMap 외부 정의없이 #property:jdbcType# 형태로 직접 바인드 변수 영역에 나타내고 있다. #property# 만 나타내도 iBATIS 에서 자동으로 타입처리는 잘된다. 위에서는 해당 쿼리에 parameterClass=“empVO” 에 대한 입력 객체 설정이 나타나 있지 않음에도 iBATIS 에서 런타임에 인자로 주어지는 입력 객체를 자동으로 파악하여 파라메터 처리를 하고 있음을 확인할 수 있다. 그러나 parameterClass 의 명시는 성능 상 반드시 추천하는 바이다.</p><ul><li>#property#</li><li>#property:jdbcType#</li><li>#property:jdbcType:nullValue# 형태까지 : 를 구분자로 함께 나타낼 수 있으며 nullValue 대체 값은 jdbcType 명시가 반드시 필요하다.</li></ul><p>이 외에도 속성=값 형태의 옵션 설정을 , 를 구분자로 아래와 같이 나타낼 수 있다.</p><ul><li>#propertyName,javaType=?,jdbcType=?,mode=?,nullValue=?,handler=?,numericScale=?#</li></ul><p>위에서 ? 부분을 해당 속성에 따라 적절한 값으로 설정하면 된다. mode 는 stored procedure 의 IN/OUT/INOUT 모드를 지시할 수 있는 속성이고 numericScale 은 stored procedure 의 OUT/INOUT 변수가 decimal 이나 numeric인 경우 DBMS 의 Scale 정보를 유지하기 위해 명시해야 하는 속성이다. handler 속성에는 typeHandler 를 지시할 수 있다.</p><h3 id=sample-testcase>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EmpVO</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>ParseException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test Emp&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test Job&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7839,&#39;KING&#39;,&#39;PRESIDENT&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setMgr</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7839</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setHireDate</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;2009-02-09&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// mysql 은 소숫점 이하 자리가 .00 으로 기본 들어가게 되어 테스트 편의상 numeric(5) 로 선언하였음.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;12345&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setComm</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;12345.67&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setComm</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>100</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>00</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 10,&#39;ACCOUNTING&#39;,&#39;NEW YORK&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EmpVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testInLineParameterInsert</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertEmptUsingInLineParam&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectEmp&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testInLineParameterInsertWithNullValue</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// key 설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>9000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// inline parameter nullValue test
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;blank&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// inline parameter 에서는 empty String 을
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// nullValue로 대체할 수 없음
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// ref.)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// http://www.nabble.com/inline-map-format%3A-empty-String-in-nullValue-td18905940.html
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setJob</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#ce5c00;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>// cf.) oracle 인 경우 &#34;&#34; 는 null 과
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 같음!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setComm</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;-99999&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insertEmptUsingInLineParam&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectEmp&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// inline parameter 설정에서
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// #empName:VARCHAR:blank# ..
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 에 따라 해당값이 null 로
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 입력되었을 것임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// inline parameter 에서는 empty String 을
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// nullValue로 대체할 수 없음 확인!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// cf.) parameterMap 케이스에서는
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// assertNull(resultVO.getJob()) // cf.) oracle
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 인 경우 &#34;&#34; 는 null 과 같음!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// assertNotNull(resultVO.getJob());
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span></code></pre></div><p>위에서 Inline Parameters 을 이용한 파라메터 객체 바인딩을 처리하는 insertEmptUsingInLineParam 쿼리문에 대해 입력객체를 세팅 후 입력/조회 처리하고 있는 테스트 케이스이다. 실제로 위 어플리케이션 영역은 parameterMap 사용 시와 차이가 없음을 알 수 있다. 위의 testInLineParameterInsertWithNullValue 테스트 메서드에서는 Inline Parameters 에 nullValue 속성으로 지정한 특정한 값을 세팅 함으로써 DB 에 null 로 입력이 된 결과를 조회하여 assertNull 로 확인하고 있다. 위에서 empty String 의 nullValue 설정은 inline parameter 노테이션의 한계로 제대로 처리되지 않음을 확인하였으므로 참고하기 바란다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-49d0958be1675a1cd07380605a368e58>8 - resultMap</h1><div class=lead>resultMap은 SQL 결과를 Java 객체의 속성에 어떻게 매핑할지 상세하게 제어할 수 있는 매핑 요소로, 칼럼 타입 지정, null 값 대체, 타입 핸들러 처리, 복합 객체 매핑 등을 지원한다. 이는 자동 매핑 방식보다 더 복잡한 매핑을 처리할 수 있어 많이 사용된다.</div><h1 id=resultmap>resultMap</h1><p>resultMap 은 SQL 문 외부에 정의한 매핑 요소로, result set 으로부터 어떻게 데이터를 뽑아낼지, 어떤 칼럼을 어떤 property로 매핑할지에 대한 상세한 제어를 가능케 해준다. resultMap 은 일반적으로 가장 많이 사용되는 중요한 매핑 요소로 resultClass 속성을 이용한 자동 매핑 접근법에 비교하여 칼럼 타입의 지시, null value 대체값, typeHandler 처리, complex property 매핑(다른 JavaBean, Collections 등을 포함하는 복합 객체) 등을 허용한다.</p><h2 id=기본-resultmap-사용-방법>기본 resultMap 사용 방법</h2><p>아래의 샘플 resultMap 정의를 참고하라.</p><h3 id=sample-resultmap>Sample resultMap</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;empResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NO&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;1&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NAME&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;2&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;string&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;VARCHAR&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;JOB&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;string&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;VARCHAR&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;mgr&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;MGR&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;4&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;hireDate&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;HIRE_DATE&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;5&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;date&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;DATE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sal&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SAL&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;6&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;comm&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;COMM&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;7&#34;</span> <span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;0&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;8&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmpUsingResultMap&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;empResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  EMP_NO = #empNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 resultMap 요소로 empResult 라는 id 를 부여하고 대상 결과 객체는 EmpVO 를 지정하고 있다. EmpVO 에 대한 상세 attribute (속성) 들에 대해 result 하위 요소로 매핑 정의를 하고 있는데 column 속성으로 result set 에서 얻을 수 있는 select 대상 칼럼(column alias 를 쓴 경우이면 해당 alias 명) 을 매핑하게 된다. 위에서는 추가적으로 columnIndex, javaType, jdbcType 에 대해 명시하였다. 위와 같이 타입을 명확하게 지시해주면 java 의 reflection 기술을 사용하여 대상 클래스의 개별 속성에 대한 type 을 구하는 것보다 성능상 이점이 있을 수 있다. columnIndex 를 지정하는 경우에는 rs.getString(“EMP_NAME”) → rs.getString(2)로 처리되는 사소한 성능상의 이점이 있지만, 순서의 지정이나 설정 자체의 번거로움으로 추천하지 않는 바이다. 또한 nullValue 속성을 지정한 property 에 대해서는 해당 값이 데이터베이스에서 null 로 읽혔을 때 nullValue 에 지정된 값으로 대체되어 JavaBeans property 에 설정된다. 이 외에도 result 하위 요소의 속성으로 select, resultMap 을 통해 다른 쿼리문의 결과나 complex property 의 처리를 위한 내포 객체에 대한 외부 resultMap 매핑요소를 참조할 수 있다. 또한 typeHandler 속성을 통해 iBATIS 의 기본 처리가 아닌 custom typeHandler 구현체를 지시할 수도 있다.</p><ul><li>resultMap structure</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;resultMapName&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;some.domain.Class&#34;</span> 
</span></span><span style=display:flex><span>		<span style=color:#a40000>[</span><span style=color:#c4a000>extends=</span><span style=color:#4e9a06>&#34;parent-resultMap&#34;</span><span style=color:#a40000>]</span> <span style=color:#a40000>[</span><span style=color:#c4a000>groupBy=</span><span style=color:#4e9a06>&#34;some property list&#34;</span><span style=color:#a40000>]</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;propertyName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;COLUMN_NAME&#34;</span> 
</span></span><span style=display:flex><span>			<span style=color:#a40000>[</span><span style=color:#c4a000>columnIndex=</span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#a40000>]</span> <span style=color:#a40000>[</span><span style=color:#c4a000>javaType=</span><span style=color:#4e9a06>&#34;int&#34;</span><span style=color:#a40000>]</span> <span style=color:#a40000>[</span><span style=color:#c4a000>jdbcType=</span><span style=color:#4e9a06>&#34;NUMERIC&#34;</span><span style=color:#a40000>]</span> <span style=color:#a40000>[</span><span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;-999999&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>			<span style=color:#a40000>[</span><span style=color:#c4a000>select=</span><span style=color:#4e9a06>&#34;someOtherStatement&#34;</span><span style=color:#a40000>]</span> <span style=color:#a40000>[</span><span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;someOtherResultMap&#34;</span><span style=color:#a40000>]</span>
</span></span><span style=display:flex><span>			<span style=color:#a40000>[</span><span style=color:#c4a000>typeHandler=</span><span style=color:#4e9a06>&#34;com.mydomain.MyTypehandler&#34;</span><span style=color:#a40000>]</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#a40000>…</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#a40000>…</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#a40000>…</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span></code></pre></div><p>위에서 resultMap 태그의 extends 속성을 명시하면 외부에 정의한 다른 resultMap 을 상속(관련 property - column 매핑을 현재 resultMap 에 정의하지 않고도)할 수 있으며, groupBy 속성을 사용하여 nested resultMap 에서의 N+1 쿼리 문제를 풀수 있도록 해당 속성을 통해 명시한 property 리스트의 값이 같은 row 들에 대해 하나의 결과 객체로 생성해 주게 된다.</p><h3 id=sample-testcase>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testResultMapSelect</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmp</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectEmpUsingResultMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SMITH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1980-12-17&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// nullValue test - &lt;result property=&#34;comm&#34; column=&#34;COMM&#34; .. nullValue=&#34;0&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 resultMap 을 이용한 결과 객체 매핑을 처리하는 selectEmpUsingResultMap 쿼리문에 대해 조회조건(pk) 를 세팅한 입력 객체를 인자로 조회 처리하고 있는 테스트 케이스이다. 실제로 매핑 파일 내에서 resultMap 을 사용하는 경우와 resultClass 를 그대로 쓰는 경우에서도 어플리케이션 영역은 동일한 형태의 결과 객체를 얻을 수 있지만 sql 매핑 파일내에서 resultMap 의 정의와 사용은 많은 장점이 있으므로 추천된다. 위의 테스트 검증을 통해 EmpVO 의 결과 객체로 조회 결과가 잘 반영되었음을 확인할 수 있고 nullValue 속성으로 지정한 comm attribute 에 대해서는 데이터베이스는 null 이지만 0 에 해당하는 numeric 값으로 대체되어 조회되었음을 확인할 수 있다.</p><h2 id=resultmap-상속>resultMap 상속</h2><p>아래의 샘플 resultMap 정의를 참고하라.</p><h3 id=sample-vo>Sample VO</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EmpExtendsDeptVO</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>DeptVO</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>4653117983538108612L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>empName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>job</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>mgr</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>hireDate</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>sal</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>comm</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>empNo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span></code></pre></div><h3 id=sample-resultmap-extends>Sample resultMap (extends)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empExtendsDeptVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpExtendsDeptVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!--
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		cf.) VO 의 상속관계와 resultMap의 상속관계가 같을 필요는 없음. 아래의 empExtendsDeptResult 가
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		empResult (Emp 속성을 가지고 있는 위의 resultMap)를 extends 하고 있지만 실제
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		EmpExtendsDeptVO 는 DeptVO 를 extends 하면서 child가 Emp 속성을 가지게끔 define 했음을 볼
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		수 있음
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	--&gt;</span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;empExtendsDeptResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empExtendsDeptVO&#34;</span> <span style=color:#c4a000>extends=</span><span style=color:#4e9a06>&#34;empResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!--&lt;result property=&#34;deptNo&#34; column=&#34;DEPT_NO&#34;/&gt;--&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmpExtendsDeptUsingResultMap&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;empExtendsDeptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       A.DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       B.DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       B.LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   EMP A, DEPT B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  A.DEPT_NO = B.DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			and    EMP_NO = #empNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>empExtendsDeptResult resultMap 은 위의 기본적인 resultMap 사용 방법에서 정의한 empResult resultMap 을 extends 하고 있으며, 추가적인 deptName, loc 에 대한 property 매핑만을 추가하여 실제로 emp 관련 property 들에 대해서는 extends 하고 있는 매핑 정의를 따라 자동으로 처리가 됨을 확인할 수 있다. resultMap 에 대한 매핑 정의의 상속은 결과 객체 JavaBeans 의 상속 관계와는 상관없이 별개로 이루어진다. (위에서는 VO extends 코드와 resultMap extends 가 반대임)</p><h3 id=sample-testcase-1>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testExtendsResultMapSelect</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpExtendsDeptVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmpExtendsDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectEmpExtendsDeptUsingResultMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// resultMap extends test (extends empResult)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SMITH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1980-12-17&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// nullValue test - &lt;result property=&#34;comm&#34; column=&#34;COMM&#34; .. nullValue=&#34;0&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;RESEARCH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;DALLAS&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLoc</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 extends 속성을 통해 상위 resultMap 을 상속하는 empExtendsDeptResult resultMap 을 이용한 결과 객체 매핑을 처리하는 selectEmpExtendsDeptUsingResultMap 에 대해 조회 처리하고 있는 테스트 케이스이다. 위의 테스트 검증을 통해 EmpExtendsDeptVO 의 결과 객체로 조회 결과가 잘 반영되었음을 확인할 수 있고 parent resultMap 에 존재하는 nullValue 대체 처리도 잘 반영됨을 확인할 수 있다.</p><h2 id=simple-composite-resultmap>Simple Composite resultMap</h2><p>아래의 샘플 resultMap 정의를 참고하라.</p><h3 id=sample-vo-1>Sample VO</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EmpDeptSimpleCompositeVO</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8049578957221741495L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>empName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>job</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>mgr</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>hireDate</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>sal</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>comm</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>loc</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>empNo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span></code></pre></div><p>별도의 parent - child extends 구조를 사용하지 않고 단순히 attributes 를 통합한 VO 이다.</p><h3 id=sample-resultmap-1>Sample resultMap</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empDeptSimpleCompositeVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpDeptSimpleCompositeVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;empDeptSimpleComposite&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empDeptSimpleCompositeVO&#34;</span> <span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NO&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NAME&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;JOB&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;mgr&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;MGR&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;hireDate&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;HIRE_DATE&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sal&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SAL&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;comm&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;COMM&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;0&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmpDeptSimpleCompositeUsingResultMap&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;empDeptSimpleComposite&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       A.DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       B.DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       B.LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   EMP A, DEPT B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  A.DEPT_NO = B.DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			and    EMP_NO = #empNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>EMP 와 DEPT 에 대한 조인 쿼리를 통하여 DEPT 정보를 포함하는 결과 row 를 조회하는 쿼리문은 위에서와 완전히 동일하며, extends 를 사용하는 empExtendsDeptResult resultMap 과 비교하여 resultMap 정의가 모든 요소를 포함하고 있다. 위에서는 조회 필드가 결과 객체의 property 가 동일하므로 extends 를 사용하는 resultMap 으로 단순히 resultClass 만 맞춰주어 변경 가능할 것이다.</p><h3 id=sample-testcase-2>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testSimpleCompositeResultMapSelect</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpDeptSimpleCompositeVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmpDeptSimpleComposite</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectEmpDeptSimpleCompositeUsingResultMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SMITH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1980-12-17&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// nullValue test - &lt;result property=&#34;comm&#34; column=&#34;COMM&#34; .. nullValue=&#34;0&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;RESEARCH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;DALLAS&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLoc</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>extends 없이 모든 매핑 요소를 simple 하게 모두 정의한 resultMap 을 이용한 결과 객체 매핑을 처리하는 selectEmpDeptSimpleCompositeUsingResultMap 에 대해 조회 처리하고 있는 테스트 케이스이다. 위의 테스트 검증을 통해 EmpDeptSimpleCompositeV 의 결과 객체로 조회 결과가 잘 반영되었음을 확인할 수 있다.</p><p>위의 비교 구현을 통해 join 조회를 통해 얻어지는 결과 객체가 단순 composite VO 형태인 경우 resultMap extends 을 사용하면 좀더 쉽게 매핑 처리할 수 있을 것으로 보여진다.</p><h2 id=complex-properties-resultmap-사용-방법>Complex Properties resultMap 사용 방법</h2><p>아래의 1:1, 1:N, 1:N(N+1 select), Hierarchical relation 에 대한 샘플 resultMap 정의를 참고하라.</p><h3 id=complext-properties---11-관계-resultmap>Complext Properties - (1:1 관계) resultMap</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EmpIncludesDeptVO</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>4113989804152701350L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>empName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>job</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>mgr</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>hireDate</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>sal</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>comm</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// EMP - DEPT 1:1 relation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>DeptVO</span> <span style=color:#000>deptVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>empNo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>DeptVO</span> <span style=color:#000>getDeptVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>deptVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setDeptVO</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>deptVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>deptVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 EmpIncludesDeptVO 는 DeptVO 를 1:1 관계의 멤버 attribute 로 포함하고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;EmpComplexResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empIncludesDeptVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpIncludesDeptVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;empIncludesDeptResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empIncludesDeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;JOB&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;mgr&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;MGR&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;hireDate&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;HIRE_DATE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sal&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SAL&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;comm&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;COMM&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;0&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!--
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			Emp-Dept 1:1 relation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			테스트 결과 resultMap 의 참조 시 sql-map-config.xml 의
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			useStatementNamespaces=&#34;false&#34; 와 상관없이 namespace prefix 를 써야 하는듯
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		--&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;EmpComplexResult.getDeptResult&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;getDeptResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmpIncludesDeptResultUsingResultMap&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;empIncludesDeptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       A.DEPT_NO as DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       B.DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       B.LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   EMP A, DEPT B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  A.DEPT_NO = B.DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			and    EMP_NO = #empNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 1:1 관계를 표현하는 Complex Properties 를 포함하는 EmpIncludesDeptVO 에 대한 resultMap 매핑 처리 시 해당 객체의 deptVO 멤버 attribute 에 대한 매핑 정의를 위해 resultMap=“EmpComplexResult.getDeptResult” 과 같이 DeptVO 에 대한 외부 resultMap 을 재사용하며 참조하고 있다. iBATIS 는 nested resultMap 에 대한 매핑 정의를 참고하여 join 쿼리에 의한 결과 칼럼을 자동으로 복합 객체(특히 DeptVO 관련 멤버 객체에)에 매핑해 주게 된다.</p><h3 id=sample-testcase-3>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testComplexPropertiesOneToOneResultMapSelect</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpIncludesDeptVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmpDeptComplexProperties</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectEmpIncludesDeptResultUsingResultMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SMITH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1980-12-17&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 1:1 relation included DeptVO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;RESEARCH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;DALLAS&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getLoc</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 테스트 케이스 검증 코드에서 resultVO.getDeptVO().getXXX 와 같이 내포 객체의 각 attribute 가 잘 설정되었음을 확인할 수 있다.</p><h3 id=complext-properties---1n-관계-resultmap>Complext Properties - (1:N 관계) resultMap</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DeptIncludesEmpListVO</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>3369530755443065377L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>loc</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>empVOList</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setDeptNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>deptNo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>empVOList</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setEmpVOList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>empVOList</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>empVOList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empVOList</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 DeptIncludesEmpListVO 는 EmpVO 의 List 를 1:N 관계의 멤버 attribute 로 포함하고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;EmpComplexResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptIncludesEmpListVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- 1:N 인 경우 groupBy 속성을 명시 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListVO&#34;</span> <span style=color:#c4a000>groupBy=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!-- Dept-EmpList 1:N relation --&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empVOList&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;EmpComplexResult.getEmpResult&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;getEmpResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;EMP_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;job&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;JOB&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;mgr&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;MGR&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;hireDate&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;HIRE_DATE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;sal&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;SAL&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;comm&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;COMM&#34;</span> <span style=color:#c4a000>nullValue=</span><span style=color:#4e9a06>&#34;0&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultUsingResultMap&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select   A.DEPT_NO as DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         LOC,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         COMM
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from     DEPT A,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where    A.DEPT_NO = B.DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         and A.DEPT_NO = #deptNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			order by B.EMP_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 1:N 관계를 표현하는 Complex Properties 를 포함하는 DeptIncludesEmpListVO 에 대한 resultMap 매핑 처리 시 해당 객체의 empVOList 멤버 attribute 에 대한 매핑 정의를 위해 resultMap=“EmpComplexResult.getEmpResult” 과 같이 EmpVO 에 대한 외부 resultMap 을 재사용하며 참조하고 있다. 이때 위의 쿼리에서는 join 에 따라 조회되는 row 수가 1:1 관계와 같이 단건이 아니라 같은 DEPT_NO 에 대해 복수 개의 결과가 얻어지는데 이에 대한 resultMap 정의 시 groupBy=“deptNo” 을 지정하였으므로 같은 deptNo 인 다건의 EmpVO 에 대한 List 가 복합 객체의 List 멤버 attribute 에 설정되어 얻어진다. iBATIS 는 nested resultMap 에 대한 매핑 정의를 참고하여 join 쿼리에 의한 결과 칼럼을 자동으로 복합 객체에 매핑해 주게 되며 여기에서와 같이 groupBy 로 지정한 property 로 그룹핑하여 하위 요소를 List 형태로 자동 세팅할 수 있다.</p><h3 id=sample-testcase-4>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testComplexPropertiesOneToManyResultMapSelect</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 20,&#39;RESEARCH&#39;,&#39;DALLAS&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>DeptIncludesEmpListVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDeptEmpListComplexProperties</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultUsingResultMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;RESEARCH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;DALLAS&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getLoc</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * deptNo 20 인 EmpList 는 초기데이터에 따라 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * 7566,&#39;JONES&#39;,&#39;MANAGER&#39;,7839,&#39;1981-04-02&#39;,2975,NULL,20 7788,&#39;SCOTT&#39;,&#39;ANALYST&#39;,7566,&#39;1987-04-19&#39;,3000,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * 7876,&#39;ADAMS&#39;,&#39;CLERK&#39;,7788,&#39;1987-05-23&#39;,1100,NULL,20 7902,&#39;FORD&#39;,&#39;ANALYST&#39;,7566,&#39;1981-12-03&#39;,3000,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SMITH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1980-12-17&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7566</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7788</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7876</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 테스트 케이스 검증 코드에서 resultVO.getEmpVOList().get(X).getXXX 와 같이 내포 객체(List&lt;EmpVO>)의 각 EmpVO 와 해당 attributes 가 잘 설정되었음을 확인할 수 있다.</p><h3 id=complext-properties---1n-관계---outer-join-의-경우-resultmap>Complext Properties - (1:N 관계 - outer join 의 경우) resultMap</h3><p>1:N 관계를 포함하는 복합 객체의 리스트를 조회할 때 outer join 을 사용한 예이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;EmpComplexResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultListUsingResultMap&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select   A.DEPT_NO as DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         LOC,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         COMM
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from     DEPT A
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         left outer join EMP B
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			           on (A.DEPT_NO = B.DEPT_NO)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where    A.DEPT_NAME like &#39;%&#39;||#deptName#||&#39;%&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			order by A.DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         B.EMP_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id=sample-testcase-5>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testComplexPropertiesOneToManyVOListResultMapSelect</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// deptName 에 의한 like 검색 테스트 &#39;%&#39;|| &#39;E&#39; ||&#39;%&#39; --&gt; R&#39;E&#39;S&#39;E&#39;ARCH, SAL&#39;E&#39;S, OP&#39;E&#39;RATIONS
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 20,&#39;RESEARCH&#39;,&#39;DALLAS&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 30,&#39;SALES&#39;,&#39;CHICAGO&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 40,&#39;OPERATIONS&#39;,&#39;BOSTON&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;E&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DeptIncludesEmpListVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDeptEmpListComplexPropertiesList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isMysql</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultListUsingResultMapMysql&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultListUsingResultMap&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>40</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * deptNo 20 인 EmpList 는 초기데이터에 따라 5 명, deptNo 30 인 EmpList 는 초기데이터에 따라 6 명, deptNo 40 인 EmpList 는 초기데이터에 따라 0 명
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * --&gt; cf.)outer join 에 따라 deptNo 만 가진 EmpVO 1건 생김
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// cf.)outer join 에 따라 deptNo 만 가진 EmpVO 1건 생김을 확인함. 주의할 것!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * deptNo 20 인 EmpList 는 초기데이터에 따라 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * 7566,&#39;JONES&#39;,&#39;MANAGER&#39;,7839,&#39;1981-04-02&#39;,2975,NULL,20 7788,&#39;SCOTT&#39;,&#39;ANALYST&#39;,7566,&#39;1987-04-19&#39;,3000,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * 7876,&#39;ADAMS&#39;,&#39;CLERK&#39;,7788,&#39;1987-05-23&#39;,1100,NULL,20 7902,&#39;FORD&#39;,&#39;ANALYST&#39;,7566,&#39;1981-12-03&#39;,3000,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7566</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7788</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7876</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 테스트 케이스 검증 코드에서 iBATIS 의 resultMap 을 사용하여 outer join 의 결과를 복합 객체로 매핑하는 경우 (groupBy 속성 사용 형태) join key 에 해당하는 값만을 가진 하위 객체가 의도하지 않게 생기는 문제가 있어 보이므로 사용에 유의하기 바란다!</p><h3 id=complext-properties---1n-관계---n1-select-형태-resultmap>Complext Properties - (1:N 관계 - N+1 select 형태) resultMap</h3><p>EmpVO 의 List 를 1:N 관계의 멤버 attribute 로 포함하고 있는 DeptIncludesEmpListVO 를 결과 객체로 사용하고 있는 것은 같다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;EmpComplexResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- 1:N 인 경우 N+1 select 형태 - 비추천 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListUsingSelectAttrResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!-- Dept-EmpList 1:N relation using select attribute --&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empVOList&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#c4a000>select=</span><span style=color:#4e9a06>&#34;selectEmpList&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultListUsingRepetitionSelect&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptIncludesEmpListUsingSelectAttrResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select   DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from     DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where    DEPT_NAME like &#39;%&#39;||#deptName#||&#39;%&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			order by DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmpList&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;decimal&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;getEmpResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select   EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from     EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where    DEPT_NO = #deptNo#
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			order by EMP_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 1:N 관계를 표현하는 Complex Properties 를 포함하는 DeptIncludesEmpListVO 에 대한 resultMap 매핑 처리 시 해당 객체의 empVOList 멤버 attribute 에 대한 매핑 정의를 위해 select=“selectEmpList” 과 같이 별도의 쿼리문을 호출하여(EmpVO 에 대한 resultMap 으로 처리되는) 처리하는 예이다. 쿼리문 상에서 join 을 사용하지 않고 있으며 메인 쿼리문 한번(1번)의 호출에도 결과 rows 수만큼의 select 속성으로 지정한 별도 쿼리 (N번) 가 수행되므로 성능 측면에서 매우 바람직하지 않은 형태이다.</p><h3 id=sample-testcase-6>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testComplexPropertiesOneToManyVOListRepetitionSelect</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// deptName 에 의한 like 검색 테스트 &#39;%&#39;|| &#39;E&#39; ||&#39;%&#39; --&gt; R&#39;E&#39;S&#39;E&#39;ARCH, SAL&#39;E&#39;S, OP&#39;E&#39;RATIONS
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 20,&#39;RESEARCH&#39;,&#39;DALLAS&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 30,&#39;SALES&#39;,&#39;CHICAGO&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 40,&#39;OPERATIONS&#39;,&#39;BOSTON&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;E&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DeptIncludesEmpListVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDeptEmpListComplexPropertiesList</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>isMysql</span>
</span></span><span style=display:flex><span>                        <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultListUsingRepetitionSelectMysql&#34;</span>
</span></span><span style=display:flex><span>                        <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;selectDeptIncludesEmpListResultListUsingRepetitionSelect&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>40</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * deptNo 20 인 EmpList 는 초기데이터에 따라 5 명, deptNo 30 인 EmpList 는 초기데이터에 따라 6 명 deptNo 40 인 EmpList 는 초기데이터에 따라 0 명
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * --&gt; 위 outer join 케이스와 달리 EmpList 도 건수 없음 확인
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * deptNo 20 인 EmpList 는 초기데이터에 따라 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902,&#39;1980-12-17&#39;,800,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * 7566,&#39;JONES&#39;,&#39;MANAGER&#39;,7839,&#39;1981-04-02&#39;,2975,NULL,20 7788,&#39;SCOTT&#39;,&#39;ANALYST&#39;,7566,&#39;1987-04-19&#39;,3000,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         * 7876,&#39;ADAMS&#39;,&#39;CLERK&#39;,7788,&#39;1987-05-23&#39;,1100,NULL,20 7902,&#39;FORD&#39;,&#39;ANALYST&#39;,7566,&#39;1981-12-03&#39;,3000,NULL,20
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>         */</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7566</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7788</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7876</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpVOList</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 테스트 케이스 검증 코드에서 resultList.get(X).getEmpVOList().get(X).getXXX 와 같이 조회 결과(List) 의 내포 객체(List&lt;EmpVO>)의 각 EmpVO 와 해당 attributes 가 잘 설정되었음을 확인할 수 있다. 그러나 N+1 조회의 성능 문제를 야기하므로 sql 매핑 정의 시 join 쿼리와 groupBy 속성을 통한 1:N 관계 처리 매핑으로 처리하는 것이 바람직하다.</p><h3 id=complext-properties---hierarchy-관계-resultmap>Complext Properties - (Hierarchy 관계) resultMap</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EmpIncludesMgrVO</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5695339933191681519L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>empName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>job</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>mgr</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>hireDate</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>sal</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>comm</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Hierarchy 관계
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>EmpIncludesMgrVO</span> <span style=color:#000>mgrVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>empNo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EmpIncludesMgrVO</span> <span style=color:#000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>mgrVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setMgrVO</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EmpIncludesMgrVO</span> <span style=color:#000>mgrVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>mgrVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mgrVO</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 EmpIncludesMgrVO 는 자신과 동일한 EmpIncludesMgrVO 를 Hierarchy 관계의 멤버 attribute 로 포함하고 있다. 위에서는 Emp 의 Manager 에 대해서 포함하고 있는데 MgrVO 를 거슬러 올라가면 결국 자기 관리자 path 에 있는 모든 사원에 대한 정보를 포함하고 있는 객체라 볼 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;EmpComplexResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empIncludesMgrVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpIncludesMgrVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- Hierarchical relation 인 경우 ibatis resultMap select 에 의한 처리 예 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;empIncludesMgrResult&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;empIncludesMgrVO&#34;</span> <span style=color:#c4a000>extends=</span><span style=color:#4e9a06>&#34;getEmpResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;mgrVO&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;MGR&#34;</span> <span style=color:#c4a000>select=</span><span style=color:#4e9a06>&#34;selectMgrHierarchy&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- 하나의 쿼리를 사용하여 empNo, mgr 속성의 유무에 따라 Hierarchy 반복조회로도 사용토록 변경
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 parameterClass 는 최초 조회와 resultMap 의 select 조회의 경우 empVO 와 decimal 로 다르기 때문에
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 따로 명시하지 않고 자동 reflection 에 의해 처리토록 함
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectMgrHierarchy&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;empIncludesMgrResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select   EMP_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         EMP_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         JOB,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         MGR,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         HIRE_DATE,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         SAL,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         COMM,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			         DEPT_NO
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from     EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where    1=1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!-- 최초 - empNo 는 parameter bean 의 property 임--&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;isPropertyAvailable</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;and&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			EMP_NO = #empNo#
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/isPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;!-- 반복 - column=&#34;MGR&#34; 에 의한 연결로 empNo 는 property가 아님 --&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;isNotPropertyAvailable</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;and&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			EMP_NO = #mgr#
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/isNotPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 Hierarchy 관계를 표현하는 Complex Properties 를 포함하는 EmpIncludesMgrVO 에 대한 resultMap 매핑 처리 시 해당 객체의 mgrVO 멤버 attribute 에 대한 매핑 정의를 위해 select=“selectMgrHierarchy” 과 같이 자기 자신의 sql 문을 재호출 하는 형태이다.</p><h3 id=sample-testcase-7>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testComplexPropertiesHierarcyRepetitionSelect</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7369,&#39;SMITH&#39;,&#39;CLERK&#39;,7902
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// --&gt; 7902,&#39;FORD&#39;,&#39;ANALYST&#39;,7566
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// --&gt; 7566,&#39;JONES&#39;,&#39;MANAGER&#39;,7839
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// --&gt; 7839,&#39;KING&#39;,&#39;PRESIDENT&#39;,NULL
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#8f5902;font-style:italic>// EmpIncludesMgrVO resultVO =
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#8f5902;font-style:italic>// empDAO.selectEmpMgrHierarchy(&#34;selectEmpWithMgr&#34;, vo);
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>EmpIncludesMgrVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmpMgrHierarchy</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;selectMgrHierarchy&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7369</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SMITH&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgr</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1980-12-17&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getHireDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>800</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getComm</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>EmpIncludesMgrVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7902</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7566</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7839</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getMgrVO</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UncategorizedSQLException</span> <span style=color:#000>ue</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// tibero 인 경우 ibatis 의 재귀 queyr 형태의 sub 객체 맵핑 시 com.tmax.tibero.jdbc.TbSQLException: TJDBC-90646:Resultset
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#8f5902;font-style:italic>// is already closed 에러 발생 확인함!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isTibero</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ue</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>NestedSQLException</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ue</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>TbSQLException</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(((</span><span style=color:#000>TbSQLException</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>ue</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCause</span><span style=color:#ce5c00;font-weight:700>()).</span><span style=color:#c4a000>getMessage</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>contains</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;TJDBC-90646:Resultset is already closed&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 테스트 케이스 검증 코드에서 SMITH → FORD → JONES → KING 으로 연결되는 관리자 정보를 모두 포함하는 복합 객체의 각 attribute 가 잘 설정되었음을 확인할 수 있다. 일부 DBMS 에서는 문제가 발생할 수 있으므로 사용에 유의한다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-426f2185ff6bb6e3c057f56220644dea>9 - iBATIS Dynamic SQL 사용</h1><div class=lead>iBATIS의 Dynamic 요소를 사용하면 다양한 조건에 따라 쿼리를 동적으로 변경할 수 있으며, 조건에 따라 SQL 문의 일부가 추가 또는 제거된다. 예를 들어, 특정 파라미터 값이 있을 때만 조건절이 추가되는 방식으로, SQL의 재사용성을 높이고 복잡한 조건 분기 문제를 해결한다.</div><h1 id=dynamic-sql>Dynamic SQL</h1><p>일반적으로 JDBC API 를 사용한 코딩에서 한번 정의한 쿼리문을 최대한 재사용하고자 하나 단순 파라메터 변수의 값만 변경하는 것으로 해결하기 어렵고 다양한 조건에 따라 조금씩 다른 쿼리의 실행이 필요한 경우 많은 if~else 조건 분기의 연결이 필요한 문제가 있다. 여기에서는 SQL 문의 동적인 변경에 대한 상대적으로 유연한 방법을 제공하는 iBATIS 의 Dynamic 요소에 대해 알아본다.</p><h2 id=기본-dynamic-요소-사용-방법>기본 Dynamic 요소 사용 방법</h2><p>아래의 샘플 Dynamic 요소 사용예를 참고하라.</p><h3 id=sample-dynamic-sql-mapping-xml>Sample Dynamic SQL mapping xml</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.JobHistVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicElement&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO     as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       START_DATE as startDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       END_DATE   as endDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB        as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL        as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM       as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NO    as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   JOBHIST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;dynamic</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;where&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotNull</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empNo&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;and&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				EMP_NO = #empNo#
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotNull&gt;</span>		
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/dynamic&gt;</span>
</span></span><span style=display:flex><span>			order by EMP_NO, START_DATE
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위 sql 매핑 파일에서 파라메터 객체의 empNo 속성의 값 유무에 따라 where EMP_NO = #empNo# 조건절이 동적으로 추가/제거 될 수 있는 예이다. 위에서 dynamic 의 prepend 속성으로 “where” 를 지정하고 있지만 하위 요소의 조건이 하나라도 만족하지 않으면 sql 문에 추가되지 않는다. 또한 위의 예에서는 하위 요소로 isNotNull 태그에 prepend=“and” 가 지정되어 있지만 처음 true 가 되는 조건의 prepend 는 parent 인 dynamic 의 prepend 인 “where” 로 덮어써져 최종적으로는 where EMP_NO = #empNo# 가 됨에 유의한다.</p><h3 id=sample-testcase>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicStatement</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>JobHistVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>JobHistVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7788</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>JobHistVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectJobHistList</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicElement&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1987-04-19&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1988-04-13&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1990-05-05&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectJobHistList</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicElement&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// where 이 수행되지 않아 전체 데이터가 조회될 것임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>17</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 파라메터 객체에 empNo 의 값을 세팅했을 때 결과로는 해당 조건절이 동적으로 추가된 조회 결과인 사원번호 7788 에 해당하는 Job 이력 3건만 조회되지만 empNo 의 값을 세팅하지 않았을 때(위에서 null 로 세팅하는 것도 동일) 조회 조건절 없이 전체 사원에 대한 이력이 모두 조회됨을 확인할 수 있다.</p><h2 id=unary-조건-비교>Unary 조건 비교</h2><p>아래의 샘플 sql mapping xml 예를 참고하라.</p><p>일반적인 경우 Dynamic SQL 작성을 위한 동적 요소는 Where 조건절의 변경을 위해 많이 쓰이지만, 아래에서는 테스트 편의의 목적으로 dual 에 대하여 임의의 상수를 입력 값으로 전달한 결과를 재조회 하는 과정에 Unary 비교 연산을 활용한 예이다.</p><h3 id=sample-unary-비교-연산>Sample Unary 비교 연산</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.util.EgovMap&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDynamicUnary&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;map&#34;</span> <span style=color:#c4a000>remapResults=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		select
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;dynamic&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isEmpty</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testEmptyString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;empty String&#39; as IS_EMPTY_STRING
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isEmpty&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotEmpty</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testEmptyString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;not empty String&#39; as IS_EMPTY_STRING
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotEmpty&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isEmpty</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testEmptyCollection&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;empty Collection&#39; as IS_EMPTY_COLLECTION
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isEmpty&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotEmpty</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testEmptyCollection&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;not empty Collection&#39; as IS_EMPTY_COLLECTION
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotEmpty&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNull</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNull&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;null&#39; as IS_NULL
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNull&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotNull</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNull&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;not null&#39; as IS_NULL
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotNull&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isPropertyAvailable</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testProperty&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;testProperty Available&#39; as	TEST_PROPERTY_AVAILABLE
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotPropertyAvailable</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testProperty&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;testProperty Not Available&#39; as TEST_PROPERTY_AVAILABLE
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/dynamic&gt;</span>
</span></span><span style=display:flex><span>		from dual
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위에서 테스트한 Unary 비교 연산 태그는 다음과 같다.</p><ul><li>isEmpty : Collection, String(또는 String.valueOf()) 대상 속성이 null 이거나 empty(”” 또는 size() &lt; 1) 인 경우 true</li><li>isNotEmpty : Collection, String(또는 String.valueOf()) 대상 속성이 not null 이고 not empty(”” 또는 size() &lt; 1) 인 경우 true</li><li>isNull : 대상 속성이 null 인 경우 true</li><li>isNotNull : 대상 속성이 not null 인 경우 true</li><li>isPropertyAvailable : 파라메터 객체에 대상 속성이 존재하는 경우 true</li><li>isNotPropertyAvailable : 파라메터 객체에 대상 속성이 존재하지 않는 경우 true</li></ul><p>Unary 비교 연산 태그에 사용할 수 있는 속성은 다음과 같다.</p><ul><li>prepend : 동적 구문 앞에 추가되는 override 가능한 SQL 영역.</li><li>property : 필수. 파라메터 객체의 어떤 property 에 대한 체크인지 지정.</li><li>removeFirstPrepend : 첫번째로 내포될 내용을 생성하는 태그의 prepend 를 제거할지 여부(true/false)</li><li>open : 전체 결과 구문에 대한 시작 문자열</li><li>close : 전체 결과 구문에 대한 닫는 문자열</li></ul><h3 id=sample-testcase-1>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicUnary</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Map</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// isEmpty 테스트 - String
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testEmptyString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEmpty 테스트 - Collection
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span> <span style=color:#000>list</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testEmptyCollection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isNull 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNull&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isPropertyAvailable 테스트 - cf.) property 의 값을 null 로 설정하더라도 해당 property 는 Available 한것에 유의!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testProperty&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicUnary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;empty String&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEmptyString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;empty Collection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEmptyCollection&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;null&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isNull&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testProperty Available&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testPropertyAvailable&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// isEmpty 테스트 - String - null 인 경우도 isEmpty 는 만족함
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testEmptyString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEmpty 테스트 - Collection - null 인 경우도 isEmpty 는 만족함
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span> <span style=color:#000>nullList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testEmptyCollection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>nullList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicUnary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;empty String&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEmptyString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;empty Collection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEmptyCollection&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 3
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEmpty 테스트 - String
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testEmptyString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;aa&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEmpty 테스트 - Collection
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;aa&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testEmptyCollection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isNull 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNull&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isPropertyAvailable 테스트 - key 자체를 담지 않았을 때 isNotPropertyAvailable 임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// map.put(&#34;testProperty&#34;, null);
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicUnary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;not empty String&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEmptyString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;not empty Collection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEmptyCollection&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;not null&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isNull&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testProperty Not Available&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testPropertyAvailable&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 Unary 조건 비교를 위한 입력 파라메터 객체(여기서는 Map 사용)를 다양하게 세팅하여 어떤 경우에 어떤 조건이 만족하는지 테스트한 예이다. 위에서 isEmpty 의 경우 String 이 null 이거나 ””, Collection 에 하위 element 가 add 되지 않은 경우나 Collection 객체 자체가 null 인 경우에 모두 만족하는 것을 확인할 수 있으며, isPropertyAvailable 태그는 입력 객체에 해당 key 만 추가되있고 값은 null 인 경우에도 true 임을 확인할 수 있다. Dynamic SQL 의 동적인 where 조건절 변경의 경우 전달된 인자의 특정 property 에 대한 isNotNull 또는 isNotEmpty 로 간단히 비교하는 경우가 가장 많이 쓰이게 된다.</p><h2 id=binary-조건-비교>Binary 조건 비교</h2><p>아래의 샘플 sql mapping xml 예를 참고하라.</p><p>마찬가지로 아래에서는 테스트 편의의 목적으로 dual 에 대하여 임의의 상수를 입력 값으로 전달한 결과를 재조회 하는 과정에 Binary 비교 연산을 활용한 예이다.</p><h3 id=sample-binary-비교-연산>Sample Binary 비교 연산</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.util.EgovMap&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;map&#34;</span> <span style=color:#c4a000>remapResults=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		select
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;dynamic&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testString&#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;$testString$&#39; as TEST_STRING, &#39;test : equals&#39; as IS_EQUAL
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isEqual&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testString&#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;$testString$&#39; as TEST_STRING, &#39;test : not equals&#39; as IS_EQUAL
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotEqual&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isPropertyAvailable</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					cast($testNumeric$ as $castTypeScale$) as TEST_NUMERIC, &#39;10 : equals&#39; as IS_EQUAL_NUMERIC
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isEqual&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isNotEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					cast($testNumeric$ as $castTypeScale$) as TEST_NUMERIC, &#39;10 : not equals&#39; as IS_EQUAL_NUMERIC
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isNotEqual&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isGreaterEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;10 <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&lt;=]]&gt;</span> $testNumeric$&#39; as IS_GREATER_EQUAL
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isGreaterEqual&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isGreaterThan</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;10 <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&lt;]]&gt;</span> $testNumeric$&#39; as IS_GREATER_THAN
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isGreaterThan&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isLessEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;10 <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&gt;=]]&gt;</span> $testNumeric$&#39; as IS_LESS_EQUAL
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isLessEqual&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isLessThan</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				&#39;10 <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&gt;]]&gt;</span> $testNumeric$&#39; as IS_LESS_THAN
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isLessThan&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#8f5902;font-style:italic>&lt;!-- checkMore --&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isPropertyAvailable</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareProperty=</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;$testOtherString$&#39; as TEST_OTHER_STRING, &#39;test : testOtherString equals testString&#39; as COMPARE_PROPERTY_EQUAL
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isEqual&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isNotEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareProperty=</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;$testOtherString$&#39; as TEST_OTHER_STRING, &#39;test : testOtherString not equals testString&#39; as COMPARE_PROPERTY_EQUAL
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isNotEqual&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isGreaterEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareProperty=</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;&#39;&#39;$testOtherString$&#39;&#39; <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&gt;=]]&gt;</span> &#39;&#39;$testString$&#39;&#39;&#39; as COMPARE_PROPERTY_GREATER_EQUAL
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isGreaterEqual&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isGreaterThan</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareProperty=</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;&#39;&#39;$testOtherString$&#39;&#39; <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&gt;]]&gt;</span> &#39;&#39;$testString$&#39;&#39;&#39; as COMPARE_PROPERTY_GREATER_THAN
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isGreaterThan&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isLessEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareProperty=</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;&#39;&#39;$testOtherString$&#39;&#39; <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&lt;=]]&gt;</span> &#39;&#39;$testString$&#39;&#39;&#39; as COMPARE_PROPERTY_LESS_EQUAL
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isLessEqual&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isLessThan</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>compareProperty=</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;&#39;&#39;$testOtherString$&#39;&#39; <span style=color:#8f5902;font-style:italic>&lt;![CDATA[&lt;]]&gt;</span> &#39;&#39;$testString$&#39;&#39;&#39; as COMPARE_PROPERTY_LESS_THAN
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isLessThan&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/dynamic&gt;</span>
</span></span><span style=display:flex><span>		from dual
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위에서 테스트한 Binary 비교 연산 태그는 다음과 같다.</p><ul><li>isEqual : 대상 속성이 compareValue 값 또는 compareProperty 로 명시한 대상 속성 값과 같은 경우 true</li><li>isNotEqual : 대상 속성이 compareValue 값 또는 compareProperty 로 명시한 대상 속성 값과 다른 경우 true</li><li>isGreaterEqual : 대상 속성이 compareValue 값 또는 compareProperty 로 명시한 대상 속성 값보다 크거나 같은 경우 true</li><li>isGreaterThan : 대상 속성이 compareValue 값 또는 compareProperty 로 명시한 대상 속성 값보다 큰 경우 true</li><li>isLessEqual : 대상 속성이 compareValue 값 또는 compareProperty 로 명시한 대상 속성 값보다 작거나 같은 경우 true</li><li>isLessThan : 대상 속성이 compareValue 값 또는 compareProperty 로 명시한 대상 속성 값보다 작은 경우 true</li></ul><p>Binary 비교 연산 태그에 사용할 수 있는 속성은 다음과 같다.</p><ul><li>prepend : 동적 구문 앞에 추가되는 override 가능한 SQL 영역.</li><li>property : 필수. 파라메터 객체의 어떤 property 에 대한 비교인지 지정.</li><li>compareProperty : 파라메터 객체의 다른 property 와 대상 property 값을 비교하고자 할 경우 지정. (compareValue 가 없는 경우 필수)</li><li>compareValue : 대상 property 와 비교될 값을 지정. (compareProperty 가 없는 경우 필수)</li><li>removeFirstPrepend : 첫번째로 내포될 내용을 생성하는 태그의 prepend 를 제거할지 여부(true/false)</li><li>open : 전체 결과 구문에 대한 시작 문자열</li><li>close : 전체 결과 구문에 대한 닫는 문자열</li></ul><p>위에서 각 비교 연산 태그의 중첩이 가능함을 확인할 수 있다. 복잡한 조건 처리가 필요한 경우 다양한 비교 연산 태그의 중첩으로 적절히 구성할 수 있을 것이다. 또한 비교 연산자 (>, &lt;) 등과 같이 XML 에서 escape 처리가 필요한 경우 &lt;![CDATA[>]]> 와 같이 CDATA 섹션으로 묶어 사용할 수 있다. CDATA 섹션을 전체 쿼리 영역에 묶어 한번에 사용하면 편하겠지만 Dynamic 요소 자체는 실제 XML 태그로 해석이 되어야 하므로 위와 같이 Dynamic 영역 내에서 발생하는 특수문자에 대해 개별로 사용하는 번거로움이 존재함에 유의한다. cf.) &lt; , > 대신 &amp;lt; , &amp;gt; 와 같이 직접 escape 처리 할수도 있다.</p><h3 id=sample-testcase-2>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicBinary</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Map</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>String</span> <span style=color:#000>castTypeScale</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;numeric(2)&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// oracle 인 경우 - numeric 에 대응되는 type 은 number
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isOracle</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>castTypeScale</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;number(2)&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>isMysql</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>castTypeScale</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;decimal(2)&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - String
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - BigDecimal
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// dual 임시 테이블 상에 상수 조회시 numeric(db) - decimal(java) 처리를 위해 cast 처리 추가
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;castTypeScale&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>castTypeScale</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 : equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqualNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 &lt;= 10&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 &gt;= 10&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - String
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;not test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - BigDecimal
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// dual 임시 테이블 상에 상수 조회시 numeric(db) - decimal(java) 처리를 위해 cast 처리 추가
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;castTypeScale&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>castTypeScale</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;not test&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : not equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 : not equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqualNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 &lt;= 11&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 &lt; 11&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 2
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - String
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// isEqual 비교 대상 property 에 null 값을 넘기면 에러는 발생하지 않고, isNotEqual 과 매칭됨
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - BigDecimal
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// dual 임시 테이블 상에 상수 조회시 numeric(db) - decimal(java) 처리를 위해 cast 처리 추가
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;castTypeScale&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>castTypeScale</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// oracle 인 경우 &#39;&#39; 는 null 과 같고 결과 객체에는 null 로 맵핑됨
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(!(</span><span style=color:#000>isOracle</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>isTibero</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#34;&#34;</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : not equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>9</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 : not equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqualNumeric&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 &gt;= 9&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;10 &gt; 9&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 3
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// isEqual 테스트 - BigDecimal
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// testNumeric property 를 넘기지 않았을 때 기대 결과
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// testOtherString 비교
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : testOtherString equals testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;test&#39; &gt;= &#39;test&#39;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;test&#39; &lt;= &#39;test&#39;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 4
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// &#39;test&#39; &gt;= &#39;sample&#39; 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;sample&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// testNumeric property 를 넘기지 않았을 때 기대 결과
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// testOtherString 비교
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;sample&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : testOtherString not equals testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;sample&#39; &lt;= &#39;test&#39;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;sample&#39; &lt; &#39;test&#39;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 property 에 따른 Dynamic 테스트 5
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// &#39;test&#39; &lt;= &#39;testa&#39; 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;testa&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicBinary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : equals&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// testNumeric property 를 넘기지 않았을 때 기대 결과
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// testOtherString 비교
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testa&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;testOtherString&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;test : testOtherString not equals testString&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;testa&#39; &gt;= &#39;test&#39;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyGreaterEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;&#39;testa&#39; &gt; &#39;test&#39;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyGreaterThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyLessEqual&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;comparePropertyLessThan&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 Binary 조건 비교를 위한 입력 파라메터 객체(여기서는 Map 사용)를 다양하게 세팅하여 어떤 경우에 어떤 조건이 만족하는지 테스트한 예이다. 위에서 숫자형의 입력객체 속성에 대해 isGreaterEqual, isGreaterThan, isLessEqual, isLessThan 비교의 경우 쉽게 결과를 예상할 수 있으며 숫자 형식의 결과 조회를 위해 DB 단의 cast 를 처리하게 하였다. 테스트 시나리오 4, 5 에서 String 에 대한 isGreaterEqual, isGreaterThan, isLessEqual, isLessThan 가 가능함을 확인할 수 있으며 &lsquo;sample&rsquo; &lt; &rsquo;test&rsquo; , &rsquo;testa&rsquo; > &rsquo;test&rsquo; 임을 확인할 수 있다.</p><h2 id=parameterpresent-비교>ParameterPresent 비교</h2><p>아래의 샘플 sql mapping xml 예를 참고하라.</p><h3 id=sample-parameterpresent-비교>Sample ParameterPresent 비교</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.util.EgovMap&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDynamicParameterPresent&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;map&#34;</span> <span style=color:#c4a000>remapResults=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		select 
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isParameterPresent&gt;</span>
</span></span><span style=display:flex><span>				&#39;parameter object exist&#39; as IS_PARAMETER_PRESENT
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isParameterPresent&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotParameterPresent&gt;</span>
</span></span><span style=display:flex><span>				&#39;parameter object not exist&#39; as IS_PARAMETER_PRESENT
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotParameterPresent&gt;</span>
</span></span><span style=display:flex><span>		from dual
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><ul><li>isParameterPresent : 파라메터 객체가 전달된(not null) 경우 true</li><li>isNotParameterPresent : 파라메터 객체가 전달되지 않은(null) 경우 true</li></ul><p>ParameterPresent 비교 연산 태그에 사용할 수 있는 속성은 다음과 같다.</p><ul><li>prepend : 동적 구문 앞에 추가되는 override 가능한 SQL 영역.</li><li>removeFirstPrepend : 첫번째로 내포될 내용을 생성하는 태그의 prepend 를 제거할지 여부(true/false)</li><li>open : 전체 결과 구문에 대한 시작 문자열</li><li>close : 전체 결과 구문에 대한 닫는 문자열</li></ul><h3 id=sample-testcase-3>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicParameterPresent</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 입력 파라메터 객체의 전달 여부에 따른 Dynamic 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// isParameterPresent 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicParameterPresent&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;parameter object exist&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isParameterPresent&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>null</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicParameterPresent&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;parameter object not exist&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;isParameterPresent&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>iBATIS 의 쿼리문 실행을 위한 API 호출 시 파라메터 객체의 전달 여부에 따라 isParameterPresent, isNotParameterPresent 의 비교 연산을 사용할 수 있다.</p><h2 id=iterate-연산>iterate 연산</h2><p>아래의 샘플 sql mapping xml 예를 참고하라.</p><p>일반적으로 iterate 태그 처리에 가장 많이 사용되는 in 조건절 처리 예이다.</p><h3 id=sample-iterate-연산>Sample iterate 연산</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span> 	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.JobHistVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empIncludesEmpListVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpIncludesEmpListVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicIterate&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;empIncludesEmpListVO&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO     as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       START_DATE as startDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       END_DATE   as endDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB        as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL        as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM       as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NO    as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   JOBHIST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;dynamic</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;where&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;iterate</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;empList&#34;</span> <span style=color:#c4a000>open=</span><span style=color:#4e9a06>&#34;EMP_NO in (&#34;</span> <span style=color:#c4a000>conjunction=</span><span style=color:#4e9a06>&#34;, &#34;</span> <span style=color:#c4a000>close=</span><span style=color:#4e9a06>&#34;)&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				#empList[].empNo#
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/iterate&gt;</span>		
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/dynamic&gt;</span>
</span></span><span style=display:flex><span>			order by EMP_NO, START_DATE
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><ul><li>iterate : collection 형태의 대상 객체에 대하여 포함하고 있는 각 개별 요소만큼 반복 루프를 돌며 해당 내용을 수행한다.</li></ul><p>iterate 태그에 사용할 수 있는 속성은 다음과 같다.</p><ul><li>prepend : 동적 구문 앞에 추가되는 override 가능한 SQL 영역.</li><li>property : java.util.Collection 이나 java.util.Iterator 또는 array(배열) 유형인 대상 객체를 지정. 명시되지 않으면 파라메터 객체가 collection 임을 가정하여 처리됨.</li><li>removeFirstPrepend : 첫번째로 내포될 내용을 생성하는 태그의 prepend 를 제거할지 여부(true/false/iterate)</li><li>open : 전체 결과 구문에 대한 시작 문자열. 괄호 용도로 유용함.</li><li>close : 전체 결과 구문에 대한 닫는 문자열. 괄호 용도로 유용함.</li><li>conjunction : 각 iteration 사이에 적용될 문자열. AND, OR 연산자나 &lsquo;,&rsquo; 등의 구분자 필요시 유용함.</li></ul><p>위에서는 empList 라는 attribute 로 List&lt;EmpVO> 인 리스트 객체를 포함하는 EmpIncludesEmpListVO 가 파라메터 객체로 사용되고 있으며, iterate 태그에 의해서 empList 의 size 만큼 각 EmpVO 객체의 empNo 값이 in 리스트에 포함되는 아래의 조건절이 동적으로 만들어지게 된다.</p><pre tabindex=0><code class=language-bashxml data-lang=bashxml>where EMP_NO in ( ? , ? , ? ) 
</code></pre><p>iterate 태그의 body 영역 표기법에 유의한다. #empList[].empNo# 에서 확인할 수 있듯이 looping 중의 현재 item 을 지시하기 위해 &lsquo;리스트속성명[]&rsquo; 이 사용되고 있으며 여기서는 해당 item 이 EmpVO 이고 empNo 라는 property 를 포함하고 있으며 이 값이 in 절의 현재 항목으로 바인딩되고 있다. 만약 파라메터 객체 자체가 iterate 가능한 형태인 경우 iterate property 의 명시 없이 body 영역에 &lsquo;[]&rsquo; 로 바로 현재 item 을 지시할 수 있다.</p><ul><li>iBATIS 에서는 파라메터 객체가 복합 객체인 경우 dot notation (. 을 사용하여) 을 사용하여 쉽게 원하는 sub 객체/속성에 접근할 수 있다.</li></ul><h3 id=sample-testcase-4>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicIterate</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// CompositeKeyTest.testCompositeKeySelect() 참조
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7521,&#39;WARD&#39;,&#39;SALESMAN&#39;,7698,&#39;1981-02-22&#39;,1250,500,30
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// --&gt; mgr 이 7698 인 EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 7499,&#39;ALLEN&#39;,&#39;SALESMAN&#39;,7698,&#39;1981-02-20&#39;,1600 --&gt; O
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 7654,&#39;MARTIN&#39;,&#39;SALESMAN&#39;,7698,&#39;1981-09-28&#39;,1250 --&gt; O
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 7844,&#39;TURNER&#39;,&#39;SALESMAN&#39;,7698,&#39;1981-09-08&#39;,1500 --&gt; O
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 7900,&#39;JAMES&#39;,&#39;CLERK&#39;,7698,&#39;1981-12-03&#39;,950 --&gt; X
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmpNo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7521</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpIncludesEmpListVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>empDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmpIncludesEmpList</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectEmpIncludesSameMgrMoreSalaryEmpList&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7521</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WARD&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7499</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1600</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7844</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1500</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7654</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1250</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSal</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>JobHistVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForList</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicIterate&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 7499, 7654, 7844 의 jobhist 는 초기데이터에 따라 각 1건 임
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7499</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7654</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7844</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-02-20&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-09-28&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-09-08&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 이전에 작성한 CompositeKeyTest 의 쿼리를 실행하여 리스트 형태의 속성을 가지는 복합 객체를 만들었고, 이를 파라메터 객체로 iterate 테스트를 위한 쿼리를 수행하였다.</p><h3 id=iterate-property-가-파라메터-객체의-속성-vs-파라메터-객체-자신일-때-비교>iterate property 가 파라메터 객체의 속성 vs. 파라메터 객체 자신일 때 비교</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- parameterClass 는 명시하지 않았음. Map 에 collection 이란 key 로 List 를 넘긴 경우와 바로 List를 넘긴 경우로 구분하여 테스트 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>&lt;!-- iterate 요소가 검색조건 등의 입력 파라메터 바인딩 변수로 사용될 경우는 #collection[]# 과 같이 사용하면 됨 --&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDynamicIterateSimple&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;egovMap&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		select 
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isPropertyAvailable</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;collection&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;iterate</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;collection&#34;</span> <span style=color:#c4a000>conjunction=</span><span style=color:#4e9a06>&#34;, &#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;$collection[]$&#39; as $collection[]$
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/iterate&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#8f5902;font-style:italic>&lt;!-- List 를 바로 넘긴 경우 --&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;isNotPropertyAvailable</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;collection&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;iterate</span> <span style=color:#c4a000>conjunction=</span><span style=color:#4e9a06>&#34;, &#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					&#39;$[]$&#39; as $[]$
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/iterate&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/isNotPropertyAvailable&gt;</span>
</span></span><span style=display:flex><span>		from dual
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>collection 이란 속성이 포함됬는지 여부에 따라 iterate 대상이 파라메터 객체의 속성(위에서는 파라메터 객체 내에 collection 이라는 property 로 전달된 리스트) 또는 파라메터 객체 자신(파라메터 객체 자신이 리스트 형태인 경우) 에 대한 iterate 처리 예이다. $property명$ 로 작성된 영역은 #property명# 와 같이 prepared statement 의 바인드 변수로 처리되는 것이 아니라 SQL 문 자체에 텍스트가 replace 되어 처리됨에 유의한다.</p><h3 id=sample-testcase-5>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicIterateSimple</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Collection 형의 객체 size 만큼
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span> <span style=color:#000>iterateList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>iterateList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>iterateList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>iterateList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;c&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicIterateSimple&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>iterateList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;c&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;c&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;d&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// map 안에 collection 이란 property 로 List 를 넣은 경우
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;collection&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>iterateList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>resultMap</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForObject</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectDynamicIterateSimple&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;a&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;b&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;c&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;c&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(!</span><span style=color:#000>resultMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;d&#34;</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// iterate 를 위한 테스트로 Map, Set, Iterator 를 시도해 보았으나 아래 에러를 냄. (List 나 Array 와 같이 index 로 접근 가능해야 하는듯)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// The &#39;xxx&#39;(ex. collection) property of the XXX (ex. java.util.HashMap$EntryIterator) class is not a List or
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// Array.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 파라메터 객체 자체를 List 로 전달한 첫번째 경우와 파라메터 객체(Map) 안에 “collection” 이란 key 로 List 를 전달한 두번째 경우의 iterate 태그 처리 차이를 알 수 있을 것이다.</p><h2 id=nested-iterate-연산>Nested iterate 연산</h2><p>아래의 샘플 sql mapping xml 예를 참고하라.</p><h3 id=sample-iterate-연산-1>Sample iterate 연산</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicNestedIterate&#34;</span> <span style=color:#c4a000>parameterClass=</span><span style=color:#4e9a06>&#34;map&#34;</span> <span style=color:#c4a000>resultClass=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO     as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       START_DATE as startDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       END_DATE   as endDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB        as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL        as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM       as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NO    as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   JOBHIST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;dynamic</span> <span style=color:#c4a000>prepend=</span><span style=color:#4e9a06>&#34;where&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;iterate</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;condition&#34;</span> <span style=color:#c4a000>open=</span><span style=color:#4e9a06>&#34;(&#34;</span> <span style=color:#c4a000>conjunction=</span><span style=color:#4e9a06>&#34;and&#34;</span> <span style=color:#c4a000>close=</span><span style=color:#4e9a06>&#34;)&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				$condition[].columnName$ $condition[].columnOperation$ 
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;condition[].nested&#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;iterate</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;condition[].columnValue&#34;</span> <span style=color:#c4a000>open=</span><span style=color:#4e9a06>&#34;(&#34;</span> <span style=color:#c4a000>conjunction=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#c4a000>close=</span><span style=color:#4e9a06>&#34;)&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>						#condition[].columnValue[]#
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;/iterate&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isEqual&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;isNotEqual</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;condition[].nested&#34;</span> <span style=color:#c4a000>compareValue=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					#condition[].columnValue#
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/isNotEqual&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/iterate&gt;</span>		
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/dynamic&gt;</span>
</span></span><span style=display:flex><span>			order by EMP_NO, START_DATE
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>복잡한 조건 처리의 예로 일반 비교 연산과 Nested Iterate 처리가 함께 사용되고 있다. 쿼리 호출 시 columnName, columnOperation, columnValue 를 멀티로 넘기며 columnName 과 columnOperation 은 sql 문에 직접 replaced Text 로 처리하고 columnValue 에 대해서는 바인드 변수 처리하며, 이때 nested 로 추가 설정한 값이 true 이면 columnValue 가 in 조건절인 경우로 판단하여 nested iterate 처리하는 예이다. 아래 테스트 케이스에서 파라메터 객체 세팅에 따라 다음 조건절이 동적으로 추가된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>where <span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#000>DEPT_NO</span> <span style=color:#ce5c00;font-weight:700>=</span> ? and SAL &lt; ? and JOB in <span style=color:#ce5c00;font-weight:700>(</span> ? , ? <span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><h3 id=sample-testcase-6>Sample TestCase</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>..</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDynamicNestedIterate</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// nested iterate 태그 테스트 - columnName, columnOperation, columnValue 를 Map 형태로 모아 담은 List 를 condition 이란 key 로 파라메터 객체(Map) 에 추가
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// columnValue 가 nested iterate 로 풀려야 하는 경우(ex. in 조건절) nested &#39;true&#39; 로 추가 설정을 하여 호출함.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>Map</span> <span style=color:#000>map</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>List</span> <span style=color:#000>condition</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Map</span> <span style=color:#000>columnMap1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;DEPT_NO&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnOperation&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;=&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnValue&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>columnMap1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>Map</span> <span style=color:#000>columnMap2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;SAL&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnOperation&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;&lt;&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnValue&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>columnMap2</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>Map</span> <span style=color:#000>columnMap3</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap3</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;JOB&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap3</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnOperation&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;in&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>List</span> <span style=color:#000>jobList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>jobList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CLERK&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>jobList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SALESMAN&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>columnMap3</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;columnValue&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>jobList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// List 를 nested 로 포함하고 있음을 flag 로 알림
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>columnMap3</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;nested&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>columnMap3</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>condition</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>JobHistVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>resultList</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#000>jobHistDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSqlMapClientTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>queryForList</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicNestedIterate&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>map</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertNotNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// 결과 데이터
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// Empno Startdate Enddate Job Sal Comm Deptno
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 1 7499 81/02/20 SALESMAN 1600 300 30
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 2 7521 81/02/22 SALESMAN 1250 500 30
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 3 7654 81/09/28 SALESMAN 1250 1400 30
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// cf.) 7698 81/05/01 MANAGER 2850 30 데이터는 in 조건절에 JOB 이 &#39;MANAGER&#39; 인 것이 없기 때문에 nested 안에서 필터링 됨.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 4 7844 81/09/08 SALESMAN 1500 0 30
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#8f5902;font-style:italic>// 5 7900 83/01/15 CLERK 950 30
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>5</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7499</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7521</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7654</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7844</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BigDecimal</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>7900</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>        <span style=color:#000>SimpleDateFormat</span> <span style=color:#000>sdf</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleDateFormat</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;yyyy-MM-dd&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>util</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Locale</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDefault</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-02-20&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-02-22&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-09-28&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1981-09-08&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>sdf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parse</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;1983-01-15&#34;</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>resultList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>4</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>getStartDate</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>지금까지 살펴본 바에서 확인할 수 있듯이 iBATIS 의 Dynamic 요소를 사용하여 매우 복잡한 조건 처리도 가능하다. 그러나 조건 처리가 복잡한 경우 dynamic 태그 영역을 쉽게 알아보기 어렵고 단순 논리/산술 연산 수준의 태그로 감당하기 어려운 복잡한 요구사항에 완벽하게 대응하기는 미비한 점이 존재한다. iBATIS 차후 버전에서는 좀더 유연하고 강력한 Dynamic 처리가 가능해질 걸로 보인다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b0625eb5b34c13083c128310e5f8f842>10 - MyBatis</h1><p>MyBatis</p><ul><li><a href=./dataaccess-ibatis_vs_mybatis.md>주요 변경 사항</a></li><li><a href=./dataaccess-getting_started.md>Getting Started</a></li><li><a href=./dataaccess-configuration_xml.md>Configuration XML</a></li><li><a href=./dataaccess-mapper_xml_files.md>Mapper XML Files</a></li><li><a href=./dataaccess-dynamic_sql.md>Dynamic SQL</a></li><li><a href=./dataaccess-mybatis-guide.md>표준프레임워크 기반 적용 가이드</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-793d7e9a4bdd43ff70f99a1ae6bdd6cd>11 - MyBatis 주요 변경점</h1><div class=lead>MyBatis는 iBatis에서 패키지 구조와 용어가 변경되었으며, com.ibatis.*에서 org.apache.ibatis.*로 패키지 구조가 바뀌고, 여러 구문 및 속성들이 통합 또는 대체되었다. 예를 들어, sqlMap은 mapper로, parameterClass는 parameterType으로 변경되었다.</div><h1 id=mybatis-주요-변경점>MyBatis 주요 변경점</h1><p>본 가이드는 MyBatis와 iBatis의 차이점을 설명한다.</p><h2 id=변경된-용어종합>변경된 용어(종합)</h2><table><thead><tr><th>iBatis</th><th>MyBatis</th><th>비고</th></tr></thead><tbody><tr><td>com.ibatis.*</td><td>org.apache.ibatis.*</td><td>패키지 구조 변경</td></tr><tr><td>SqlMapConfig</td><td>Configration</td><td>용어변경</td></tr><tr><td>sqlMap</td><td>mapper</td><td>용어변경</td></tr><tr><td>sqlMapClient</td><td>sqlSession</td><td>구문대체</td></tr><tr><td>rowHandler</td><td>resultHandler</td><td>구문대체</td></tr><tr><td>resultHandler</td><td>SqlSessionFactory</td><td>구문대체</td></tr><tr><td>parameterMap, parameterClass</td><td>parameterType</td><td>속성 통합</td></tr><tr><td>resultClass</td><td>resultType</td><td>용어변경</td></tr><tr><td>#var#</td><td>#{var}</td><td>구문대체</td></tr><tr><td>$var$</td><td>${var}</td><td>구문대체</td></tr><tr><td><isequal>, <isnull></td><td><if></td><td>구문대체</td></tr></tbody></table><h2 id=변경사항>변경사항</h2><h3 id=패키지-구조-변경>패키지 구조 변경</h3><table><thead><tr><th>iBatis</th><th>MyBatis</th></tr></thead><tbody><tr><td>com.ibatis.*</td><td>org.apache.ibatis.*</td></tr></tbody></table><p>패키지 구조는 변경되었으나 기존에 iBatis 패키지명은 그대로 사용한다.</p><h3 id=mybatis-library-별도-제공>MyBatis library 별도 제공</h3><p>Maven Dependency Information 예시</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.mybatis<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>mybatis<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>3.2.2<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.mybatis<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>mybatis-spring<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>1.2.0<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h3 id=annotation-도입>annotation 도입</h3><ul><li>annotation 을 적극 도입하여 DAO 에 대해서 행하던 sqlMapClient DI 설정을 안 해도 된다.</li><li>spring 2.5 대 부터 annotation 이 도입되어서 설정이 매우 간편해진 것처럼 무척 간편해 졌다.</li><li>bean id sqlSessionFactory, sqlSessionTemplate 만 지정하면 된다.</li></ul><h3 id=rowhandler-대체>rowHandler 대체</h3><ul><li>xml 및 대량 데이터 처리를 위해 사용하였던 rowHandler가 삭제되었다.</li><li>sqlMapClient 가 없어지고 sqlSession 으로 대체 되었는데, sqlSession 의 API 를 살펴보니 large data 처리용 method 를 제공한다.</li><li>rowHandler 가 resultHandler 로 바뀌었다.</li><li>큰 변화중 하나는 자바 어노테이션을 사용해서 xml을 사용하지 않고 모든 것을 자바로만 할 수 있게 되었다. 물론 Configration.xml 도 자바에서 직접 DataSource, Environment 등을 선언해서 클래스화 시킬 수 있다.</li><li>주의할 점은 xml로 Configure를 만들고 환경변수와 property를 클래스로도 만들었다면, 클래스 쪽이 나중에 읽어지게 돼서 xml로 되어있는 세팅이 자바 클래스에서 선언해 놓은 것으로 덮어써지게 된다. 혼란을 줄 수 있으니 한가지 방법만으로 프로젝트를 구성하는 것이 좋을 것이다.</li><li>Configuration configuration = new Con…. 형식으로 선언을 하고 나서는 mapper도 xml이 아니고 configuration.addMapper(UserMapper.class) 형식으로 추가 해야 하기 때문에 어느 쪽으로 할 것인지 확실하게 결정을 하고 나서 진행해야 한다.</li></ul><h3 id=네임스페이스-방식-변경>네임스페이스 방식 변경</h3><ul><li>sqlMap 파일별로 줄여 놓은 이름을 사용했다면 이제 전체 경로(full path)로 사용하게 된다.(공식 설명서에서는 혼란을 줄이고 어떤 것이 호출되는지 정확하게 알 수 있으니 좋다고 기재)</li></ul><table><thead><tr><th>iBatis</th><th>MyBatis</th></tr></thead><tbody><tr><td>&lt;sqlMap namespace=“User”></td><td>&lt;mapper namespace=“myBatis.mapper.UserMapper”></td></tr></tbody></table><p>실제 자바쪽에서 호출할 때도 길게 호출하여야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>list</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;myBatis.mappers.UserMapper.getUserList&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>이런 경우에 위에서 이야기한 자바 어노테이션 (@Select)을 사용해서 mapper 파일을 xml이 아니고 자바로 만들어 놓으면 코드 힌트까지 사용해서 편하게 쓸 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>UserMapper</span> <span style=color:#000>mapper</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMapper</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>UserMapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>list</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectUserList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><h2 id=변경되거나-추가된-속성들>변경되거나 추가된 속성들</h2><p>기존에 조건에 따라 변하는 쿼리를 만들기 위해서 사용되던 태그들이 변경되었다. 조금 더 직관적으로 바뀌었고 해당상황(Update, Select)등에 맞춰서 사용할 수 있는 태그들도 추가되었다.</p><ul><li>parameterMap은 더이상 사용하지 않게 되었다. parameterMap과 parameterClass 대신 parameterType 하나로 사용한다.</li><li>resultMap은 여전히 남아있지만 resultClass 는 resultType 으로 변경되었다.</li><li>parameterType과 resultType에는 기본형(int, byte, …. )부터 클래스 명까지 기존처럼 사용할 수 있다.</li><li>기존에 procedure를 호출하기 위해 사용하던 &lt;procedure>가 사라지고 statementType 속성이 생겼다. PREPARED, STATEMENT, CALLABLE 중에 하나를 선택할 수 있고 기본값은 PREPARED이다.</li><li>파라미터를 매핑하기 위해서 사용하던 #var# 형태는 #{var} 로 바뀌었다. $var$ 역시 ${var} 형태로 사용하면 된다.</li></ul><p>참고) #{var}와 ${var}의 차이는 prepredStatement의 파라미터로 사용, String 값으로 사용.<br>order by 같은 경우에 사용하기 위해서는 order by ${orderParam} 처럼 사용해야 한다.<br>이 방법을 사용하는 경우 MyBatis가 자체적으로 쿼리의 적합성여부를 판단할 수 없기 때문에 사용자의 입력 값을 그대로 사용하는 것보다는 개발자가 미리 정해 놓은 값 등으로 변경하도록 해서 정확한 값이 들어올 수 있도록 해야 한다.</p><p>sqlMap쪽에서 사용하던 typeAlias가 sqlMap이 바뀐 mapper 에서 사용되지 않고 Configration 파일에서 정의하도록 변경되었다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;typeAliases&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;vo.UserVO&#34;</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;User&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/typeAliases&gt;</span>
</span></span></code></pre></div><p>Configuration 파일에 위의 형식처럼 Alias를 정의하면 전체 mapper 에서 사용할 수 있다.</p><h3 id=dynamic-statement의-변화>Dynamic Statement의 변화</h3><ul><li>&lt;isEqual> , &lt;isNull> 등의 구문이 &lt;if>로 통합되었다.</li></ul><p>&lt;if test=“userID != null”> 형태로 간단하게 사용할 수 있다.<br>&lt;dynamic> 형태로 해서 where 조건절이나 and , or 를 동적으로 만들던 것이 &lt;where>나 update에서 사용할 수 있는 &lt;set> 등으로 변경되었다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;getUserList&#34;</span> <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;User&gt;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    SELECT * FROM TR_USER
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &lt;where&gt;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &lt;if test=&#34;</span><span style=color:#a40000>isAdmin</span> <span style=color:#a40000>!=</span> <span style=color:#a40000>null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                authLevel = &#39;1&#39;
</span></span><span style=display:flex><span>             <span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>&lt;/where&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><ul><li>trim, foreach 태그가 새로 추가</li></ul><ol><li>trim은 쿼리를 동적 생성 할 때에 쿼리를 연결하기 위해서 컴마(,)를 사용한 경우 마지막항목이 조건을 만족하지 못해서 생성된 쿼리 끝에 컴마가 붙어있다던가 하는 경우에 잘라낼 수 있다.</li><li>foreach는 반복적인 항목을 동적으로 넣을 때 사용할 수 있다. ( ex. where 조건절에서 in 을 사용하는 경우)</li></ol><h2 id=참고자료>참고자료</h2><ul><li>MyBatis 마이그레이션 가이드(<a href=http://code.google.com/p/mybatis/wiki/DocUpgrade3>http://code.google.com/p/mybatis/wiki/DocUpgrade3</a>)</li><li><a href="http://blog.naver.com/PostView.nhn?blogId=vikong&amp;logNo=60180433051">http://blog.naver.com/PostView.nhn?blogId=vikong&amp;logNo=60180433051</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a2c5dd6fe956a5bc7c9f004b8cd06f2b>12 - MyBatis 시작하기</h1><div class=lead>MyBatis 애플리케이션은 SqlSessionFactory 인스턴스를 사용하며, 이를 SqlSessionFactoryBuilder를 통해 XML 설정 파일에서 빌드할 수 있다. Resources 유틸 클래스를 사용하여 클래스패스 또는 다른 위치에서 자원을 쉽게 로드할 수 있다.</div><h2 id=시작하기>시작하기</h2><p>모든 MyBatis 애플리케이션은 SqlSessionFactory 인스턴스를 사용한다. SqlSessionFactory 인스턴스는 SqlSessionFactoryBuilder 를 사용하여 만들 수 있다. SqlSessionFactoryBuilder 는 XML 설정파일에서 SqlSessionFactory 인스턴스를 빌드할 수 있다;</p><h3 id=xml에서-sqlsessionfactory-빌드하기>XML에서 SqlSessionFactory 빌드하기</h3><p>XML 파일에서 SqlSessionFactory 인스턴스를 빌드하는 것은 매우 간단하다. 설정을 위해 클래스패스 자원을 사용하는 것을 추천하나, 파일 경로나 file URL 로부터 만들어진 InputStream 인스턴스를 사용할 수도 있다. MyBatis 는 클래스패스와 다른 위치에서 자원을 로드하는 것으로 좀더 쉽게 해주는 Resources 라는 유틸성 클래스를 가지고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>resource</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;org/mybatis/example/mybatis-config.xml&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000>InputStream</span> <span style=color:#000>inputStream</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Resources</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResourceAsStream</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>resource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>SqlSessionFactory</span> <span style=color:#000>sqlSessionFactory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SqlSessionFactoryBuilder</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>inputStream</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>XML 설정파일에서 지정하는 MyBatis 의 핵심이 되는 설정은 트랜잭션을 제어하기 위한 TransactionManager 과 함께 데이터베이스 Connection 인스턴스를 가져오기 위한 DataSource 를 포함한다. 예제 :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE configuration
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>  &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;environments</span> <span style=color:#c4a000>default=</span><span style=color:#4e9a06>&#34;development&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;environment</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;development&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;transactionManager</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;JDBC&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;dataSource</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;POOLED&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driver&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${driver}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${url}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${username}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;${password}&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/dataSource&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/environment&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/environments&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;mappers&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;mapper</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;org/mybatis/example/BlogMapper.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/mappers&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>좀 더 많은 XML 설정방법이 있지만, 위 예제에서는 가장 핵심적인 부분만을 보여주고 있다. XML 가장 위부분에서는 XML 문서의 유효성체크를 위해 필요하다. environment 요소는 트랜잭션 관리와 커넥션 풀링을 위한 환경적인 설정을 나타낸다. mappers 요소는 SQL 코드와 매핑 정의를 가지는 XML 파일인 mapper 의 목록을 지정한다.</p><h3 id=xml-을-사용하지-않고-sqlsessionfactory-빌드하기>XML 을 사용하지 않고 SqlSessionFactory 빌드하기</h3><p>XML 보다 자바를 사용해서 직접 설정하길 원한다면, XML 파일과 같은 모든 설정을 제공하는 Configuration 클래스를 사용하면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>DataSource</span> <span style=color:#000>dataSource</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>DeptDataSourceFactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptDataSource</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>TransactionFactory</span> <span style=color:#000>transactionFactory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>JdbcTransactionFactory</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#000>Environment</span> <span style=color:#000>environment</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Environment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;development&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>transactionFactory</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>dataSource</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>Configuration</span> <span style=color:#000>configuration</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Configuration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>environment</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>configuration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addMapper</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptMapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>SqlSessionFactory</span> <span style=color:#000>sqlSessionFactory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SqlSessionFactoryBuilder</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>configuration</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>이 설정에서 추가로 해야 할 일은 Mapper 클래스를 추가하는 것이다. Mapper 클래스는 SQL 매핑 어노테이션을 가진 자바 클래스이다. 어쨌든 자바 어노테이션의 몇 가지 제약과 몇 가지 설정방법의 복잡함에도 불구하고, XML 매핑은 세부적인 매핑을 위해 언제든 필요하다.</p><h3 id=sqlsessionfactory-에서-sqlsession-만들기>SqlSessionFactory 에서 SqlSession 만들기</h3><p>SqlSessionFactory 이름에서 보듯이, SqlSession 인스턴스를 만들 수 있다. SqlSession 은 데이터베이스에 대해 SQL 명령어를 실행하기 위해 필요한 모든 메서드를 가지고 있다. 그래서 SqlSession 인스턴스를 통해 직접 SQL 구문을 실행할 수 있다. 예를 들면 :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#000>SqlSession</span> <span style=color:#000>session</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sqlSessionFactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>openSession</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Dept</span> <span style=color:#000>dept</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.DeptMapper.selectDept&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>101</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>close</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>이 방법이 MyBatis 의 이전버전을 사용한 사람이라면 굉장히 친숙할 것이다. 하지만 좀더 좋은 방법이 생겼다. 주어진 SQL 구문의 파라미터와 리턴값을 설명하는 인터페이스(예를 들면, DeptMapper.class )를 사용하여, 문자열 처리 오류나 타입 캐스팅 오류 없이 좀더 타입에 안전하고 깔끔하게 실행할 수 있다.</p><p>예를 들면:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>SqlSession</span> <span style=color:#000>session</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>sqlSessionFactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>openSession</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>DeptMapper</span> <span style=color:#000>mapper</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getMapper</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptMapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Dept</span> <span style=color:#000>dept</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>101</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>close</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>그럼 좀더 자세히 살펴보자.</p><h3 id=매핑된-sql-구문-살펴보기>매핑된 SQL 구문 살펴보기</h3><p>이 시점에 SqlSession 이나 Mapper 클래스가 정확히 어떻게 실행되는지 궁금할 것이다. 매핑된 SQL 구문에 대한 내용이 가장 중요하다. 그래서 이 문서 전반에서 가장 자주 다루어진다. 하지만 다음의 두가지 예제를 통해 정확히 어떻게 작동하는지에 대해서는 충분히 이해하게 될 것이다.</p><p>위 예제처럼, 구문은 XML 이나 어노테이션을 사용해서 정의할 수 있다. 그럼 먼저 XML 을 보자. MyBatis 가 제공하는 대부분의 기능은 XML 을 통해 매핑 기법을 사용한다. 이전에 MyBatis 를 사용했었다면 쉽게 이해되겠지만, XML 매핑 문서에 이전보다 많은 기능이 추가되었다. SqlSession 을 호출하는 XML 기반의 매핑 구문이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE mapper   PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mapper</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.DeptMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> 
</span></span><span style=display:flex><span>                <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;int&#34;</span> 
</span></span><span style=display:flex><span>                     <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;Dept&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			where  DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/mapper&gt;</span>
</span></span></code></pre></div><p>한 개의 매퍼 XML 파일에는 많은 수의 매핑 구문을 정의할 수 있다. XML 도입부의 헤더와 doctype 을 제외하면, 나머지는 쉽게 이해되는 구문의 형태이다. 여기선 egovframework.rte.psl.dataaccess.DeptMapper 명명공간에서 selectDept 라는 매핑 구문을 정의했고, 이는 결과적으로 egovframework.rte.psl.dataaccess.DeptMapper.selectDept 형태로 실제 명시되게 된다. 그래서 다음처럼 사용하게 되는 셈이다.</p><p>Dept dept = (Dept) session.selectOne(“egovframework.rte.psl.dataaccess.DeptMapper.selectDept”, 101); 이건 마치 패키지를 포함한 전체 경로의 클래스내 메서드를 호출하는 것과 비슷한 형태이다. 이 이름은 매핑된 select 구문의 이름과 파라미터 그리고 리턴 타입을 가진 명명공간과 같은 이름의 Mapper 클래스와 직접 매핑될 수 있다. 이건 위에서 본 것과 같은 Mapper 인터페이스의 메서드를 간단히 호출하도록 허용한다. 위 예제에 대응되는 형태는 아래와 같다.</p><p>DeptMapper mapper = session.getMapper(DeptMapper.class); Dept dept = mapper.selectDept(101); 두번째 방법은 많은 장점을 가진다. 먼저 문자열에 의존하지 않는다는 것이다. 이는 애플리케이션을 좀더 안전하게 만든다. 두번째는 개발자가 IDE 를 사용할 때, 매핑된 SQL 구문을 사용할 때의 수고를 덜어준다. 세번째는 리턴 타입에 대해 타입 캐스팅을 하지 않아도 된다. 그래서 DeptMapper 인터페이스는 깔끔하고 리턴 타입에 대해 타입에 안전하며 이는 파라미터에도 그대로 적용된다.</p><h4 id=참고--명명공간namespaces에-대한-설명>참고 : 명명공간(Namespaces)에 대한 설명</h4><p>명명공간(Namespaces) 이 이전 버전에서는 사실 선택 사항이었다. 하지만 이제는 패키지 경로를 포함한 전체 이름을 가진 구문을 구분하기 위해 필수로 사용해야 한다.</p><p>명명공간은 인터페이스 바인딩을 가능하게 한다. 명명공간을 사용하고 자바 패키지의 명명공간을 두면 코드가 깔끔해 지고 MyBatis 의 사용성이 크게 향상될 것이다.</p><p>이름 분석(Name Resolution): 타이핑을 줄이기 위해, MyBatis 는 구문과 결과맵, 캐시등의 모든 설정요소를 위한 이름 분석 규칙을 사용한다.</p><ul><li>“com.mypackage.MyMapper.selectAllThings” 과 같은 패키지를 포함한 전체 경로명(Fully qualified names)은 같은 형태의 경로가 있다면 그 경로내에서 직접 찾는다.</li><li>“selectAllThings” 과 같은 짧은 형태의 이름은 모호하지 않은 엔트리를 참고하기 위해 사용될 수 있다. 그래서 짧은 이름은 모호해서 에러를 자주 보게 되니 되도록이면 전체 경로를 사용해야 할 것이다.</li></ul><h2 id=참고-자료>참고 자료</h2><ul><li><a href=http://mybatis.github.io/mybatis-3/ko>http://mybatis.github.io/mybatis-3/ko</a></li><li><a href=http://mybatis.github.io/mybatis-3/getting-started.html>http://mybatis.github.io/mybatis-3/getting-started.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-c6dabd11eb456c4aaacfca3fe688ebda>13 - MyBatis Configuration XML File</h1><div class=lead>MyBatis XML 설정 파일은 <code>properties</code>, <code>settings</code>, <code>typeAliases</code>, <code>mappers</code> 등 다양한 설정 항목으로 구성되며, 데이터베이스와의 상호작용을 정의하는 중요한 설정들을 포함한다. 이 파일은 MyBatis의 동작 방식과 데이터베이스 연결 환경을 관리하는 역할을 한다.</div><h1 id=mybatis-configuration-xml-file>MyBatis Configuration XML File</h1><p>MyBatis XML 설정파일은 다양한 셋팅과 프로퍼티를 가진다 해당 파일의 작성과 상세한 옵션 설정에 대해 알아본다.</p><h2 id=configuration-xml>Configuration XML</h2><p>MyBatis XML 설정파일의 일반적인 구조 및 구성은 properties, settings, typeAliases, typeHandlers, objectFactory, plugins, environments, databaseIdProvider, mappers 등의 내용으로 구성이 되어 있으며 주요 내용은 아래와 같다.</p><h4 id=sample-configuration>Sample Configuration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE configuration PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;properties</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;org/mybatis/example/config.properties&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;dev_user&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;F2Fa3!33TYyg&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;settings&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;setting</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;cacheEnabled&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;setting</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lazyLoadingEnabled&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;setting</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;multipleResultSetsEnabled&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/settings&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeHandlers&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;typeHandler</span> <span style=color:#c4a000>handler=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.typehandler.CalendarMapperTypeHandler&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/typeHandlers&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;typeAliases&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;empVO&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	.
</span></span><span style=display:flex><span>	.
</span></span><span style=display:flex><span>	. 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/typeAliases&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/configuration&gt;</span>
</span></span></code></pre></div><ul><li><p>properties : 표준 java properties (key=value 형태)파일에 대한 연결을 지원하며 설정 파일내에서 ${key} 와 같은 형태로 properties 형태로 외부화해놓은 실제 값(여기서는 DB 접속 관련 driver, url, id/pw)을 참조할 수 있다. resource 속성으로 classpath, url 속성으로 유효한 URL 상에 있는 자원을 지정 가능하다.</p></li><li><p>settings : 런타임시 MyBatis의 행위를 조정하기 위한 옵션 설정을 통해 최적화할 수 있도록 지원한다. 다음표는 셋팅과 그 의미 그리고 디폴트 값을 설명한다.</p></li></ul><table><thead><tr><th>셋팅</th><th>설명</th><th>사용가능한 값들</th><th>디폴트</th></tr></thead><tbody><tr><td>cacheEnabled</td><td>설정에서 각 mapper 에 설정된 캐시를 전역적으로 사용할지 말지에 대한 여부</td><td>true / false</td><td>TRUE</td></tr><tr><td>lazyLoadingEnabled</td><td>늦은 로딩을 사용할지에 대한 여부. 사용하지 않는다면 모두 즉시 로딩할 것이다.</td><td>true / false</td><td>TRUE</td></tr><tr><td>aggressiveLazyLoading</td><td>활성화 상태로 두게 되면 늦은(lazy) 로딩 프로퍼티를 가진 객체는 호출에 따라 로드될 것이다. 반면에 개별 프로퍼티는 요청할때 로드된다.</td><td>true / false</td><td>TRUE</td></tr><tr><td>multipleResultSetsEnabled</td><td>한개의 구문에서 여러개의 ResultSet 을 허용할지의 여부(드라이버가 해당 기능을 지원해야 함)</td><td>true / false</td><td>TRUE</td></tr><tr><td>useColumnLabel</td><td>칼럼명 대신에 칼럼라벨을 사용. 드라이버마다 조금 다르게 작동한다. 문서와 간단한 테스트를 통해 실제 기대하는 것처럼 작동하는지 확인해야 한다.</td><td>true / false</td><td>TRUE</td></tr><tr><td>useGeneratedKeys</td><td>생성키에 대한 JDBC 지원을 허용. 지원하는 드라이버가 필요하다. true 로 설정하면 생성키를 강제로 생성한다. 일부 드라이버(예를들면, Derby)에서는 이 설정을 무시한다.</td><td>true / false</td><td>FALSE</td></tr><tr><td>autoMappingBehavior</td><td>MyBatis 가 칼럼을 필드/프로퍼티에 자동으로 매핑할지와 방법에 대해 명시. PARTIAL 은 간단한 자동매핑만 할뿐, 내포된 결과에 대해서는 처리하지 않는다. FULL 은 처리가능한 모든 자동매핑을 처리한다.</td><td>NONE, PARTIAL, FULL</td><td>PARTIAL</td></tr><tr><td>defaultExecutorType</td><td>디폴트 실행자(executor) 설정. SIMPLE 실행자는 특별히 하는 것이 없다. REUSE 실행자는 PreparedStatement 를 재사용한다. BATCH 실행자는 구문을 재사용하고 수정을 배치처리한다.</td><td>SIMPLE REUSE BATCH</td><td>SIMPLE</td></tr><tr><td>defaultStatementTimeout</td><td>데이터베이스로의 응답을 얼마나 오래 기다릴지를 판단하는 타임아웃을 셋팅</td><td>양수</td><td>셋팅되지 않음(null)</td></tr><tr><td>safeRowBoundsEnabled</td><td>중첩구문내 RowBound 사용을 허용</td><td>true / false</td><td>FALSE</td></tr><tr><td>mapUnderscoreToCamelCase</td><td>전통적인 데이터베이스 칼럼명 형태인 A_COLUMN을 CamelCase형태의 자바 프로퍼티명 형태인 aColumn으로 자동으로 매핑하도록 함</td><td>true / false</td><td>FALSE</td></tr><tr><td>localCacheScope</td><td>MyBatis uses local cache to prevent circular references and speed up repeated nested queries. By default (SESSION) all queries executed during a session are cached. If localCacheScope=STATEMENT local session will be used just for statement execution, no data will be shared between two different calls to the same SqlSession.</td><td>SESSION / STATEMENT</td><td>SESSION</td></tr><tr><td>jdbcTypeForNull</td><td>Specifies the JDBC type for null values when no specific JDBC type was provided for the parameter. Some drivers require specifying the column JDBC type but others work with generic values like NULL, VARCHAR or OTHER.</td><td>JdbcType enumeration. Most common are: NULL, VARCHAR and OTHER</td><td>OTHER</td></tr><tr><td>lazyLoadTriggerMethods</td><td>Specifies which Object&rsquo;s methods trigger a lazy load</td><td>A method name list separated by commas</td><td>equals,clone,hashCode,toString</td></tr><tr><td>defaultScriptingLanguage</td><td>Specifies the language used by default for dynamic SQL generation.</td><td>A type alias or fully qualified class name.</td><td>org.apache.ibatis.scripting.xmltags.XMLDynamicLanguageDriver</td></tr><tr><td>callSettersOnNulls</td><td>Specifies if setters or map&rsquo;s put method will be called when a retrieved value is null. It is useful when you rely on Map.keySet() or null value initialization. Note primitives such as (int,boolean,etc.) will not be set to null.</td><td>true / false</td><td>FALSE</td></tr><tr><td>logPrefix</td><td>Specifies the prefix string that MyBatis will add to the logger names.</td><td>Any String</td><td>Not set</td></tr><tr><td>logImpl</td><td>Specifies which logging implementation MyBatis should use. If this setting is not present logging implementation will be autodiscovered.</td><td>SLF4J / LOG4J / LOG4J2 / JDK_LOGGING / COMMONS_LOGGING / STDOUT_LOGGING / NO_LOGGING</td><td>Not set</td></tr><tr><td>proxyFactory</td><td>Specifies the proxy tool that MyBatis will use for creating lazy loading capable objects.</td><td>CGLIB / JAVASSIST</td><td>CGLIB</td></tr></tbody></table><ul><li><p>typeAliases : 타입 별칭을 통해 자바 타입에 대한 좀더 짧은 이름을 사용할 수 있다. 오직 XML 설정에서만 사용되며, 타이핑을 줄이기 위해 사용된다.</p></li><li><p>typeHandler : MyBatis 가 PreparedStatement 에 파라미터를 셋팅하고 ResultSet 에서 값을 가져올때마다, TypeHandler 는 적절한 자바 타입의 값을 가져오기 위해 사용된다. typeHandler 구현체를 등록하여 사용할 수 있다.</p></li><li><p>objectFactory : MyBatis 는 결과 객체의 인스턴스를 만들기 위해 ObjectFactory를 사용한다.</p></li><li><p>mappers: 매핑된 SQL 구문을 정의한다. 해당 매퍼 파일의 지정은 클래스패스에 상대적으로 리소스를 지정할 수도 있고, url 을 통해서 지정할 수 도 있다</p></li></ul><p>이외에도 plugins (매핑 구문을 실행하는 어떤 시점에 호출을 가로챈다. 기본적으로 MyBatis 는 메서드 호출을 가로채기 위한 플러그인을 허용한다), environments (여러개의 환경으로 설정), databaseIdProvider(데이터베이스 제품마다 다른 구문을 실행) 등의 설정을 통해 다양한 환경 및 시점에서 추가적인 설정이 가능하다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fe45f7e46b285ea79bc285f3f358415f>14 - Mapper XML Files</h1><div class=lead>MyBatis Mapper XML 파일은 SQL문을 정의하고, Parameter Object를 받아 SQL문을 실행하며, 그 결과를 Result Object에 자동으로 바인딩하는 기능을 제공한다. 이를 통해 SQL 실행과 데이터 매핑을 쉽게 처리할 수 있다.</div><h1 id=mapper-xml-file>Mapper XML File</h1><p>MyBatis Mapper XML (SQL Mapping XML) File은 실행할 SQL문을 정의해놓은 파일로서,<br>SQL문 실행을 위해 Parameter Object를 받아오거나 SQL문 실행 결과를 Result Object에 자동 바인딩하는 기능 등을 제공한다.</p><h2 id=mapper-xml-sql-mapping-xml>Mapper XML (SQL Mapping XML)</h2><p>Mapper XML File에는 다음과 같은 요소들을 사용할 수 있다.</p><ul><li><strong><code>&lt;select></code></strong>: 매핑된 SELECT 구문</li><li><strong><code>&lt;insert></code></strong>: 매핑된 INSERT 구문</li><li><strong><code>&lt;update></code></strong>: 매핑된 UPDATE 구문</li><li><strong><code>&lt;delete></code></strong>: 매핑된 DELETE 구문</li><li><strong><code>&lt;sql></code></strong>: 다른 구문에서 재사용하기 위한 SQL 조각</li><li><strong><code>&lt;resultMap></code></strong>: 데이터베이스 결과 데이터를 객체에 매핑하는 방법을 정의</li><li><strong><code>&lt;cache></code></strong>: 자신의 namespace를 위한 캐시설정</li><li><strong><code>&lt;cache-ref></code></strong>: 다른 namespace의 캐시설정을 참조</li></ul><h3 id=sample-configuration>Sample Configuration</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mapper</span> <span style=color:#c4a000>namespace=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.DeptMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> <span style=color:#8f5902;font-style:italic>&lt;!-- MyBatis에서는 namespace를 필수로 설정해야함 --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> <span style=color:#8f5902;font-style:italic>&lt;!-- [주의] iBatis의 class속성 -&gt; type속성으로 변경 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;int&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> <span style=color:#8f5902;font-style:italic>&lt;!-- [주의] iBatis의 parameterClass속성 -&gt; parameterType속성으로 변경 --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            select DEPT_NO, DEPT_NAME, LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            from DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            where DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        ]]&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            insert into DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                       (DEPT_NO, DEPT_NAME, LOC)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            values     (#{deptNo}, #{deptName}, #{loc})
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        ]]&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;update</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;updateDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            update DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            set    DEPT_NAME = #{deptName},
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                   LOC = #{loc}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            where  DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        ]]&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/update&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;delete</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deleteDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            delete from DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            where       DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        ]]&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/delete&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/mapper&gt;</span>
</span></span></code></pre></div><h3 id=select><code>&lt;select></code></h3><p><strong><code>&lt;select></code>는 SELECT문을 작성할 때 사용되는 요소</strong>로, 데이터베이스에서 조회한 결과를 오브젝트에 매핑하는 역할을 한다.</p><p>먼저 <code>&lt;select></code> 요소에서 사용 가능한 속성들에 대해 알아보고, 위 샘플코드에서 언급된 <code>&lt;select></code> 설정을 자세히 살펴보자.</p><ul><li>속성</li></ul><table><thead><tr><th>속성</th><th>설명</th></tr></thead><tbody><tr><td><code>id</code></td><td>해당 구문을 호출할 때 사용되는 값으로, 각 SQL문을 구분하는 유일한 식별자 (필수)</td></tr><tr><td><code>parameterType</code></td><td>해당 구문에 전달될 파라미터의 패키지 경로를 포함한 전체 클래스명이나 별칭</td></tr><tr><td><code>parameterMap</code></td><td><code>&lt;select></code> 외부에 정의된 Parameter Object(<code>&lt;parameterMap></code>)를 참조하는 방법, 권장하지 않음. <code>parameterType</code> 속성이나 Inline Parameter를 권장</td></tr><tr><td><code>resultType</code></td><td>해당 구문이 리턴하는 타입의 패키지 경로를 포함한 전체 클래스명이나 별칭</td></tr><tr><td><code>resultMap</code></td><td><code>&lt;select></code> 외부에 정의된 Result Object(<code>&lt;resultMap></code>)를 참조하는 방법</td></tr><tr><td><code>flushCache</code></td><td>이 속성값이 true이면, 구문이 호출될 때마다 캐시가 지원됨 (default: false)</td></tr><tr><td><code>useCache</code></td><td>이 속성값이 true이면, 구문의 결과가 캐시됨 (default: true)</td></tr><tr><td><code>timeout</code></td><td>예외가 던져지기 전에 데이터베이스의 요청 결과를 기다리는 최대 시간 (드라이버에 따라 다소 지원되지 않을 수 있음)</td></tr></tbody></table><ul><li>기본 예제</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;int&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        select DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>               DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>               LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        from DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where DEPT_NO = #{deptNo} &lt;!-- 파라미터 바인딩 표기법 #{property} --&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위의 <code>&lt;select></code> 구문은 &lsquo;selectDept&rsquo;를 이용하여 호출하며, &lsquo;int&rsquo; 타입의 파라미터를 받아와 WHERE절 조건식에 바인딩하고,<br>SELECT 결과를 &lsquo;deptResult&rsquo;라는 이름을 가진 <code>&lt;resultMap></code> 설정에 따라 오브젝트에 매핑하여 리턴한다.</p><p><code>&lt;resultMap id="deptResult" ... /></code> 형태로 <code>&lt;select></code> 외부에 정의되어 있다.</p><h2 id=insert-update-delete><code>&lt;insert>, &lt;update>, &lt;delete></code></h2><p><strong><code>&lt;insert></code>, <code>&lt;update></code>, <code>&lt;delete></code>는 각각 INSERT, UPDATE, DELETE문을 작성할 때 사용되는 요소</strong>로, 필요한 파라미터를 전달받아 데이터베이스의 데이터를 변경하는 역할을 한다.</p><p>먼저 <code>&lt;insert></code>, <code>&lt;update></code>, <code>&lt;delete></code> 요소에서 사용 가능한 속성들에 대해 알아보고, 위 샘플코드에서 언급된 설정을 각각 살펴보겠습니다.</p><h3 id=1-insert>1. <code>&lt;insert></code></h3><h4 id=속성>속성</h4><table><thead><tr><th>속성</th><th>설명</th></tr></thead><tbody><tr><td><code>id</code></td><td>해당 구문을 호출할 때 사용되는 값으로, 각 SQL문을 구분하는 유일한 식별자 (필수)</td></tr><tr><td><code>parameterType</code></td><td>해당 구문에 전달될 파라미터의 패키지 경로를 포함한 전체 클래스명이나 별칭</td></tr><tr><td><code>flushCache</code></td><td>이 속성값이 true이면, 구문이 호출될 때마다 캐시가 지원됨 (default: false)</td></tr><tr><td><code>timeout</code></td><td>예외가 던져지기 전에 데이터베이스의 요청 결과를 기다리는 최대 시간 (드라이버에 따라 다소 지원되지 않을 수 있음)</td></tr><tr><td><code>statementType</code></td><td>STATEMENT / PREPARED / CALLABLE 중 선택, MyBatis에게 Statement, PreparedStatement 또는 CallableStatement를 사용하게 함 (default: PREPARED)</td></tr><tr><td><code>useGeneratedKeys</code></td><td>DB 내부에서 생성한 키를 받는 JDBC <code>getGeneratedKeys</code> 메서드를 사용하도록 설정 (default: false)</td></tr><tr><td><code>keyProperty</code></td><td><code>getGeneratedKeys</code> 메서드나 INSERT 구문의 <code>selectKey</code> 하위 요소에 의해 리턴된 키를 셋팅할 프로퍼티를 지정</td></tr><tr><td><code>keyColumn</code></td><td>생성키를 가진 테이블의 칼럼명을 셋팅 (키 칼럼이 테이블의 첫번째 칼럼이 아닐 경우 필요)</td></tr></tbody></table><ul><li>기본 예제</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        insert into DEPT (DEPT_NO, DEPT_NAME, LOC)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        values (#{deptNo}, #{deptName}, #{loc}) &lt;!-- 파라미터 바인딩 표기법 #{property} --&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span></code></pre></div><p>위의 <code>&lt;insert></code> 구문은 &lsquo;insertDept&rsquo;를 이용하여 호출하며, &rsquo;egovframework.rte.psl.dataaccess.vo.DeptVO&rsquo; 타입의 파라미터를 받아와 INSERT 절에 바인딩한다.</p><h2 id=2-update>2. <code>&lt;update></code></h2><h3 id=속성-1>속성</h3><table><thead><tr><th>속성</th><th>설명</th></tr></thead><tbody><tr><td><code>id</code></td><td>해당 구문을 호출할 때 사용되는 값으로, 각 SQL문을 구분하는 유일한 식별자 (필수)</td></tr><tr><td><code>parameterType</code></td><td>해당 구문에 전달될 파라미터의 패키지 경로를 포함한 전체 클래스명이나 별칭</td></tr><tr><td><code>flushCache</code></td><td>이 속성값이 true이면, 구문이 호출될 때마다 캐시가 지원됨 (default: false)</td></tr><tr><td><code>timeout</code></td><td>예외가 던져지기 전에 데이터베이스의 요청 결과를 기다리는 최대 시간 (드라이버에 따라 다소 지원되지 않을 수 있음)</td></tr><tr><td><code>statementType</code></td><td>STATEMENT / PREPARED / CALLABLE 중 선택, MyBatis에게 Statement, PreparedStatement 또는 CallableStatement를 사용하게 함 (default: PREPARED)</td></tr></tbody></table><h3 id=기본-예제>기본 예제</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;update</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;updateDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        update DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        set    DEPT_NAME = #{deptName}, &lt;!-- 파라미터 바인딩 표기법 #{property} --&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>               LOC = #{loc}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where  DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/update&gt;</span>
</span></span></code></pre></div><p>위의 <update>구문은 &lsquo;updateDept&rsquo;를 이용하여 호출하며, &rsquo;egovframework.rte.psl.dataaccess.vo.DeptVO&rsquo; 타입의 파라미터를 받아와 UPDATE절에 바인딩한다.</p><h2 id=3-delete>3. <code>&lt;delete></code></h2><ul><li>속성</li></ul><table><thead><tr><th>속성</th><th>설명</th></tr></thead><tbody><tr><td><code>id</code></td><td>해당 구문을 호출할 때 사용되는 값으로, 각 SQL문을 구분하는 유일한 식별자 (필수)</td></tr><tr><td><code>parameterType</code></td><td>해당 구문에 전달될 파라미터의 패키지 경로를 포함한 전체 클래스명이나 별칭</td></tr><tr><td><code>flushCache</code></td><td>이 속성값이 true이면, 구문이 호출될 때마다 캐시가 지원됨 (default: false)</td></tr><tr><td><code>timeout</code></td><td>예외가 던져지기 전에 데이터베이스의 요청 결과를 기다리는 최대 시간 (드라이버에 따라 다소 지원되지 않을 수 있음)</td></tr><tr><td><code>statementType</code></td><td>STATEMENT / PREPARED / CALLABLE 중 선택, MyBatis에게 Statement, PreparedStatement 또는 CallableStatement를 사용하게 함 (default: PREPARED)</td></tr></tbody></table><ul><li>기본 예제</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;delete</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deleteDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        delete from DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where DEPT_NO = #{deptNo} -- 파라미터 바인딩 표기법 #{property}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/delete&gt;</span>
</span></span></code></pre></div><p>위의 <code>&lt;delete></code> 구문은 <code>deleteDept</code>를 이용하여 호출하며, <code>egovframework.rte.psl.dataaccess.vo.DeptVO</code> 타입의 파라미터를 받아와 WHERE절에 바인딩한다.</p><h3 id=참고>참고</h3><p>parameterType에 지정한 전체 클래스명이 복잡하다면, 해당 클래스타입에 대한 Alias(별칭)로 대체할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- In MyBatis Configuration XML File --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;typeAlias</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span> <span style=color:#c4a000>alias=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- Mapper XML File --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;delete</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deleteDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        delete from DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where DEPT_NO = #{deptNo} -- 파라미터 바인딩 표기법 #{property}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/delete&gt;</span>
</span></span></code></pre></div><h3 id=sql><code>&lt;sql></code></h3><p><strong><code>&lt;sql></code> 요소는 다른 구문에서 재사용 가능한 SQL구문을 정의</strong>할 때 사용한다.</p><p><include refid="<sql의 ID값>">설정을 통해 재사용할 수 있다.</p><ul><li>기본예제</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sql</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;userColumns&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> id, username, password <span style=color:#204a87;font-weight:700>&lt;/sql&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectUsers&#34;</span> <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;map&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        select &lt;include refid=&#34;userColumns&#34;/&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        from some_table
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where id = #{id}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><h2 id=parameters>Parameters</h2><p>예제 코드에서 파라미터를 전달하는 간단한 구문을 살펴보도록 하겠다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;insert</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;insertDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        insert into DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                   (DEPT_NO,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    DEPT_NAME,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    LOC)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        values     (#{deptNo},
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    #{deptName},
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    #{loc})
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/insert&gt;</span>
</span></span></code></pre></div><p>위에서 egovframework.rte.psl.dataaccess.vo.DeptVO 클래스 타입의 객체가 mapper 오브젝트를 통해 전달될 경우 해당 객체의 deptNo, deptName, loc를 찾아서 PreparedStatement 파라미터로 전달된다.</p><p>추가적으로 파라미터 전달 시 파라미터에 다음과 같은 형태로 데이터 타입을 명시할 수 있다:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>#</span><span style=color:#a40000>{</span><span style=color:#000>property</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>javaType</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>int</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jdbcType</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>NUMERIC</span><span style=color:#a40000>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=resultmap><code>&lt;resultMap></code></h3><p><strong><code>&lt;resultMap></code>는 SELECT 조회 결과값을 오브젝트에 매핑하기 위해 사용하는 요소</strong>로, ResultSet에서 데이터를 가져올 때 필요한 JDBC 코드를 대신한다.</p><ul><li>속성</li></ul><table><thead><tr><th><strong>속성</strong></th><th><strong>설명</strong></th></tr></thead><tbody><tr><td><strong>id</strong></td><td>Statement에서 resultMap을 참조하기 위한 유일한 식별자</td></tr><tr><td><strong>type</strong></td><td>구문이 리턴한 결과를 매핑할 오브젝트 타입의 패키지 경로를 포함한 전체 클래스명이나 별칭</td></tr></tbody></table><ul><li>기본예제</li></ul><pre tabindex=0><code>&lt;!-- 기본 예제 코드 --&gt;
&lt;resultMap id=&#34;deptResult&#34; type=&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;&gt;
    &lt;result property=&#34;deptNo&#34; column=&#34;DEPT_NO&#34; /&gt;
    &lt;result property=&#34;deptName&#34; column=&#34;DEPT_NAME&#34; /&gt;
    &lt;result property=&#34;loc&#34; column=&#34;LOC&#34; /&gt;
&lt;/resultMap&gt;

&lt;select id=&#34;selectDept&#34; parameterType=&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34; resultMap=&#34;deptResult&#34;&gt;
		&lt;![CDATA[
			select DEPT_NO,DEPT_NAME,LOC
			from   DEPT
			where  DEPT_NO = #{deptNo}
		]]&gt;
	&lt;/select&gt;
</code></pre><p>SELECT문 결과값은 <strong><code>&lt;select></code>에 지정한 <code>resultMap</code> 속성값에 따라 <code>&lt;resultMap id="deptResult"></code>에 매핑</strong>되어 리턴된다.</p><p>또는 다음과 같이 <code>&lt;select></code>에서 <strong><code>resultMap</code> 속성 대신 <code>resultType</code> 속성을 사용</strong>하여 결과값을 매핑할 클래스 타입을 지정할 수도 있다.</p><p>단, 아래와 같이 <code>resultType</code> 속성을 이용하는 경우에는 DB 컬럼명과 프로퍼티명이 동일해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span> <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.DeptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        select deptno, deptname, loc
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        from   DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where  deptno = #{deptno}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>위의 두 코드는 SELECT문의 칼럼명과 Result Object(DeptVO)의 프로퍼티명을 비교하여 일치하는 프로퍼티의 setter를 찾아 결과값을 매핑한다.</p><ul><li>DB 컬럼명과 프로퍼티명이 다를 경우</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 1) resultType 속성 사용 시 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            DEPT_NO     as &#34;deptNo&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            DEPT_NAME   as &#34;deptName&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            LOC         as &#34;loc&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        from DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 2) &lt;resultMap&gt; 사용 시 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span> <span style=color:#c4a000>type=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptNo&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NO&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;deptName&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;loc&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;LOC&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectDept&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;deptVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;deptResult&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        select DEPT_NO, DEPT_NAME, LOC
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        from   DEPT
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        where  DEPT_NO = #{deptNo}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    ]]&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>1)번의 경우, 컬럼 Alias를 이용하여 프로퍼티명과 일치시킨다.</p><p>2)번의 경우, <resultmap>의 하위 요소인 <result>을 이용하여 명시적으로 property명과 column명을 일치시킨다.</p><p>[참고] ResultSet 처리를 위해 hashmap 등으로 키 형태로 매핑하여 결과를 받아올 수 있지만, 좋지 않은 방법이므로 resultMap의 도메인 모델로는 자바빈이나 POJO를 사용한다.</p><h2 id=cache><code>&lt;cache></code></h2><p>MyBatis는 쉽게 설정 가능하고 변경 가능한 쿼리 캐싱 기능을 가지고 있다. MyBatis 3 캐시 구현체는 좀 더 쉽게 설정할 수 있도록 많은 부분이 수정되었다.</p><p>성능을 개선하고 순환하는 의존성을 해결하기 위해 필요한 로컬 세션 캐싱을 제외하고 기본적으로 캐시가 작동하지 않는다. 캐싱을 활성화하기 위해서, SQL 매핑 파일에 다음 한 줄을 추가하면 된다.</p><ul><li><code>&lt;cache/></code></li><li>디폴트 설정내용</li></ul><ol><li>매핑 파일 내의 모든 <code>&lt;select></code> 구문의 결과는 캐시된다.</li><li>매핑 파일 내의 모든 <code>&lt;insert></code>, <code>&lt;update></code>, <code>&lt;delete></code> 구문이 호출될 때 캐시가 플러시된다.</li></ol><p>이 외에 캐시 설정에 대해서는 MyBatis 매뉴얼을 참고하시길 바랍니다.</p><h3 id=cache-ref><code>&lt;cache-ref></code></h3><p>MyBatis 에서는 이전 섹션 내용을 돌이켜보면서, 특정 명명공간을 위한 캐시는 오직 하나만 사용되거나 같은 명명공간내에서는 구문마다 캐시를 지울수 있다.</p><p>명명공간간의 캐시 설정과 인스턴스를 공유하고자 할때가 있을 것이다.</p><p>이 경우 cache-ref 요소를 사용해서 다른 캐시를 참조할 수 있다.</p><ul><li><code>&lt;cache-ref namespace=”com.someone.application.data.SomeMapper” /></code></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-d233086ba0d691c7d9c53da8180a8660>15 - Mapper Dynamic SQL</h1><div class=lead>MyBatis는 다양한 조건에 따라 동적으로 SQL을 생성할 수 있는 강력한 동적 SQL 기능을 제공하며, OGNL 기반의 표현식을 통해 유연하고 편리하게 사용할 수 있다. 이는 iBatis보다 간단하고 직관적인 방식으로 동적 SQL 처리를 가능하게 한다.</div><h1 id=dynamic-sql>Dynamic SQL</h1><p>일반적으로 JDBC API를 사용한 코딩에서 다양한 조건에 따라 다양한 형태의 쿼리의 실행이 필요한 경우가 존재하며 이에 MyBatis는 강력한 동적 SQL 언어를 제공한다.</p><p>MyBatis는 SQL 문의 동적인 변경에 대해 iBatis보다 상대적으로 유연하다.<br>iBatis도 다양한 Dynamic 요소를 제공하였으나 이해해야 하는 요소들이 많았다.</p><p>MyBatis에서 제공하는 동적 SQL 요소들은 JSTL이나 XML 기반의 텍스트 프로세서와 유사한 형태로 제공되며 OGNL 기반의 표현식을 제공함으로써 보다 유연하고 편리하게 Dynamic 요소를 사용할 수 있다.</p><h2 id=기본-dynamic-요소-사용-방법>기본 Dynamic 요소 사용 방법</h2><h3 id=sample-dynamic-sql-mapper-xml>Sample Dynamic SQL mapper xml</h3><p>MyBatis에서 제공하는 Dynamic 요소의 기본적인 형태에 대해 알아보도록 한다.<br>아래 Sql 매퍼 파일은 파라미터 객체의 empNo 속성의 값 유무에 따라 <code>where EMP_NO = #{empNo}</code> 조건절을 동적으로 추가/제거할 수 있는 예이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicElement&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.JobHistVO&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.JobHistVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO     as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       START_DATE as startDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       END_DATE   as endDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB        as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL        as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM       as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NO    as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   JOBHIST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;where&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;empNo != null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				EMP_NO = #{empNo}				
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>		
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/where&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>where 요소는 태그에 의해 콘텐츠가 리턴되면 단순히 “WHERE” 만을 추가한다. 하지만 하위 요소의 조건이 하나라도 만족하지 않으면 추가되지 않는다.<br>또한 콘텐츠가 “AND” 나 “OR”로 시작한다면, 그 “AND” 나 “OR”를 지워버리는 점에 유념하여 사용하도록 한다.</p><h3 id=if>if</h3><p>if는 가장 많이 사용되는 Dynamic 요소로 문자열을 선택적으로 검색하는 기능을 제공한다.<br>where 절 안에 사용되며 if 안에 해당 값이 존재하지 않으면 모든 결과값이 리턴된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>        ..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmployerList&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span> <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				EMP_NO as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				EMP_NAME as empName,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				JOB as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				MGR as mgr,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				HIRE_DATE as hireDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				SAL as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				COMM as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				DEPT_NO as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;where&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;empNo != null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				EMP_NO = #{empNo}
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;empName != null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				EMP_NAME LIKE &#39;%&#39; || #{empName} || &#39;%&#39;
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/where&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><p>전달된 인자의 특정 property에 대해 if로 비교하는 경우가 가장 많이 사용된다.</p><h3 id=choose-when-otherwise>choose (when, otherwise)</h3><p>모든 조건을 적용하는 대신 한 가지 조건 만을 적용해야 할 필요가 있는 경우 MyBatis에서 제공하는 choose 요소를 사용하며 이는 자바의 switch 구문과 유사한 개념이다.</p><p>아래 예제를 보면 지금은 MGR 정보만으로 검색하고, EMP 정보가 있다면 그 값으로 검색된다.<br>두 가지 값을 모두 제공하지 않는다면 HIRE 상태인 Employee 정보가 리턴될 것이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmployeeList&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span> <span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		SELECT * FROM EMP WHERE JOB = &#39;Engineer&#39;
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;choose&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;when</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;mgr ! null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				AND MGR like #{mgr}
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/when&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;when</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;empNo ! null and empName ! =null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				AND EMP_NAME like #{empName}
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/when&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;otherwise&gt;</span>
</span></span><span style=display:flex><span>				AND HIRE_STATUS = &#39;Y&#39;
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/otherwise&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/choose&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id=trim-where-set>trim (where, set)</h3><p>아래 예제의 <code>&lt;trim prefix=“WHERE” prefixOverrides=“AND|OR”></code>은 <code>&lt;where></code>와 동일하게 동작한다. 즉, where 요소에 대한 trim 기능을 제공한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	..
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectEmployerList&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>resultType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.vo.EmpVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				EMP_NO as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				EMP_NAME as empName,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				JOB as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				MGR as mgr,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				HIRE_DATE as hireDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				SAL as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				COMM as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>				DEPT_NO as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from EMP
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;trim</span> <span style=color:#c4a000>prefix=</span><span style=color:#4e9a06>&#34;WHERE&#34;</span> <span style=color:#c4a000>prefixOverrides=</span><span style=color:#4e9a06>&#34;AND|OR &#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;empNo != null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				EMP_NO = #{empNo}
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;empName != null&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				EMP_NAME LIKE &#39;%&#39; || #{empName} || &#39;%&#39;
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/trim&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div><h3 id=foreach>foreach</h3><p>아래의 샘플 sql mapper xml 예를 참고하라. 일반적으로 iterate 태그 처리에 가장 많이 사용되는 in 조건절 처리 예이다.</p><p>foreach 요소는 매우 강력한 기능을 제공하는데 그중 하나가 collection을 명시하는 것을 허용하는 것이다.<br>foreach 요소에서는 item, index 두 가지 변수를 선언하며, 이 요소는 열고 닫는 문자열로 명시할 수 있고 반복 간에 둘 수 있는 구분자도 추가 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;selectJobHistListUsingDynamicNestedIterate&#34;</span> <span style=color:#c4a000>parameterType=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.util.EgovMap&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;jobHistVO&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#8f5902;font-style:italic>&lt;![CDATA[
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			select EMP_NO     as empNo,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       START_DATE as startDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       END_DATE   as endDate,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       JOB        as job,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       SAL        as sal,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       COMM       as comm,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			       DEPT_NO    as deptNo
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>			from   JOBHIST
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		]]&gt;</span>
</span></span><span style=display:flex><span>			where
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;foreach</span> <span style=color:#c4a000>collection=</span><span style=color:#4e9a06>&#34;condition&#34;</span> <span style=color:#c4a000>item=</span><span style=color:#4e9a06>&#34;item&#34;</span> <span style=color:#c4a000>open=</span><span style=color:#4e9a06>&#34;(&#34;</span> <span style=color:#c4a000>separator=</span><span style=color:#4e9a06>&#34;and&#34;</span> <span style=color:#c4a000>close=</span><span style=color:#4e9a06>&#34;)&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				${item.columnName} ${item.columnOperation} 
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;item.nested == &#39;true&#39;&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;foreach</span> <span style=color:#c4a000>item=</span><span style=color:#4e9a06>&#34;item&#34;</span> <span style=color:#c4a000>index=</span><span style=color:#4e9a06>&#34;index&#34;</span> <span style=color:#c4a000>collection=</span><span style=color:#4e9a06>&#34;item.columnValue&#34;</span> <span style=color:#c4a000>open=</span><span style=color:#4e9a06>&#34;(&#34;</span> <span style=color:#c4a000>separator=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#c4a000>close=</span><span style=color:#4e9a06>&#34;)&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					      &#39;${item}&#39;
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;/foreach&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;if</span> <span style=color:#c4a000>test=</span><span style=color:#4e9a06>&#34;item.nested != &#39;true&#39;&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					#{item.columnValue}
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/if&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/foreach&gt;</span>		
</span></span><span style=display:flex><span>			order by EMP_NO, START_DATE
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-189b1937088aa7587b87d5c96ecac5ea>16 - MyBatis 적용 가이드</h1><div class=lead>전자정부 표준프레임워크 기반 MyBatis 적용 가이드이다.</div><h1 id=mybatis-적용-가이드>MyBatis 적용 가이드</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크 기반 MyBatis 적용 가이드이다.</p><p>📁 <a href="https://www.egovframe.go.kr/wiki/lib/exe/fetch.php?media=egovframework:rte2:psl:dataaccess:ex-dataaccess-mybatis.zip">ex-dataaccess-mybatis.zip</a></p><h2 id=step-1-pomxml-변경>Step 1. pom.xml 변경</h2><p>표준프레임워크 dataaccess artifact version을 다음과 같이 2.7.0으로 변경한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 실행환경 라이브러리 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>egovframework.rte<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>egovframework.rte.psl.dataaccess<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;version&gt;</span>2.7.0<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id=step-2-환경-설정>Step 2. 환경 설정</h2><h3 id=step-21-xml-설정>Step 2.1 XML 설정</h3><p>Spring XML 설정 파일 상(ex: context-mapper.xml)에 다음과 같은 sqlSession bean을 추가한다.</p><p>Ex) context-mapper.xml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- SqlSession setup for MyBatis Database Layer --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlSession&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.mybatis.spring.SqlSessionFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;mapperLocations&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/sqlmap/mappers/**/*.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=step-22-mapper-xml-작성>Step 2.2 mapper xml 작성</h3><p>MyBatis 가이드에 따라 query xml을 작성한다. (2.1의 예제 상 지정된 mapperLocations 위치)</p><h2 id=step-3-dao-작성>Step 3. DAO 작성</h2><p>DAO의 경우는 다음과 같이 3가지 방식이 가능하다.</p><table><thead><tr><th>방식</th><th>설명</th><th>비고</th></tr></thead><tbody><tr><td>기존 DAO 클래스 방식</td><td>@Repository 지정 및 EgovAbstractMapper extends 활용</td><td>기존 iBatis와 같은 방식</td></tr><tr><td>Mapper interface 방식</td><td>Mapper 인터페이스 작성 및 @Mapper annotation 지정</td><td>@Mapper는 marker annotation(표준프레임워크 제공)</td></tr><tr><td>Annotation 방식</td><td>query xml 없이 mapper 인터페이스 상 @Select, @Insert 등을 활용</td><td>Dynamic SQL 등의 사용에 제약이 있음</td></tr></tbody></table><h3 id=31-기존-dao-형태로-사용하는-경우>3.1 기존 DAO 형태로 사용하는 경우</h3><p>@Repository 지정된 class에 EgovAbstractMapper를 extends 하여 insert, update, delete, selectByPk, list 메서드를 활용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Repository</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deptMapper&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>DeptMapper</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>EgovAbstractMapper</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>insertDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>updateDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>deleteDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>DeptVO</span> <span style=color:#000>selectDept</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>selectByPk</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>DeptVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectDeptList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>DeptVO</span> <span style=color:#000>searchVO</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>list</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>queryId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>searchVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=32-mapper-interface-사용-방식>3.2 Mapper interface 사용 방식</h3><p>Mapper 인터페이스 작성 시 다음과 같이 @Mapper annotation을 사용한다.</p><p>(패키지를 포함하는 클래스명 부분이 mapper xml 상의 namespace로 선택되고 인터페이스 메서드가 query id로 호출되는 방식)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Mapper</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;employerMapper&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>EmployerMapper</span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>EmpVO</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectEmployerList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EmpVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EmpVO</span> <span style=color:#000>selectEmployer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>insertEmployer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EmpVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>updateEmployer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EmpVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>deleteEmployer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>empNo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>이 경우는 xml 설정상에 다음과 같은 MapperConfigurer 설정이 필요하다.</p><p>Ex: context-mapper.xml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.dataaccess.mapper.MapperConfigurer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;basePackage&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.rte.**.mapper&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>basePackage에 지정된 패키지 안에서 @Mapper annotation을 스캔하는 설정이다.</p><p>⇒ @Mapper로 지정된 인터페이스를 @Service에서 injection 하여 사용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EmployerMapperTest</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;employerMapper&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>EmployerMapper</span> <span style=color:#000>employerMapper</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testInsert</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EmpVO</span> <span style=color:#000>vo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeVO</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>employerMapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insertEmployer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// select
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>EmpVO</span> <span style=color:#000>resultVO</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>employerMapper</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>selectEmployer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmpNo</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// check
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#000>checkResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>resultVO</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=33-annotation-사용-방식>3.3 Annotation 사용 방식</h3><p>mapper xml 작성 없이 Mapper 인터페이스 상에 @Select, @Insert, @Update, @Delete 등의 annotation을 통해 query가 지정되어 사용된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Mapper</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;departmentMapper&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>DepartmentMapper</span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Select</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select DEPT_NO as deptNo, DEPT_NAME as deptName, LOC as loc from DEPT where DEPT_NO = #{deptNo}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>DeptVO</span> <span style=color:#000>selectDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;insert into DEPT(DEPT_NO, DEPT_NAME, LOC) values (#{deptNo}, #{deptName}, #{loc})&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>insertDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;update DEPT set DEPT_NAME = #{deptName}, LOC = #{loc} WHERE DEPT_NO = #{deptNo}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>updateDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptVO</span> <span style=color:#000>vo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;delete from DEPT WHERE DEPT_NO = #{deptNo}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>deleteDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BigDecimal</span> <span style=color:#000>deptNo</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>⇒ 이 경우는 별도의 mapper xml을 만들 필요는 없지만, dynamic query를 사용하지 못하는 등의 제약사항이 따른다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-11609d1e6bd3df169129f7edb67885a9>17 - Spring Data</h1><div class=lead>Spring Data는 관계형 및 비관계형 데이터베이스, map-reduce 프레임워크, 클라우드 기반 데이터 서비스 등 다양한 데이터 액세스 기술을 쉽게 사용할 수 있도록 지원하는 오픈 소스 프로젝트이다. 이를 통해 새로운 데이터 기술뿐만 아니라 관계형 데이터베이스에 대한 향상된 지원도 제공한다.</div><h1 id=spring-data>Spring Data</h1><p>Spring Data는 데이터베이스 관련 많은 하위 프로젝트를 포함하는 오픈 소스 프로젝트로, non-relational databases, map-reduce frameworks, and cloud based data services 등의 새로운 데이터 액세스 기술을 보다 쉽게 사용 할 수 있는 기능을 제공한다. 또한 관계형 데이터베이스 기술에 대한 향상된 지원도 제공한다.</p><h3 id=spring-data-project>Spring Data Project</h3><table><thead><tr><th>Category</th><th>Sub-Project</th><th>Description</th></tr></thead><tbody><tr><td>Relational Databases</td><td>JPA</td><td>Spring Data JPA - Simplifies the development of creating a JPA-based data access layer</td></tr><tr><td></td><td>JDBC Extensions</td><td>Support for Oracle RAC, Advanced Queuing, and Advanced datatypes. Support for using QueryDSL with JdbcTemplate.</td></tr><tr><td>Big Data</td><td>Apache Hadoop</td><td>The Apache Hadoop project is an open-source implementation of frameworks for reliable, scalable, distributed computing and data \storage.</td></tr><tr><td>Data-Grid</td><td>GemFire</td><td>VMware vFabric GemFire is a distributed data management platform providing dynamic scalability, high performance, and database-like \persistence. It blends advanced techniques like replication, partitioning, data-aware routing, and continuous querying.</td></tr><tr><td>HTTP</td><td>REST</td><td>Spring Data REST - Perform CRUD operations of your persistence model using HTTP and Spring Data Repositories.</td></tr><tr><td>Key Value Stores</td><td>Redis</td><td>Redis is an open source, advanced key-value store.</td></tr><tr><td>Document Stores</td><td>MongoDB</td><td>MongoDB is a scalable, high-performance, open source, document-oriented database.</td></tr><tr><td>Graph Databases</td><td>Neo4j</td><td>Neo4j is a graph database, a fully transactional database that stores data structured as graphs.</td></tr><tr><td>Column Stores</td><td>HBase</td><td>Apache HBase is an open-source, distributed, versioned, column-oriented store modeled after Google&rsquo; Bigtable. HBase functionality is part of the Spring for Apache Hadoop project.</td></tr><tr><td>Common Infrastructure</td><td>Commons</td><td>Provides shared infrastructure for use across various data access projects. General support for cross-database persistence is located here</td></tr></tbody></table><h2 id=참고자료>참고자료</h2><ul><li><a href=http://projects.spring.io/spring-data>http://projects.spring.io/spring-data</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b207d213a0a6f6f402a4e71513881924>18 - Spring Data Repository</h1><div class=lead>Spring Data는 Repository를 추상화하여 Data Access Layer 구현을 최소화하고, 메소드명만으로 쿼리를 자동 생성하는 Query Method를 지원해 개발 생산성을 높인다. CrudRepository는 기본적인 CRUD 메소드를, PagingAndSortingRepository는 페이징 및 정렬 기능을 제공한다.</div><h1 id=repository>Repository</h1><h2 id=설명>설명</h2><p>일반적으로 Data Access Layer를 구현하기 위해서는 상당량의 코드를 작성해야 한다. Spring Data에서는 Repository를 추상화하여 다양한 저장소에 접근하기 위한 Data Access Layer 구현 코드를 최소화함으로써 개발생산성을 높일 수 있도록 한다. 이는 Query Method를 통해 가능한데 Query Method란 메소드명만 가지고 쿼리를 만들 수 있다는 것이다. 특정 규칙에 맞게 메소드를 작성하면 개발자가 따로 Data Access 클래스를 만들지 않아도 Spring Data가 대신하여 해당 Database와 자동으로 매핑하여 결과를 가져다준다.</p><p>Repository 인터페이스를 상속받아 CRUD 관련 메소드들을 제공하는 CrudRepository 인터페이스와 Paging 처리 기능이 제공되는 PagingAndSortingRepository 인터페이스를 살펴보도록 하겠다.</p><h2 id=user-guide>User Guide</h2><h3 id=crud-기능-제공-인터페이스>CRUD 기능 제공 인터페이스</h3><p>Spring Data 리파지토리 추상화의 핵심 인터페이스는 바로 Repository이다. Repository는 일종의 마커 인터페이스로 클래스 타입과 ID 타입을 이용해서 작성할 수 있으며 Repository 인터페이스의 하위 인터페이스로 CRUD 기능을 제공하는 CrudRepository가 있다.
다음은 CrudRepository 코드이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>CrudRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ID</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Serializable</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Repository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ID</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>S</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>S</span> <span style=color:#000>save</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>S</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);........................</span><span style=color:#a40000>❶</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>T</span> <span style=color:#000>findOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ID</span> <span style=color:#000>primaryKey</span><span style=color:#ce5c00;font-weight:700>);..............................</span><span style=color:#a40000>❷</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Iterable</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findAll</span><span style=color:#ce5c00;font-weight:700>();.................................</span><span style=color:#a40000>❸</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Long</span> <span style=color:#000>count</span><span style=color:#ce5c00;font-weight:700>();..........................................</span><span style=color:#a40000>❹</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);.................................</span><span style=color:#a40000>❺</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>exists</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ID</span> <span style=color:#000>primaryKey</span><span style=color:#ce5c00;font-weight:700>);.........................</span><span style=color:#a40000>❻</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>❶ 전달받은 엔터티를 저장한다.</p><p>❷ 전달된 ID로 식별한 엔터티를 리턴한다.</p><p>❸ 모든 엔터티를 리턴한다.</p><p>❹ 엔터티의 갯수를 리턴한다.</p><p>❺ 전달받은 엔터티를 삭제한다.</p><p>❻ 전달된 ID에 해당하는 엔터티의 존재여부를 리턴한다.</p><h3 id=crud-기능-제공-인터페이스-1>CRUD 기능 제공 인터페이스</h3><p>Spring Data에서는 CrudRepository 이외에도 페이징 처리 기능을 제공하는 PagingAndSortingRespository라는 인터페이스를 제공하며 이 인터페이스는 CrudRepository를 상속받고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>PagingAndSortingRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ID</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Serializable</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>CrudRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>ID</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Iterable</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Sort</span> <span style=color:#000>sort</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Pageable</span> <span style=color:#000>pageable</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p><b>PagingAndSortingRepository</b> 인터페이스를 사용하여 2번째 페이지에서 20건의 데이터를 가져오는 예제이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>PagingAndSortingRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>repository</span> <span style=color:#ce5c00;font-weight:700>=</span> 
</span></span><span style=display:flex><span><span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>repository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>PageRequest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-data/data-jpa/docs/current/reference/html/>http://static.springsource.org/spring-data/data-jpa/docs/current/reference/html/</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f286d06cdc87230486623dd1dfce6c5e>19 - Query Method</h1><div class=lead>JPA 모듈은 문자열로 쿼리를 정의하거나 메서드에서 파생되어진 쿼리를 사용하는 방법을 지원한다.</div><h1 id=query-method>Query Method</h1><h2 id=설명>설명</h2><h2 id=user-guide>User Guide</h2><h3 id=query-method-1>Query Method</h3><p>JPA 모듈은 문자열로 쿼리를 정의하거나 메서드에서 파생되어진 쿼리를 사용하는 방법을 지원한다.</p><h4 id=쿼리생성>쿼리생성</h4><p>스트링으로 쿼리를 정의하는 예시 :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>UserRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>Repository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findByEmailAddressAndLastname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>emailAddress</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span> <span style=color:#000>lastname</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>JPA표준 API는 위의 스트링으로 정의된 쿼리를 다음 쿼리로 변경한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>u</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>User</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>u</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>u</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>emailAddress</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>and</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>u</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>lastname</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=지원하는-메서드-명>지원하는 메서드 명</h4><table><thead><tr><th>Keyword</th><th>Sample</th><th>JPQL snippet</th></tr></thead><tbody><tr><td><code>And</code></td><td>findByLastnameAndFirstname</td><td>… where x.lastname = ?1 and x.firstname = ?2</td></tr><tr><td><code>Or</code></td><td>findByLastnameOrFirstname</td><td>… where x.lastname = ?1 or x.firstname = ?2</td></tr><tr><td><code>Between</code></td><td>findByStartDateBetween</td><td>… where x.startDate between 1? and ?2</td></tr><tr><td><code>LessThan</code></td><td>findByAgeLessThan</td><td>… where x.age &lt; ?1</td></tr><tr><td><code>GreaterThan</code></td><td>findByAgeGreaterThan</td><td>… where x.age > ?1</td></tr><tr><td><code>After</code></td><td>findByStartDateAfter</td><td>… where x.startDate > ?1</td></tr><tr><td><code>Before</code></td><td>findByStartDateBefore</td><td>… where x.startDate &lt; ?1</td></tr><tr><td><code>IsNull</code></td><td>findByAgeIsNull</td><td>… where x.age is null</td></tr><tr><td><code>IsNotNull,NotNull</code></td><td>findByAge(Is)NotNull</td><td>… where x.age not null</td></tr><tr><td><code>Like</code></td><td>findByFirstnameLike</td><td>… where x.firstname like ?1</td></tr><tr><td><code>NotLike</code></td><td>findByFirstnameNotLike</td><td>… where x.firstname not like ?1</td></tr><tr><td><code>StartingWith</code></td><td>findByFirstnameStartingWith</td><td>… where x.firstname like ?1 (parameter bound with appended %)</td></tr><tr><td><code>EndingWith</code></td><td>findByFirstnameEndingWith</td><td>… where x.firstname like ?1 (parameter bound with prepended %)</td></tr><tr><td><code>Containing</code></td><td>findByFirstnameContaining</td><td>… where x.firstname like ?1 (parameter bound wrapped in %)</td></tr><tr><td><code>OrderBy</code></td><td>findByAgeOrderByLastnameDesc</td><td>… where x.age = ?1 order by x.lastname desc</td></tr><tr><td><code>Not</code></td><td>findByLastnameNot</td><td>… where x.lastname &lt;> ?1</td></tr><tr><td><code>In</code></td><td>findByAgeIn(Collection<age> ages)</td><td>… where x.age in ?1</td></tr><tr><td><code>NotIn</code></td><td>findByAgeNotIn(Collection<age> age)</td><td>… where x.age not in ?1</td></tr><tr><td><code>True</code></td><td>findByActiveTrue()</td><td>… where x.active = true</td></tr><tr><td><code>False</code></td><td>findByActiveFalse()</td><td>… where x.active = false</td></tr></tbody></table><h3 id=using-query>Using @Query</h3><p>Using named queries to declare queries for entities is a valid approach and works fine for a small number of queries. As the queries themselves are tied to the Java method that executes them you actually can bind them directly using the Spring Data JPA @Query annotation rather than annotating them to the domain class. This will free the domain class from persistence specific information and co-locate the query to the repository interface.</p><p>쿼리메서드에 정의된 쿼리들은 xml에 선언된 @NamedQuery나 named queries보다 우선하여 처리됩니다.</p><p>@Query를 이용한 쿼리 선언 예제 :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>UserRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>JpaRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select u from User u where u.emailAddress = ?1&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>User</span> <span style=color:#000>findByEmailAddress</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>emailAddress</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=파라미터를-활용한-query>파라미터를 활용한 @Query</h4><p>By default Spring Data JPA will use position based parameter binding as described in all the samples above. This makes query methods a little error prone to refactoring regarding the parameter position. To solve this issue you can use @Param annotation to give a method parameter a concrete name and bind the name in the query: 기본적으로 스프링 데이터 JPA는 위의 모든 샘플에 설명 된대로 파라미터가 바인딩 된 바인딩 위치 기반 매개 변수를 사용합니다.</p><p>파라미터를 이용한 쿼리 선언 예제 :</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>UserRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>JpaRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;select u from User u where u.firstname = :firstname or u.lastname = :lastname&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>User</span> <span style=color:#000>findByLastnameOrFirstname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@Param</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;lastname&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>String</span> <span style=color:#000>lastname</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#5c35cc;font-weight:700>@Param</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;firstname&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>String</span> <span style=color:#000>firstname</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-data/data-jpa/docs/current/reference/html/jpa.repositories.html>http://static.springsource.org/spring-data/data-jpa/docs/current/reference/html/jpa.repositories.html</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5a66a59a43ca1f67154af011561e3276>20 -</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-caaedd7111ee911b289122f959e225fe>21 - MongoDB support</h1><div class=lead>Spring Data MongoDB는 MongoDB를 위한 Data Access 기능을 제공하는 하위 프로젝트로, MongoTemplate을 통한 효율적인 데이터 처리와 Annotation 기반 매핑, Java 기반의 Query 및 Criteria DSL을 지원한다. 또한, Spring의 데이터 액세스 예외 계층 구조 변환 기능과 Spring Data Repository 인터페이스 통합을 제공한다. 이를 통해 MongoDB와의 데이터 접근을 보다 쉽게 구현할 수 있다.</div><h1 id=mongodb-support-351>MongoDB support 3.5.1</h1><h2 id=설명>설명</h2><p>Spring Data MongoDB는 Spring Data의 하위 프로젝트로서 document-oriented storage를 지원하는 MongoDB에 대한 Data Access 기능을 제공한다.</p><h3 id=mongodb-support-주요-기능>MongoDB support 주요 기능</h3><ul><li>Spring configuration 지원 (@Configuration, XML namespace)</li><li>기본 처리를 효율적으로 지원하는 MongoTemplate helper 제공</li><li>Spring이 제공하는 Data Access Exception hierarchy 변환 기능 제공</li><li>Spring의 Conversion Service와 통합된 Feature Rich Object Mapping 기능</li><li>Annotation 기반 매핑 metadata</li><li>Java 기반 Query, Criteria, Update DSLs</li><li>Spring Data의 Repository 인페이스 지원</li><li>QueryDSL 등</li></ul><h2 id=1-시작하기>1. 시작하기</h2><p>Spring Data MongoDB를 사용하기 위해서는 다음과 같은 dependency 추가가 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;groupId&gt;</span>org.springframework.data<span style=color:#204a87;font-weight:700>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;artifactId&gt;</span>spring-data-mongodb<span style=color:#204a87;font-weight:700>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;version&gt;</span>1.7.2.RELEASE<span style=color:#204a87;font-weight:700>&lt;/version&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/dependency&gt;</span>
</span></span></code></pre></div><h2 id=2-spring-관련-설정>2. Spring 관련 설정</h2><h3 id=mongo-mongo-client-mongotemplate-생성>Mongo mongo-client, mongoTemplate 생성</h3><p>Spring 기반에서는 다음과 같이 Mongo에 대한 인스턴스 생성이 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;beans</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/beans&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xmlns:xsi=</span><span style=color:#4e9a06>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xmlns:context=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/context&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xmlns:mongo=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/data/mongo&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xsi:schemaLocation=</span>
</span></span><span style=display:flex><span>               <span style=color:#4e9a06>&#34;http://www.springframework.org/schema/context
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          http://www.springframework.org/schema/context/spring-context-4.0.xsd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          http://www.springframework.org/schema/data/mongo
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          http://www.springframework.org/schema/data/mongo/spring-mongo.xsd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          http://www.springframework.org/schema/beans
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          http://www.springframework.org/schema/beans/spring-beans-4.0.xsd&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;!-- Default bean name is &#39;mongo&#39; --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;mongo:mongo-client</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>host=</span><span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>port=</span><span style=color:#4e9a06>&#34;27017&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>credentials=</span><span style=color:#4e9a06>&#34;id:password@database&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/mongo:mongo-client&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/beans&gt;</span>
</span></span></code></pre></div><p>추가적으로 MongoDB가 replica 방식으로 굿어된 경우는 다음과 같이 replica-set 설정을 지정하면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mongo:mongo</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;replicaSetMongo&#34;</span> <span style=color:#c4a000>replica-set=</span><span style=color:#4e9a06>&#34;127.0.0.1:27017,localhost:27018&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h3 id=mongodbfactory-생성>MongoDBFactory 생성</h3><p>다음으로 Mongo 인스턴스와 연결을 위한 MongoDBFactory이 필요한데, XML 기반의 설정에서는 다음과 같이 지정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- Default bean name is &#39;mongoDbFactory&#39; --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mongo:db-factory</span> <span style=color:#c4a000>dbname=</span><span style=color:#4e9a06>&#34;database&#34;</span> <span style=color:#c4a000>mongo-ref=</span><span style=color:#4e9a06>&#34;mongo&#34;</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongoDbFactory&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h3 id=mongotemplate-생성>MongoTemplate 생성</h3><p>실제 mongoDB에 대한 처리(operations)를 위하여 MongoTemplate을 생성한다.</p><p>MontoTemplate의 다은과 같은 생성자를 통해 생성될 수 있다.</p><ul><li>MongoTemplate(Mongo mongo, String databaseName)</li><li>MongoTemplate(Mongo mongo, String databaseName, UserCredentials userCredentials) : 사용자 접속 정보 추가</li><li>MongoTemplate(MongoDbFactory mongoDbFactory) : MogoDbFactory(com.mongodb.Mongo object, database name 및 접속 계정 포함)를 통한 연결</li><li>MongoTemplate(MongoDbFactory mongoDbFactory, MongoConverter mongoConverter) : 매핑을 위한 MongoConverter 사용</li></ul><p>XML 설정일 경우는 다음과 같이 생성할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mongo:mongo-client</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>host=</span><span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>port=</span><span style=color:#4e9a06>&#34;27017&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>credentials=</span><span style=color:#4e9a06>&#34;id:password@database&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/mongo:mongo-client&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongoTemplate&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.data.mongodb.core.MongoTemplate&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;mongo&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;databaseName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;geospatial&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>MongoDbFactory를 사용하는 경우 다음과 같이 지정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- Default bean name is &#39;mongo&#39; --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mongo:mongo-client</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>host=</span><span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>port=</span><span style=color:#4e9a06>&#34;27017&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>credentials=</span><span style=color:#4e9a06>&#34;id:password@xxx&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongo&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/mongo:mongo-client&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- for Replica Sets --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- mongo:mongo id=&#34;replicaSetMongo&#34; replica-set=&#34;127.0.0.1:27017,127.0.0.1:27018&#34; /--&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- Default bean name is &#39;mongoDbFactory&#39; --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;mongo:db-factory</span> <span style=color:#c4a000>dbname=</span><span style=color:#4e9a06>&#34;database&#34;</span> <span style=color:#c4a000>mongo-ref=</span><span style=color:#4e9a06>&#34;mongo&#34;</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongoDbFactory&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongoTemplate&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.data.mongodb.core.MongoTemplate&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;mongoDbFactory&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;mongoDbFactory&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=기본-처리>기본 처리</h3><p>MongoTemplate는 저장, 수정, 삭제 및 object 매팽 등의 기본 기능을 제공한다.</p><p>다음은 Person 객체에 대한 간단한 기본 예제이다.</p><h4 id=person-클래스>Person 클래스</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Person</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>age</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getId</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getName</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getAge</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>age</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>toString</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;Person [id=&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;, name=&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;, age=&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>age</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;]&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=test-클래스>Test 클래스</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;mongoTemplate&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span>  <span style=color:#000>MongoTemplate</span> <span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testBasicOperations</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>Person</span> <span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Joe&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>34</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Insert
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Insert : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Find
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>where</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>is</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Joe&#34;</span><span style=color:#ce5c00;font-weight:700>)),</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Found: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Joe&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Update
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateFirst</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>where</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>is</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Joe&#34;</span><span style=color:#ce5c00;font-weight:700>)),</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;age&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>35</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>    
</span></span><span style=display:flex><span>	<span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>where</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>is</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Joe&#34;</span><span style=color:#ce5c00;font-weight:700>)),</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Updated: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>35</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getAge</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Delete
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#8f5902;font-style:italic>// Check that deletion worked
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span>  <span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>	<span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Number of people = : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>people</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>	<span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>people</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>dropCollection</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;person&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>※ 내부적으로 MongoConverter에 의해 String과 ObjectId에 대해서는 자동 변환 처리됨</p><h3 id=_id-필드-처리>_id 필드 처리</h3><p>MongoDB는 모든 문서에 대하여 &lsquo;_id&rsquo; 필드를 가져야 한다. 그렇지 않은 경우 내부적으로 자동생성되는 ObjectId로 처리된다.
그러나 MongoMappingConverter가 사용되면 다음과 같은 규칙에 의해 &lsquo;_id&rsquo; 필드에 대한 매핑을 처리한다.</p><ul><li>@Id(org.springframework.data.annotation.Id)가 지정된 property가 &lsquo;_id&rsquo;에 매핑된다.</li><li>id라는 이름의 property는 &lsquo;_id&rsquo;로 매핑된다. (위 Person 예제의 경우 이에 해당)</li></ul><h3 id=문서-저장-처리save-insert>문서 저장 처리(save, insert)</h3><p>MongoTemplate에는 객체를 저장하기 위한 몇 개의 메소드를 제공한다.
가장 간단한 경우가 POJO를 저장하는 것이다. 이 경우 collection 이름은 클래스명(not fully qualifed)이 사용되면, 저장 메소스 호출 시 지정될 수도 있다.</p><p>다음은 저장 처리 메소드에 대한 정리이다.</p><ul><li>void save(Object objectToSave) : 기본 collection에 저장</li><li>void save(Object objectToSave, String collectionName) : 지정된 collection에 저장</li><li>void insert(Object objectToSave) : 기본 collection에 등록</li><li>void insert(Object objectToSave, String collectionName) : 지정된 collection에 등록</li></ul><p>※ MongoTemplate은 저장을 위해 save와 insert를 제공하는데, save의 경우는 기존 등록된 문서가 없는 경우 insert로 처리되며 존재하는 경우 덮어쓰기를 한다.</p><p>insert의 경우 기존 id가 존재하면 오류를 발생한다.</p><h3 id=문서-수정-처리update>문서 수정 처리(update)</h3><p>문서 수정 처리를 위해서는 첫번째 문서만을 수정하는 updateFirst 메소드와 모든 문서를 수정하는 updateMulti로 구성된다.</p><p>다음은 계정이 저축계좌(SAVINGS)인 모든 계좌에 50원을 추가하는 예제이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>import static</span> <span style=color:#000>org.springframework.data.mongodb.core.query.Criteria.where</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import static</span> <span style=color:#000>org.springframework.data.mongodb.core.query.Query</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import static</span> <span style=color:#000>org.springframework.data.mongodb.core.query.Update</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>WriteResult</span> <span style=color:#000>wr</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>mongoTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateMulti</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>where</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;accounts.accountType&#34;</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>is</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Account</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Type</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>SAVINGS</span><span style=color:#ce5c00;font-weight:700>)),</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Update</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>inc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;accounts.$.balance&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>50</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>00</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>            <span style=color:#000>Account</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h4 id=update-class-저장-메소드>Update class 저장 메소드</h4><ul><li>Update addToSet (String key, Object value) Update using the $addToSet update modifier</li><li>Update inc (String key, Number inc) Update using the $inc update modifier</li><li>Update pop (String key, Update.Position pos) Update using the $pop update modifier</li><li>Update pull (String key, Object value) Update using the $pull update modifier</li><li>Update pullAll (String key, Object[] values) Update using the $pullAll update modifier</li><li>Update push (String key, Object value) Update using the $push update modifier</li><li>Update pushAll (String key, Object[] values) Update using the $pushAll update modifier</li><li>Update rename (String oldName, String newName) Update using the $rename update modifier</li><li>Update set (String key, Object value) Update using the $set update modifier</li><li>Update unset (String key) Update using the $unset update modifier</li></ul><h2 id=참고자료>참고자료</h2><p>MongoDB에 대한 기본 처리는 <a href=http://docs.mongodb.org/manual/>MongoDB Manual</a>을 참조하고, Spring과의 연동 부분에 대한 세부적인 처리는 Spring Data MongoDB에 대한 <a href=http://docs.spring.io/spring-data/data-mongo/docs/1.5.2.RELEASE/reference/html/mongo.core.html>Reference</a>를 참조한다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f9c74007eee02f02d8d76bb3bf93b68c>22 - MongoDB Repositories</h1><div class=lead>Spring Data MongoDB는 Spring Data의 repository 추상화 인터페이스를 지원하며, 자세한 내용은 Spring Data JPA 가이드의 Repository 섹션을 참조 한다.</div><h1 id=mongodb-repositories-351>MongoDB Repositories 3.5.1</h1><h2 id=설명>설명</h2><p>Spring Data MongoDB도 Spring Data repository 추상화 인터페이스를 지원한다. 이에 대한 내용은 Spring Data JPA 가이드 중 <a href=./jpa-repository.md>Repository</a> 부분을 참조한다.</p><h2 id=1-시작하기>1. 시작하기</h2><p>MongoDB에 대한 repository를 사용하기 위해서는 다음과 같은 mongo schem의 repositories 설정이 필요하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;beans</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/beans&#34;</span> <span style=color:#c4a000>xmlns:xsi=</span><span style=color:#4e9a06>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xmlns:mongo=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/data/mongo&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#c4a000>xsi:schemaLocation=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>		http://www.springframework.org/schema/data/mongo http://www.springframework.org/schema/data/mongo/spring-mongo.xsd&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;mongo:mongo-client</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>host=</span><span style=color:#4e9a06>&#34;localhost&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>port=</span><span style=color:#4e9a06>&#34;27017&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#c4a000>credentials=</span><span style=color:#4e9a06>&#34;id:password@database&#34;</span>  <span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/mongo:mongo-client&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;mongo:db-factory</span> <span style=color:#c4a000>dbname=</span><span style=color:#4e9a06>&#34;database&#34;</span> <span style=color:#c4a000>mongo-ref=</span><span style=color:#4e9a06>&#34;mongo&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mongoTemplate&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.data.mongodb.core.MongoTemplate&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;constructor-arg</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;mongoDbFactory&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;mongoDbFactory&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>&lt;!-- for Repository --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;mongo:repositories</span> <span style=color:#c4a000>base-package=</span><span style=color:#4e9a06>&#34;egovframework.rte.psl.data.mongodb.repository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/beans&gt;</span>
</span></span></code></pre></div><h3 id=domain-object-생성>Domain Object 생성</h3><p>일반적인 POJO를 통해 MongoDB에 문서를 저장한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Person</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>id</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>firstname</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>lastname</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Address</span> <span style=color:#000>address</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>double</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>location</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// getters/setters
</span></span></span></code></pre></div><h3 id=기본-repository-interface>기본 repository interface</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>PersonRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>MongoRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// additional custom finder methods go here
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=paging-처리>Paging 처리</h3><p>MongoRepository interface는 기본적으로 PagingAndSortingRepository를 extends하기 때문에 다음과 같은 기본 페이징 처리를 지원한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Autowired</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>PersonRepository</span> <span style=color:#000>repository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>readsFirstPageCorrectly</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>persons</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>repository</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>PageRequest</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>LOGGER</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Persons Total elements : &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>persons</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTotalElements</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>persons</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>isFirst</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=2-query-methods>2. Query methods</h2><p>Repository는 Spring Data에서 제공되는 keyword 기반의 query method를 사용할 수 있다.</p><p>ex:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>PersonRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>MongoRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findByLastname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>lastname</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Page</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findByFirstname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>firstname</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Pageable</span> <span style=color:#000>pageable</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Person</span> <span style=color:#000>findByShippingAddresses</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Address</span> <span style=color:#000>address</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>지원되는 keyword는 다음과 같다.</p><table><thead><tr><th>Keyword</th><th>Sample</th><th>Logic result</th></tr></thead><tbody><tr><td>GreaterThan</td><td>findByAgeGreaterThan(int age)</td><td>{“age” : {“$gt” : age}}</td></tr><tr><td>GreaterThanEqual</td><td>findByAgeGreaterThanEqual(int age)</td><td>{“age” : {“$gte” : age}}</td></tr><tr><td>LessThan</td><td>findByAgeLessThan(int age)</td><td>{“age” : {“$lt” : age}}</td></tr><tr><td>LessThanEqual</td><td>findByAgeLessThanEqual(int age)</td><td>{“age” : {“$lte” : age}}</td></tr><tr><td>Between</td><td>findByAgeBetween(int from, int to)</td><td>{“age” : {“$gt” : from, “$lt” : to}}</td></tr><tr><td>In</td><td>findByAgeIn(Collection ages)</td><td>{“age” : {“$in” : [ages…]}}</td></tr><tr><td>NotIn</td><td>findByAgeNotIn(Collection ages)</td><td>“age” : {“$nin” : [ages…]}}</td></tr><tr><td>IsNotNull, NotNull</td><td>findByFirstnameNotNull()</td><td>{“age” : {“$ne” : null}}</td></tr><tr><td>IsNull, Null</td><td>findByFirstnameNull()</td><td>{“age” : null}</td></tr><tr><td>Like</td><td>findByFirstnameLike(String name)</td><td>{“age” : age} ( age as regex)</td></tr><tr><td>Regex</td><td>findByFirstnameRegex(String firstname)</td><td>{“firstname” : {“$regex” : firstname }}</td></tr><tr><td>(No keyword)</td><td>findByFirstname(String name)</td><td>{“age” : name}</td></tr><tr><td>Not</td><td>findByFirstnameNot(String name)</td><td>{“age” : {“$ne” : name}}</td></tr><tr><td>Near</td><td>findByLocationNear(Point point)</td><td>{“location” : {“$near” : [x,y]}}</td></tr><tr><td>Within</td><td>findByLocationWithin(Circle circle)</td><td>{“location” : {“$within” : {“$center” : [ [x, y], distance]}}}</td></tr><tr><td>Within</td><td>findByLocationWithin(Box box)</td><td>{“location” : {“$within” : {“$box” : [ [x1, y1], x2, y2]}}}</td></tr><tr><td>IsTrue, True</td><td>findByActiveIsTrue()</td><td>{“active” : true}</td></tr><tr><td>IsFalse, False</td><td>findByActiveIsFalse()</td><td>{“active” : false}</td></tr><tr><td>Exists</td><td>findByLocationExists(boolean exists)</td><td>{“location” : {“$exists” : exists }}</td></tr></tbody></table><h2 id=3-repository-delete-queries>3. Repository delete queries</h2><p>위의 keyword를 delete..By 또는 remove..By 형태로 사용하는 경우 삭제 처리가 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>PersonRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>MongoRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>List</span> <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>deleteByLastname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>lastname</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Long</span> <span style=color:#000>deletePersonByLastname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>lastname</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=4-geo-spatial-repository-queries>4. Geo-spatial repository queries</h2><p>Near keyword를 사용하는 경우 geo-spatial 처리와 관련된 query도 처리 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>PersonRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>MongoRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// { &#39;location&#39; : { &#39;$near&#39; : [point.x, point.y], &#39;$maxDistance&#39; : distance}}
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findByLocationNear</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Point</span> <span style=color:#000>location</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Distance</span> <span style=color:#000>distance</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=5-mongodb-json-based-query-methods>5. MongoDB JSON based query methods</h2><p>org.springframework.data.mongodb.repository.Query anntation을 사용할 경우 JSON query 방식을 통해 직접 query를 지정할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>interface</span> <span style=color:#000>PersonRepository</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>MongoRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Query</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;{ &#39;firstname&#39; : ?0 }&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findByThePersonsFirstname</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>firstname</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9af2e60bb419e6a09feeb9f67531ff01>23 - ORM 서비스</h1><div class=lead>ORM 서비스는 객체 모델링과 관계형 데이터 모델링의 불일치를 해결하기 위해 JPA와 Hibernate를 사용하며, DBMS 변경 시에도 설정 정보만 수정하면 코드 변경 없이 동작이 가능하다. Lazy Loading과 Cache 활용으로 성능을 향상시키며, Entity Class에 최소한의 Annotation을 사용해 매핑을 정의한다. SQL 처리 방식에 익숙한 개발자는 추가 학습이 필요할 수 있다.</div><h1 id=orm-서비스>ORM 서비스</h1><h2 id=개요>개요</h2><p>객체 모델링(Object Oriented Modeling)과 관계형 데이터 모델링(Relational Data Modeling) 사이의 불일치를 해결해 주는 OR Mapping 서비스로 자바 표준인 JPA를 표준 서비스로 제시하고 구현체로는 JPA 구현체중에 가장 성능이 우수한 것으로 알려진 Hibernate를 이용하였다. 서비스의 특징을 살펴보면 다음과 같다.</p><ul><li>특정 DBMS에 영향을 받지 않으므로 DBMS가 변경되더라도 데이터 액세스 처리 코드에 대한 변경없이 설정 정보의 변경만으로도 동작 가능하다.</li><li>SQL을 작성하고 <acronym title="Structured Query Language">SQL</acronym> 실행 결과로부터 전달하고자 하는 객체로 변경하는 코드를 작성하는 시간이 줄어든다. 하지만 필요시 <a href=orm-native_sql.md>SQL 작업</a>도 가능하다.</li><li>기본적으로 필요 시점에만 DBMS에 접근하는 Lazy Loading 전략 채택하고 <a href=orm-cache_handling.md>Cache활용</a>을 통해 DBMS에 대한 접근 횟수를 줄여나가 어플리케이션의 성능 향상을 도모한다.</li><li>별도의 <acronym title="Extensible Markup Language">XML</acronym> 파일로 매핑을 관리하지 않고 <a href=./orm-entities.md>Entity Class</a>에 최소한의 Annotation으로 정의하므로써 작업이 용이하다.</li><li>Entity Class가 일반 클래스로 정의됨으로써 상속이나 다양성, 캡슐화 같은 것들을 그대로 적용하면서 퍼시스턴스 오브젝트로 사용할 수 있다.</li><li>자바 표준이므로 많은 벤더들에서 구현체를 지원하고 개발을 편리하게 할 수 있는 <a href=https://projects.eclipse.org/projects/webtools.dali>JPA툴(Dali)</a>을 지원한다.</li><li>SQL을 이용하여 처리하는 방식에 익숙한 개발자가 사용하려면 학습이 필요하고 이에 따른 장벽이 존재한다.</li></ul><h2 id=설명>설명</h2><h3 id=주요-개념>주요 개념</h3><img src=../images/conceptua_architecture.jpg align=left><p>옆의 그림에서 보는것과 같이 DBMS 기반의 어플리케이션 수행을 하기 위해 필요한 주요 구성 요소는 Entity, Persistence.xml 이며, 각각은 다음과 같은 역할을 수행한다.</p><ul><li><a href=orm-entities.md>Entity</a>: 어플리케이션 실행 여부와 상관없이 물리적으로 존재하는 데이터들을 다룬다. 일반적으로 DBMS 데이터를 이용하는 어플리케이션을 개발할 경우 어플리케이션의 비즈니스 레이어에서 특정 DBMS에 맞는 SQL을 통해 어플리케이션의 데이터를 처리하게 된다. 그러나 JPA 기반의 어플리케이션에서는 Entity를 중심으로 하여 어플리케이션의 데이터와 DBMS 연동이 가능해진다. annotation 기반으로 매핑관련 사항도 Entity 클래스에서 정의할 수 있어서 별도의 파일없이 테이블과의 관계를 표현할 수 있다.</li><li><a href=orm-jpa_configuration.md>Persistence.xml</a>: 구현체에 대한 선언 및 대상 엔티티 클래스 지정 구현체별 프로퍼티 지정등을 할 수 있는 설정 파일로 JPA를 이용해서 어플리케이션을 구동할 경우 필수적으로 작성을 해야하는 파일이다.</li><li><a href=https://hibernate.org/>JPA(Hibernate)</a> : JPA 구현체로의 Hibernate의 요소는 Hibernate Core , Hibernate Annotations , Hibernate EntityManager 로 되어 있으며 JPA 구성에 필요한 Entity Manager등 구현 클래스를 포함하고 있다.</li><li>JPA Tool : JPA 지원툴이 Eclipse Web Tools Platform내에 서브프로젝트로 Dali JPA Tools 가 있다. 이 툴을 활용함으로써 DB에 생성된 테이블로부터 Entity 클래스 생성등 손이 많이 가는 작업을 자동으로 처리할 수 있다. 자세한 정보는 <a href=https://projects.eclipse.org/projects/webtools.dali>Dali Homepage</a>를 참조한다.</li></ul><h3 id=시작하기>시작하기</h3><p>ORM 서비스에 대한 자세한 설명에 앞서 간단하게 ORM 서비스를 시작하는데 필요한 것에 대한 설명을 하고자 한다.</p><h4 id=step1-사전-준비>Step1. 사전 준비</h4><h5 id=필요-library>필요 <strong>Library</strong></h5><p>본 서비스를 활용하기 위해서 필요한 Library 목록과 설명은 아래와 같다.</p><table><thead><tr><th>라이브러리</th><th>설명</th><th>연관 라이브러리</th></tr></thead><tbody><tr><td>antlr-2.7.7.jar</td><td>파서 라이브러리</td><td></td></tr><tr><td>commons-collections-3.2.jar</td><td>collection 처리를 위한 라이브러리</td><td></td></tr><tr><td>commons-dbcp-1.2.2.jar</td><td>DataSource 커넥션 풀 라이브러리</td><td></td></tr><tr><td>commons-logging-1.1.1.jar</td><td>Logging 처리를 위한 라이브러리</td><td>hibernate-annotations-3.4.0.GA.jar에서 참조</td></tr><tr><td>log4j-1.3alpha-8.jar</td><td>Logging 처리를 위한 라이브러리</td><td></td></tr><tr><td>slf4j-api-1.5.3.jar</td><td>Logging 처리를 위한 라이브러리</td><td></td></tr><tr><td>slf4j-log4j12-1.5.3.jar</td><td>Logging 처리를 위한 라이브러리</td><td></td></tr><tr><td>commons-pool-1.3.jar</td><td>pooling 처리를 위한 라이브러리</td><td>commons-dbcp-1.2.2.jar에서 참조</td></tr><tr><td>dom4j-1.6.1.jar</td><td>XML 파싱 라이브러리</td><td>hibernate-3.2.4.ga.jar 에서 참조</td></tr><tr><td>ejb3-persistence-1.0.2.GA.jar</td><td>JPA Interface 클래스 라이브러리</td><td></td></tr><tr><td>hibernate-annotations-3.4.0.GA.jar</td><td>Hibernate Annotation</td><td></td></tr><tr><td>hibernate-entitymanager-3.4.0.GA.jar</td><td>Hibernate Entity Manager 구현체 라이브러리</td><td></td></tr><tr><td>hibernate-commons-annotations-3.1.0.GA.jar</td><td>Hibernate 공통 annotation 라이브러리</td><td>hibernate-entitymanager-3.4.0.GA.jar에서 참조</td></tr><tr><td>hibernate-core-3.3.0.SP1.jar</td><td>Hiberante Core 라이브러리</td><td>hibernate-entitymanager-3.4.0.GA.jar에서 참조</td></tr><tr><td>javassist-3.4.GA.jar</td><td>자바 bytecode 조작 라이브러리</td><td>hibernate-entitymanager-3.4.0.GA.jar에서 참조</td></tr><tr><td>jta-1.1.jar</td><td>JTA 인터페이스 라이브러리</td><td>hibernate-entitymanager-3.4.0.GA.jar에서 참조</td></tr><tr><td>hsqldb-1.8.0.10.jar</td><td>HSQL JDBC 드라이버</td><td></td></tr><tr><td>mysql-connector-java-5.1.6.jar</td><td>MYSQL JDBC 드라이버</td><td></td></tr><tr><td>ojdbc-14.jar</td><td>ORACLE JDBC 드라이버</td><td></td></tr><tr><td>junit-4.4.jar</td><td>테스트 지원 라이브러리</td><td></td></tr></tbody></table><h4 id=step2-entity-클래스-생성>Step2. Entity 클래스 생성</h4><p>간단한 형태의 Entity 클래스를 생성한다. 네개의 Attribute로 구성되어 있고 각각의 getter,setter 메소드로 구성되어 있다.</p><h5 id=entity-클래스>Entity 클래스</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Date</span> <span style=color:#000>createDate</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>BigDecimal</span> <span style=color:#000>empCount</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getDeptId</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setDeptId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>deptId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>	   
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>@Entity : Department 가 Entity 클래스임을 정의</li><li>@Id : Primary Key 정보 지정</li></ul><h4 id=step3-persistencexml-생성>Step3. persistence.xml 생성</h4><p>위에서 정의한 Entity 클래스를 가지고 JPA 수행하기 위한 프로퍼티 파일로 구현체제공 클래스정보,엔티티클래스정보,DB접속 정보,로깅정보,테이블자동생성정보를 포함하고 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>persistence</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>unit</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;PersistUnit&#34;</span> <span style=color:#000>transaction</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;RESOURCE_LOCAL&#34;</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>provider</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>hibernate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>ejb</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>HibernatePersistence</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>provider</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>class</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000>egovframework</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Department</span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>class</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>exclude</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>unlisted</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>classes</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>properties</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.connection.driver_class&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;org.hsqldb.jdbcDriver&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.connection.url&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;jdbc:hsqldb:mem:testdb&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.connection.username&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;sa&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.dialect&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;org.hibernate.dialect.HSQLDialect&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.connection.autocommit&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.show_sql&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.format_sql&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>property</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;hibernate.hbm2ddl.auto&#34;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;create&#34;</span><span style=color:#ce5c00;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>properties</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>&lt;/</span><span style=color:#000>persistence</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#000>unit</span><span style=color:#ce5c00;font-weight:700>&gt;</span>
</span></span></code></pre></div><ul><li>provider : 구현체 클래스 지정</li><li>class : 엔티티 클래스명 정의</li><li>exclude-unlisted-classes : 위에서 지정하지 않은 클래스는 엔티티라고 정의되어 있어도 제외</li><li>hibernate.connection.* : DB 연결정보로 각자 환경에 맞추어 변경 가능</li><li>hibernate.dialect : DBMS별 Hibernate 사용을 위한 클래스 ( 각 DBMS별로 별도로 정의됨 )</li><li>hibernate.connection.autocommit : 자동 커밋여부 설정 false로 했으므로 명시적인 commit 가 필요함</li><li>hibernate.show_sql : 로그에 SQL 포함</li><li>hibernate.format_sql : <acronym title="Structured Query Language">SQL</acronym>을 포맷에 맞추어 출력</li><li>hibernate.hbm2ddl.auto : DDL 자동 생성 , Entity로 정의된 클래스에 대해서 자동으로 테이블 생성함</li></ul><h4 id=step4-테스트-클래스-생성>Step4. 테스트 클래스 생성</h4><p>위에서 정의한 Department를 이용하여 입력,수정,조회,삭제 처리를 하는 것을 JUNIT형태로 구성하였다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>String</span> <span style=color:#000>modifyName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Marketing Department&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>String</span> <span style=color:#000>deptId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT-0001&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>makeDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// Entity Manager 생성
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>emf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Persistence</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createEntityManagerFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;PersistUnit&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>emf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createEntityManager</span><span style=color:#ce5c00;font-weight:700>();</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 입력
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>begin</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>commit</span><span style=color:#ce5c00;font-weight:700>();</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>begin</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>departmentAfterInsert</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>deptId</span> <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 입력 확인
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Department Name Compare!&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#000>departmentAfterInsert</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 수정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>departmentAfterInsert</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>modifyName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>departmentAfterInsert</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>commit</span><span style=color:#ce5c00;font-weight:700>();</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>begin</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>departmentAfterUpdate</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>deptId</span> <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 수정 확인
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Department Modify Name Compare!&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>modifyName</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>departmentAfterUpdate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 삭제
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>departmentAfterUpdate</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>commit</span><span style=color:#ce5c00;font-weight:700>();</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 삭제 확인
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>Department</span> <span style=color:#000>departmentAfterDelete</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>deptId</span> <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>assertNull</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Department is Deleted!&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>departmentAfterDelete</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>close</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><ul><li>Persistence.createEntityManagerFactory : Entity Manager Factory 생성하기</li><li>emf.createEntityManager : Entity Manager 생성</li><li>em.getTransaction().begin() : Transaction 시작</li><li>em.getTransaction().commit(): Commit 처리</li><li>em.persist : Insert 처리</li><li>em.find : SELECT 처리</li><li>em.merge : UPDATE 처리</li><li>em.remove : DELETE 처리</li><li>assertEquals : 값이 같은지 비교하는 것 (JUnit 메소드)</li><li>assertNull : NULL 인지 확인하는 것 (JUnit 메소드)</li></ul><h4 id=step5-실행>Step5. 실행</h4><ol><li><a href="https://www.egovframe.go.kr/wiki/lib/exe/fetch.php?media=egovframework:rte:ormsimpleguide.zip">ormsimpleguide.zip</a> 파일을 다운로드 받아서 압축을 푼다.</li><li>이클립스에서 압축 푼 폴더를 선택하여 프로젝트를 Import 한다.</li><li>프로젝트내 src 폴더에 Department.java, DepartmentTest.java, resources 폴더에 META-INF/persistence.xml, log4j.xml 가 정상적으로 있는지 확인한다.</li><li>lib에 라이브러리 파일이 있는지 확인한다.</li><li>DepartmentTest.java를 선택하여 마우스 오른쪽 클릭하여 Run As > JUnit Test 실행한다.</li><li>JUnit 결과창에서 정상적으로 수행된 것을 확인한다.
※ ORACLE 이나 MySQL의 경우는 첨부되는 persistence.xml 의 주석을 참고하여 설정하고 수행하면 정상적으로 수행되는 것을 확인할 수 있다.</li></ol><h3 id=상세-설명>상세 설명</h3><ol><li><a href=./orm-entities.md>Entities</a></li><li><a href=./orm-entity_operation.md>Entity Operation</a></li><li><a href=./orm-association_mapping.md>Association Mapping</a></li><li><a href=./orm-query_language.md>Query Language</a></li><li><a href=./orm-native_sql.md>Native SQL</a></li><li><a href=./orm-concurrency.md>Concurrency</a></li><li><a href=./orm-cache_handling.md>Cache Handling</a></li><li><a href=./orm-fetch_strategy./md>Fetch Strategy</a></li><li><a href=./orm-spring_integration.md>Spring Integration</a></li><li><a href=./orm-jpa_configuration.md>JPA Configuration</a></li></ol><h2 id=예제>예제</h2><p><a href=../../runtime-example/individual-example/persistence-layer/orm-example.md>ORM 예제</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-476bcaf52f3100270c9cab5ee0a05356>24 - Entities</h1><div class=lead>ORM 서비스를 구성하는 가장 기초적인 클래스로 어플리케이션에서 다루고자 하는 테이블에 대응하여 구성할 수 있으며 테이블이 포함하는 컬럼에 대응한 속성들을 가지고 있다.</div><h1 id=entities>Entities</h1><p>ORM 서비스를 구성하는 가장 기초적인 클래스로 어플리케이션에서 다루고자 하는 테이블에 대응하여 구성할 수 있으며 테이블이 포함하는 컬럼에 대응한 속성들을 가지고 있다.</p><h2 id=기본-필요-요건>기본 필요 요건</h2><p>Entity를 구성하기 위한 아래와 같은 요건이 있다.(JPA요건)</p><h3 id=필수-entity-annotation-선언-필요--혹은-xml-설정파일에-정의->[필수] Entity annotation 선언 필요 ( 혹은 XML 설정파일에 정의 )</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=필수-argument-없는-생성자-필요>[필수] Argument 없는 생성자 필요</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>(){</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=필수-최상위레벨-클래스로-생성되어야-하고-enuminterface로-정의될-수-없음>[필수] 최상위레벨 클래스로 생성되어야 하고 enum,interface로 정의될 수 없음</h3><h3 id=필수-final-클래스로-선언될-수-없음>[필수] final 클래스로 선언될 수 없음</h3><h3 id=필수-primary-key-있어야-함--id라는-annotation-표기>[필수] Primary Key 있어야 함 : @Id라는 Annotation 표기</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span></code></pre></div><h3 id=권장-serializable-인터페이스-구현>[권장] Serializable 인터페이스 구현</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8077677670915867738L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=권장-속성-정보-접근을-위한-getter-setter-정의>[권장] 속성 정보 접근을 위한 getter, setter 정의</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getUserName</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setUserName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>userName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=주요-annotations>주요 Annotations</h2><p>Entity를 구성하는 주요한 Annotation은 다음과 같다.</p><h3 id=entity>@Entity</h3><p>해당 클래스가 Entity 클래스임을 표시하는 것으로 클래스 선언문 위에 기재한다. 테이블명과 Entity명이 다를 때에는 name에 해당 테이블명을 기재한다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;USER_TB&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=id>@Id</h3><p>해당 Attribute가 Key임을 표시하는 것으로 Attribute 위에 기재한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span></code></pre></div><h3 id=column>@Column</h3><p>해당 Attribute와 매핑되는 컬럼정보를 입력하기 위한 것으로 Attribue위에 기재한다. 컬럼명과 Attribute명이 일치할 경우는 기재하지 않아도 됨</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT_NAME&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>30</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span></code></pre></div><h3 id=onetoone-onetomany-manytoone-manytomany>@OneToOne, @OneToMany, @ManyToOne, @ManyToMany</h3><p>테이블간 관계를 구성하기 위한 것으로 정의되는 Attribute위에 기재한다. 각각은 1:1,1:N,N:1,N;N의 관계를 표현함. 이에 대한 자세한 설명은 <a href=./orm-association_mapping.md>association_mapping</a> 참고</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ManyToMany</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h3 id=transient>@Transient</h3><p>테이블의 컬럼과 매핑되지 않고 쓰이는 Attribute를 정의하고자 할때 Attribute위에 기재한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Transient</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>roleName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span></code></pre></div><h2 id=entity-status>Entity Status</h2><ul><li>New(transient) : 단순히 Entity 객체가 초기화되어 있는 상태를 말한다.</li><li>Managed(persistent) : Entity Manager에 의해 Entity가 관리되는 상태를 말한다.</li><li>Detached : Entity 객체가 더 이상 Persistance Context와 연관이 없는 상태이다.</li><li>Removed : Managed 되어 있는 Entity 객체가 삭제된 상태이다.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fc3aaef6e1ed1ca361fad2fc6909769b>25 - Entity Operation</h1><div class=lead>ORM서비스를 이용하여 특정 DB에 데이터를 입력, 수정, 조회, 삭제, 배치입력하는 방법에 대해 알아보도록 한다.</div><h1 id=entity-operation>Entity Operation</h1><p>ORM서비스를 이용하여 특정 DB에 데이터를 입력, 수정, 조회, 삭제, 배치입력하는 방법에 대해 알아보도록 한다.</p><h2 id=입력>입력</h2><p>EntityManager의 persist()메소드를 호출하여 DB에 단건의 데이터를 추가할 수 있다. persist() 메소드 호출시 대상이 되는 Entity를 입력 인자로 전달해야 한다.</p><h3 id=sample-source>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>addDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. insert a new Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>String</span> <span style=color:#000>DepartmentId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT-0001&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DepartmentId</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SaleDept&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDesc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;판매부서&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 EntityManager의 persist() 메소드에 department라는 Entity를 입력인자로 전달하여 처리하였다.</p><h2 id=수정>수정</h2><p>수정을 하고자 할때는 두가지 방법으로 가능한데 우선 EntityManager의 merge()메소드를 호출하여 DB에 단건의 데이터를 수정할 수 있고, 특정 객체가 Persistent 상태이고, 동일한 트랜잭션 내에서 해당 객체의 속성 값에 변경이 발생한 경우 merge() 메소드를 직접적으로 호출하지 않아도 트랜잭션 종료 시점에 변경 여부가 체크되어 변경 사항이 DB에 반영된다.</p><h3 id=merge-호출-sample-source>merge 호출 Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testUpdateDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. insert a new Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addDepartment</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. update a Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Purchase Dept&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 3. 명시적인 메소드 호출
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 EntityManager의 merge() 메소드에 department라는 Entity를 입력인자로 전달하여 처리하였다.</p><h3 id=merge-호출없는-sample-source>merge 호출없는 Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testUpdateDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. insert a new Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addDepartment</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. update a Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Purchase Dept&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// commit. successful update!!!
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 setDeptName()을 통해서 변경하고 Commit 처리시 변경된다.</p><h2 id=조회>조회</h2><p>EntityManager의 find()메소드를 호출하여 DB에서 원하는 한건의 데이터를 조회할 수 있다. find() 메소드 호출시 대상이 되는 Entity의 Id를 입력 인자로 전달해야 한다.</p><h3 id=sample-source-1>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>assertDepartmentInfo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>departmentId</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>result</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>departmentId</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>//...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 EntityManager의 find() 메소드에 departmentId라는 Entity Id를 입력인자로 전달하여 처리하였다.</p><h2 id=삭제>삭제</h2><p>EntityManager의 remove()메소드를 호출하여 DB에서 원하는 한건의 데이터를 조회할 수 있다. remove() 메소드 호출시 대상이 되는 Entity를 입력 인자로 전달해야 한다.</p><h3 id=sample-source-2>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDeleteDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. insert a new Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addDepartment</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. delete a Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 EntityManager의 remove() 메소드에 department라는 Entity를 입력인자로 전달하여 처리하였다. 그러나 주의할 점은 위의 예에서는 department 객체는 DB에 등록처리한 객체와 동일 객체이기에 그대로 remove를 쓸 수 있지만 키만 동일하게 신규로 객체를 만든경우에는 remove를 바로 쓸수 없다. 그럴 경우에는 아래와 같은 방법으로 처리해야 한다.</p><h3 id=sample-source-3>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testDeleteDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT_1&#34;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. delete a Department information
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getReference</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptId</span><span style=color:#ce5c00;font-weight:700>()));</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예에서는 getReference 메소드를 호출하여 Entity의 Id에 해당하는 객체 정보를 추출하여 그정보를 입력인자로 해서 remove를 호출하였다.</p><h2 id=배치입력>배치입력</h2><p>EntityManager의 persist()메소드를 호출하여 DB에 입력하고 loop를 통해 반복적으로 수행한다. OutOfMemoryException 방지를 위해서 일정한 term을 두고 flush(),clear()을 호출하여 메모리에 있는 사항을 삭제한다.</p><h3 id=sample-source-4>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testMultiSave</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>900</span> <span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#000>String</span> <span style=color:#000>DeptId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT-000&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>DeptId</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Sale&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDesc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;판매부&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>logger</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>debug</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;=== DEPT-000&#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34; ===&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// OutOfMemoryException 피하기 위해서
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>%</span> <span style=color:#0000cf;font-weight:700>9</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>flush</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>         <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>clear</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>     <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=callback-methods>Callback Methods</h2><p>엔티티 클래스에 정의하거나 EntityListener를 지정하여 콜백함수를 정의하여 실제 엔티티 Operation 직전 직후에 비지니스 로직 체크등의 로직을 별도 분리하여 처리하도록 지원한다.</p><h3 id=callback-methods-1>Callback Methods</h3><table><thead><tr><th>메소드명</th><th>설 명</th><th>관련 Operation</th></tr></thead><tbody><tr><td>PrePersist</td><td>Persist이전 시점에 수행</td><td><a href=#%EC%9E%85%EB%A0%A5>persist</a></td></tr><tr><td>PostPersist</td><td>Persist이후 시점에 수행</td><td><a href=#%EC%9E%85%EB%A0%A5>persist</a></td></tr><tr><td>PreRemove</td><td>Remove이전 시점에 수행</td><td><a href=#%EC%82%AD%EC%A0%9C>remove</a></td></tr><tr><td>PostRemove</td><td>Remove이후 시점에 수행</td><td><a href=#%EC%82%AD%EC%A0%9C>remove</a></td></tr><tr><td>PreUpdate</td><td>Update이전 시점에 수행</td><td><a href=#%EC%88%98%EC%A0%95>merge</a></td></tr><tr><td>PostUpdate</td><td>Update이후 시점에 수행</td><td><a href=#%EC%88%98%EC%A0%95>merge</a></td></tr><tr><td>PostLoad</td><td>Find 이후 시점에 수행</td><td><a href=#%EC%A1%B0%ED%9A%8C>find</a></td></tr></tbody></table><h3 id=entity에-직접-정의>Entity에 직접 정의</h3><p>콜백 함수를 Entity 클래스에 직접 Annotation을 기재하여 Method를 정의할 수 있다.</p><h4 id=define-source---entity-클래스에-정의>Define Source - Entity 클래스에 정의</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@PrePersist</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@PreUpdate</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>protected</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>validateCreate</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getSalary</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#0000cf;font-weight:700>2000000</span> <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Insufficient Salary !&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 Persist, Update 이전 시점에 Salary가 2,000,000 이하가 되는지 여부를 체크를 하도록 한다. Update의 경우는 EntityManager의 merge()를 이용하여 하는 것과 ql을 이용하여 Update 수행하는 것 모두에 해당한다.</p><h4 id=sample-source---merge-이용-케이스>Sample Source - merge() 이용 케이스</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testUpdateFailUser</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>User</span> <span style=color:#000>getUser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getUser</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getSalary</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>sal</span> <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setSalary</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1000000</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. Update User , 위의 merge() 호출이 아닌 Transaction 종료시 Update수행됨. 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>catch</span><span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#000>Exception</span> <span style=color:#000>e</span> <span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>      <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to PreUpdate.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 salary가 2000000 이하로 설정되어 Update될 경우 Exception 이 발생하는 것을 알 수 있다.</p><h4 id=sample-source---ql을-통한-update-케이스>Sample Source - ql을 통한 Update 케이스</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testUpdateFail2User</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>User</span> <span style=color:#000>getUser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>ql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;UPDATE User user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SET user.salary = :salary &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE user.userId = :userId &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;salary&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1000000</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;userId&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>getUser</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserId</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. Update User , 위의 merge() 호출이 아닌 Transaction 종료시 Update수행됨. 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>try</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>catch</span><span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#000>Exception</span> <span style=color:#000>e</span> <span style=color:#ce5c00;font-weight:700>){</span>
</span></span><span style=display:flex><span>      <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to PreUpdate.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>Exception</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 salary가 2000000 이하로 설정되어 Update될 경우 Exception 이 발생하는 것을 알 수 있다. ql를 이용한 Update를 처리할 때도 동일하게 Exception이 발생함을 확인할 수 있다.</p><h3 id=entitylistener-정의>EntityListener 정의</h3><p>엔티티 클래스에 EntityListener를 지정하고 EntityListener에서 Annotation을 기재하여 Method를 정의할 수 있다.</p><h4 id=define-source---entitylistener-클래스에-정의>Define Source - EntityListener 클래스에 정의</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@EntityListeners</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>egovframework</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sample</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>model</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>callback</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>AlertMonitor</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//위에서 정의한 AlertMonitor 클래스
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>AlertMonitor</span> <span style=color:#ce5c00;font-weight:700>{</span>	
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@PostPersist</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>newUserAlert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>()+</span><span style=color:#4e9a06>&#34; Created!&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@PostLoad</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>usrGetAlert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>()+</span><span style=color:#4e9a06>&#34; Get!&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>정의하는 위치가 다르고 원래 엔티티를 매개변수로 넘겨야 하는 부분이 차이가 있지만 엔티티 클래스에 지정하는 것과 동일하게 작동한다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-babd23700ecbe8799cc4dabe3da884ec>26 - Association Mapping</h1><div class=lead>두 클래스 간의 연관 관계를 매핑하는 방법으로, 1:1 관계는 @OneToOne 애노테이션을 사용해 처리하고, 1:N 관계는 @OneToMany와 @ManyToOne 애노테이션을 사용해 매핑한다. 다양한 컬렉션 매핑과 inverse, cascade 같은 주요 속성도 함께 설정할 수 있다.</div><h1 id=association-mapping>Association Mapping</h1><p>두 클래스 사이의 Association 유형별 매핑 방법에 대해서 살펴보고자 한다. 그리고 다양한 Collection의 매핑 방법 및 Collection의 주요속성인 inverse,cascade에 대해서 샘플코드를 중심으로 살펴본다.</p><h2 id=one-to-one-mapping>One To One Mapping</h2><p>테이블간 1:1 매핑이 있을 경우에 각각의 Entity 클래스를 정의하고 클래스간 관계를 OneToOne 매핑으로 처리한다.</p><h5 id=sample-source>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Employee</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>TravelProfile</span> <span style=color:#000>profile</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>TravelProfile</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Employee</span> <span style=color:#000>employee</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 Employee 와 TravelProfile가 각각 OneToOne이라는 Annotation을 기재하여 매핑처리한 것을 알수 있다.</p><h2 id=one-to-many-mapping>One To Many Mapping</h2><p>테이블간 1:N 매핑이 있을 경우에 각각의 Entity 클래스를 정의하고 한쪽에는 OneToMany, 다른쪽에는 ManyToOne 이라는 Annotation을 기재하여 관계를 나타낸다.</p><h5 id=sample-source-1>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@ManyToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 Department:User = 1:N 의 관계가 있으며 그 관계에 대해서 Department 클래스에서 OneToMany로 표시하고 User 클래스에서 ManyToOne으로 표시하여 관계를 나타냈다.</p><h3 id=collection-type>Collection Type</h3><p>Collection은 위의 예에서 사용된 Set 이외에도 List,Map를 사용할 수 있는데 각각의 사용법은 다음과 같다</p><h4 id=set>Set</h4><p>java.util.Set 타입으로 &lt;set>을 이용하여 정의한다. 객체의 저장 순서를 알 수 없으며, 동일 객체의 중복 저장을 허용하지 않는다. (HashSet 이용) 다음은 set 태그를 이용하여 Collection 객체를 정의한 소스 코드의 예이다</p><h5 id=sample-source-2>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=list>List</h4><p>java.util.List 타입으로 &lt;list>를 이용하여 정의한다. List 타입의 경우 저장된 객체의 순서를 알 수 있으며, 저장 순서를 테이블에 보관하기 위해서 별도 인덱스 컬럼 정의가 필요하다. (ArrayList 이용) 다음은 list 태그를 이용하여 Collection 객체를 정의한 소스 코드의 예이다</p><h5 id=sample-source-3>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span> <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=map>Map</h4><p>java.util.map 타입으로 &lt;map>을 이용하여 (키,값)을 쌍으로 정의한다. (HashMap 이용) 다음은 map 태그를 이용하여 Collection 객체를 정의한 소스 코드의 예이다. Key 설정을 위해 MapKey라는 Annotation을 추가적으로 정의해야 한다.</p><h5 id=sample-source-4>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@MapKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;userId&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=단방향양방향-관계-속성>단방향/양방향 관계 속성</h3><p>1:N(부모:자식)관계 지정에 있어서 자식쪽에서 부모에 대한 참조 관계를 가지고 있느냐 없느냐에 따라서 참조관계가 있으면 양방향 관계, 없으면 단방향 관계로 정의된다.</p><h4 id=단방향>단방향</h4><p>자식 Entity에 부모 Entity에 대한 참조정보 없이 정의한다.</p><h5 id=sample-source-5>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;DEPT_ID&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예에서 보면 User 클래스에서 Department 클래스에 대한 참조관계를 지정하지 않고 단순하게 테이블의 컬럼 DEPT_ID와의 매핑으로 deptId를 지정한 것을 알 수 있다.</p><h4 id=양방향>양방향</h4><p>자식 Entity에 부모 Entity에 대한 참조정보를 지정하여 정의한다.</p><h5 id=sample-source-6>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@ManyToOne</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예에서 보면 User 클래스에서 Department 클래스에 대한 ManyToOne Annotation을 통해 매핑관계를 지정한 것을 알 수 있다.</p><h3 id=mappedbycascade-속성>mappedBy,Cascade 속성</h3><p>mappedBy와 cascade는 Collection 정의시 중요한 의미를 가지는 속성 중의 하나로, 다음과 같은 의미를 지닌다.</p><ul><li>mappedBy: 객체간 관계 연결을 어느 Entity에서 할 것인지에 대한 옵션을 정의하기 위한 속성이다.</li><li>cascade : 부모 객체에 대한 CUD를 자식 객체에도 전이할지에 대한 옵션을 정의하기 위한 속성이다.</li></ul><h4 id=mappedby--cascade->mappedBy: ○, cascade: ○</h4><p>mappedBy와 cascade를 모두 정의하여 사용할 경우에는 자식 Entity에서 관계연결 처리를하고 부모 Entity에서 CUD처리시 자식 Entity도 자동으로 처리된다.</p><h5 id=define-source>Define Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>mappedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;deptId&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>cascade</span><span style=color:#ce5c00;font-weight:700>={</span><span style=color:#000>CascadeType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PERSIST</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>CascadeType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MERGE</span><span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ManyToOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=sample-source-7>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// User(자식) Entity의 setDepartment 메소드를 통해서 관계설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 부모 entity의 저장으로 자식까지 동시처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h4 id=mappedby--cascade--1>mappedBy: ○, cascade: Ⅹ</h4><p>mappedBy만 정의하여 사용할 경우에는 자식 Entity에서 관계연결 처리를하고 부모,자식 각자 CUD처리한다.</p><h5 id=define-source-1>Define Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>mappedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;deptId&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@ManyToOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=sample-source-8>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// User(자식) Entity의 setDepartment 메소드를 통해서 관계설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDepartment</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 부모/자식 entity의 각각 처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h4 id=mappedby--cascade--2>mappedBy: Ⅹ, cascade: ○</h4><p>cascade만 정의하여 사용할 경우에는 부모 Entity에서 관계연결 처리를 하고 부모 Entity에서 CUD처리시 자식 Entity도 자동으로 처리된다.</p><h5 id=define-source-2>Define Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>cascade</span><span style=color:#ce5c00;font-weight:700>={</span><span style=color:#000>CascadeType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PERSIST</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>CascadeType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MERGE</span><span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ManyToOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=sample-source-9>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Department(부모) Entity의 getUsers().add 메소드를 통해서 관계설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUsers</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 부모 entity의 저장으로 자식까지 동시처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h4 id=mappedby--cascade--3>mappedBy: Ⅹ, cascade: Ⅹ</h4><p>모두 정의하지 않을때는 부모 Entity에서 관계 연결 처리를 하고 부모,자식 각자 CUD처리한다.</p><h5 id=define-source-3>Define Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@ManyToOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Department</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h5 id=sample-source-10>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Department(부모) Entity의 getUsers().add 메소드를 통해서 관계설정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUsers</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// 부모/자식 entity의 각각 처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><h3 id=many-to-many-mapping>Many To Many Mapping</h3><p>테이블간 M:N 매핑이 있을 경우에 각각의 Entity 클래스를 정의하고 양쪽에 ManyToMany이라는 Annotation을 기재하여 관계를 나타낸다.</p><h5 id=sample-source-11>Sample Source</h5><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@ManyToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@ManyToMany</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@JoinTable</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;AUTHORITY&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>joinColumns</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#5c35cc;font-weight:700>@JoinColumn</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;USER_ID&#34;</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>        <span style=color:#000>inverseJoinColumns</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#5c35cc;font-weight:700>@JoinColumn</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;ROLE_ID&#34;</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 Role:User = M:N 의 관계가 있으며 그 관계에 대해서 Role클래스에서 ManyToMany로 표시하고 User 클래스에서 ManyToMany로 표시하여 관계를 나타내면서 User 클래스에서 관계를 위한 별도의 테이블에 대한 정의를 하고 있다. 이 경우에 ROLE과 USER를 연결하는 관계 테이블로 AUTHORITY가 사용된 것을 알 수 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b324c47affbdf84bb67655467c3c7d94>27 - JPA Query Language</h1><div class=lead>JPA는 객체 지향적인 관점에서 DB 유형에 독립적인 쿼리를 정의할 수 있도록 별도의 Query Language(QL)를 제공하며, 주요 유형으로 SELECT 문과 UPDATE/DELETE 문이 있다. SELECT 문은 다양한 절(WHERE, ORDER BY, GROUP BY)과 함께 사용되며, UPDATE/DELETE 문은 WHERE 절과 함께 사용된다.</div><h1 id=query-language>Query Language</h1><p>JPA에는 별도의 Query Language를 제공함으로써 객체 지향 관점에서 특정 객체에 대한 조회와 DB 유형에 독립적인 Query 정의를 가능하도록 한다. 구성요소 및 작성 방법은 아래와 같다.</p><h2 id=구성요소>구성요소</h2><p>QL Statement 유형으로는 SELECT 문과 Update and Delete 문 두가지가 있다.</p><ul><li>SELECT문 : SELECT 절 + FROM 절 + WHERE 절(Option) + ORDER BY 절(Option) + GROUP BY 절(Option)</li><li>UPDATE&amp;DELETE문 : UPDATE/DELETE 절 + WHERE 절
각각의 절에 대해서 아래에서 알아보고자 한다.</li></ul><h3 id=select-절>SELECT 절</h3><p>조회 결과값을 구체적으로 명시하고자 할 경우 정의한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>object</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>또는</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>property</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>Aggregate</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Funtions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>여러 건의 데이터를 조회할 경우 조회 결과값을 List, Map 또는 사용자 정의 Type으로 정의 가능하다. (Default = Object[])</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>prop1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>prop2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>…</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>가능한 Aggregate Funtions</p><pre tabindex=0><code>COUNT   : Long 으로 리턴
MAX, MIN: 정의된 필드로 리턴
AVG     : Double로 리턴
SUM     : integral type의 경우는 Long, float type의 경우는 Double, BigInteger는 BigInteger, BigDecimal 은 BigDecimal 
</code></pre><p><strong>QL에서 사용 가능한 주요 Function</strong></p><h4 id=string-functions>String Functions</h4><table><thead><tr><th>함수명</th><th>설명</th></tr></thead><tbody><tr><td>CONCAT(str1, str2)</td><td>두개의 문자열을 연결한다.</td></tr><tr><td>SUBSTRING(str, idx, length)</td><td>문자열의 지정한 idx 위치에서 length만큼의 문자열을 얻어낸다.</td></tr><tr><td>TRIM([type] str)</td><td>문자열의 앞뒤 공백을 삭제한다. (Type이 BOTH일 경우 앞뒤공백 삭제, Type이 LEADING일 경우 앞 공백 삭제, Type이 TRAILING일 경우 뒤 공백 삭제)</td></tr><tr><td>LOWER(str)</td><td>소문자로 변환한다.</td></tr><tr><td>UPPER(str)</td><td>대문자로 변환한다.</td></tr><tr><td>LENGTH(str)</td><td>문자열의 전체 길이를 구한다.</td></tr><tr><td>LOCATE(str, s, idx)</td><td>해당 문자열 str에서 정의된 문자열 s가 포함되어 있는 위치를 구한다. 검색 시작 위치는 idx이다.</td></tr></tbody></table><h4 id=arithmetic-functions>Arithmetic Functions</h4><table><thead><tr><th>함수명</th><th>설 명</th></tr></thead><tbody><tr><td>ABS(num)</td><td>숫자의 절대값을 구한다.</td></tr><tr><td>SQRT(num)</td><td>숫자의 제곱근을 구한다.</td></tr><tr><td>MOD(num1,num2)</td><td>num2을 num2로 나눈 나머지값을 구한다.</td></tr><tr><td>SIZE(collection value)</td><td>Collection의 포함 엔트리 숫자를 구한다.</td></tr></tbody></table><h4 id=datetime-functions>DateTime Functions</h4><table><thead><tr><th>함수명</th><th>설 명</th></tr></thead><tbody><tr><td>CURRENT_DATE</td><td>현재 날짜를 구한다.</td></tr><tr><td>CURRENT_TIME</td><td>현재 시간을 구한다.</td></tr><tr><td>CURRENT_TIMESTAMP</td><td>현재 날짜 및 시간을 구한다.</td></tr></tbody></table><h3 id=from-절>FROM 절</h3><p>조회 대상 객체를 정의하며, SELECT 절이 생략되었을 경우 FROM 절에 정의된 객체가 전달 대상이 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>object</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>((</span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>alias</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>…</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=joins>JOINS</h4><p>FROM 절에 JOIN 을 쓸 수 있는데 JOIN의 종류는 다음과 같다.</p><table><thead><tr><th>JOIN 종류</th><th>예 제</th><th>설 명</th></tr></thead><tbody><tr><td>Inner Joins</td><td>SELECT c FROM Customer c <strong>JOIN</strong> c.orders o WHERE c.status = 1</td><td>비교 대상 양쪽 모두 존재하는 것 추출(Order를 낸 고객만 추출)</td></tr><tr><td>Left Outer Joins</td><td>SELECT c FROM Customer c <strong>LEFT JOIN</strong> c.orders o WHERE c.status = 1</td><td>한쪽에만 존재하더라도 추출(Order를 내지않은 고객도 추출)</td></tr><tr><td>Fetch Joins</td><td>SELECT d FROM Department d LEFT JOIN <strong>FETCH</strong> d.employees WHERE d.deptno = 1</td><td>FETCH문 뒤에 오는 자식리스트도 같이 추출 (Department의 attribute로 가지고 있는 employee 목록 추출, lazy로딩의 경우 Fetch를 하지 않으면 employee정보는 추출되지 않음)</td></tr></tbody></table><h3 id=where-절option>WHERE 절(Option)</h3><p>조회 결과 영역을 보다 상세히 구분하고자 할 경우 정의한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>condition</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>…</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>조건을 나타내는 여러 표현이 있는데 그중에 대표적인 것은 다음과 같다.
Outer pipes Cell padding
No sorting</p><table><thead><tr><th>조건</th><th>설명</th><th>예</th></tr></thead><tbody><tr><td>Path Expressions</td><td>entity 클래스의 attribute를 지칭함.</td><td>user.roles</td></tr><tr><td>Named Parameters</td><td>이름을 지정한 파라미터를 지정할 수 있고 setParameter를 통해서 값을 지정함.</td><td>WHERE department.deptName like :condition</td></tr><tr><td>Positional Parameters</td><td>위치를 지정한 파라미터를 지정할 수 있고 setParameter를 통해서 값을 지정함.</td><td>WHERE role.roleName = ?1</td></tr><tr><td>Collection Member Expressions</td><td>Collection 타입의 Attribute를 ”[NOT] MEMBER [OF]” 라는 표현으로 조건처리함.</td><td>user MEMBER OF role.users</td></tr></tbody></table><p>그외에도 IN, LIKE, IS NULL, EXISTS, <a href=#string-functions>Function</a> 등의 표현이 지원된다.</p><h3 id=order-by-절option>ORDER BY 절(Option)</h3><p>조회 결과의 정렬 방법을 정의한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>ORDER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>condition</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>ASC</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>또는</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>DESC</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>…</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=group-by-절option>GROUP BY 절(Option)</h3><p>조회 결과를 특정 기준으로 그룹핑하고자 할 경우 정의한다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>GROUP</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>condition</span><span style=color:#000;font-weight:700>],</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#a40000>…</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>HAVING</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>condition</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=기본적인-사용-방법>기본적인 사용 방법</h2><p>대표적인 사용 방법을 예제소스 기반으로 설명하고자 한다. 기본적인 CRUD 방법과 Join 방법은 다음과 같다</p><h3 id=기본-리스트-조회>기본 리스트 조회</h3><p>QL을 통해 하나의 테이블을 대상으로 조회 작업을 수행할 수 있다.</p><h4 id=sample-source>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM Department department &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE department.deptName like :condition &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ORDER BY department.deptName&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>qlQuery</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlQuery</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;%%&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>departmentList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>qlQuery</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의된 QL문을 통해 조회 조건에 맞는 Department 객체의 List가 리턴된다. WHERE절의 조회 조건은 객체명.Attribute명(department.deptName)으로 정의할 수 있으며 &lsquo;:&lsquo;을 사용하여 Named Paramenter를 통해 조회 조건을 완성할 수 있다. 조회 조건의 값은 Query의 setParameter() 메소드를 통해 지정해 주고 있다.</p><h3 id=join을-통한-리스트-조회>JOIN을 통한 리스트 조회</h3><p>INNER JOIN 과 LEFT OUTER JOIN 을 수행할 수 있고 그 예는 다음과 같다.</p><h4 id=inner-join-1>INNER JOIN (1)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user join user.roles role &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE role.roleName = ?1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의된 QL문을 통해 조회 조건에 맞는 Department 객체의 List가 리턴된다. FROM절에서 JOIN을 이용하여 INNER JOIN 처리를 했고 WHERE절의 조회 조건은 객체명.Attribute명(department.deptName)으로 정의할 수 있으며 &lsquo;?!&lsquo;를 사용하여 Positional Paramenter를 통해 조회 조건을 완성할 수 있다. 조회 조건의 값은 Query의 setParameter() 메소드를 통해 지정해 주고 있다.</p><h4 id=inner-join-2>INNER JOIN (2)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT distinct user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user, Department department &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE user.department.deptId = department.deptId &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;AND department.deptId = :condition1 &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;AND user.userName like :condition2 &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition1&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition2&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;%%&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의된 QL문을 통해 조회 조건에 맞는 Department 객체의 List가 리턴된다. WHERE절에서 &lsquo;=&lsquo;를 통해 INNER JOIN 처리를 했고 조회 조건은 객체명.Attribute명(department.deptName)으로 정의할 수 있으며 &lsquo;?!&lsquo;를 사용하여 Positional Paramenter를 통해 조회 조건을 완성할 수 있다. 조회 조건의 값은 Query의 setParameter() 메소드를 통해 지정해 주고 있다.</p><h4 id=left-outer-join>LEFT OUTER JOIN</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT distinct role &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM Role role left outer join role.users user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ORDER BY role.roleName ASC &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>roleList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의된 QL문을 통해 조회 조건에 맞는 role객체의 List가 리턴된다. FROM절에서 LEFT OUTER JOIN 처리를 했다. LEFT OUTER JOIN이므로 RIGHT에 있는 정보가 누락되더라도 추출되므로 위의 예에서는 USER 정보가 없는 ROLE 정보도 모두 리스트 됨을 알 수 있다.</p><h2 id=defined-return-type>Defined Return Type</h2><p>조회 작업을 수행한 후, 조회 작업의 결과를 원하는 객체 형태로 전달받을 수 있다. 이는 여러 테이블을 Join할 경우 한 테이블에 매핑되는 Persistence 클래스가 아닌 composite 클래스로 리턴받고자 할 때 사용할 수 있다.</p><h3 id=특정-객체-형태로-전달>특정 객체 형태로 전달</h3><p>Relation 관계에 놓여 있는 두개의 테이블을 대상으로 QL(Inner Join)을 이용한 조회 결과를 특정 객체(예에선 User객체)형태로 전달받는다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT new User(user.userId as userId, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	user.userName as userName, user.password as password, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	role.roleName as roleName, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	user.department.deptName as deptName) &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user join user.roles role &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE role.roleName = :condition&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>한가지 주의할 점은 new User(…)를 통해서 생성자를 호출하고 있는데 이 생성자가 User 클래스에 정의되어 있어야 한다. 또한 리턴된 결과값에서 각각의 attribute에 해당하는 값을 꺼낼 때에는 List에서 각 User 객체를 꺼낸 다음 getter 메소드를 사용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>User</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>User</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userList</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>user1</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getUserName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#204a87;font-weight:700>User</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>User</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>userList</span><span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000>user2</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>getUserName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=map-형태로-전달>Map 형태로 전달</h3><p>Relation 관계에 놓여 있는 두개의 테이블을 대상으로 QL(Inner Join)을 이용한 조회 결과를 Map 형태로 전달받는다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT new Map(user.userId as userId, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	user.userName as userName, user.password as password, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	role.roleName as roleName, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	user.department.deptName as deptName) &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user join user.roles role &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE role.roleName = :condition&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의할 경우 조회 결과는 Map의 List 형태가 된다. 이때 alias로 정의한 userId, userName, password, roleName, deptName이 Map의 Key 값이 된다. 따라서 다음과 같이 Map으로 정의된 Key 값을 통해 결과값을 조회할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Map</span> <span style=color:#000>user1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>user1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;userId&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>user1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;userName&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span></code></pre></div><h3 id=list-형태로-전달>List 형태로 전달</h3><p>Relation 관계에 놓여 있는 두개의 테이블을 대상으로 QL(Inner Join)을 이용한 조회 결과를 List 형태로 전달받는다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT new List(user.userId as userId, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	user.userName as userName, user.password as password, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	role.roleName as roleName, &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;	user.department.deptName as deptName) &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user join user.roles role &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE role.roleName = :condition&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의할 경우 조회 결과는 List의 List 형태가 된다. List에서 결과값을 꺼낼 때에는 정의된 순서에 따르면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>user1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>user1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>//userId
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>user1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>);</span> <span style=color:#8f5902;font-style:italic>//userName
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span></code></pre></div><h2 id=named-query>Named Query</h2><p>Entity 클래스 파일 내에 Annotation으로 정의한 QL문의 name을 입력하여 실행시킬 수 있다.</p><h3 id=sample-source-1>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>qlQuery</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNamedQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;findDeptList&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlQuery</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;%%&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>deptList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>qlQuery</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 createNamedQuery() 메소드에 query name을 넘겨주면 이 이름에 맞는 QL문을 찾아서 실행하게 된다. 다음은 findDeptList가 담겨있는 Department Entity 클래스 소스 일부이다.</p><h3 id=entity-source>Entity Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@NamedQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;findDeptList&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> 
</span></span><span style=display:flex><span>           <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;FROM Department department WHERE department.deptName like :condition ORDER BY department.deptName&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=paging-처리>Paging 처리</h2><p>Paging 처리는 한 페이지에 보여줘야 할 조회 목록에 제한을 둠으로써 DB 또는 어플리케이션 메모리의 부하를 감소시키고자 하는데 목적이 있다. QL 수행시 페이징 처리된 조회 결과를 얻기 위한 방법에 대해 알아보도록 한다. 특정 테이블을 대상으로(예에서는 USER 테이블) QL을 이용한 조회 작업을 수행한다. 이때, 조회를 시작해야 하는 Row의 Number(FirstResult)와 조회 목록의 개수(MaxResult)를 정의함으로써, 페이징 처리가 가능해진다.</p><h3 id=sample-source-2>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>//첫번째로 조회해야 할 항목의 번호
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setFirstResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>//조회 항목의 전체 개수
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setMaxResults</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의할 경우 QL에서는 persistence.xml 파일에 정의된 hibernate.dialect 속성에 따라 각각의 DB에 맞는 SQL을 생성한다. 이는 Pagination을 할 때 모든 데이터를 읽은 후 해당 페이지에 속한 데이터 갯수를 결과값으로 전달하는 것이 아니라 조회해야 할 데이터 즉, 해당 페이지에 속한 갯수만큼의 데이터만 읽어오게 된다.</p><h2 id=ql을-이용한-cud>QL을 이용한 CUD</h2><p>기본적으로 JPA를 이용한 CUD(Create, Update, Delete)를 할 때에는 기본 API를 사용하게 된다. (본메뉴얼 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:rte2:psl:orm:basic_crud">Basic CRUD</a> 참고) 그러나 특이한 경우 QL을 통해 기본 CUD를 수행해야 하는 경우가 발생할 수 있다.</p><h3 id=insert>INSERT</h3><p>다음은 QL을 사용한 Insert문의 예이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>ql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO Department (deptId,deptName) &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT CONCAT(deptId,&#39;UPD&#39;), CONCAT(deptName,&#39;UPD&#39;) &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM Department department &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE deptId = :deptId&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deptId&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeUpdate</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 작성할 경우 QL을 이용하여 신규 Department 정보를 등록할 수 있다.</p><h3 id=update>UPDATE</h3><p>다음은 QL을 사용한 Update문의 예이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>ql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;UPDATE Department department &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SET department.desc = :desc &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE department.deptId = :deptId and department.deptName = :deptName &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;desc&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Human Resource&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deptId&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deptName&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;HRD&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeUpdate</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위의 예는 QL을 사용하여 Department 정보를 수정한 것이며 Query의 setParameter() 메소드를 통해 인자값을 세팅하고 있다.</p><h3 id=delete>DELETE</h3><p>다음은 QL을 사용한 Delete문의 예이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>ql</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;DELETE Department department &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE department.deptId = :deptId &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ql</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;deptId&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>executeUpdate</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위의 예는 QL을 사용하여 Department 정보를 삭제한 것이며 Query의 setParameter() 메소드를 통해 인자값을 세팅하고 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-81d786dd7e57e3b8b129ac69079ef6c5>28 - Native SQL</h1><div class=lead>JPA는 기본 API나 QL 외에도 특정 DBMS 기능을 활용하기 위해 createNativeQuery() 메소드를 통해 Native SQL 실행을 지원한다. 이를 통해 표준 SQL을 직접 사용하여 CRUD 작업을 수행할 수 있다.</div><h1 id=native-sql>Native SQL</h1><p>기본적으로 CRUD 작업을 할 때 JPA 기본 API를 사용하거나 QL을 이용하여 수행한다. 그러나 특정 DBMS에서 제공하는 기능을 사용할 수 있도록 하기 위해 Native <acronym title="Structured Query Language">SQL</acronym> 사용을 지원한다.</p><h2 id=기본적인-사용-방법>기본적인 사용 방법</h2><p>entityManager.createNativeQuery() 메소드를 이용하여 Native SQL을 실행할 수 있다.</p><h3 id=기본-리스트-조회>기본 리스트 조회</h3><p>SQL을 통해 하나의 테이블을 대상으로 조회 작업을 수행할 수 있다.</p><h4 id=sample-source>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT * &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM DEPARTMENT &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE DEPT_NAME like :condition &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ORDER BY DEPT_NAME&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;%%&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>deptList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의된 SQL문을 통해 조회 조건에 맞는 Department 객체의 List가 리턴된다. WHERE절에서 &lsquo;:&lsquo;을 사용하여 Named Paramenter를 통해 조회 조건을 완성할 수 있다. 조회 조건의 값은 Query의 setParameter() 메소드를 통해 지정해 주고 있다. 또한, createNativeQuery의 두번재 인자로 리턴받고자하는 Entity 클래스(Department.class)를 지정한 것을 확인할 수 있다.</p><h3 id=join을-통한-리스트-조회>JOIN을 통한 리스트 조회</h3><p>Relation 관계에 놓여 있는 두개의 테이블을 대상으로 Native <acronym title="Structured Query Language">SQL</acronym>(Inner Join)을 이용한 조회 작업을 수행할 수 있다.</p><h4 id=basic-source>Basic Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT user.* &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM USER user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;join AUTHORITY auth on user.USER_ID = auth.USER_ID &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;join ROLE role on auth.ROLE_ID = role.ROLE_ID &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE role.ROLE_NAME = ?&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위의 코드와 같이 join 키워드를 사용하여 Inner Join을 수행할 수 있다. 또한, Relation 관계에 놓여 있는 두개의 테이블을 대상으로 Native <acronym title="Structured Query Language">SQL</acronym>(Right Outer Join)을 이용한 조회 작업을 수행할 수 있다.</p><h4 id=right-join-source>RIGHT JOIN Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT distinct role.* &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM USER user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;right join AUTHORITY auth on user.USER_ID=auth.USER_ID &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;right join ROLE role on auth.ROLE_ID=role.ROLE_ID &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ORDER BY role.ROLE_NAME ASC &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>roleList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>또한 Join하여 조회한 결과를 각각의 Join된 객체의 값으로 select 하기 위해서는 createNativeQuery의 두번째 인자에 @SqlResultSetMapping에 정의된 명을 기재하여 수행한다.</p><h4 id=multi-entity-result-source>Multi Entity Result Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT distinct user.*, department.* &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM USER user, DEPARTMENT department &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE user.DEPT_ID = department.DEPT_ID &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;AND department.DEPT_NAME = :condition1 &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;AND user.USER_NAME like :condition2 &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#4e9a06>&#34;UserAndDept&#34;</span> <span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>;</span>		
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition1&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;HRD&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition2&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;%%&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위의 예를 보면 User Entity Class에 UserAndDept 라는 이름으로 리턴받고자 하는 Entity 클래스를 정의하고 있음을 알 수 있다.</p><h4 id=sqlresultsetmapping-define-source>SqlResultSetMapping Define Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@SqlResultSetMapping</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;UserAndDept&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>entities</span><span style=color:#ce5c00;font-weight:700>={</span><span style=color:#5c35cc;font-weight:700>@EntityResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>		                                  <span style=color:#5c35cc;font-weight:700>@EntityResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>		                                 <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 User Entity 클래스에서 Annotation을 통해서 UserAndDept를 정의하고 있음을 알 수 있다. 또한, 각각의 추출은 아래와 같이 한다.</p><h4 id=multi-entity-result-use-source>Multi Entity Result Use Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>results</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>[])</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>User</span> <span style=color:#000>user1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>results</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>];</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>dept1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>results</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>];</span>
</span></span></code></pre></div><h2 id=named-query>Named Query</h2><p>Entity 클래스 파일 내에 Annotation으로 정의한 SQL문의 name을 입력하여 실행시킬 수 있다.</p><h4 id=sample-source-1>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNamedQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;nativeFindDeptList&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;%%&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>deptList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 createNamedQuery() 메소드에 query name을 넘겨주면 이 이름에 맞는 QL문을 찾아서 실행하게 된다. 다음은 nativeFindDeptList가 담겨있는 Department Entity 클래스 소스 일부이다.</p><h4 id=entity-source>Entity Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@NamedNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;nativeFindDeptList&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>           <span style=color:#000>resultClass</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>	         <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;SELECT * FROM DEPARTMENT department &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>		       <span style=color:#4e9a06>&#34;WHERE department.DEPT_Name like :condition &#34;</span><span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>		       <span style=color:#4e9a06>&#34;ORDER BY department.DEPT_Name&#34;</span> <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 볼 수 있듯이 QL의 NamedQuery과는 resultClass 를 명시적으로 기재한다는 점에서 차이가 있다.</p><h2 id=paging-처리>Paging 처리</h2><p>Paging 처리는 한 페이지에 보여줘야 할 조회 목록에 제한을 둠으로써 DB 또는 어플리케이션 메모리의 부하를 감소시키고자 하는데 목적이 있다. Native <acronym title="Structured Query Language">SQL</acronym> 수행시 페이징 처리된 조회 결과를 얻기 위한 방법에 대해 알아보도록 한다. 특정 테이블을 대상으로(예에서는 USER 테이블) Native SQL을 이용한 조회 작업을 수행한다. 이때, 조회를 시작해야 하는 Row의 Number(FirstResult)와 조회 목록의 개수(MaxResult)를 정의함으로써, 페이징 처리가 가능해진다.</p><h4 id=sample-source-2>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT * &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setFirstResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setMaxResults</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위와 같이 정의할 경우 QL에서는 persistence.xml 파일에 정의된 hibernate.dialect 속성에 따라 각각의 DB에 맞는 SQL을 생성한다. 이는 Pagination을 할 때 모든 데이터를 읽은 후 해당 페이지에 속한 데이터 갯수를 결과값으로 전달하는 것이 아니라 조회해야 할 데이터 즉, 해당 페이지에 속한 갯수만큼의 데이터만 읽어오게 된다.</p><h2 id=function-호출>Function 호출</h2><p>해당 DB에 생성한 Function을 이용하여 Native SQL을 실행하고 결과를 확인할 수 있다.</p><h4 id=sample-source-3>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>StringBuffer</span> <span style=color:#000>qlBuf</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringBuffer</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT * FROM USER_TBL &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE salary &gt; FIND_USER(:condition)&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createNativeQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;condition&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>위의 예에서 보면 FIND_USER라는 함수를 호출하여 WHERE문에서 비교를 수행하는 것을 알 수 있다. Procedure의 경우는 입력/출력 인자 처리를 어찌 해야하는지에 대한 확인이 불가능해서 예제로 설명하지 못했다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fda5691520f3a24830db2e5724582e02>29 - Concurrency</h1><div class=lead>동시에 동일한 데이터에 접근할 때 Optimistic Locking을 지원하며, Pessimistic Locking은 JPA 2.0부터 Hibernate의 Native API를 통해 지원된다.</div><h1 id=concurrency>Concurrency</h1><p>동시에 동일한 데이터에 접근할 때에 데이터에 대한 접근을 제어하기 위해 Optimistic Locking을 지원한다. 한편 Hibernate의 Native API를 통해서는 지원 가능한 Pessimistic Locking 은 JPA2.0 버전에 정의될 예정이다.</p><h2 id=optimistic-locking>Optimistic Locking</h2><h3 id=without-locking-source>Without Locking Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testUpdateUserWithoutOptimisticLocking</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. 테스트를 위한 신규 데이터를 입력
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>addDepartmentUserAtOnce</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. 동일한 식별자를 이용하여 User 정보를 두번 조회
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>User</span> <span style=color:#000>fstUser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>User</span> <span style=color:#000>scdUser</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 3. Detached 상태에서의 변경처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>fstUser</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setUserName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;First : Kim&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 4. 별도의 트랜잭션으로 변경처리
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>scdUser</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setUserName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Second : Kim&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 5. 3에서 작업한 내용이 반영되어 변경.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>fstUser</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 제시한 로직에 대해 자세히 살펴보자.</p><ol><li>#1, #2번 코드에 의해 각각 동일한 식별자를 이용하여 같은 데이터 조회</li><li>두번째 트랜잭션이 종료된 후, #3번 코드에서는 Detached 상태의 fstUser 객체의 userName 변경</li><li>세번째 트랜잭션 내의 #4번 코드에서는 scdUser 객체의 userName 변경, 세번째 트랜잭션 종료시 변경 사항이 DB에 반영</li><li>네번째 트랜잭션 내에서 #3번 코드를 통해 변경된 fstUser 객체에 대해 update 수행</li><li>fstUser에 대한 수정 작업 또한 성공적으로 처리</li><li></li></ol><p>결론적으로 보면, userId가 “User1”인 User의 userName은 “First : Kim”이 되어 앞서 scdUser에서 요청했던 수정 작업은 무시된 것이다. 이러한 현상을 Lost Update라고 하며, 이를 해결하기 위한 방법은 3가지가 있다.</p><ol><li>Last Commit Wins : Optimistic Locking 을 수행하지 않게 되면 기본적으로 수행되는 유형으로 2개의 트랜잭션 모두 성공적으로 commit된다. 그러므로 두번째 commit은 첫번째 commit 내용을 덮어쓸 수 있다. (위의 예의 경우)</li><li>First Commit Wins : Optimistic Locking을 적용한 유형으로 첫번째 commit만이 성공적으로 이루어지며, 두번째 commit 시에는 Error를 얻게 된다.</li><li>Merge : 첫번째 commit만이 성공적으로 이루어지며, 두번째 commit 시에는 Error를 얻게 된다. 그러나 First Commit Wins와는 달리 두번째 commit을 위한 작업을 처음부터 다시 하지 않고 개발자의 선택에 의해 선택적으로 변경될 수 있도록 한다. 가장 좋은 전략이나 변경 사항을 merge 할 수 있는 화면이나 방법을 직접 제공해 줄 수 있어야 한다.(추가 구현 필요함)</li></ol><p>JPA에서는 Versioning 기반의 Automatic Optimistic Locking을 통해 First Commit Wins 전략을 취할 수 있도록 지원한다. JPA에서 Optimistic Locking을 수행하기 위해서는 해당 테이블에 Version을 추가해야 한다. 그러한 경우 해당 테이블과 매핑된 객체를 로드할 때 Version 정보도 함께 로드되고 객체 수정시 테이블의 현재 값과 비교하여 처리 여부를 결정하게 된다.</p><h3 id=with-optimistic-locking-source>With Optimistic Locking Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testUpdateDepartmentWithOptimisticLocking</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. 테스트를 위한 신규 데이터를 입력
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>addDepartmentUserAtOnce</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2. Department 정보를 두번 조회
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>fstDepartment</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to check a version of department.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>fstDepartment</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getVersion</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>scdDepartment</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 3. 두번째 조회한 Department 정보에 다른 deptName을 셋팅하여 DB에 반영
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>fstDepartment</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;First : Dept.&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 4. 첫번째 조회한 Department 정보에 대해 merge() 메소드를 호출
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>scdDepartment</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDeptName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Second : Dept.&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 5. 세번째 트랜잭션에서의 수정으로 인해 DEPARTMENT_VERSION이 이미 변경되었기 때문에
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#8f5902;font-style:italic>//    StaleObjectStateException 발생이 예상
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>fstDepartment</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#000>assertTrue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to throw StaleObjectStateException.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>e</span> <span style=color:#204a87;font-weight:700>instanceof</span> <span style=color:#000>StaleObjectStateException</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위와같이 다음의 testUpdateDepartmentWithOptimisticLocking() 메소드를 수행하였을 때 첫번째 수정 작업은 성공적으로 이루어지나 두번째 수정 작업에 대해서는 #6번 코드에서처럼 StaleObjectStateException이 throw될 것이다. 이를 위한 entity 클래스의 설정의 일부분은 다음과 같다.</p><h3 id=entity-class-source>Entity Class Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Table</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;DEPARTMENT&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT_ID&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>deptId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Version</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DEPT_VERSION&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>version</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 보는 것 같이 DEPT_VERSION이라는 컬럼을 추가하여 버전관리를 하게 함으로써 Optimistic Locking처리를 할 수 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-10fba63d32009815621876b85000ad65>30 - Cache Handling</h1><div class=lead>JPA에서는 성능 이슈를 개선하기 위해 1레벨 캐시를 활용하며, 객체를 테이블로 매핑해 데이터 액세스 처리를 수행한다. JPA 2.0부터는 2레벨 캐시가 추가되어 더 효율적인 캐시 관리가 가능해졌다.</div><h1 id=cache-handling>Cache Handling</h1><p>입력 인자로 전달된 객체를 정의된 테이블로 매핑시켜 데이터 액세스 처리를 수행해야 하는데 JPA에서는 이로 인해 발생 가능한 성능 이슈를 개선하기 위해 Cache를 활용한다. 현재 표준버전에서는 1 level Cache 만을 정의하고 있다. JPA 2.0에서는 2level Cache 정의 추가됨.</p><h2 id=1-level-cache>1 Level Cache</h2><p>Entity Manager 내부에 정의된 Cache로, 트랜잭션의 시작과 종료 사이에서 사용되며 한 트랜잭션 내에서 읽혀진 객체들을 보관하는 역할을 수행한다. JPA 구현체는 하나의 트랜잭션 내에서 동일한 객체를 한 번 이상 Loading할 경우 2번째부터는 Cache로부터 해당 객체를 추출하고 또한, 한 트랜잭션 범위 내에서 객체의 속성 변경시 변경 사항은 트랜잭션 종료시에 자동적으로 DB에 반영하도록 한다. 즉, 하나의 트랜잭션 내에서 동일한 객체에 대한 재조회가 이루어지는 경우 Cache를 이용함으로써 DB 접근 횟수를 줄여주기 때문에 어플리케이션 성능 향상에 도움이 되는 것이다.</p><h3 id=sample-source>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testFindUser</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>SetUpInitCacheData</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>initializeData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>User</span> <span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Set</span> <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRoles</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 1. Read from Cache
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;User1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRoles</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>		
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위와 같이 작성할 경우 동일한 트랜잭션 내에서 SetUpInitCacheData.initializeData(em)을 통해 persist된 Persistence 객체는 1LC에 저장되므로 다음에 #1번 코드에서처럼 동일한 Persistence 객체 조회시 DB에 재접근하지 않고도, Cache를 통해 조회된다.</p><h2 id=2-level-cache>2 Level Cache</h2><p>2 Level Cache에 대한 것은 JPA 2.0에서 정의하고 있어서 여기서는 JPA 구현체로 쓰이는 Hibernate에서 지원하는 방법으로 가이드를 하고자 한다. 2 Level Cache는 어플리케이션 단위의 Cache로, 어플리케이션 관점에서의 Cache 기능을 지원한다. 이는 여러 트랜잭션들을 통해 Load된 Persistence 객체를 Session Factory 레벨에서 저장하는 방법으로 처리된다. persistence.xml 파일 내에 hibernate.cache.use_second_level_cache, hibernate.cache.provider_class 등을 정의 하고, 2 Level Cache에 저장되어야 할 Persistence Class 매핑 파일의 <cache>속성을 정의하면 해당 어플리케이션을 구성하는 특정 Persistence 객체들에 대해 2LC를 적용할 수 있다. 다음은 2 Level Cache에 대한 속성이 정의되어 있는 persistence.xml 파일의 일부이다.</p><h3 id=config-파일>Config 파일</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;persistence-unit</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;HSQLMCUnit&#34;</span> <span style=color:#c4a000>transaction-type=</span><span style=color:#4e9a06>&#34;RESOURCE_LOCAL&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.cache.use_second_level_cache&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.cache.provider_class&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.hibernate.cache.EhCacheProvider&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>   ...
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/persistence-unit&gt;</span>
</span></span></code></pre></div><p>다음은 cache 속성이 READ_WRITE로 설정되어 있는 Entity 클래스의 일부이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Department에 지정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#5c35cc;font-weight:700>@Cache</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>usage</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>CacheConcurrencyStrategy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>READ_WRITE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Department와 User의 Join에 지정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#5c35cc;font-weight:700>@Cache</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>usage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>CacheConcurrencyStrategy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>READ_WRITE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#5c35cc;font-weight:700>@OneToMany</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>targetEntity</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>mappedBy</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;department&#34;</span> 
</span></span><span style=display:flex><span> 	       <span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>cascade</span><span style=color:#ce5c00;font-weight:700>={</span><span style=color:#000>CascadeType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PERSIST</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>CascadeType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MERGE</span><span style=color:#ce5c00;font-weight:700>})</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// User에 지정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Cache</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>usage</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>CacheConcurrencyStrategy</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>READ_WRITE</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 Department, User , Set<user> 세군데에 Cache를 지정한 것을 알 수 있다. 각각은 Department 와 User 그리고 Department와 User의 Join에 대해서 Cache를 지정하는 것이다. Cache 속성은 위에서 정의한 READ_WRITE외에도 다음과 값으로 정의할 수 있다.</p><ul><li>READ_OLNY : Persistence 객체가 변경되지 않는 경우에 사용 가능하다. 수정이 없으므로 분산 환경에서도 안전하게 사용 가능하며 가장 빠른 성능을 제공한다.</li><li>NONSTRICT_READ_WRITE : 트랜잭션 격리를 엄격히 적용할 필요가 없는 경우 사용 가능하다.</li><li>TRANSACTIONAL : 완전한 트랜잭션을 보장하나 가장 느린 성능을 제공한다.</li></ul><h3 id=sample-source-1>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testFindDepartment</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 데이터 입력.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>SetUpInitCacheData</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>initializeData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeTransaction</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>//Hibernate 메소드를 이용하기 위해  Hibernate Session Factory 생성(Entity Manager 로부터 얻어냄)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newHibernateSessionFactory</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2Level Cache를 이용한 자료 추출(Hibernate의 메소드를 이용함)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newSession</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>Set</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUsers</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>users</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>closeSession</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// 2Level Cache를 이용한 자료 추출(Hibernate의 메소드를 이용함)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>newSession</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>session</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Dept1&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUsers</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>   <span style=color:#000>users</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// Hibernate Session close
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>closeSession</span><span style=color:#ce5c00;font-weight:700>();</span>		
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예에서 두번째 Session.get()을 통해서는 DB 접근없이 2 Level Cache의 값을 가지고 오는 것을 알 수 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6f400a309d9330ce4780aec9a709641b>31 - Fetch Strategy</h1><div class=lead>ORM에서 기본적으로 Lazy Loading을 사용하여 필요한 시점에 SQL을 실행하지만, 성능 이슈를 해결하기 위해 Batch 조회, Sub-Query 조회, Join Fetch와 같은 다양한 Fetch 전략이 있다. 이 전략들은 JPA 표준이 아닌 Hibernate 구현체에서 제공되는 기능이다.</div><h1 id=fetch-strategy>Fetch Strategy</h1><p>ORM 서비스는 기본적으로 Entity간의 연관관계를 정의하고 정의된 연관관계를 가지고 관련 Entity를 추출하여 사용한다. 관련 Entity를 추출하는데 기본적으로 Lazy Loading이란 기법을 통해서 객체가 실제로 필요하기 전까지 SQL을 실행하지 않고 Proxy 객체로 리턴하도록 하고 한다. 그러나 이러한 Lazy Loading으로 처리하게 되면 Lazy Loading을 하지 않는 것에 대비하여 필요시점에 쿼리를 여러번 수행해야 하는 문제가 발생한다. 이런 문제를 해결하기 위한 여러가지 Fetch 전략이 존재하는데 <strong>Batch를 이용하여 데이터 조회, Sub-Query를 이용하여 데이터 조회, Join Fetch를 이용하여 데이터 한꺼번에 조회하는 방법</strong>이 있다. 하지만 이 서비스는 JPA표준이 아닌 구현체인 Hibernate에 정의된 사항이다.</p><h2 id=batch를-이용하여-데이터-조회>Batch를 이용하여 데이터 조회</h2><p>Entity 클래스에 BatchSize를 지정할 경우 지정한 개수만큼 해당 객체를 로딩하는 방식으로 쿼리 실행 회수가 n / batch size + 1로 감소한다. 다음은 batch-size 설정 예인 Department 클래스 파일의 일부이다.</p><h3 id=config-source>Config Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Department</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@org.hibernate.annotations.BatchSize</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 Department에 속한 Set<user> 을 추출할 때 적용되는 BatchSize를 2로 지정하였다.</p><h3 id=sample-source>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM Department&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>deptList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of department list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>deptList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>deptList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>();</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#000>Department</span> <span style=color:#000>department</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Department</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>deptList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a department name.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;HRD&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>         <span style=color:#000>Set</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUsers</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of user list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>users</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a department name.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;PD&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getDeptName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>         <span style=color:#000>Set</span> <span style=color:#000>users</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>department</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUsers</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of user list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>users</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span></code></pre></div><p>위의 Config와 Sample에 의해서 query.getResultList()에 의한 것과 department.getUsers() 호출 시 자동 생성되는 SQL Query는 다음과 같다.</p><h3 id=generated-sql>Generated SQL</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user0_</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>users0_</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>users0_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>DEPT_ID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>IN</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>?</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>위에 where 절의 [in (?,?)]에서의 ?의 숫자가 BatchSize이다. 위에서 2로 설정했기에 두개 지정되어 조회된다.</p><h2 id=sub-query를-이용하여-데이터-조회>Sub-Query를 이용하여 데이터 조회</h2><p>Entity 클래스에 FetchMode를 SUBSELECT로 지정할 경우 Sub Query 형태의 SELECT 문이 수행되며 한번에 모두 로딩하게 된다. 다음은 SUBSELECT 설정 예인 User 클래스 파일의 일부이다.</p><h3 id=config-source-1>Config Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@org.hibernate.annotations.Fetch</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>org</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>hibernate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>annotations</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>FetchMode</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>SUBSELECT</span><span style=color:#ce5c00;font-weight:700>)</span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>HashSet</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>);</span>	
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위에서 User에 속한 Set&lt;Role> 을 추출할 때 적용되는 FetchMode를 SUBSELECT 로 지정하였다.</p><h3 id=sample-source-1>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of user list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>();</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>User</span> <span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user name.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;kim&#34;</span> <span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user password.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;kim123&#34;</span> <span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getPassword</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>         <span style=color:#000>Set</span> <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRoles</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of role list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user name.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;lee&#34;</span> <span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user password.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;lee123&#34;</span> <span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getPassword</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>...</span>
</span></span></code></pre></div><p>위의 Config와 Sample에 의해서 query.getResultList() 호출 시와 user.getRoles() 호출 시 자동 생성되는 <acronym title="Structured Query Language">SQL</acronym> Query는 다음과 같다.</p><h3 id=generated-sql-1>Generated SQL</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user0_</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AUTHORITY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>roles0_</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>LEFT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>OUTER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>JOIN</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>role1_</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>roles0_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ROLE_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>role1_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ROLE_ID</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>roles0_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>USER_ID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>IN</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user0_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>USER_ID</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user0_</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>위에 where절의 [in (select user0_.USER_ID from USER user0_)]를 보면 Sub Query 형태로 해당하는 모든 User에 대해서 모든 Roles 정보를 추출하는 것을 확인 할 수 있다.</p><h2 id=join-fetch를-이용하여-데이터-한꺼번에-조회하는-방법>join fetch를 이용하여 데이터 한꺼번에 조회하는 방법</h2><p>Entity 클래스에서의 별도 설정없이 QL 수행시 join fetch 를 기재함으로써 한번에 연관된 자식 엔티티를 모두 추출하여 사용한다.</p><h3 id=sample-source-2>Sample Source</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT user &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// JOIN FETCH 를 이용함.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user join fetch user.roles role &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;WHERE role.roleName = ?&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>qlBuf</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>   <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setParameter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;Admin&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#000>List</span> <span style=color:#000>userList</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of user list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>();</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>User</span> <span style=color:#000>user</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>userList</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user name.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;kim&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user password.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;kim123&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getPassword</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>         <span style=color:#000>Set</span> <span style=color:#000>roles</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRoles</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match the size of role list.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>roles</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user name.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;lee&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>         <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;fail to match a user password.&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;lee123&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getPassword</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>...</span>
</span></span></code></pre></div><p>위의 예를 보면 [FROM User user join fetch user.roles role]에서 join fetch 라는 키워드를 쓴 것을 확인할 수 있다. 이것에 의한 생성된 SQL은 다음과 같다.</p><h3 id=generated-sql-2>Generated SQL</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#204a87;font-weight:700>SELECT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>USER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user0_</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>INNER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>JOIN</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>AUTHORITY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>roles1_</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>user0_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>USER_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>roles1_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>USER_ID</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#204a87;font-weight:700>INNER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>JOIN</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ROLE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>role2_</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ON</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>roles1_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ROLE_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>role2_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ROLE_ID</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>role2_</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ROLE_NAME</span><span style=color:#ce5c00;font-weight:700>=?</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>위에 SQL은 query.getResultList()에 의해서 실행되는 SQL로 JOIN에 관련된 ROLE정보를 모두 추출하는 것을 확인할 수 있다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-601a807baad20bd70afd8a322ff52d87>32 - Spring과 JPA 통합</h1><div class=lead>Spring은 JPA 기반 DAO 클래스를 쉽게 구현하기 위해 JpaTemplate을 제공하지만, 직접 EntityManager 메서드를 사용하는 방식(plain JPA)도 지원한다. JPA를 사용하기 위해서는 persistence.xml과 Spring ApplicationContext 설정이 필요하다.</div><h1 id=spring-integration>Spring Integration</h1><p>Spring에서는 JPA 기반에서 DAO 클래스를 쉽게 구현할 수 있도록 하기 위해 JdbcTemplate,HibernateTemplate등처럼 <strong>JpaTemplate</strong>을 제공한다. 하지만 JPA에 있어서는 Entity Manager의 Method를 직접 이용하는 것(<strong>plain JPA</strong>)에 대한 것도 가이드한다. 이에 두가지 방법에 대한 설정 및 사용방법에 대해서 설명하고자 한다. <a href=http://static.springframework.org/spring/docs/2.5.x/reference/orm.html#orm-jpa>Spring JPA</a></p><h2 id=기본-설정>기본 설정</h2><p>Spring 기반하에서 JPA를 쓰고자 할 때 필요한 설정은 persistence.xml과 ApplicationContext 파일 설정이 필요하다.</p><h4 id=persistencexml-설정>persistence.xml 설정</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;persistence-unit</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;HSQLMUnit&#34;</span> <span style=color:#c4a000>transaction-type=</span><span style=color:#4e9a06>&#34;RESOURCE_LOCAL&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span> 
</span></span><span style=display:flex><span>   // 구현체는 Hibernate	
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;provider&gt;</span>org.hibernate.ejb.HibernatePersistence<span style=color:#204a87;font-weight:700>&lt;/provider&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   // Entity Class List
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;class&gt;</span>egovframework.sample.model.bidirection.User<span style=color:#204a87;font-weight:700>&lt;/class&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;class&gt;</span>egovframework.sample.model.bidirection.Role<span style=color:#204a87;font-weight:700>&lt;/class&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;class&gt;</span>egovframework.sample.model.bidirection.Department<span style=color:#204a87;font-weight:700>&lt;/class&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;exclude-unlisted-classes/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>      // DBMS별 다른 설정 여기는 HSQL 설정.
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.dialect&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.hibernate.dialect.HSQLDialect&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.show_sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.format_sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.hbm2ddl.auto&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;create-drop&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/properties&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/persistence-unit&gt;</span>
</span></span></code></pre></div><p>위에서 Entity Class List와 그에 따르는 &lt;exclude-unlisted-classes/>는 프로젝트내에 있는 엔티티 클래스중에 리스트하는 것만을 엔티티로 인식하도록 설정하는 것이고 dialect설정은 DBMS별 별도 설정이다. 위의 예에서는 HSQL 설정.</p><h4 id=application-context-설정>Application Context 설정</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   // 1.Transation Manager 설정
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.jpa.JpaTransactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   // 2.Entity Manager Factory 설정
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;persistenceUnitName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;HSQLMUnit&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;persistenceXmlLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:META-INF/persistHSQLMemDB.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    // 3.DataSource 설정
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.apache.commons.dbcp.BasicDataSource&#34;</span> <span style=color:#c4a000>destroy-method=</span><span style=color:#4e9a06>&#34;close&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;net.sf.log4jdbc.DriverSpy&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;jdbc:log4jdbc:hsqldb:mem:testdb&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;sa&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;defaultAutoCommit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   // 4.JPA Annotation 사용 설정
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   // 5.Annotation 사용 설정
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;context:component-scan</span> <span style=color:#c4a000>base-package=</span><span style=color:#4e9a06>&#34;egovframework&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   // 6.Annotation 기반의 Transaction 활성화 설정 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;tx:annotation-driven</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>위의 예를 살펴보면 1.Transation Manager 설정, 2.Entity Manager Factory 설정, 3.DataSource 설정, 4.JPA Annotation 사용 설정, 5.Annotation 사용 설정, 6.Annotation 기반의 Transaction 활성화 설정 으로 구분되어 설정되어 있고 1~4까지가 JPA를 위한 설정이다. 각자 쓰고자 할때 변경이 필요한 부분은 2,3,5 내역으로 2번 항목은 persistence.xml 파일 위치와 persistenceUnitName 설정, 3번 항목은 DBMS연결을 위한 DataSource 설정, 5번 항목은 package 설정이다.</p><h2 id=jpatemplate-이용>JpaTemplate 이용</h2><p>Spring에서 정의한 JpaDaoSupport를 상속받아 getJpaTemplate()를 통해서 Entity Method 등을 호출 작업할 수 있다.</p><h4 id=dao-클래스-source>DAO 클래스 Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>UserDAO</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>JpaDaoSupport</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// Application Context 에서 설정한 Entity Manager Factory 명을 지정하여 부모의 EntityManagerFactory를 설정한다.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>setEMF</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>EntityManagerFactory</span> <span style=color:#000>entityManagerFactory</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEntityManagerFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entityManagerFactory</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// getTemplate()에 의한 입력	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>createUser</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJpaTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// getTemplate()에 의한 조회	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>User</span> <span style=color:#000>findUser</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>userId</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJpaTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>userId</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// getTemplate()에 의한 query .. find method 지원됨	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span> <span style=color:#000>findUserListAll</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJpaTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM User user ORDER BY user.userName&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// getTemplate()에 의한 삭제	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>removeUser</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJpaTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJpaTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getReference</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getUserId</span><span style=color:#ce5c00;font-weight:700>()));</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// getTemplate()에 의한 수정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>updateUser</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>User</span> <span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getJpaTemplate</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>user</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 JpaDaoSupport 를 상속받아서 this.getJpaTemplate().method()를 통해서 기능을 구현하였다.</p><h4 id=entity-클래스-source>Entity 클래스 Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>User</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>8077677670915867738L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;USER_ID&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;USER_NAME&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>userName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>password</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예제는 DAO 클래스에서 쓰인 User Entity Class 소스의 일부이다.</p><h2 id=plain-jpa-이용>Plain JPA 이용</h2><p>JPA에서 정의한 Entity Manager의 Entity Method를 호출 작업할 수 있다. Entity Manager를 통해 작업함으로써 Spring 환경하에서 Spring에 대한 의존성을 최소화 할 수 있다.</p><h4 id=dao-클래스-source-1>DAO 클래스 Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>RoleDAO</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// Application Context 설정의 4.JPA Annotation 사용 설정에 의해서 정의가능한 것으로 Annotation기반으로 Entity Manager를 지정한다.	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#5c35cc;font-weight:700>@PersistenceContext</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>EntityManager</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// EntityManager를 통한 입력	
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>createRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>persist</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// EntityManager를 통한 조회
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Role</span> <span style=color:#000>findRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>roleId</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>roleId</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// EntityManager를 통한 Query
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span> <span style=color:#000>findRoleListAll</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Query</span> <span style=color:#000>query</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createQuery</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FROM Role role ORDER BY role.roleName&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span>  <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getResultList</span><span style=color:#ce5c00;font-weight:700>();</span>		
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// EntityManager를 통한 삭제
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>removeRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getReference</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRoleId</span><span style=color:#ce5c00;font-weight:700>()));</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#8f5902;font-style:italic>// EntityManager를 통한 수정
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>   <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>updateRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>em</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>merge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 Entity Manager의 메소드를 통해서 기능을 구현하였다</p><h4 id=entity-클래스-source-1>Entity 클래스 Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Entity</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Role</span> <span style=color:#204a87;font-weight:700>implements</span> <span style=color:#000>Serializable</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1042037005623082102L</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Id</span>
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;ROLE_ID&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>roleId</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;ROLE_NAME&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>roleName</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>   <span style=color:#5c35cc;font-weight:700>@Column</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;DESC&#34;</span> <span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>length</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>50</span><span style=color:#ce5c00;font-weight:700>)</span>	
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>private</span> <span style=color:#000>String</span> <span style=color:#000>desc</span><span style=color:#ce5c00;font-weight:700>;</span>	
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예제는 DAO 클래스에서 쓰인 Role Entity Class 소스의 일부이다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8d50b52d2822868b4f7ed0f541314106>33 - JPA Configuration</h1><div class=lead><p>JPA는 persistence.xml 파일을 기반으로 동작하며, 이 파일은 실행 속성을 포함하고 여러 개의 persistence-unit을 정의할 수 있다. persistence.xml은 JPA 설정의 핵심 요소로, 상위에 <persistence>태그를 포함하고 있다.</p></div><h1 id=jpa-configuration>JPA Configuration</h1><p>JPA는 실행 속성을 포함하고 있는 persistence.xml을 기반으로 하여 동작하도록 구성되어 있다. persistence.xml 파일의 주요 구성 요소와 속성 정의 방법에 대해 살펴보기로 한다. 먼저, persistence.xml 파일은 가장 상위에 &lt;persistence> 태그를 포함하고 있으며 &lt;persistence> 태그 내에 여러개의 &lt;persistence-unit>를 포함할 수 있다.</p><h2 id=persistence-unit>Persistence Unit</h2><p>Persistence Unit에 포함하고 있는 주요한 엔티티들은 다음과 같다.</p><table><thead><tr><th>element 명</th><th>설 명</th></tr></thead><tbody><tr><td>provider</td><td>Entity Manager를 지원하는 Provider 클래스</td></tr><tr><td>mapping-file</td><td>매핑정보 파일</td></tr><tr><td>class</td><td>Entity 클래스 리스트, @Entity, @Embeddable or @MappedSuperclass 를 포함하고 있는 클래스</td></tr><tr><td>exclude-unlisted-classes</td><td>class 에서 정의하지 않은 것은 제외</td></tr><tr><td>properties</td><td>JPA 구현체 프로퍼티 리스트</td></tr></tbody></table><p>상세한 정보는 <a href=http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd>스키마</a> 참조 아래는 위의 항목을 포함하고 있는 설정파일 예입니다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;persistence-unit</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;HSQLMUnit&#34;</span> <span style=color:#c4a000>transaction-type=</span><span style=color:#4e9a06>&#34;RESOURCE_LOCAL&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;provider&gt;</span>org.hibernate.ejb.HibernatePersistence<span style=color:#204a87;font-weight:700>&lt;/provider&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;class&gt;</span>egovframework.sample.model.bidirection.User<span style=color:#204a87;font-weight:700>&lt;/class&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;exclude-unlisted-classes/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;properties&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.connection.driver_class&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;net.sf.log4jdbc.DriverSpy&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>      ...
</span></span></code></pre></div><h2 id=hibernate-properties>Hibernate Properties</h2><p>Properties 아래에 정의되는 Vendor별 설정 정보중에 Hibernate의 설정정보에 대해서 설명한다. 좀더 자세한 사항은 <a href=http://www.hibernate.org/hib_docs/reference/en/html/session-configuration.html>Hibernate사이트</a>를 참조한다.</p><h4 id=datasource-속성>DataSource 속성</h4><p>아래의 속성들을 통해 Hibernate는 특정 DB에 접근하여 데이터 액세스 처리가 가능하다.</p><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>hibernate.connection.driver_class</td><td>접근 대상이 되는 DB의 Driver 클래스명을 정의하기 위한 속성</td></tr><tr><td>hibernate.connection.url</td><td>접근 대상이 되는 DB의 URL을 정의하기 위한 속성</td></tr><tr><td>hibernate.connection.username</td><td>DB에 접근할 때 사용할 사용자명을 정의하기 위한 속성</td></tr><tr><td>hibernate.connection.password</td><td>DB에 접근할 때 사용할 패스워드를 정의하기 위한 속성</td></tr></tbody></table><p>다음은 위에서 언급한 속성들을 포함하고 있는 persistence.xml 파일의 일부이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.connection.driver_class&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;net.sf.log4jdbc.DriverSpy&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.connection.url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;jdbc:log4jdbc:hsqldb:mem:testdb&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.connection.username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;sa&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=generated-sql-속성>Generated SQL 속성</h4><p>아래의 속성들을 통해 Hibernate는 특정 DB에 접근하여 데이터 액세스 처리가 가능하다.</p><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>hibernate.dialect</td><td>Hibernate 기반 개발시 DB에 특화된 SQL을 구성하지 않더라도 DB에 따라 알맞은 SQL을 생성할 수 있다. 이를 위해서 Dialect 클래스를 사용한다. hibernate.dialect는 Dialect 클래스명을 정의하기 위한 속성</td></tr><tr><td>hibernate.default_schema</td><td>Hibernate에서 SQL을 생성할 때 특정 테이블에 대해 별도 정의된 Schema가 없는 경우 적용할 DB Schema 명을 정의하기 위한 속성</td></tr><tr><td>hibernate.default_catalog</td><td>Hibernate에서 SQL을 생성할 때 특정 테이블에 대해 별도 정의된 Catalog가 없는 경우 적용할 DB Catalog 명을 정의하기 위한 속성</td></tr></tbody></table><p>다음은 위에서 언급한 속성들을 포함하고 있는 persistence.xml 파일의 일부이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.dialect&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.hibernate.dialect.HSQLDialect&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>다음은 Hibernate에서 제공하는 주요 Dialect 클래스 목록이다</p><table><thead><tr><th>DB 종류</th><th>Dialect 클래스</th></tr></thead><tbody><tr><td>Oracle 10g</td><td>org.hibernate.dialect.Oracle10gDialect</td></tr><tr><td>Oracle 9i/10i</td><td>org.hibernate.dialect.Oracle9iDialect</td></tr><tr><td>Oracle (모든 버전)</td><td>org.hibernate.dialect.OracleDialect</td></tr><tr><td>MySQL 5.x</td><td>org.hibernate.dialect.MySQL5Dialect</td></tr><tr><td>MySQL 4.x, 3.x</td><td>org.hibernate.dialect.MySQLDialect</td></tr><tr><td>DB2</td><td>org.hibernate.dialect.DB2Dialect</td></tr><tr><td>Sybase 11.9.2</td><td>org.hibernate.dialect.Sybase11Dialect</td></tr><tr><td>Sybase Anywhere</td><td>org.hibernate.dialect.SybaseAnywhereDialect</td></tr></tbody></table><h4 id=cache-속성>Cache 속성</h4><p>아래의 속성들을 통해 Hibernate는 Cache 기능을 지원한다.</p><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>hibernate.cache.provider_class</td><td>Cache 기능을 구현하고 있는 구현체의 클래스명을 정의하기 위한 속성</td></tr><tr><td>hibernate.cache.use_second_level_cache</td><td>2nd Level Cache를 적용할지 여부를 정의하기 위한 속성 (true/false)</td></tr><tr><td>hibernate.cache.use_query_cache</td><td>Hibernate Query를 Caching할지 여부를 정의하기 위한 속성 (true/false)</td></tr></tbody></table><p>다음은 위에서 언급한 속성들을 포함하고 있는 persistence.xml 파일의 일부이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.cache.use_second_level_cache&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.cache.use_query_cache&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.cache.provider_class&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.hibernate.cache.EhCacheProvider&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=logging-속성>Logging 속성</h4><p>아래의 속성들을 통해 Hibernate는 좀더 자세한 Logging 기능을 지원한다.</p><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>hibernate.show_sql</td><td>Hibernate을 통해 생성된 SQL을 콘솔에 남길 것인지 여부를 정의하는 속성 (true/false)</td></tr><tr><td>hibernate.format_sql</td><td>hibernate.show_sql=true인 경우 해당 SQL문의 포맷을 정돈하여 콘솔에 남길 것인지 여부를 정의하는 속성 (true/false)</td></tr><tr><td>hibernate.use_sql_comments</td><td>Hibernate을 통해 생성된 SQL을 콘솔에 남길 때 Comments도 같이 남길 것인지 여부를 정의하는 속성 (true/false)</td></tr></tbody></table><p>다음은 위에서 언급한 속성들을 포함하고 있는 persistence.xml 파일의 일부이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.show_sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.format_sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=기타-속성>기타 속성</h4><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>hibernate.hbm2ddl.auto</td><td>DDL을 자동으로 검증,생성 또는 수정할지 여부를 정의하기 위한 속성 (validate/ update/ create/ create-drop)</td></tr><tr><td>hibernate.jdbc.batch_size</td><td>Hibernate는 일반적으로 실행해야 할 SQL들에 대해 일괄적으로 batch 처리를 수행하는데 이 때 batch로 처리할 SQL의 개수를 정의하기 위한 속성</td></tr></tbody></table><p>다음은 위에서 언급한 속성들을 포함하고 있는 persistence.xml 파일의 일부이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.hbm2ddl.auto&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;create-drop&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;hibernate.jdbc.batch_size&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;10&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4d382722195aa50fe41772f984d91b0a>34 - Transaction 서비스</h1><div class=lead>Spring 트랜잭션 서비스는 DataSource, JTA, JPA 트랜잭션 서비스를 지원하며, 트랜잭션 관리는 선언적 방식(Declarative)과 프로그래밍 방식(Programmatic)으로 수행할 수 있다. DataSource 트랜잭션 서비스는 로컬 트랜잭션 관리를 위한 설정 및 사용법을 제공한다.</div><h1 id=transaction-서비스>Transaction 서비스</h1><h2 id=개요>개요</h2><p>트랜잭션 서비스는 Spring 트랜잭션 서비스를 채택하여 가이드한다. 트랜잭션 서비스에는 여러가지가 있지만 여기서는 DataSource Transaction Service, JTA Transaction Service, JPA Transaction Service에 대해서 설명하고 트랜잭션 활용에 대해서는 설정 및 Annotation을 통해서 활용할 수 있는 Declaration Transaction Management와 프로그램에서 직접 API를 호출하여 쓸 수 있도록 하는 Programmatic Transaction Management 두가지에 대해서 설명한다.</p><ul><li><a href=./transaction-declarative-transaction-management.md>Declarative Transaction Management</a></li><li><a href=./transaction-programmatic-transaction-management.md>Programmatic Transaction Management</a></li></ul><h2 id=설명>설명</h2><h3 id=datasource-transaction-service>DataSource Transaction Service</h3><p>DataSource를 사용하여 Local Transaction을 관리할 수 있다. 아래에서 예를 들어서 설정 방법과 사용법을 설명한다.</p><p><b>Configuration</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.apache.commons.dbcp.BasicDataSource&#34;</span> <span style=color:#c4a000>destroy-method=</span><span style=color:#4e9a06>&#34;close&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;com.mysql.jdbc.Driver&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;dbc:mysql://db2:1621/rte&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;rte&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;xxx&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;defaultAutoCommit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>driverClassName</td><td>jdbc driver</td></tr><tr><td>url</td><td>db url</td></tr><tr><td>username</td><td>사용자명</td></tr><tr><td>password</td><td>패스워드</td></tr><tr><td>defaultAutoCommit</td><td>자동commit 설정</td></tr></tbody></table><p>위의 설정을 보면 transactionManager의 property로 dataSource를 지정하고 그에 필요한 driver정보,Url정보등을 지정한 것을 확인 할 수 있다. 설정한 dataSource 기반하에서 트랜잭션 서비스를 제공한다. 사이트 환경에 맞추어 driverClassName,url,username,password는 변경해서 적용한다.</p><p><b>Sample Source</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Resource</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>PlatformTransactionManager</span> <span style=color:#000>transactionManager</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span>    <span style=color:#000>TransactionStatus</span> <span style=color:#000>txStatus</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>transactionManager</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>txDefinition</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>위의 예와 같이 transactionManager을 활용할 수 있다.</p><h3 id=jta-transaction-service>JTA Transaction Service</h3><p>자바 트랜잭션 API(Java Transaction API, JTA)는 XA 리소스(예, 데이터베이스) 간의 분산 트랜잭션을 처리하는 자바 API이다.</p><p>Java에서 제공되는 대부분의 API와 마찬가지로, JTA는 실제 구현은 다르지만 어플리케이션이 공통적으로 사용할 수 있는 하나의 인터페이스를 제공한다. 이 말은 트랜잭션 처리가 필요한 어플리케이션이 (API의 사용 방식 그대로만 사용한다면) 특정 벤더의 트랜잭션 매니저에 의존할 필요가 없음을 의미한다.</p><p>그에따라, JTA는 일반적으로 단일 데이터베이스 또는 여러 개의 데이터베이스를 이용할 경우 트랜잭션을 제어하기 위한 목적으로 사용된다.</p><p>JTA를 이용하여 Global Transation관리를 할 수 있도록 지원하는 것으로 아래에서 예를 들어서 설정 방법을 설명한다. 사용법은 DataSource Transaction Service와 동일하다.</p><p><b>Configuration</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tx:jta-transaction-manager/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;jee:jndi-lookup</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>jndi-name=</span><span style=color:#4e9a06>&#34;dbmsXADS&#34;</span> <span style=color:#c4a000>resource-ref=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;jee:environment&gt;</span>
</span></span><span style=display:flex><span>         java.naming.factory.initial=weblogic.jndi.WLInitialContextFactory
</span></span><span style=display:flex><span>         java.naming.provider.url=t3://was:7002
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;/jee:environment&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/jee:jndi-lookup&gt;</span>
</span></span></code></pre></div><p>위의 설정예에서 jndi-name 과 java.naming.factory.initial,java.naming.provider.url은 사이트 환경에 맞추어 변경해야 한다. DataSource Transaction Service와는 달리 transationManager에 대해서 따로 bean 정의하지 않아도 된다.</p><h3 id=jpa-transaction-service>JPA Transaction Service</h3><p>JPA Transaction 서비스는 JPA EntityManagerFactory를 이용하여 트랜잭션을 관리한다. JpaTransactionManager는 EntityManagerFactory에 의존성을 가지고 있으므로 반드시 EntityManagerFactory 설정과 함께 정의되어야 한다. 아래에서 예를 들어서 설정 방법을 설명한다. 사용법은 DataSource Transaction Service와 동일하다.</p><p><b>Configuration</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.jpa.JpaTransactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;entityManagerFactory&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;persistenceUnitName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;OraUnit&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;persistenceXmlLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:META-INF/persistence.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.apache.commons.dbcp.BasicDataSource&#34;</span> <span style=color:#c4a000>destroy-method=</span><span style=color:#4e9a06>&#34;close&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;driverClassName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;com.mysql.jdbc.Driver&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;url&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;dbc:mysql://db2:1621/rte&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;username&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;rte&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;password&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;xxx&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;defaultAutoCommit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;false&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>driverClassName</td><td>jdbc driver</td></tr><tr><td>url</td><td>db url</td></tr><tr><td>username</td><td>사용자명</td></tr><tr><td>password</td><td>패스워드</td></tr><tr><td>defaultAutoCommit</td><td>자동commit 설정</td></tr><tr><td>persistenceUnitName</td><td>persistenceUnitName</td></tr><tr><td>persistenceXmlLocation</td><td>XML 위치</td></tr><tr><td>dataSource</td><td>데이타소스</td></tr></tbody></table><p>위의 설정을 보면 transactionManager의 property로 entiyManagerFactory로 지정하고 entityManagerFactory의 property로 dataSource를 지정하고 그에 필요한 driver정보,Url정보등을 지정한 것을 확인 할 수 있다. 설정한 dataSource 기반하에서 트랜잭션 서비스를 제공한다. 사이트 환경에 맞추어 driverClassName,url,username,password는 변경해서 적용한다. 또한 persistenceUnitName과 persistenceXmlLocation 정보를 지정하는 것을 알수 있다.</p><h2 id=참고자료>참고자료</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-032282c342bc4b7273d1026b001f454f>35 - 선언적 Transaction 관리</h1><div class=lead>Spring에서는 트랜잭션을 코드에서 직접 처리하지 않고, 애노테이션이나 XML 정의를 통해 선언적으로 관리할 수 있다. 애노테이션 기반 트랜잭션 관리는 설정과 사용법을 통해 간편하게 트랜잭션을 처리할 수 있다.</div><h1 id=declarative-transaction-management>Declarative Transaction Management</h1><h2 id=개요>개요</h2><p>코드에서 직접적으로 Transaction 처리하지 않고, 선언적으로 Transaction을 관리할 수 있는데 Annotation을 이용한 Transaction 관리, XML 정의를 이용한 Transaction 관리를 지원한다.</p><h2 id=설명>설명</h2><h3 id=annotation-transaction-management>Annotation Transaction Management</h3><p>Annotation 설정을 이용해서 Transaction을 관리할 수 있는데 아래에서 예를 들어서 설정 방법과 사용법을 설명한다.</p><h4 id=configuration>Configuration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;tx:annotation-driven</span> <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>설정 XML에 위의 &lt;tx:annotation-driven..>을 기재하면 설정된다. transactionManager는 <a href=./transaction.md>TransactionManager 설정</a> 참조</p><h4 id=sample-source>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Transactional</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>removeRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Role</span> <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>roleDAO</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>removeRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예를 보면 @Transactional을 트랜잭션 처리하고자 하는 메소드위에 기재하여 트랜잭션 관리를 할 수 있다. @Transactional에 속성을 정의하여 쓸 수 있는데 속성 목록은 아래와 같다.</p><table><thead><tr><th>속 성</th><th>설 명</th><th>사 용 예</th></tr></thead><tbody><tr><td>isolation</td><td>Transaction의 isolation Level 정의하는 요소. 별도로 정의하지 않으면 DB의 Isolation Level을 따름.</td><td>@Transactional(isolation=Isolation.DEFAULT)</td></tr><tr><td>noRollbackFor</td><td>정의된 Exception 목록에 대해서는 rollback을 수행하지 않음.</td><td>@Transactional(noRollbackFor=NoRoleBackTx.class)</td></tr><tr><td>noRollbackForClassName</td><td>Class 객체가 아닌 문자열을 이용하여 rollback을 수행하지 않아야 할 Exception 목록 정의</td><td>@Transactional(noRollbackForClassName=“NoRoleBackTx”)</td></tr><tr><td>propagation</td><td>Transaction의 propagation 유형을 정의하기 위한 요소</td><td>@Transactional(propagation=Propagation.REQUIRED)</td></tr><tr><td>readOnly</td><td>해당 Transaction을 읽기 전용 모드로 처리 (Default = false)</td><td>@Transactional(readOnly = true)</td></tr><tr><td>rollbackFor</td><td>정의된 Exception 목록에 대해서는 rollback 수행</td><td>@Transactional(rollbackFor=RoleBackTx.class)</td></tr><tr><td>rollbackForClassName</td><td>Class 객체가 아닌 문자열을 이용하여 rollback을 수행해야 할 Exception 목록 정의</td><td>@Transactional(rollbackForClassName=“RoleBackTx”)</td></tr><tr><td>timeout</td><td>지정한 시간 내에 해당 메소드 수행이 완료되지 않은 경우 rollback 수행. -1일 경우 no timeout (Default = -1)</td><td>@Transactional(timeout=10)</td></tr></tbody></table><h3 id=configurational-transaction-management>Configurational Transaction Management</h3><p>XML 정의 설정을 이용해서 Transaction을 관리할 수 있는데 아래에서 예를 들어서 설정 방법과 사용법을 설명한다.</p><h4 id=configuration-1>Configuration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;aop:config&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:pointcut</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;requiredTx&#34;</span> <span style=color:#c4a000>expression=</span><span style=color:#4e9a06>&#34;execution(* egovframework.sample..impl.*Impl.*(..))&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;aop:advisor</span> <span style=color:#c4a000>advice-ref=</span><span style=color:#4e9a06>&#34;txAdvice&#34;</span> <span style=color:#c4a000>pointcut-ref=</span><span style=color:#4e9a06>&#34;requiredTx&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/aop:config&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;tx:advice</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;txAdvice&#34;</span> <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;tx:attributes&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tx:method</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;find*&#34;</span> <span style=color:#c4a000>read-only=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tx:method</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;createNoRBRole&#34;</span> <span style=color:#c4a000>no-rollback-for=</span><span style=color:#4e9a06>&#34;NoRoleBackTx&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tx:method</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;createRBRole&#34;</span> <span style=color:#c4a000>rollback-for=</span><span style=color:#4e9a06>&#34;RoleBackTx&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tx:method</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;create*&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/tx:attributes&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/tx:advice&gt;</span>
</span></span></code></pre></div><p>위의 설정을 보면 aop:pointcut를 이용하여 실행되어 Catch해야 하는 Method를 지정하고 tx:advice를 통해서 각각에 대한 룰을 정의하고 있다. 이렇게 정의하면 프로그램내에서는 별도의 트랜잭션 관련한 사항에 대해서 기술하지 않아도 트랜잭션관리가 된다. 위 샘플 XML에서와 같이 Transaction 관리를 위해 <a href=tx:advice>tx:advice</a> 하위 태그인 <a href=tx:method>tx:method</a>에는 다음과 같은 상세 속성 정보를 부여할 수 있다. 관련 속성 정보는 아래와 같다.</p><table><thead><tr><th>속 성</th><th>설 명</th><th>사 용 예</th></tr></thead><tbody><tr><td>name</td><td>메소드명 기술. 와일드카드 사용 가능함</td><td>name=“find*”</td></tr><tr><td>isolation</td><td>Transaction의 isolation Level 정의하는 요소. 별도로 정의하지 않으면 DB의 Isolation Level을 따름.</td><td>isolation=“DEFAULT”</td></tr><tr><td>no-rollback-for</td><td>정의된 Exception 목록에 대해서는 rollback을 수행하지 않음.</td><td>no-rollback-for=“NoRoleBackTx”</td></tr><tr><td>propagation</td><td>Transaction의 propagation 유형을 정의하기 위한 요소</td><td>propagation=“REQUIRED”</td></tr><tr><td>read-only</td><td>해당 Transaction을 읽기 전용 모드로 처리 (Default = false)</td><td>read-only=“true”</td></tr><tr><td>rollback-for</td><td>정의된 Exception 목록에 대해서는 rollback 수행</td><td>rollback-for=“RoleBackTx”</td></tr><tr><td>timeout</td><td>지정한 시간 내에 해당 메소드 수행이 완료되지 않은 경우 rollback 수행. -1일 경우 no timeout (Default = -1)</td><td>timeout=“10”</td></tr></tbody></table><p>관련 속성별 가능 값 정보는 <a href=http://www.springframework.org/schema/tx/spring-tx-2.5.xsd>스키마</a> 참조.</p><h3 id=propagation-behavior-isolation-level>Propagation Behavior, Isolation Level</h3><p>위에서 설명한 두가지 Transaction Management에 공통적으로 사용되는 항목은 Propagation 과 Isolation Level에 대한 설명을 하고자 한다.</p><h4 id=propagation-behavior>Propagation Behavior</h4><p>트랜잭션의 전파 규칙을 설정하기 위해 사용한다.</p><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>PROPAGATION_MADATORY</td><td>반드시 Transaction 내에서 메소드가 실행되어야 한다. 없으면 예외발생</td></tr><tr><td>PROPAGATION_NESTED</td><td>Transaction에 있는 경우, 기존 Transaction 내의 nested transaction 형태로 메소드를 실행하고, nested transaction 자체적으로 commit, rollback이 가능하다. Transaction이 없는 경우, PROPAGATION_REQUIRED 속성으로 행동한다. nested transaction 형태로 실행될 때는 수행되는 변경사항이 커밋이 되기 전에는 기존 Transaction에서 보이지 않는다.</td></tr><tr><td>PROPAGATION_NEVER</td><td>Manatory와 반대로 Transaction 없이 실행되어야 하며 Transaction이 있으면 예외를 발생시킨다.</td></tr><tr><td>PROPAGATION_NOT_SUPPORTED</td><td>Transaction 없이 메소드를 실행하며,기존의 Transaction이 있는 경우에는 이 Transaction을 호출된 메소드가 끝날 때까지 잠시 보류한다</td></tr><tr><td>PROPAGATION_REQUIRED</td><td>기존 Transaction이 있는 경우에는 기존 Transaction 내에서 실행하고, 기존 Transaction이 없는 경우에는 새로운 Transaction을 생성한다.</td></tr><tr><td>PROPAGATION_REQUIRED_NEW</td><td>호출되는 메소드는 자신 만의 Transaction을 가지고 실행하고, 기존의 Transaction들은 보류된다</td></tr><tr><td>PROPAGATION_SUPPORTS</td><td>새로운 Transaction을 필요로 하지는 않지만, 기존의 Transaction이 있는 경우에는 Transaction 내에서 메소드를 실행한다.</td></tr></tbody></table><h4 id=isolation-level>Isolation Level</h4><p>Transaction에서 일관성이 없는 데이터를 허용하도록 하는 수준이며, 여러 Transaction들이 다른 Transaction의 방해로부터 보호되는 정도를 나타낸다. 좀더 자세한 설명은 <a href=http://en.wikipedia.org/wiki/Isolation_level>여기</a> 참고.</p><table><thead><tr><th>속 성 명</th><th>설 명</th></tr></thead><tbody><tr><td>ISOLATION_DEFAULT</td><td>개별적인 PlatformTransactionManager를 위한 격리 레벨</td></tr><tr><td>ISOLATION_READ_COMMITTED</td><td>이 격리수준을 사용하는 메소드는 commit 되지 않은 데이터를 읽을 수 없다. 쓰기 락은 다른 Transaction에 의해 이미 변경된 데이터는 얻을수 없다. 따라서 조회 중인 commit 되지 않은 데이터는 불가능하다. 대개의 데이터베이스에서의 디폴트로 지원하는 격리 수준이다.</td></tr><tr><td>ISOLATION_READ_UNCOMMITTED</td><td>가장 낮은 Transaction 수준이다. 이 격리수준을 사용하는 메소드는 commit 되지 않은 데이터를 읽을 수 있다. 그러나 이 격리수준은 새로운 레코드가 추가되었는지 알수 없다.</td></tr><tr><td>ISOLATION_REPEATABLE_READ</td><td>ISOLATION_READ_COMMITED 보다는 다소 조금 더 엄격한 격리 수준이다. 이 격리 수준은 다른 Transaction이 새로운 데이터를 입력했다면, 새롭게 입력된 데이터를 조회할 수 있다는 것을 의미한다.</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>가장 높은 격리수준이다. 모든 Transaction(조회를 포함하여)은 각 라인이 실행될 때마다 기다려야 하기 때문에 매우 느리다. 이 격리수준을 사용하는 메소드는 데이터 상에 배타적 쓰기를 락을 얻음으로써 Transaction이 종료될 때까지 조회, 수정, 입력 데이터로부터 다른 Transaction의 처리를 막는다. 가장 많은 비용이 들지만 신뢰할만한 격리 수준을 제공하는 것이 가능하다.</td></tr></tbody></table><h2 id=참고자료>참고자료</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-872036067b899e847ab82d5662739e4a>36 - 프로그래밍 방식의 Transaction 관리</h1><div class=lead>프로그래밍 방식으로 트랜잭션을 관리할 때는 TransactionTemplate을 사용하거나 Transaction Manager를 사용하는 방법이 있다. TransactionTemplate은 콜백 메소드를 정의해 트랜잭션을 처리하는 방법을 제공한다.</div><h1 id=programmatic-transaction-management>Programmatic Transaction Management</h1><h2 id=개요>개요</h2><p>프로그램에서 직접 트랜잭션을 관리하고자 할 때 사용할 수 있는 방법에 대해서 설명하고자 한다. TransactionTemplate를 사용하는 방법과 Trnasaction Manager를 사용하는 방법 두가지가 있다.</p><h2 id=설명>설명</h2><h3 id=transactiontemplate를-사용하는-방법>TransactionTemplate를 사용하는 방법</h3><p>TransactionTemplate를 정의하고 callback 메소드 정의를 이용하여 Transaction 관리를 할 수 있도록 하는 방법이다.</p><p><b>Configuration</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionTemplate&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.transaction.support.TransactionTemplate&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>transactionManager</td><td>트랜잭션매니저</td></tr><tr><td>dataSource</td><td>데이타소스</td></tr></tbody></table><p>위의 설정에서 transactionTemplate를 정의하고 property로 transactionManager을 정의한다. Templeate를 이용한 샘플은 아래와 같다.</p><h4 id=sample-source>Sample Source&lt;</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testInsertCommit</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>transactionTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TransactionCallbackWithoutResult</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>doInTransactionWithoutResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TransactionStatus</span> <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>Role</span> <span style=color:#000>role</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>            <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRoleId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ROLE-001&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRoleName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ROLE-001&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRoleDesc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Integer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>            <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRollbackOnly</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>});</span>		
</span></span><span style=display:flex><span>   <span style=color:#000>Role</span> <span style=color:#000>retRole</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>findRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;ROLE-001&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>		
</span></span><span style=display:flex><span>   <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;roleName Compare OK&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#000>retRole</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRoleName</span><span style=color:#ce5c00;font-weight:700>(),</span><span style=color:#4e9a06>&#34;ROLE-001&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>위의 예에서 transactionTemplate.execute에 TransactionCallbackWithoutResult를 정의하여 Transaction 관리를 하는 것을 확인할 수 있다.</p><h4 id=사용-방법>사용 방법</h4><p>Transaction Context에 의해 호출될 callback 메소드를 정의하고 이 메소드 내에 비즈니스 로직을 구현해주면 된다. 아래는 사용하는 방법의 예이다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>transactionTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TransactionCallbackWithoutResult</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>                
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>doInTransactionWithoutResult</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TransactionStatus</span> <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>                    
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>//... biz. logic ...       
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>});</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>transactionTemplate</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execute</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>TransactionCallback</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>                
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Object</span> <span style=color:#000>doInTransaction</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TransactionStatus</span> <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>                    
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>//... biz. logic ...       
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>});</span>
</span></span></code></pre></div><p>callback 메소드 doInTransactionWithoutResult()는 Result 값이 없을 경우에 사용하고, Result 값이 존재하는 경우에는 doInTransaction()으로 사용하도록 한다. 또한, callback 메소드 내에서 입력 인자인 TransactionStatus 객체의 setRollbackOnly() 메소드를 호출함으로써 해당 Transaction을 rollback할 수 있다.</p><h3 id=trnasaction-manager를-사용하는-방법>Trnasaction Manager를 사용하는 방법</h3><p>Transaction Manager를 직접 이용하는 방법이다.</p><h4 id=configuration>Configuration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><table><thead><tr><th>PROPERTIES</th><th>설 명</th></tr></thead><tbody><tr><td>dataSource</td><td>데이타소스</td></tr></tbody></table><p>위의 설정에서 transactionManager을 정의한다.</p><h4 id=sample-source-1>Sample Source</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>testInsertRollback</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>prevCommitCount</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCommitCount</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>prevRollbackCount</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRollbackCount</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#000>DefaultTransactionDefinition</span> <span style=color:#000>txDefinition</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DefaultTransactionDefinition</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>txDefinition</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setPropagationBehavior</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>TransactionDefinition</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PROPAGATION_REQUIRED</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>TransactionStatus</span> <span style=color:#000>txStatus</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>transactionManager</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTransaction</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>txDefinition</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Role</span> <span style=color:#000>role</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Role</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRoleId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Thread</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>currentThread</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;-roleId&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRoleName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Thread</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>currentThread</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;-roleName&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setRoleDesc</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Integer</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1000</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>        <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createRole</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>role</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>transactionManager</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>commit</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>txStatus</span><span style=color:#ce5c00;font-weight:700>);</span>		
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Exception</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>transactionManager</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>rollback</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>txStatus</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>prevCommitCount</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getCommitCount</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#000>assertEquals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>prevRollbackCount</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>roleService</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getRollbackCount</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Transaction 서비스를 직접 얻어온 후에 위와 같이 try~catch 구문 내에서 Transaction 서비스를 이용하여, 적절히 begin, commit, rollback을 수행한다. 이 때, TransactionDefinition와 TransactionStatus 객체를 적절히 이용하면 된다.</p><h2 id=참고자료>참고자료</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-a7cf39ebb6d7f307603008511f9ac2e3>37 - Spring Data - Reactive</h1><div class=lead>Spring Data는 데이터베이스와의 상호작용을 단순화하고 다양한 데이터 저장소 기술을 지원하는 하위 프로젝트로, Reactive 프로그래밍과의 연동을 지원한다. 이를 통해 NoSQL 데이터베이스인 R2DBC, MongoDB, Cassandra, Redis와의 비동기적 데이터 처리 기능을 제공한다. 전자정부 표준프레임워크에서도 이와 관련된 라이브러리를 지원한다.</div><h1 id=spring-data---reactive>Spring Data - Reactive</h1><h2 id=개요>개요</h2><p>Spring Data는 스프링 프레임워크의 하위 프로젝트 중 하나로, 데이터 액세스를 단순화하고 보다 쉽게 관리할 수 있도록 지원하는 도구 모음이다. 주로 데이터베이스와의 상호 작용을 다루며, 다양한 데이터 저장소 및 데이터 액세스 기술을 지원한다.<br>여기서는 NoSQL 데이터베이스인 R2DBC, Spring Data MongoDB, Cassandra, Redis와 Spring Reactive 연동에 전자정부 표준프레임워크에서 지원하는 라이브러리에 대해 설명한다.<br>자세한 내용은 아래 페이지에서 확인할 수 있다.</p><ul><li><a href=./reactive-r2dbc.md>R2DBC</a></li><li><a href=./reactive-mongodb.md>MongoDB</a></li><li><a href=./reactive-cassandra.md>Cassandra</a></li><li><a href=./reactive-redis.md>Redis</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-78a8d1019dfc38342808d17a2d018a74>38 - R2DBC</h1><div class=lead>R2DBC는 비동기적 방식으로 관계형 데이터베이스와 상호작용하기 위한 자바 라이브러리로, Spring WebFlux와 함께 리액티브 애플리케이션을 구성할 수 있다. 데이터베이스에 액세스하려면 ConnectionFactory 객체를 생성하여 공통으로 사용하며, 데이터베이스 종류에 따라 다른 구현체를 사용한다.</div><h1 id=r2dbc>R2DBC</h1><h2 id=개요>개요</h2><p>R2DBC(Relational Reactive Database Connectivity)는 Reactive 프로그래밍 모델을 기반으로 하는 비동기적인 방식으로 관계형 데이터베이스와 상호 작용하기 위한 자바 라이브러리로 Spring WebFlux와 함께 사용하여 비동기 논블로킹 방식의 애플리케이션을 구성할 수 있다. 이를 통해 리액티브 애플리케이션 스택에서 관계형 데이터 액세스 기술을 사용하는 Spring 기반 애플리케이션을 더 쉽게 빌드할 수 있다.</p><h2 id=설명>설명</h2><h3 id=데이터베이스-연동>데이터베이스 연동</h3><p>R2DBC를 사용하여 데이터베이스에 액세스하기 위해 가장 먼저 해야 할 일은 JDBC의 DataSource와 비슷한 역할을 하는 ConnectionFactory 객체를 만드는 것이다.<br>ConnectionFactory를 생성하는 가장 간단한 방법은 ConnectionFactories 클래스를 사용하는 것인데 이 클래스에는 ConnectionFactoryOptions 객체를 받아 ConnectionFactory를 반환하는 정적 메서드가 있다.<br>ConnectionFactory의 인스턴스는 하나만 필요하며, 데이터베이스 종류 및 데이터베이스 드라이버에 따라 구현체가 다를 수 있으므로 공통으로 사용할 수 있게 실행환경에 구성하고 애플리케이션 구성에서 필요할 때마다 주입을 통해 사용할 수 있도록 제공한다.</p><h4 id=실행환경-라이브러리>실행환경 라이브러리</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.r2dbc.connect</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovR2dbcConnectionFactory</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ConnectionFactory</span> <span style=color:#000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>ConnectionFactories</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r2dbcUrl</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=적용-예제>적용 예제</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovframework.webflux.config</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.egovframe.rte.psl.reactive.r2dbc.connect.EgovR2dbcConnectionFactory</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>......</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovR2dbcConfig</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;connectionFactory&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ConnectionFactory</span> <span style=color:#000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EgovR2dbcConnectionFactory</span> <span style=color:#000>egovR2dbcConnectionFactory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EgovR2dbcConnectionFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>r2dbcUrl</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>egovR2dbcConnectionFactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=repository-구성>Repository 구성</h3><p>R2DBC는 스프링 생태계와 통합되어 있어 스프링 기반 애플리케이션에서 쉽게 사용할 수 있으며, 스프링 데이터 R2DBC 프로젝트를 통해 스프링의 강력한 기능과 R2DBC의 비동기 데이터베이스 액세스를 결합할 수 있다.<br>R2dbcEntityTemplate은 객체와 관계형 데이터베이스 간의 매핑을 지원하므로 SQL 쿼리를 직접 작성하지 않고도 객체를 데이터베이스 테이블에 매핑할 수 있으며, CRUD 작업을 단순화하여 개발자는 복잡한 SQL 쿼리를 작성하는 대신 객체 지향적인 방식으로 데이터베이스와 상호 작용할 수 있어 코드 가독성이 향상되고 유지 보수가 용이해진다.</p><h4 id=실행환경-라이브러리-1>실행환경 라이브러리</h4><p>@Repository 클래스에 EgovR2dbcRepository 클래스를 extends 하여 insertData, updateData, deleteData, selectAllData 메소드를 활용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.r2dbc.repository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovR2dbcRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>R2dbcEntityTemplate</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EgovR2dbcRepository</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ConnectionFactory</span> <span style=color:#000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Flux</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectAllData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>select</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectOneData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>selectOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>countData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>count</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>insertData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>updateData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>deleteData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=https://docs.spring.io/spring-data/r2dbc/docs/1.5.12/reference/html/>Spring Data R2DBC - Reference Documentation</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-69b177967de51129d841ccbb03dc7514>39 - MongoDB</h1><div class=lead>Spring Data MongoDB는 MongoDB 문서형 데이터 저장소와의 연동을 위한 고수준 추상화 템플릿을 제공하며, Spring JDBC 지원 방식과 유사하다. SimpleReactiveMongoDatabaseFactory 클래스를 사용해 MongoDB 연결을 관리하고, 데이터 액세스 작업에 집중할 수 있도록 지원한다.</div><h1 id=mongodb>MongoDB</h1><h2 id=개요>개요</h2><p>Spring Data MongoDB 프로젝트는 MongoDB 문서 스타일 데이터 저장소를 사용하는 솔루션 개발에 Spring의 핵심 개념을 적용하여 문서를 저장하고 쿼리하기 위한 높은 수준의 추상화 템플릿을 제공한다. Spring 프레임워크에서 제공하는 JDBC 지원과 유사하다는 것을 알 수 있다.</p><h2 id=설명>설명</h2><h3 id=데이터베이스-연동>데이터베이스 연동</h3><p>Spring WebFlux에서 MongoDB 데이터베이스와 연결을 설정하고 관리하기 위해서는 ReactiveMongoDatabaseFactory 인터페이스의 구현클래스인 SimpleReactiveMongoDatabaseFactory 클래스를 사용하여, 연결 풀링이나 커넥션 관리 기능 등을 추상화하여 데이터 액세스 작업에 집중할 수 있게 한다.</p><h4 id=실행환경-라이브러리>실행환경 라이브러리</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.mongodb.connect</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovMongoDbConnectionFactory</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveMongoDatabaseFactory</span> <span style=color:#000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>ConnectionString</span> <span style=color:#000>connectionString</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ConnectionString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>mongoDbUrl</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>MongoClientSettings</span> <span style=color:#000>mongoClientSettings</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>MongoClientSettings</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>builder</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>applyConnectionString</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>connectionString</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>SimpleReactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#000>MongoClients</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>create</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>mongoClientSettings</span><span style=color:#ce5c00;font-weight:700>),</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>mongoDbName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=적용-예제>적용 예제</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovframework.webflux.config</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.egovframe.rte.psl.reactive.mongodb.connect.EgovMongoDbConnectionFactory</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>......</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovMongodbConfig</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;reactiveMongoDatabaseFactory&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveMongoDatabaseFactory</span> <span style=color:#000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EgovMongoDbConnectionFactory</span> <span style=color:#000>egovMongoDbConnectionFactory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EgovMongoDbConnectionFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>mongoDBName</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>mongoDBUrl</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>egovMongoDbConnectionFactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveMongoTransactionManager</span> <span style=color:#000>transactionManager</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;reactiveMongoDatabaseFactory&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#000>ReactiveMongoDatabaseFactory</span> <span style=color:#000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>ReactiveMongoTransactionManager</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=repository-구성>Repository 구성</h3><p>ReactiveMongoTemplate 클래스를 이용하여 Repository를 구성하면 MongoDB와 상호 작용하는 동안 Reactive 프로그래밍 모델을 활용할수 있고, Async Non-Blocking 데이터 처리가 가능하여 애플리케이션이 데이터베이스 작업을 대기하지 않고 다른 작업을 수행할 수 있도록 하며, 성능 향상을 실현할 수 있다. 또한 높은 동시 요청을 처리하기 위해 최적화되어 있어 논블로킹 작업을 통해 많은 동시 연결을 처리할 수 있으므로, 대규모 및 고트래픽 애플리케이션에 적합하다. 그리고 Reactive 프로그래밍은 자원을 효율적으로 사용할 수 있도록 도와준다. MongoDB 작업이 블로킹되지 않으므로 스레드 풀 및 메모리 자원을 효율적으로 관리할 수 있으며 MongoDB 연결을 관리하고 에러 처리를 담당하여 연결 풀링, 재시도 메커니즘 및 예외 처리를 제공하여 안정성을 향상시킨다.</p><h4 id=실행환경-라이브러리-1>실행환경 라이브러리</h4><p>@Repository 클래스에 EgovMongoDbRepository 클래스를 extends 하여 insertData, updateData, deleteData, selectAllData 메소드를 활용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.mongodb.repository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovMongoDbRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>ReactiveMongoTemplate</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EgovMongoDbRepository</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ReactiveMongoDatabaseFactory</span> <span style=color:#000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>reactiveMongoDatabaseFactory</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Flux</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectAllData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>find</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectOneData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>findOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>countData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>count</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>insertData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>objectToSave</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>objectToSave</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>updateData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Update</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>findAndModify</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>deleteData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>findAndRemove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=https://docs.spring.io/spring-data/mongodb/docs/3.4.12/reference/html/>Spring Data MongoDB - Reference Documentation</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-19e5c7e551bfe26f47d2680ecc30f088>40 - Cassandra</h1><div class=lead>Spring Data Cassandra는 Cassandra 데이터베이스와의 연동을 위한 고수준 추상화 템플릿을 제공하며, Spring의 JDBC 지원 방식과 유사하다. 비동기적인 상호 작용을 위해 DefaultBridgedReactiveSession 클래스를 사용하여 Cassandra 클러스터에 연결하고, 비동기 쿼리를 실행 및 관리할 수 있다.</div><h1 id=cassandra>Cassandra</h1><h2 id=개요>개요</h2><p>Cassandra를 위한 Spring 데이터 프로젝트는 핵심 Spring 개념을 Cassandra 컬럼형 데이터 저장소를 사용하는 솔루션 개발에 적용하여 문서를 저장하고 쿼리하기 위한 높은 수준의 추상화 템플릿을 제공한다. Spring 프레임워크에서 제공하는 JDBC 지원과 유사하다는 것을 알 수 있다.</p><h2 id=설명>설명</h2><h3 id=데이터베이스-연동>데이터베이스 연동</h3><p>Spring Data Cassandra와 Spring WebFlux를 함께 사용하여 Cassandra 데이터베이스와의 비동기적인 상호 작용을 지원하기 위해 Spring Data Cassandra에서 제공하는 DefaultBridgedReactiveSession 클래스를 사용한다. 해당 클래스를 사용하여 Cassandra 클러스터에 대한 연결을 설정하고, 세션을 관리하며 비동기 쿼리를 실행하고 결과를 처리할 수 있다.</p><h4 id=실행환경-라이브러리>실행환경 라이브러리</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.cassandra.connect</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovCassandraConfiguration</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveSession</span> <span style=color:#000>reactiveSession</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>DefaultBridgedReactiveSession</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#000>CqlSession</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>builder</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>withLocalDatacenter</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getDataCenterName</span><span style=color:#ce5c00;font-weight:700>())</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>withKeyspace</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getKeyspaceName</span><span style=color:#ce5c00;font-weight:700>())</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addContactPoint</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>InetSocketAddress</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>createUnresolved</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getContactPoint</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>getPort</span><span style=color:#ce5c00;font-weight:700>()))</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>withAuthCredentials</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>getUsername</span><span style=color:#ce5c00;font-weight:700>(),</span> <span style=color:#000>getPassword</span><span style=color:#ce5c00;font-weight:700>())</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=적용-예제>적용 예제</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovframework.webflux.config</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>org.egovframe.rte.psl.reactive.cassandra.connect.EgovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>......</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovCassandraConfig</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;reactiveSession&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveSession</span> <span style=color:#000>reactiveSession</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EgovCassandraConfiguration</span> <span style=color:#000>egovCassandraConfiguration</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EgovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>        <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setDataCenterName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>dataCenterName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setKeyspaceName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>keyspaceName</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setContactPoint</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>contactPoints</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setPort</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>port</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setUsername</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>username</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setPassword</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>password</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>egovCassandraConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>reactiveSession</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=repository-구성>Repository 구성</h3><p>Spring WebFlux와 ReactiveCassandraTemplate을 사용하면 비동기, 논블로킹 처리와 높은 가용성을 통한 효율적인 Cassandra 데이터베이스 상호 작용을 달성할 수 있으며 확장성, 효율성, 그리고 반응형 스트리밍을 통해 데이터베이스 처리를 최적화할 수 있다. 또한 Flux 및 Mono와 같은 리액티브 타입을 사용하여 스트림 데이터를 다룰 수 있으며, 실시간 데이터 처리 및 웹 소켓과 같은 실시간 기능을 구현하기가 용이하다.</p><h4 id=실행환경-라이브러리-1>실행환경 라이브러리</h4><p>@Repository 클래스에 EgovCassandraRepository 클래스를 extends 하여 insertData, updateData, deleteData, selectAllData 메소드를 활용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.cassandra.repository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovCassandraRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>ReactiveCassandraTemplate</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EgovCassandraRepository</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ReactiveSession</span> <span style=color:#000>reactiveSession</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>reactiveSession</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Flux</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectAllData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>select</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectOneData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>selectOne</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>countData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Query</span> <span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Class</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>count</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>query</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entityClass</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>insertData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>insert</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>updateData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>update</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>deleteData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=https://docs.spring.io/spring-data/cassandra/docs/3.4.12/reference/html/>Spring Data for Apache Cassandra - Reference Documentation</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-1a8028e2da9a5dfe75b15e537b4e1e39>41 - Redis</h1><div class=lead>Spring Data Redis는 키-값 데이터 저장소인 Redis와의 상호작용을 위해 높은 수준의 추상화 템플릿을 제공하며, Spring의 JDBC 지원 방식과 유사하다. LettuceConnectionFactory 클래스를 사용해 비동기적으로 Redis와 연결하고, 데이터베이스 세션 관리 및 쿼리 실행을 지원한다.</div><h1 id=redis>Redis</h1><h2 id=개요>개요</h2><p>Spring Data Redis 프로젝트는 키-값 스타일 데이터 저장소를 사용하여 솔루션 개발에 핵심 Spring 개념을 적용하여 메시지를 주고받기 위한 높은 수준의 추상화 템플릿을 제공한다. Spring 프레임워크의 JDBC 지원과 유사하다는 것을 알 수 있다.</p><h2 id=설명>설명</h2><h3 id=데이터베이스-연동>데이터베이스 연동</h3><p>Spring Data Redis와 Spring WebFlux를 함께 사용하여 Redis 데이터베이스와의 비동기적인 상호 작용을 지원하기 위해 Spring Data Redis에서 제공하는 ReactiveRedisConnectionFactory 인터페이스의 구현클래스인 LettuceConnectionFactory 클래스를 사용한다. 해당 클래스를 사용하여 데이터베이스 연결을 설정하고, 세션을 관리하며 비동기 쿼리를 실행하고 결과를 처리할 수 있다.</p><h4 id=실행환경-라이브러리>실행환경 라이브러리</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.redis.connect</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovRedisConfiguration</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveRedisConnectionFactory</span> <span style=color:#000>reactiveRedisConnectionFactory</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>LettuceConnectionFactory</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>host</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>port</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h4 id=적용-예제>적용 예제</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>egovframework.webflux.config</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovRedisConfig</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;reactiveRedisConnectionFactory&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>ReactiveRedisConnectionFactory</span> <span style=color:#000>reactiveRedisConnectionFactory</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>EgovRedisConfiguration</span> <span style=color:#000>egovRedisConfiguration</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>EgovRedisConfiguration</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>host</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>port</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>egovRedisConfiguration</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>reactiveRedisConnectionFactory</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;idsSerializationContext&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>RedisSerializationContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Ids</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>idsReactiveRedisTemplate</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Jackson2JsonRedisSerializer</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Ids</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>serializer</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Jackson2JsonRedisSerializer</span><span style=color:#ce5c00;font-weight:700>&lt;&gt;(</span><span style=color:#000>Ids</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>RedisSerializationContext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RedisSerializationContextBuilder</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Ids</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>builder</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>RedisSerializationContext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newSerializationContext</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ew</span> <span style=color:#000>StringRedisSerializer</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>builder</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>value</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>serializer</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>hashValue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>serializer</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>hashKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>serializer</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#5c35cc;font-weight:700>@Bean</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;sampleSerializationContext&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>RedisSerializationContext</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Sample</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>sampleReactiveRedisTemplate</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Jackson2JsonRedisSerializer</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Sample</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>serializer</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Jackson2JsonRedisSerializer</span><span style=color:#ce5c00;font-weight:700>&lt;&gt;(</span><span style=color:#000>Sample</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>RedisSerializationContext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>RedisSerializationContextBuilder</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>Sample</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>builder</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>                <span style=color:#000>RedisSerializationContext</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newSerializationContext</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>StringRedisSerializer</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>builder</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>value</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>serializer</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>hashValue</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>serializer</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>hashKey</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>serializer</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=repository-구성>Repository 구성</h3><p>Spring WebFlux와 ReactiveRedisTemplate을 이용을 사용하면 Async Non-Blocking 처리로 I/O 밀집적인 작업을 효율적으로 처리 가능하여 대량의 동시 요청을 효과적으로 처리하고 확장 가능한 애플리케이션을 개발할 수 있다. 또한, Redis 데이터베이스에 비동기 쿼리를 보내고 전반적인 성능을 향상시킬 수 있어 데이터 스트리밍과 실시간 데이터 처리에 적합하다. 그리고, Spring 프레임워크와의 원활한 통합으로 풍부한 개발 환경을 제공하며 모델의 일관성을 유지하고 유지 관리를 간편하게 할 수 있다.</p><h4 id=실행환경-라이브러리-1>실행환경 라이브러리</h4><p>@Repository 클래스에 EgovRedisRepository 클래스를 extends 하여 insertData, updateData, deleteData, selectData 메소드를 활용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>org.egovframe.rte.psl.reactive.redis.repository</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovRedisRepository</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#204a87;font-weight:700>extends</span> <span style=color:#000>ReactiveRedisTemplate</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>EgovRedisRepository</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>ReactiveRedisConnectionFactory</span> <span style=color:#000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>RedisSerializationContext</span> <span style=color:#000>serializationContext</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>super</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>connectionFactory</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>serializationContext</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Flux</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>selectData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>range</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>findIndex</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>indexOf</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>countData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>size</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>insertData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>leftPush</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>updateData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>idx</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>set</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>idx</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>deleteAllData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>delete</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Mono</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Boolean</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>deleteData</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>T</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>opsForList</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>redisKey</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>entity</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=참고자료>참고자료</h2><ul><li><a href=https://docs.spring.io/spring-data/redis/docs/2.7.12/reference/html/>Spring Data Redis</a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/eGovFramework/egovframe-docs aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2016&ndash;2024
<span class=td-footer__authors>eGovFrame | <a href="https://www.egovframe.go.kr/home/sub.do?menuNo=23">Apache 2.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href="https://www.egovframe.go.kr/home/sub.do?menuNo=77" target=_blank rel=noopener>개인정보 보호 정책</a></span></div></div></div></footer></div><script src=/egovframe-docs/js/main.min.4eb19af2236072614b7d308c10176f918f1b447443492377d98b5b2c5e44aac3.js integrity="sha256-TrGa8iNgcmFLfTCMEBdvkY8bRHRDSSN32YtbLF5EqsM=" crossorigin=anonymous></script>
<script defer src=/egovframe-docs/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script>
<script src=/egovframe-docs/js/tabpane-persist.js></script></body></html>