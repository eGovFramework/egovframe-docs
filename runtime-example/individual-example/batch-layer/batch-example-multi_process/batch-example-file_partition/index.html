<!doctype html><html lang=kr dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>N:N 파일 Partition 예제 | 표준프레임워크 개발가이드</title><link rel=stylesheet href=https://eGovFramework.github.io/egovframe-docs/css/custom.css integrity crossorigin=anonymous><script src=https://eGovFramework.github.io/egovframe-docs/js/custom.js integrity crossorigin=anonymous defer></script></head><body><header id=krds-header><div class=header-in><div class=header-container><div class=inner style=padding-bottom:0><div class=header-branding><h2 class=logo><a href=https://eGovFramework.github.io/egovframe-docs/></a></h2><div class=header-actions><nav class=krds-main-menu style=border:none><div class=inner><ul class=gnb-menu><li><a href=/egovframe-docs/egovframe-development/ class="gnb-main-trigger is-link">개발환경(예정)</a></li><li><a href=/egovframe-docs/egovframe-runtime/ class="gnb-main-trigger is-link">실행환경</a></li><li><a href=/egovframe-docs/runtime-example/ class="gnb-main-trigger is-link active">실행환경 예제</a></li><li><a href=/egovframe-docs/common-component/ class="gnb-main-trigger is-link">공통컴포넌트(예정)</a></li><li><a href class="gnb-main-trigger is-link active">batchLayer</a></li></ul></div></nav></div></div></div></div></div></header><main id=wrap><div id=container class=krds-in-page-navigation-type><div class="inner in-between layout"><nav class=krds-side-navigation><h2 class=lnb-tit>batchLayer</h2><ul class=lnb-list role=menubar><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu0 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-setup/>Setup</button><div class=lnb-submenu><ul id=lnb-menu0 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu1 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-batch_runner/>Runner</button><div class=lnb-submenu><ul id=lnb-menu1 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu2 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-event_notice_template_mgmt/>EventNotice</button><div class=lnb-submenu><ul id=lnb-menu2 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu3 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-core-egov_commandline_runner_template/>EgovCommandLineRunner</button><div class=lnb-submenu><ul id=lnb-menu3 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu4 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-core-egov_scheduler_runner_template/>EgovSchedulerRunner</button><div class=lnb-submenu><ul id=lnb-menu4 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu5 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-pre_post_process_mgmt/>PrePostProcess</button><div class=lnb-submenu><ul id=lnb-menu5 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu6 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-retry_mgmt/>Retry</button><div class=lnb-submenu><ul id=lnb-menu6 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu7 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-repository_mgmt/>Repository</button><div class=lnb-submenu><ul id=lnb-menu7 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu8 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-job_group_mgmt/>JobGroup</button><div class=lnb-submenu><ul id=lnb-menu8 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu9 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-tasklet_mgmt/>Tasklet</button><div class=lnb-submenu><ul id=lnb-menu9 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu10 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-batch_exec_mgmt/>Log</button><div class=lnb-submenu><ul id=lnb-menu10 role=menu></ul></div><li class="lnb-item active" role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu11 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi_process/>MultiProcess</button><div class=lnb-submenu><ul id=lnb-menu11 role=menu><li class=lnb-subitem><a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi_process/batch-example-db_partition/ class="lnb-btn lnb-link" role=menuitem>DbPartition</a></li><li class="lnb-subitem active"><a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi_process/batch-example-file_partition/ class="lnb-btn lnb-link" role=menuitem>FilePartition</a></li><li class=lnb-subitem><a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi_process/batch-example-single_file_partition/ class="lnb-btn lnb-link" role=menuitem>SpigntFilePartition</a></li></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu12 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-skip_mgmt/>Skip</button><div class=lnb-submenu><ul id=lnb-menu12 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu13 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-sync_async/>SyncAsync</button><div class=lnb-submenu><ul id=lnb-menu13 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu14 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-job_reuse/>JobReuse</button><div class=lnb-submenu><ul id=lnb-menu14 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu15 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-resource/>MultiResource</button><div class=lnb-submenu><ul id=lnb-menu15 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu16 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-db_jdbccursor/>JdbcCursor</button><div class=lnb-submenu><ul id=lnb-menu16 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu17 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-db_ibatis/>Ibatis</button><div class=lnb-submenu><ul id=lnb-menu17 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu18 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-file_fixedlength/>FixedLength</button><div class=lnb-submenu><ul id=lnb-menu18 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu19 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-file_delimitied/>Delimited</button><div class=lnb-submenu><ul id=lnb-menu19 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu20 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-composite_item/>CompositeItem</button><div class=lnb-submenu><ul id=lnb-menu20 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu21 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-multi-restart_mgmt/>Restart</button><div class=lnb-submenu><ul id=lnb-menu21 role=menu></ul></div><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu22 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>JUnitTest</button><div class=lnb-submenu><ul id=lnb-menu22 role=menu></ul></div></li></ul></ul></ul><h2 class=lnb-tit>실행환경 예제</h2><ul class=lnb-list role=menubar><li class=lnb-item role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu0 aria-expanded=false data-url=/egovframe-docs/runtime-example/integrated-example/>실행환경 통합 예제</button><div class=lnb-submenu><ul id=lnb-menu0 role=menu></ul></div><li class="lnb-item active" role=none><button type=button class="lnb-btn lnb-toggle" role=menuitem aria-controls=lnbmenu1 aria-expanded=false data-url=/egovframe-docs/runtime-example/individual-example/>실행환경 개별 예제</button><div class=lnb-submenu><ul id=lnb-menu1 role=menu><li class=lnb-subitem role=none><button type=button class="lnb-btn lnb-toggle-popup" role=menuitem aria-controls=lnbmenu-1 aria-expanded=false aria-haspopup=true data-url=/egovframe-docs/runtime-example/individual-example/foundation-layer-core/>
공통기반 핵심 예제<span class=sr-only>열기</span></button><div class=lnb-submenu-lv2 id=lnbmenu-1 role=menu><button type=button class=lnb-btn-tit data-url=/egovframe-docs/runtime-example/individual-example/>공통기반 핵심 예제</button><ul><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer-core/spel-example/>SpEL 예제</a></li></ul></div></li><li class=lnb-subitem role=none><button type=button class="lnb-btn lnb-toggle-popup" role=menuitem aria-controls=lnbmenu-1 aria-expanded=false aria-haspopup=true data-url=/egovframe-docs/runtime-example/individual-example/foundation-layer/>
공통기반 예제<span class=sr-only>열기</span></button><div class=lnb-submenu-lv2 id=lnbmenu-1 role=menu><button type=button class=lnb-btn-tit data-url=/egovframe-docs/runtime-example/individual-example/>공통기반 예제</button><ul><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer/spring-security-example/>Spring Security 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer/marshalling-unmarshalling-example/>OXM 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer/mail-example/>Mail 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer/compress-decompress-example/>압축/압축해제 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer/file-upload-example/>파일업로드 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/foundation-layer/excel-example/>엑셀 예제</a></li></ul></div></li><li class=lnb-subitem role=none><button type=button class="lnb-btn lnb-toggle-popup" role=menuitem aria-controls=lnbmenu-1 aria-expanded=false aria-haspopup=true data-url=/egovframe-docs/runtime-example/individual-example/presentation-layer/>
화면처리 예제<span class=sr-only>열기</span></button><div class=lnb-submenu-lv2 id=lnbmenu-1 role=menu><button type=button class=lnb-btn-tit data-url=/egovframe-docs/runtime-example/individual-example/>화면처리 예제</button><ul><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/presentation-layer/ui-adaptor-example/>UI Adaptor 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/presentation-layer/easycompany-example/>easycompany 예제</a></li></ul></div></li><li class=lnb-subitem><a href=/egovframe-docs/runtime-example/individual-example/business-logic-layer/ class="lnb-btn lnb-link" role=menuitem>업무처리 예제</a></li><li class=lnb-subitem role=none><button type=button class="lnb-btn lnb-toggle-popup" role=menuitem aria-controls=lnbmenu-1 aria-expanded=false aria-haspopup=true data-url=/egovframe-docs/runtime-example/individual-example/persistence-layer/>
데이터처리 예제<span class=sr-only>열기</span></button><div class=lnb-submenu-lv2 id=lnbmenu-1 role=menu><button type=button class=lnb-btn-tit data-url=/egovframe-docs/runtime-example/individual-example/>데이터처리 예제</button><ul><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/persistence-layer/dataaccess-example/>데이터 엑세스 예제</a></li><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/persistence-layer/orm-example/>ORM 예제</a></li></ul></div></li><li class=lnb-subitem role=none><button type=button class="lnb-btn lnb-toggle-popup" role=menuitem aria-controls=lnbmenu-1 aria-expanded=false aria-haspopup=true data-url=/egovframe-docs/runtime-example/individual-example/integration-layer/>
연계통합 예제<span class=sr-only>열기</span></button><div class=lnb-submenu-lv2 id=lnbmenu-1 role=menu><button type=button class=lnb-btn-tit data-url=/egovframe-docs/runtime-example/individual-example/>연계통합 예제</button><ul><li role=none><a class=lnb-btn role=menuitem href=/egovframe-docs/runtime-example/individual-example/integration-layer/restful-example/>Restful 예제</a></li></ul></div></li></ul></div></li></ul></ul></nav><div class=contents><nav class=krds-breadcrumb-wrap aria-label=브레드크럼><ol class=breadcrumb><li class=home><a href=https://eGovFramework.github.io/egovframe-docs/ class=txt>Home</a></li><li><a href=https://eGovFramework.github.io/egovframe-docs//runtime-example/ class=txt>실행환경 예제</a></li><li><a href=https://eGovFramework.github.io/egovframe-docs//runtime-example/individual-example/ class=txt>실행환경 개별 예제</a></li><li><a href=https://eGovFramework.github.io/egovframe-docs//runtime-example/individual-example/batch-layer/ class=txt>배치처리 예제</a></li><li><a href=https://eGovFramework.github.io/egovframe-docs//runtime-example/individual-example/batch-layer/batch-example-multi_process/ class=txt>대용량 처리를 위한 멀티스레드 기반의 병행처리 예제</a></li></ol></nav><div class=conts-area><div class=krds-in-page-navigation-area><nav class=in-page-navigation-action><ul><li><a href=https://github.com/eGovFramework/egovframe-docs/tree/contribution/runtime-example/individual-example/batch-layer/batch-example-file_partition.md class="krds-btn text small" target=_blank rel=noopener><i class="svg-icon ico_page_view"></i> 페이지 보기</a></li><li><a href=https://github.com/eGovFramework/egovframe-docs/edit/contribution/runtime-example/individual-example/batch-layer/batch-example-file_partition.md class="krds-btn text small" target=_blank rel=noopener><i class="svg-icon ico_page_edit"></i> 페이지 편집</a></li><li><a href="https://github.com/eGovFramework/egovframe-docs/issues/new?title=N:N%20%ed%8c%8c%ec%9d%bc%20Partition%20%ec%98%88%ec%a0%9c" class="krds-btn text small" target=_blank rel=noopener><i class="svg-icon ico_issue"></i> 문서에 이슈 생성</a></li><li><a href=https://github.com/eGovFramework/egovframe-docs/issues/new class="krds-btn text small" target=_blank rel=noopener><i class="svg-icon ico_issue"></i> 프로젝트에 이슈 생성</a></li></ul></nav><div class=in-page-navigation-header><p class=quick-caption>이 페이지의 구성</p><p class=quick-title>N:N 파일 Partition 예제</p></div><nav class=in-page-navigation-list><ul><li><a href=#설명>설명</a><ul><li><a href=#설정>설정</a></li><li><a href=#junittest-구성-및-수행>JunitTest 구성 및 수행</a></li><li><a href=#결과확인>결과확인</a></li></ul></li></ul></nav></div><div class="conts-wrap scroll-check"><h1 class=h-tit id=nn-파일-partition-예제>N:N 파일 Partition 예제</h1><div class="conts-wrap section-link" id=section_01><h2 class=sec-tit id=설명>설명</h2><h3 class=sec-tit id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><strong>File 파티셔닝 예제의 Job 설정 파일인 partitionFileJob.xml을 확인한다.</strong></p><ul><li>ppartitioner : 입력리소스 수 만큼 Master Step을 파티셔닝하는 MultiResourcePartitioner</li><li>grid-size : 생성할 Context 수</li><li>fileNameListener : 입력 리소스명과 같은 이름의 출력리소스명을 설정하고, 입력 리소스가 없다면 설정된 기본값을 이용해 출력위치 및 출력파일명을 지정한다.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;job</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;partitionJob&#34;</span> <span style=color:#a6e22e>restartable=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;step</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;step&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;partition</span> <span style=color:#a6e22e>step=</span><span style=color:#e6db74>&#34;step1&#34;</span> <span style=color:#a6e22e>partitioner=</span><span style=color:#e6db74>&#34;partitioner&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>&lt;handler</span> <span style=color:#a6e22e>grid-size=</span><span style=color:#e6db74>&#34;4&#34;</span> <span style=color:#a6e22e>task-executor=</span><span style=color:#e6db74>&#34;taskExecutor&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;/partition&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/job&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;bean</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;partitioner&#34;</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;org.springframework.batch.core.partition.support.MultiResourcePartitioner&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;resources&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;classpath:egovframework/data/input/delimited*.csv&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;step</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;step1&#34;</span> <span style=color:#a6e22e>xmlns=</span><span style=color:#e6db74>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;tasklet</span> <span style=color:#a6e22e>transaction-manager=</span><span style=color:#e6db74>&#34;transactionManager&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;chunk</span> <span style=color:#a6e22e>writer=</span><span style=color:#e6db74>&#34;itemWriter&#34;</span> <span style=color:#a6e22e>reader=</span><span style=color:#e6db74>&#34;itemReader&#34;</span> <span style=color:#a6e22e>commit-interval=</span><span style=color:#e6db74>&#34;5&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#f92672>&lt;listener</span> <span style=color:#a6e22e>ref=</span><span style=color:#e6db74>&#34;fileNameListener&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/step&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;bean</span> <span style=color:#a6e22e>id=</span><span style=color:#e6db74>&#34;fileNameListener&#34;</span> <span style=color:#a6e22e>class=</span><span style=color:#e6db74>&#34;egovframework.brte.sample.example.listener.EgovOutputFileListener&#34;</span> <span style=color:#a6e22e>scope=</span><span style=color:#e6db74>&#34;step&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;property</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;path&#34;</span> <span style=color:#a6e22e>value=</span><span style=color:#e6db74>&#34;file:./target/test-outputs/partition/file/&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><h5 id=multiresourcepartitioner>MultiResourcePartitioner</h5><p>스프링에서 제공하는 MultiResourcePartitioner 를 사용하며 입력리소스의 수(입력파일 수)만큼 Context를 생성하고 출력위치를 셋팅하는 역할을 한다.(Context 생성으로 여러 Slave Step들을 사용할 수 있게 됨)</p><ul><li>gridSize : Job 설정파일에서 프로퍼티로 받아온다. (예제에서는 4로 지정되어 있지만, 입력리소스의 수(3개)를 기준으로 Context가 생기므로 총 3개의 SalveStep이 생긴다.)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MultiResourcePartitioner</span> <span style=color:#66d9ef>implements</span> Partitioner {
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Map<span style=color:#f92672>&lt;</span>String, ExecutionContext<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>partition</span>(<span style=color:#66d9ef>int</span> gridSize) {
</span></span><span style=display:flex><span>		Map<span style=color:#f92672>&lt;</span>String, ExecutionContext<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String, ExecutionContext<span style=color:#f92672>&gt;</span>(gridSize);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>for</span> (Resource resource : resources) {
</span></span><span style=display:flex><span>			ExecutionContext context <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ExecutionContext();
</span></span><span style=display:flex><span>			Assert.<span style=color:#a6e22e>state</span>(resource.<span style=color:#a6e22e>exists</span>(), <span style=color:#e6db74>&#34;Resource does not exist: &#34;</span><span style=color:#f92672>+</span>resource);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>				context.<span style=color:#a6e22e>putString</span>(keyName, resource.<span style=color:#a6e22e>getURL</span>().<span style=color:#a6e22e>toExternalForm</span>());
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>				<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> IllegalArgumentException(<span style=color:#e6db74>&#34;File could not be located for: &#34;</span><span style=color:#f92672>+</span>resource, e);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			map.<span style=color:#a6e22e>put</span>(PARTITION_KEY <span style=color:#f92672>+</span> i, context);
</span></span><span style=display:flex><span>			i<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> map;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=egovoutputfilelistener>EgovOutputFileListener</h5><p>Step 수행 이전에 호출이 되며, 입력리소스의 정보를 이용하여 출력파일에 대한 정보를 생성 및 저장한다.
✔ 출력은 path의 기본값인 “file:./target/output/” 이하에 생성이 되며, 이 경로는 Job 설정파일(path 프로퍼티)에서 변경할 수 있다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EgovOutputFileListener</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// outputKeyName</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> String outputKeyName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;outputFile&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>// inputKeyName</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> String inputKeyName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;fileName&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#75715e>// path</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> String path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;file:./target/output/&#34;</span>;
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@BeforeStep</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>createOutputNameFromInput</span>(StepExecution stepExecution) {
</span></span><span style=display:flex><span>		ExecutionContext executionContext <span style=color:#f92672>=</span> stepExecution.<span style=color:#a6e22e>getExecutionContext</span>();
</span></span><span style=display:flex><span>		String inputName <span style=color:#f92672>=</span> stepExecution.<span style=color:#a6e22e>getStepName</span>().<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>&#34;:&#34;</span>, <span style=color:#e6db74>&#34;-&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (executionContext.<span style=color:#a6e22e>containsKey</span>(inputKeyName)) {
</span></span><span style=display:flex><span>			inputName <span style=color:#f92672>=</span> executionContext.<span style=color:#a6e22e>getString</span>(inputKeyName);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>executionContext.<span style=color:#a6e22e>containsKey</span>(outputKeyName)) {
</span></span><span style=display:flex><span>			executionContext.<span style=color:#a6e22e>putString</span>(outputKeyName, path <span style=color:#f92672>+</span> FilenameUtils.<span style=color:#a6e22e>getBaseName</span>(inputName) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.csv&#34;</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 class=sec-tit id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>partitionFileJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>✔ JunitTest 클래스의 구조는
<a class="krds-btn medium text" href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명<i class="svg-icon ico-go"></i></a>
을 참고한다.<br>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ 데이터처리 결과를 확인하기 위해, 배치수행과 개별적으로 배치수행전 후의 inputs, outputs을 생성하여 비교한다.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Test</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>testUpdateCredit</span>() <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#75715e>//Job 의 output 자료들을 얻음</span>
</span></span><span style=display:flex><span>	open(inputReader);
</span></span><span style=display:flex><span>	List<span style=color:#f92672>&lt;</span>CustomerCredit<span style=color:#f92672>&gt;</span> inputs <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;</span>CustomerCredit<span style=color:#f92672>&gt;</span>(getCredits(inputReader));
</span></span><span style=display:flex><span>	close(inputReader);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#75715e>//Job 수행</span>
</span></span><span style=display:flex><span>	JobExecution jobExecution <span style=color:#f92672>=</span> jobLauncherTestUtils.<span style=color:#a6e22e>launchJob</span>();
</span></span><span style=display:flex><span>	assertEquals(BatchStatus.<span style=color:#a6e22e>COMPLETED</span>, jobExecution.<span style=color:#a6e22e>getStatus</span>());
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#75715e>//Job 의 output 자료들을 얻음</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@SuppressWarnings</span>(<span style=color:#e6db74>&#34;unchecked&#34;</span>)
</span></span><span style=display:flex><span>	ItemReader<span style=color:#f92672>&lt;</span>CustomerCredit<span style=color:#f92672>&gt;</span> outputReader <span style=color:#f92672>=</span> (ItemReader<span style=color:#f92672>&lt;</span>CustomerCredit<span style=color:#f92672>&gt;</span>) applicationContext.<span style=color:#a6e22e>getBean</span>(<span style=color:#e6db74>&#34;outputTestReader&#34;</span>);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	open(outputReader);
</span></span><span style=display:flex><span>	List<span style=color:#f92672>&lt;</span>CustomerCredit<span style=color:#f92672>&gt;</span> outputs <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;</span>CustomerCredit<span style=color:#f92672>&gt;</span>(getCredits(outputReader));
</span></span><span style=display:flex><span>	close(outputReader);
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#75715e>//input과 output 의 자료중 credit 의 값 비교</span>
</span></span><span style=display:flex><span>	assertEquals(inputs.<span style=color:#a6e22e>size</span>(), outputs.<span style=color:#a6e22e>size</span>());
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>int</span> itemCount <span style=color:#f92672>=</span> inputs.<span style=color:#a6e22e>size</span>();
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	inputs.<span style=color:#a6e22e>iterator</span>();
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> itemCount; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>		assertEquals(inputs.<span style=color:#a6e22e>get</span>(i).<span style=color:#a6e22e>getCredit</span>().<span style=color:#a6e22e>intValue</span>(), outputs.<span style=color:#a6e22e>get</span>(i).<span style=color:#a6e22e>getCredit</span>().<span style=color:#a6e22e>intValue</span>());
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은
<a class="krds-btn medium text" href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행<i class="svg-icon ico-go"></i></a>
을 참고한다.</p><h3 class=sec-tit id=결과확인>결과확인</h3><p>생성된 파일의 결과를 확인한다. 배치 수행 결과, 세개의 입력파일을 읽고 처리해 각각의 새로운 파일에 쓰여진 것을 확인할 수 있다.</p><p><img src=/egovframe-docs/runtime-example/individual-example/batch-layer/images/filepartition1.png alt=filepartition1></p></div></div></div></div></div><button class="page-top-button krds-tooltip active" type=button data-tooltip="페이지 상단으로 이동" aria-labelledby=tooltip-popover-0aha8scb><i class="svg-icon ico-go-top"></i></button></div></main><footer id=krds-footer><div class=inner><div class=f-logo></div><div class=f-cnt><div class=f-info><ul class=info-cs><li><strong class=strong>대표전화</strong><span class=span>&nbsp; 1566-3598 (070-4448-2678)</span></li><li><strong class=strong>대표문의메일</strong><span class=span>&nbsp; egovframesupport@gmail.com</span></li></ul></div><div class=f-link><div class=link-go><a href=https://www.egovframe.go.kr/ class="krds-btn medium text" target=_blank title="새 창 열림">전자정부 표준프레임워크 <i class="svg-icon ico-go"></i></a>
<a href=https://github.com/eGovFramework/egovframe-docs class="krds-btn medium text" target=_blank title="새 창 열림">Git <i class="svg-icon ico-go"></i></a></div></div></div><div class=f-btm><div class=f-btm-text><div class=f-menu><a href="https://github.com/eGovFramework/egovframe-docs?tab=readme-ov-file" class="krds-btn small text">이용 안내</a>
<a href="https://www.egovframe.go.kr/home/sub.do?menuNo=23" class="krds-btn small text">라이센스</a></div><p class=f-copy>COPYRIGHT (C) 2024 eGovFramework. ALL RIGHTS RESERVED.</p></div></div></div></footer></body></html>