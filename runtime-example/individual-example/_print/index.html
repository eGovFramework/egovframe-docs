<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=ko class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=https://eGovFramework.github.io/egovframe-docs/runtime-example/individual-example/><link rel=alternate type=application/rss+xml href=https://eGovFramework.github.io/egovframe-docs/runtime-example/individual-example/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/egovframe-docs/favicons/favicon.ico><link rel=apple-touch-icon href=/egovframe-docs/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/egovframe-docs/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/egovframe-docs/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/egovframe-docs/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/egovframe-docs/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/egovframe-docs/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/egovframe-docs/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/egovframe-docs/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/egovframe-docs/favicons/android-192x192.png sizes=192x192><title>실행환경 개별 예제 | 표준프레임워크 개발가이드</title>
<meta name=description content="실행환경 개별 레이어에 대한 예제이다."><meta property="og:url" content="https://eGovFramework.github.io/egovframe-docs/runtime-example/individual-example/"><meta property="og:site_name" content="표준프레임워크 개발가이드"><meta property="og:title" content="실행환경 개별 예제"><meta property="og:description" content="실행환경 개별 레이어에 대한 예제이다."><meta property="og:locale" content="ko"><meta property="og:type" content="website"><meta itemprop=name content="실행환경 개별 예제"><meta itemprop=description content="실행환경 개별 레이어에 대한 예제이다."><meta itemprop=wordCount content="8"><meta name=twitter:card content="summary"><meta name=twitter:title content="실행환경 개별 예제"><meta name=twitter:description content="실행환경 개별 레이어에 대한 예제이다."><link rel=preload href=/egovframe-docs/scss/main.min.48e428dab9dbffcd4478d93f783b0dba7d70fb343c8fb256ec0828788373922f.css as=style integrity="sha256-SOQo2rnb/81EeNk/eDsNun1w+zQ8j7JW7AgoeINzki8=" crossorigin=anonymous><link href=/egovframe-docs/scss/main.min.48e428dab9dbffcd4478d93f783b0dba7d70fb343c8fb256ec0828788373922f.css rel=stylesheet integrity="sha256-SOQo2rnb/81EeNk/eDsNun1w+zQ8j7JW7AgoeINzki8=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/egovframe-docs/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>표준프레임워크 개발가이드</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/egovframe-docs/egovframe-development/><span>개발환경(예정)</span></a></li><li class=nav-item><a class=nav-link href=/egovframe-docs/egovframe-runtime/><span>실행환경</span></a></li><li class=nav-item><a class="nav-link active" href=/egovframe-docs/runtime-example/><span>실행환경 예제</span></a></li><li class=nav-item><a class=nav-link href=/egovframe-docs/common-component/><span>공통컴포넌트(예정)</span></a></li><li class="td-light-dark-menu nav-item dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown data-bs-display=static aria-label="Toggle theme (auto)"><svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=bd-theme-text><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></li></ul></div><div class="d-none d-lg-block"></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>이 섹션의 다중 페이지 출력 화면임.
<a href=# onclick="return print(),!1">여기를 클릭하여 프린트</a>.</p><p><a href=/egovframe-docs/runtime-example/individual-example/>이 페이지의 일반 화면으로 돌아가기</a>.</p></div><h1 class=title>실행환경 개별 예제</h1><div class=lead>실행환경 개별 레이어에 대한 예제이다.</div><ul><li>1: <a href=#pg-defe8816185d348acbb5c39725b826b4>공통긱반 핵심 예제</a></li><ul><li>1.1: <a href=#pg-6b9e8665ae554aa1f345944db296ea0f>SpEL 예제(Spring Expression Language Example)</a></li></ul><li>2: <a href=#pg-8954a901be9392281efbd97ff66c284b>공통기반 예제</a></li><ul><li>2.1: <a href=#pg-cba6400548aa25aae3c923b4f14e8eb3>스프링 시큐리티 예제(Spring Security Example)</a></li><li>2.2: <a href=#pg-95df4f235744162badb2ce1fa09aa436>OXM 예제(OXM Example)</a></li><li>2.3: <a href=#pg-32ac74ea839980bea86a6ff3bbaca0d3>Mail 서비스 예제(Mail Service Example)</a></li><li>2.4: <a href=#pg-6d5e4b32c6ea838cdcc2c9486c3d21c3>압축/압축해제 예제(Compress/Decompress Example)</a></li><li>2.5: <a href=#pg-aa8d267c5bb18e8bea8a52fb980b4029>파일업로드 예제(File upload example)</a></li><li>2.6: <a href=#pg-38ff4101903d9dfbf0d6fb9c6b5d452d>엑셀 예제(Excel Example)</a></li></ul><li>3: <a href=#pg-fc2cdb3f0e998d3152cec8e7df4799b8>화면처리 예제</a></li><ul><li>3.1: <a href=#pg-d694346387a44f8145028667caf39579>UI 어댑터 예제(UI Adapter Example)</a></li><li>3.2: <a href=#pg-e2a86c18400ddf3040b4596ea2418903>easycompany 예제 실행하기</a></li></ul><li>4: <a href=#pg-90b25ade23f6f8acf8165de67fab90ac>업무처리 예제</a></li><ul></ul><li>5: <a href=#pg-3891641efbe4f22a0319abe1dd92904e>데이터처리 예제</a></li><ul><li>5.1: <a href=#pg-9e2e7cf5c0106a3688e46d796594659e>데이터 엑세스 예제(Data Access Example)</a></li><li>5.2: <a href=#pg-159f705a61669d54cb269afdf4a84f94>ORM 예제(ORM Example)</a></li></ul><li>6: <a href=#pg-4cc27e800a6050aefbbeb82ba5b564cf>연계통합 예제</a></li><ul><li>6.1: <a href=#pg-e3481800c67b55ba5b32267314641e72>Restful 웹서비스 예제(Restful Web Service Example)</a></li></ul><li>7: <a href=#pg-651d06a8f65d70af87b4b5f1f8753f9d>배치처리 예제</a></li><ul><li>7.1: <a href=#pg-7e6970d2e2181d4b0bc23dde334699ee>배치실행환경 예제 설치법</a></li><li>7.2: <a href=#pg-68c4fc08c868f4efbee6a9e6b6611793>배치 Runner 예제</a></li><li>7.3: <a href=#pg-bb5de3412d40d47b4581ec7a918cfe1d>이벤트알림 템플릿(Template) 예제</a></li><li>7.4: <a href=#pg-5441cca89412c710c7e640579b683102>배치 템플릿을 이용한 EgovCommandLineRunner 예제</a></li><li>7.5: <a href=#pg-828ebe16571756869b9c94ef8b1ec3d0>배치 템플릿을 이용한 EgovSchedulerRunner 예제</a></li><li>7.6: <a href=#pg-bd480298ae108e178aef847ad1ae3133>작업 전후처리 예제</a></li><li>7.7: <a href=#pg-896f8f7a80e7d6cf14eb68c02781f643>재시도(Retry) 예제</a></li><li>7.8: <a href=#pg-4a993b020dd5ef3e1b671c72df792ce7>저장소(Repository) 예제</a></li><li>7.9: <a href=#pg-406d221d8294605e3bc69a3f0a6bb0e7>작업그룹 예제</a></li><li>7.10: <a href=#pg-5aae2f35fc195becfc6bdd28a54f33f1>단순처리(Tasklet) 예제</a></li><li>7.11: <a href=#pg-9d9d8329e5dee1341b8ac6bbe6ee7e46>배치 실행로그 예제</a></li><li>7.12: <a href=#pg-0d9983b8aa0369d904ed805819f46e63>대용량 처리를 위한 멀티스레드 기반의 병행처리 예제</a></li><li>7.13: <a href=#pg-b1ced86ad25da16943289800fd3bbc28>DB 파티셔닝 예제</a></li><li>7.14: <a href=#pg-f67fc8795d9639524f06c77d5b761772>N:N 파일 Partition 예제</a></li><li>7.15: <a href=#pg-838ff7e2cabac4767a433c609d8ca979>N:1 파일 Partition 예제</a></li><li>7.16: <a href=#pg-bac8feaf27b1061d73b2707f792057bc>건너뛰기(Skip) 기능 예제</a></li><li>7.17: <a href=#pg-be38c8154de58ec7d82a4e6cd989d8d9>동기/비동기 처리 예제</a></li><li>7.18: <a href=#pg-235588e9a696b5530e09ffa735be374b>기존 업무 재사용 예제</a></li><li>7.19: <a href=#pg-cf888a2f3e65f04d734975b13db9bf5c>MultiResource 예제</a></li><li>7.20: <a href=#pg-3fdf9f0116508caa2e388d1b14eb18ed>JdbcPaging 예제</a></li><li>7.21: <a href=#pg-f8ee4514fcc55e2f6e42f15dc9d17b81>JdbcCursor 예제</a></li><li>7.22: <a href=#pg-496f2c27cf8aa0f13bfe25ff1a08fab4>Ibatis 예제</a></li><li>7.23: <a href=#pg-6a7f565ebdc4f1d625ec027f3da0db4b>FixedLength 예제</a></li><li>7.24: <a href=#pg-0360b2dd700867a0ecef9bc5a412f789>Delimited 예제</a></li><li>7.25: <a href=#pg-e98a7f3a955b08499c9428646f8c0584>CompositeItem 예제</a></li><li>7.26: <a href=#pg-05b0e597490042b6f6f8b178ac61bfd4>재시도(Restart) 예제</a></li><li>7.27: <a href=#pg-a689ba90df1c4caa531f7a39f2d8d4ea>배치실행환경 예제 JUnit Test 설명</a></li></ul></ul><div class=content><h1 id=실행환경-개별-예제>실행환경 개별 예제</h1><p>실행환경 개별 레이어에 대한 예제이다.</p></div></div><div class=td-content><h1 id=pg-defe8816185d348acbb5c39725b826b4>1 - 공통긱반 핵심 예제</h1><div class=lead>실행환경 공통기반 핵심에 관한 예제이다.</div><h1 id=공통기반-핵심-예제>공통기반 핵심 예제</h1><p>실행환경 공통기반 핵심에 관한 예제이다.</p></div><div class=td-content><h1 id=pg-6b9e8665ae554aa1f345944db296ea0f>1.1 - SpEL 예제(Spring Expression Language Example)</h1><div class=lead>Spring 3.0에서 추가된 SPeL을 사용하여 JSP 파일에서 입력값을 포맷팅해 화면에 출력하는 예제를 제공한다.</div><h1 id=spel-예제spring-expression-language-example>SpEL 예제(Spring Expression Language Example)</h1><h2 id=개요>개요</h2><p>Spring 3.0에 새롭게 추가된 SPeL 지원기능을 이용하여, JSP 파일상에서 Spring Expression Language를 사용하는 기능에 대한 예제를 제공한다. 이 예제에서는 입력된 데이터 값에 대하여 SPeL의 출력값 포맷팅 기능을 활용하여 출력값을 형식에 맞게 화면에 표시해주는 기능을 제공한다.</p><h2 id=설명>설명</h2><pre tabindex=0><code>1. 해당 예제를 실행하면 아래와 같은 예제페이지가 호출된다.
</code></pre><p><img src=../images/spel-1.png alt=spel-1></p><pre tabindex=0><code>2. 이름란과 통장 잔액란에 각각 이름과 잔액을 입력하고 [확인]을 누른다.
</code></pre><p><img src=../images/spel-2.png alt=spel-2></p><pre tabindex=0><code>3. SpEL을 적용하여 포맷팅을 적용한 값이 출력된다.
</code></pre><p><img src=../images/spel-3.png alt=spel-3></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer-core/spel/>SpEL 가이드</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8954a901be9392281efbd97ff66c284b>2 - 공통기반 예제</h1><div class=lead>실행환경 공통기반에 관한 예제이다.</div><h1 id=공통기반-예제>공통기반 예제</h1><p>실행환경 공통기반에 관한 예제이다.</p></div><div class=td-content><h1 id=pg-cba6400548aa25aae3c923b4f14e8eb3>2.1 - 스프링 시큐리티 예제(Spring Security Example)</h1><div class=lead>Spring Security를 이용하여 로그인, 보안, 권한관리를 수행하는 기능에 대한 예제이다. 사용자의 로그인 및 권한 관리, 각 페이지에 대한 접근 및 출력 내용에 대한 통제등을 Spring Security 2.0.4를 이용하여 수행하며, 이에 대한 예제 기능을 제공한다.</div><h1 id=스프링-시큐리티-예제spring-security-example>스프링 시큐리티 예제(Spring Security Example)</h1><h2 id=개요>개요</h2><p>Spring Security를 이용하여 로그인, 보안, 권한관리를 수행하는 기능에 대한 예제이다. 사용자의 로그인 및 권한 관리, 각 페이지에 대한 접근 및 출력 내용에 대한 통제등을 Spring Security 2.0.4를 이용하여 수행하며, 이에 대한 예제 기능을 제공한다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 실행하면 로그인이 가능한 페이지가 호출된다.</li></ol><p><img src=../images/security-1.png alt=security-1></p><ol start=2><li>[로그인] 버튼을 누르고 메인에 표시된 관리자 아이디와 패스워드를 이용하여 로그인한다.</li></ol><p><img src=../images/security-2.png alt=security-2></p><ol start=3><li>환영메세지가 출력되고 게시판과 카테고리 관리에 접근이 가능하다.</li></ol><p><img src=../images/security-3.png alt=security-3></p><p><img src=../images/security-5.png alt=security-5></p><ol start=4><li>로그인 하지않았거나 일반사용자 아이디로 로그인한 후 카테고리 관리에 접근하게 되면 미리 정의한 에러 페이지가 출력된다.</li></ol><p><img src=../images/security-4.png alt=security-4></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/server-security/>Server Security</a><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/server-security-architecture/>Architecture</a></li><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/server-security-authentication/>Authentication</a></li><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/server-security-authorization/>Authorization</a></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-95df4f235744162badb2ce1fa09aa436>2.2 - OXM 예제(OXM Example)</h1><div class=lead>객체와 XML 간의 매핑을 통해 데이터를 XML로 변환하고, 사용자에게 XML 파일로 제공하는 OXM(Object-XML Mapping) 기능 예제이다.</div><h1 id=oxm-예제oxm-example>OXM 예제(OXM Example)</h1><h2 id=개요>개요</h2><p>객체와 XML간의 Mapping을 이용하는 Object-XML Mapping (OXM) 기능에 대한 예제를 제공한다. 이 예제는 주어진 데이터를 XML으로 변화하여 사용자에게 제공하며, 사용자는 브라우저를 통하여 해당하는 XML 파일을 확인할 수 있다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 설치하고 실행하면 상품목록 페이지가 호출된다.</li></ol><p><img src=../images/oxm-1.png alt=oxm-1></p><ol start=2><li>[xml] 버튼을 누르면 상품목록을 XML파일로 다운받을 수 있다.</li></ol><p><img src=../images/oxm-2.png alt=oxm-2></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/marshalling-unmarshalling/>Marshalling/Unmarshalling 가이드</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-32ac74ea839980bea86a6ff3bbaca0d3>2.3 - Mail 서비스 예제(Mail Service Example)</h1><div class=lead>메일 발송 예제에서는 설정된 메일 서버를 통해 입력한 이름과 이메일로 메일을 발송하는 기능을 제공한다. 실행 후 성공적으로 메일이 발송되면 성공 메시지가 출력된다.</div><h1 id=메일-서비스-예제mail-service-example>메일 서비스 예제(Mail Service Example)</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크를 이용하여 메일을 발송하는 기능에 대한 예제이다. 사전에 정의된 property를 이용하여 메일 서버를 정의하고, 자바 코드를 이용하여 예제 메일을 발송한다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 설치하고 실행하면 다음과 같은 메일보내기가 가능한 페이지가 호출된다.</li></ol><p><img src=../images/mail-1.png alt=mail-1></p><ol start=2><li>이름과 이메일란을 작성하고 [메일보내기]를 클릭한다.</li></ol><p><img src=../images/mail-2.png alt=mail-2></p><ol start=3><li>성공적으로 메일이 발송되면 성공 메세지를 출력한다.</li></ol><p><img src=../images/mail-3.png alt=mail-3></p><h2 id=참고-자료>참고 자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/mail/>Mail 서비스</a></li><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/property-service/>Property 서비스</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6d5e4b32c6ea838cdcc2c9486c3d21c3>2.4 - 압축/압축해제 예제(Compress/Decompress Example)</h1><div class=lead>전자정부 표준프레임워크에서 서버에 있는 파일을 압축 및 해제하는 기능을 제공하는 컨트롤러 예제를 다룬다.</div><h1 id=압축압축해제-예제compressdecompress-example>압축/압축해제 예제(Compress/Decompress Example)</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크 상에서 서버상에 존재하는 특정 파일을 압축하거나 압축 해제하는 기능에 대한 예제를 제공한다. 서버상에서 지정된 파일을 zip 파일로 압축하고, 이를 다시 압축 해제하는 기능을 controller 상에서 수행하는 기능을 제공한다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 실행하고 성공메세지를 확인한다.</li></ol><p><img src=../images/compress-1.png alt=compress-1.png></p><ol start=2><li>실행에 성공하면 테스트파일을 압축해 C:\egovCompressSample.zip 형태로 압축된다.</li></ol><p><img src=../images/compress-2.png alt=compress-2.png></p><ol start=3><li>[압축해제]를 누르고 성공메세지를 확인한다.</li></ol><p><img src=../images/compress-3.png alt=compress-3.png></p><ol start=4><li>압축해제가 성공하면 C:\egovCompressSample폴더에 압축해제된 파일이 생성되어 있다.</li></ol><p><img src=../images/compress-4.png alt=compress-4.png></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/compress-decompress/>Compress/Decompress 서비스</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-aa8d267c5bb18e8bea8a52fb980b4029>2.5 - 파일업로드 예제(File upload example)</h1><div class=lead>Apache Commons FileUpload의 CommonsMultipartResolver를 사용한 파일 업로드 예제로, 이미지 파일을 업로드하고 화면에 표시하는 기능을 설명한다.</div><h1 id=파일업로드-예제file-upload-example>파일업로드 예제(File upload example)</h1><h2 id=개요>개요</h2><p>Apache Commens FileUpload에서 제공하는 CommonsMultipartResolver를 사용한 예제이다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 실행하면 간단한 파일업로드 페이지가 호출된다.</li></ol><p><img src=../images/fileupload-1.png alt=fileupload-1></p><ol start=2><li>선택버튼을 눌러 업로드할 이미지파일을 선택한다.</li></ol><p><img src=../images/fileupload-2.png alt=fileupload-2></p><ol start=3><li>업로드버튼을 누르면 예제의 루트디렉토리에 있는 image폴더에 파일이 업로드되고 화면에 표시된다.</li></ol><p><img src=../images/fileupload-3.png alt=fileupload-3></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/file-upload-download-service/>File Upload/Downlowd 서비스</a></li><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/file-upload-service/>File Upload 서비스</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-38ff4101903d9dfbf0d6fb9c6b5d452d>2.6 - 엑셀 예제(Excel Example)</h1><div class=lead>데이터베이스 내용을 화면에 출력하고, 엑셀 파일로 내보내어 사용자가 목록을 다운로드할 수 있는 기능을 제공하는 예제이다.</div><h1 id=엑셀-예제excel-example>엑셀 예제(Excel Example)</h1><h2 id=개요>개요</h2><p>데이터베이스에 저장된 내용을 화면에 출력하고, 해당 내용을 엑셀 파일로 내보내는 기능에 대한 예제이다. 사용자는 주어진 목록을 엑셀파일 형태로 다운로드 받을 수 있으며, 개발자는 엑셀 템플릿 형태로 양식을 정의하고 이에 맞추어서 데이터를 추가할 수 있다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 설치하고 실행하면 상품목록 페이지가 호출된다.</li></ol><p><img src=../images/excel-1.png alt=excel-1></p><ol start=2><li>[excel] 버튼을 누르면 상품목록을 excel파일로 다운받을 수 있다.</li></ol><p><img src=../images/excel-2.png alt=excel-2></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/foundation-layer/excel/>Excel 서비스</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fc2cdb3f0e998d3152cec8e7df4799b8>3 - 화면처리 예제</h1><div class=lead>실행환경 화면처리에 관한 예제이다.</div><h1 id=화면처리-예제>화면처리 예제</h1><p>실행환경 화면처리에 관한 예제이다.</p></div><div class=td-content><h1 id=pg-d694346387a44f8145028667caf39579>3.1 - UI 어댑터 예제(UI Adapter Example)</h1><div class=lead>외부 UI 도구를 표준프레임워크에 활용하기 위하여 데이터를 주고 받기 위한 UI 어댑터에 대한 예제이다. 이 예제는 MiPlatform을 이용하여 화면을 구성하고 전자정부 표준프레임워크를 활용하여 해당 화면을 연결하여 기초적인 CRUD 작업을 수행하는 기능을 제공한다.</div><h1 id=ui-어댑터-예제ui-adapter-example>UI 어댑터 예제(UI Adapter Example)</h1><h2 id=개요>개요</h2><p>외부 UI 도구를 표준프레임워크에 활용하기 위하여 데이터를 주고 받기 위한 UI 어댑터에 대한 예제이다. 이 예제는 MiPlatform을 이용하여 화면을 구성하고 전자정부 표준프레임워크를 활용하여 해당 화면을 연결하여 기초적인 CRUD 작업을 수행하는 기능을 제공한다.</p><h2 id=설명>설명</h2><p><img src=../images/ui-adaptor-1.png alt=ui-adaptor-1></p><p><img src=../images/ui-adaptor-2.png alt=ui-adaptor-2></p><p><img src=../images/ui-adaptor-3.png alt=ui-adaptor-3></p><p><img src=../images/ui-adaptor-4.png alt=ui-adaptor-4></p><p><img src=../images/ui-adaptor-5.png alt=ui-adaptor-5></p><p><img src=../images/ui-adaptor-6.png alt=ui-adaptor-6></p><p><img src=../images/ui-adaptor-7.png alt=ui-adaptor-7></p><h2 id=참고자료>참고자료</h2></div><div class=td-content style=page-break-before:always><h1 id=pg-e2a86c18400ddf3040b4596ea2418903>3.2 - easycompany 예제 실행하기</h1><div class=lead>EasyCompany 예제는 JDK 1.8, Eclipse 4.8.0, Tomcat 8.0, HSQLDB 2.3.2 환경에서 실행되며, SVN에서 프로젝트를 다운받아 DBMS(runHsqlDB.cmd)와 Tomcat을 실행 후 http://localhost:8080/easycompany 에 접속해 id/pwd: 1/1로 로그인하면 사원 리스트 페이지를 확인할 수 있다.</div><h1 id=easycompany-예제-실행하기>easycompany 예제 실행하기</h1><h2 id=개요>개요</h2><p>EasyCompany 예제는 MVC와 Ajax Support, Security의 예제 코드로서, JDK 1.8, Eclipse 4.8.0, Tomcat 8.0, HSQLDB 2.3.2 환경에서 실행된다. 사원 리스트 페이지 확인은 SVN에서 프로젝트를 다운받아 DBMS(runHsqlDB.cmd)와 Tomcat을 실행 후 http://localhost:8080/easycompany 에 접속해 id/pwd: 1/1로 로그인하면 가능하다.</p><h2 id=개발환경>개발환경</h2><ul><li>JDK : JDK 1.8</li><li>Eclipse : 4.8.0</li><li>Web Container : Tomcat 8.0</li><li>DBMS : HSQLDB 2.3.2</li></ul><h2 id=설치>설치</h2><ol><li>SVN에서 예제 코드 easycompany 프로젝트를 다운 받습니다.<br>이클립스에서 해당 프로젝트를 보면 아래와 같은 구조를 가지고 있습니다.</li></ol><p><img src=../images/projectexplore.jpg alt=projectexplore></p><p><strong>src/ : 자바 클래스</strong></p><ul><li>com.easycompany.controller.annotation: @Controller</li><li>com.easycompany.controller.hierachy: 계층형 Controller</li><li>com.easycompany.dao: DAO 클래스, SQL Map 파일</li><li>com.easycompany.domain: 폼클래스, JavaBeans</li><li>com.easycompany.interceptor: 선후처리를 위한 Interceptor</li><li>com.easycompany.service: 서비스 클래스들</li><li>com.easycompany.tag: 페이징을 위한 태그 클래스</li><li>com.easycompany.validator: 유효성 검증을 위한 spring validator</li><li>com.easycompany.view: View 클래스</li></ul><p><strong>db/: 샘플 구동을 위한 데이터 생성, DBMS 실행</strong></p><ul><li>runHsqlDB.cmd : dbms 실행은 이 파일을 실행시킵니다.</li><li>sampledb.script : 샘플을 실행하기 위한 SQL.</li></ul><p><strong>webapp/</strong></p><ul><li>WEB-INF/jsp: jsp 파일들.</li><li>WEB-INF/lib: 참조 라이브러리 WEB-INF/config : 스프링등의 설정 파일.</li><li>easycompany-dao.xml - DataSource, iBatis 설정등 퍼시스턴스 레이어 관련 설정.</li><li>easycompany-service.xml - 비즈니스 레이어 관련 설정.</li><li>easycompany-servlet.xml - 프리젠테이션 레이어 설정. @Controller</li><li>easycompany-servlet-old.xml - 프리젠테이션 레이어 설정. 계층형 Controller</li><li>validator.xml , validator-rules.xml-Jakarta Commons Validator를 이용한 validation 설정 파일.</li></ul><ol start=2><li>DBMS 실행<br>easycompany\db에 있는 runHsqlDB.cmd을 실행합니다.<br>샘플 실행에 필요한 데이터들도 이때 같이 생성됩니다.</li></ol><p><img src=../images/hsqldb.jpg alt=hsqldb></p><ol start=3><li>Tomcat 실행<br>이클립스에서 easycompany 프로젝트를 clean 한 번 실행해 주신 다음,
Server 탭에서 새로운 서버를 추가하시고 아래와 같이 easycompany 프로젝트를 추가해 주세요.</li></ol><p><img src=../images/newserver.jpg alt=newserver></p><p><img src=../images/serverstart.jpg alt=serverstart></p><ol start=4><li>브라우져에서 확인<br>브라우져 주소창에 http://localhost:8080/easycompany 입력한 후 로그인 페이지에서 id/pwd : 1/1 을 입력한다.<br>사원리스트 페이지가 나타나면 성공.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-90b25ade23f6f8acf8165de67fab90ac>4 - 업무처리 예제</h1><div class=lead>실행환경 업무처리에 관한 예제이다.</div><h1 id=업무처리-예제>업무처리 예제</h1><p>실행환경 업무처리에 관한 예제이다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3891641efbe4f22a0319abe1dd92904e>5 - 데이터처리 예제</h1><div class=lead>실행환경 데이터처리에 관한 예제이다.</div><h1 id=데이터처리-예제>데이터처리 예제</h1><p>실행환경 데이터처리에 관한 예제이다.</p></div><div class=td-content><h1 id=pg-9e2e7cf5c0106a3688e46d796594659e>5.1 - 데이터 엑세스 예제(Data Access Example)</h1><div class=lead>iBatis를 사용하여 Database에 데이터를 조회, 생성, 수정, 삭제하는 기능에 대한 예제를 제공한다. SQL Mapping을 통하여 쿼리 및 데이터 매핑을 정의하고, 스프링의 Data Source를 사용하여 Connection을 획득한 뒤, DAO 클래스에서 주어진 메소드를 사용하여 CRUD 작업을 수행한다. 조회 결과를 화면에 출력하거나 화면에서 작성된 입력 내용을 데이터베이스에 반영하는 기능의 예제를 제공한다.</div><h1 id=데이터-엑세스-예제data-access-example>데이터 엑세스 예제(Data Access Example)</h1><h2 id=개요>개요</h2><p>iBatis를 사용하여 Database에 데이터를 조회, 생성, 수정, 삭제하는 기능에 대한 예제를 제공한다. SQL Mapping을 통하여 쿼리 및 데이터 매핑을 정의하고, 스프링의 Data Source를 사용하여 Connection을 획득한 뒤, DAO 클래스에서 주어진 메소드를 사용하여 CRUD 작업을 수행한다. 조회 결과를 화면에 출력하거나 화면에서 작성된 입력 내용을 데이터베이스에 반영하는 기능의 예제를 제공한다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 설치하고 실행하면 iBatis로 구현한 공시게시판이 나타난다.</li></ol><p><img src=../images/dataacess-1.png alt=dataacess-1></p><ol start=2><li>[등록] 버튼을 눌러 공시 등록페이지를 호출하고, 내용을 작성한다.</li></ol><p><img src=../images/dataacess-2.png alt=dataacess-2></p><ol start=3><li>공시 등록페이지의 [등록] 버튼을 누르면 글이 등록되고, 공시게시판으로 돌아간다.</li></ol><p><img src=../images/dataacess-3.png alt=dataacess-3></p><ol start=4><li>해당글을 눌러 수정과 삭제를 할 수 있다.</li></ol><p><img src=../images/dataacess-4.png alt=dataacess-4></p><h2 id=참고-자료>참고 자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/persistence-layer/dataaccess-ibatis/>Data Access - iBatis</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-159f705a61669d54cb269afdf4a84f94>5.2 - ORM 예제(ORM Example)</h1><h1 id=orm-예제orm-example>ORM 예제(ORM Example)</h1><h2 id=개요>개요</h2><p>Hibernate를 사용한 ORM 기능의 예제를 제공한다. 별도의 쿼리문을 정의하지 않고, 객체와 테이블간의 Mapping을 정의하여 순수 자바 코드를 사용하여 자료의 조회, 생성, 수정, 삭제를 수행하는 기능을 제공한다. 일반적인 게시판 형식의 예제이지만 Hibernate를 활용하여 데이터의 입출력이 어떻게 이루어지는지 확인할 수 있다.</p><h2 id=설명>설명</h2><ol><li>해당 예제를 설치하고 실행하면 Hibernate를 사용한 카테고리관리 페이지가 나타난다.</li></ol><p><img src=../images/orm1.png alt=orm1></p><ol start=2><li>[등록] 버튼을 눌러 카테고리 등록 페이지를 호출하여 카테고리를 등록 할 수 있다.</li></ol><p><img src=../images/orm2.png alt=orm2></p><ol start=3><li>등록된 카테고리코드를 클릭하여 카테고리를 수정하거나 삭제할 수 있다.</li></ol><p><img src=../images/orm3.png alt=orm3></p><h2 id=참고-자료>참고 자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/persistence-layer/orm/>ORM</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4cc27e800a6050aefbbeb82ba5b564cf>6 - 연계통합 예제</h1><div class=lead>실행환경 연계통합에 관한 예제이다.</div><h1 id=연계통합-예제>연계통합 예제</h1><p>실행환경 연계통합에 관한 예제이다.</p></div><div class=td-content><h1 id=pg-e3481800c67b55ba5b32267314641e72>6.1 - Restful 웹서비스 예제(Restful Web Service Example)</h1><div class=lead>Spring 3.0에서 새롭게 추가된 Restful 웹서비스 지원기능을 이용하여 주어진 데이터를 Restful 요청/응답을 통하여 화면 또는 각 파일 양식으로 출력시켜주는 기능의 예제이다. URL을 통하여 각 카테고리의 목록 또는 상세정보를 요청할 수 있으며, HTML, JSON, XML 형태의 출력을 지원한다.</div><h1 id=restful-웹서비스-예제restful-web-service-example>Restful 웹서비스 예제(Restful Web Service Example)</h1><h2 id=개요>개요</h2><p>Spring 3.0에서 새롭게 추가된 Restful 웹서비스 지원기능을 이용하여 주어진 데이터를 Restful 요청/응답을 통하여 화면 또는 각 파일 양식으로 출력시켜주는 기능의 예제이다. URL을 통하여 각 카테고리의 목록 또는 상세정보를 요청할 수 있으며, HTML, JSON, XML 형태의 출력을 지원한다.</p><h2 id=설명>설명</h2><pre tabindex=0><code>1. 해당 예제를 실행하면 Restful 웹서비스기능을 이용한 카테고리 관리페이지를 볼 수 있다. 
</code></pre><p><img src=../images/restful-1.png alt=restful-1></p><pre tabindex=0><code>2. [등록] 버튼을 누르면 카테고리 등록페이지를 호출하고 카테고리 등록이 가능하다.
</code></pre><p><img src=../images/restful-2.png alt=restful-2></p><pre tabindex=0><code>3. 카테고리 관리페이지에서 [json으로 내보내기]버튼을 누르면 JSON형태로 카테고리목록을 출력한다.
</code></pre><p><img src=../images/restful-4.png alt=restful-4></p><pre tabindex=0><code>4. 카테코리 코드를 클릭하면 카테고리 수정페이지를 호출한다.
</code></pre><p><img src=../images/restful-3.png alt=restful-3></p><pre tabindex=0><code>5. 카테고리 수정페이지에서 [xml 내보내기]를 클릭하면  XML형태로 카테고리를 출력한다.
</code></pre><p><img src=../images/restful-5.png alt=restful-5></p><h2 id=참고자료>참고자료</h2><ul><li><a href=./restful.md>Restful 가이드</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-651d06a8f65d70af87b4b5f1f8753f9d>7 - 배치처리 예제</h1><div class=lead>실행환경 배치처리에 관한 예제이다.</div><h1 id=배치처리-예제>배치처리 예제</h1><p>실행환경 배치처리에 관한 예제이다.</p></div><div class=td-content><h1 id=pg-7e6970d2e2181d4b0bc23dde334699ee>7.1 - 배치실행환경 예제 설치법</h1><div class=lead>전자정부 표준프레임워크 홈페이지에서 배치실행환경 소스파일을 다운 받아 압축을 풀고, m2 이클립스가 설치되어 있다는 가정하에 설명한다.</div><h1 id=배치실행환경-예제-설치법>배치실행환경 예제 설치법</h1><h2 id=설치-순서>설치 순서</h2><h3 id=기본순서>기본순서</h3><p>전자정부 표준프레임워크 홈페이지에서 배치실행환경 소스파일을 다운 받아 압축을 풀고, m2 이클립스가 설치되어 있다는 가정하에 설명한다.</p><p><a href="http://www.egovframe.go.kr/EgovRunEnvReleaseEdu.jsp?menu=3&amp;submenu=1&amp;leftsub=5">실행환경 예제 다운로드</a></p><ol><li>Package Explorer에서 오른쪽 마우스를 클릭하여 소스를 임포트한다.</li></ol><p><img src=../images/%ec%82%ac%ec%9a%a9%ec%9e%90_%ec%a7%80%ec%a0%95_3.jpg alt></p><ol start=2><li>General>Existing Projects into Workspace를 선택하여 압축을 풀어놓은 폴더를 선택한다.</li></ol><p><img src=../images/%ec%82%ac%ec%9a%a9%ec%9e%90_%ec%a7%80%ec%a0%95_4.jpg alt></p><ol start=3><li>배치실행예제에서는 HSQL DB를 제공하고 있으며 runHsqlDB.cmd 파일을 실행시켜 DB를 기동시킨다.</li></ol><ul><li>egovframework.brte.example\database\db 폴더에서 오른쪽 마우스를 클릭하여 Path Tools>Commands Line Shell을 선택한다.</li></ul><p><img src=../images/setup_cmd.png alt></p><ul><li>명령프롬프트 창에 runHsqlDB를 입력하여 runHsqlDB.cmd 파일을 실행시킨다.</li></ul><p><img src=../images/setup_cmd2.png alt></p><p>✔ Path Tools>Commands Line Shell을 선택할 수 없을 경우, 해당 프로젝트의 폴더에서 \database\db아래에 있는 runHsqlDB 파일을 클릭한다.</p><h3 id=hsql외-db-연결순서>HSQL외 DB 연결순서</h3><ol><li>임포트 된 소스에서 DB정보를 알맞게 바꿔준다. 위치:src/test/resources/egovframework/batch/properties/globals.properties</li></ol><p><img src=../images/setup_dbproperty.png alt></p><ol start=2><li>src/script 폴더의 해당 DB의 script 파일을 참고하여 테이블을 생성하고 데이터를 추가한다.</li></ol><p><img src=../images/setup_dbscript.png alt></p><h3 id=db-연결시-주의사항>DB 연결시 주의사항</h3><p>altibase나 tibero 연결시에는 아래의 설정이 추가로 필요하다.</p><p>✔ altibase나 tibero 연결시에는 아래의 파일의 jobRepository 에 databaseType으로 oracle로 추가 설정을 해야 한다.</p><ul><li>batch-runner-context.xml</li><li>group-job-launcher-context.xml</li><li>simple-job-launcher-context.xml</li><li>sync–job-launcher-context.xml</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>p:databaseType=</span><span style=color:#4e9a06>&#34;oracle&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>p:lobHandler-ref=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>✔ JdbcPagingItemReader의 queryProvider에 databaseType으로 oracle로 추가 설정을 해야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.JdbcPagingItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;rowMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCreditRowMapper&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;queryProvider&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.support.SqlPagingQueryProviderFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;databaseType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;oracle&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sortKey&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;ID&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#8f5902;font-style:italic>&lt;!-- Intentionally put sort key second in the query list as a test --&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;selectClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;select NAME, ID, CREDIT&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fromClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;FROM CUSTOMER&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>               <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pageSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p>✔ JDBCPagingtEST 할 경우 altibase 버전이 6.1.1일경우에만 정상동작합니다.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-68c4fc08c868f4efbee6a9e6b6611793>7.2 - 배치 Runner 예제</h1><div class=lead>배치 수행에 사용되는 EgovBatchRunner의 사용법을 보여주는 예제이다. 비동기 방식으로 실행하는 Job의 시작, 정지, 재시작 방법을 보여준다.</div><h1 id=배치-runner-예제>배치 Runner 예제</h1><h2 id=개요>개요</h2><p>배치 수행에 사용되는 EgovBatchRunner의 사용법을 보여주는 예제이다. 비동기 방식으로 실행하는 Job의 시작, 정지, 재시작 방법을 보여준다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=egovbatchrunner-설정>EgovBatchRunner 설정</h4><p>EgovBatchRunner의 설정 방법은 <a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-execution-job_runner/#egovbatchrunner>배치 Runner</a>를 참고한다.</p><h4 id=launcher-설정>Launcher 설정</h4><p><strong>배치 Runner 예제의 Job 설정 파일인 batchRunnerTest.xml을 확인한다.</strong></p><p>본 예제에서는 비동기 방식으로 Job을 수행한다. 이를 위해 JobLauncher의 TaskExecutor에 SimpleAsyncTaskExecutor 클래스를 지정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SimpleAsyncTaskExecutor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=job-설정>Job 설정</h4><p><strong>배치 Runner 예제의 Job 설정 파일인 batchRunnerTest.xml을 확인한다.</strong></p><p>✔ Job 재시작시, Job 시작에 사용되었던 JobParameter를 사용하기 위해 JobParametersIncrementer를 이용한다.<br>✔ batchRunnerTestJob에서 JobParametersIncrementer 클래스를 사용하기 위해 simpleJob을 상속받는다. 이때 simpleJob은 restartable이 true로 설정된다.<br>✔ Step도 simpleStep을 상속받아서 구현한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;simpleJob&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.job.SimpleJob&#34;</span> <span style=color:#c4a000>abstract=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;restartable&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;simpleStep&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.step.item.FaultTolerantStepFactoryBean&#34;</span> <span style=color:#c4a000>abstract=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;batchRunnerTestJob&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;simpleJob&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobParametersIncrementer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.RunIdIncrementer&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;steps&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;infiniteStep&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;simpleStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.GeneratingTradeItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;limit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;1000000&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.support.EgovDummyItemWriter&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>배치 Runner 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>배치 실행 순서는 아래와 같다.</p><ol><li>EgovBatchRunner의 start() 메소드에 Job의 이름, JobParameter를 전달하여 batchRunnerTestJob을 시작하고, executionId를 얻어온다.</li><li>executionId를 이용하여 실행 중인 Job의 이름, JobParameter가 일치하는지 확인한다.</li><li>stopAndCheckStatus()를 이용하여 실행 중인 Job을 정지한다.</li><li>EgovBatchRunner의 restart() 메소드에 처음 시작했던 Job의 executionId를 전달하여 batchRunnerTestJob을 재시작 한다.</li><li>다시 한 번 stopAndCheckStatus()를 이용하여 실행 중인 Job을 정지한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testStartStopResumeJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;batchRunnerTestJob&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>createUniqueJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>long</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobInstance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getJobName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getParameters</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>stopAndCheckStatus</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>long</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resumedExecutionId</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>restart</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getParameters</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resumedExecutionId</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>stopAndCheckStatus</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resumedExecutionId</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>stopAndCheckStatus() 메소드는 Job 실행 정보를 확인하고 실행 중인 Job을 정지하는 역할을 한다.</p><ol><li>비동기 실행 중인 Job이 시작 상태로 들어갔는지 보장하기 위해, Thread.sleep()을 이용하여 1초간 대기한다.</li><li>실행 정보를 확인하고, EgovBatchRunner의 stop() 메소드를 이용하여 실행 중인 Job을 정지한다.</li><li>실행 중인 Job의 excutionId가 존재하는지 확인하고 0.1초간 대기한다.</li><li>대기 후, 해당 Job의 Summary를 출력하고, BatchStatus가 Stopped 인지 확인한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stopAndCheckStatus</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>long</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobInstance</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getJobName</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// wait to the job to get up and running	</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1000</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Set</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>runningExecutions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getRunningExecutions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Wrong executions: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>runningExecutions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34; expected: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>runningExecutions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>contains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Wrong summary: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getSummary</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getSummary</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>contains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>STARTED</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>()));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>stop</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>count</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>while</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getRunningExecutions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>contains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;&amp;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>count</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Checking for running JobExecution: count=&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>count</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>100</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>count</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>runningExecutions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getRunningExecutions</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertFalse</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Wrong executions: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>runningExecutions</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34; expected: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>runningExecutions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>contains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Wrong summary: &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getSummary</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getSummary</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>contains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>STOPPED</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>()));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// there is just a single step in the test job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Long</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>summaries</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovBatchRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobOperator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getStepExecutionSummaries</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionId</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>summaries</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>summaries</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>values</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>contains</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>STOPPED</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>()));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과확인>결과확인</h3><p>Console 창에서 Job Summary내용 중, BatchStatus가 Stopped 임을 확인한다.</p><p><img src=../images/centercut-explain1.png alt=centercut-explain1></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-execution-job_runner/#egovbatchrunner>Batch Runner</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-bb5de3412d40d47b4581ec7a918cfe1d>7.3 - 이벤트알림 템플릿(Template) 예제</h1><div class=lead>전자정부 표준프레임워크의 배치 수행중 특정시점에 이벤트가 발생하는 경우 EventNoticeTrigger를 활용하여 SMS, Email 등을 통해 사용자가 설정한 관련정보를 발신하는 과정을 보여주는 예제이다. EgovEventNoticeTriggerFunctionalTests 예제는 일반 파일을 처리하는 과정에서 특정시점(Step 수행 시)에 배치수행과 관련한 내용을 Email로 보내주는 과정을 보여주는 과정을 보여준다.</div><h1 id=이벤트알림-템플릿template-예제>이벤트알림 템플릿(Template) 예제</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크의 배치 수행중 특정시점에 이벤트가 발생하는 경우 EventNoticeTrigger를 활용하여 SMS, Email 등을 통해 사용자가 설정한 관련정보를 발신하는 과정을 보여주는 예제이다. EgovEventNoticeTriggerFunctionalTests 예제는 일반 파일을 처리하는 과정에서 특정시점(Step 수행 시)에 배치수행과 관련한 내용을 Email로 보내주는 과정을 보여주는 과정을 보여준다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>이벤트알림 템플릿(Template) 예제의 Job 설정 파일인 eventNoticeTriggerJob.xml을 확인한다.</b></p><p>Job 의 구성을 보면 기본적인 <tasklet>설정 외에 <listener>를 통해 EgovEventNoticeCallListener를 호출하도록 설정되어 있고, 관련 클래스인 EgovEventNoticeCallProcessor와 EgovEmailEventNoticeTrigger는 빈으로 등록되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;eventNoticeTriggerJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;eventNoticeTriggerStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;EventNoticeCallListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;EventNoticeCallListener&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovEventNoticeCallProcessor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;EmailEventNoticeTrigger&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.event.EgovEmailEventNoticeTrigger&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><p><b>Email 전송을 위한 EgovEmailEventNoticeTrigger 클래스의 설정을 확인한다.</b></p><p>Job 수행시 관련정보를 알리기 위한 설정은 <a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-event_notice_template_mgmt/>EgovEventNoticeTrigger</a>를 상속받은 EgovEmailEventNoticeTrigger에 구현되어 있고, 크게 세 부분으로 구성되어 있다.</p><ol><li>EgovEmailEventNoticeTrigger 클래스 Email 송수신을 위한 정보를 입력한다</li></ol><pre tabindex=0><code>수신자 : 복수로 셋팅할 수 있으며 String 배열 형태로 입력한다.
송신자 : 송신자의 메일 주소를 String 형태로 입력한다.
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovEmailEventNoticeTrigger</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovEventNoticeTrigger</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// 전자우편 수신자 셋팅(배열형태로 입력)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailList</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;****@*****&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>};</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// 전자우편 송신자 셋팅</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailFromAddress</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;****@*****&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=2><li>Email 내용구성은 invoke()의 파라미터로 받아온 정보를 활용한다. 예제에서는 JobExecution를 이용하여 Job이름과 종료상태의 정보로 얻어와 Email 내용을 구성한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 전자우편 제목</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailSubjectTxt</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobInstance</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getJobName</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34; 의 실행 결과 보고서&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 전자우편 내용</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailMsgTxt</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;============ Notice ============&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;\nJobName : &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobInstance</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getJobName</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;\nExitStatus : &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>postMail</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>emailList</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailSubjectTxt</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailMsgTxt</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>emailFromAddress</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ol start=3><li>Email 전송을 위해 사용할 SMTP서버 정보를 입력한다. 예제에서는 postMail()에 SMTP서버 정보가 설정되어 있고, SMTPAuthenticator 클래스에서 해당 SMTP서버의 username과 password 등 사용자의 계정정보를 입력해야 정상적인 메일발송이 가능하다.</li></ol><p>✔ SMTP서버는 사용자의 편의에 따라 변경할 수 있다.</p><pre tabindex=0><code>username : 해당 메일서버 계정의 메일주소를 입력한다.
password : 해당 메일서버 계정의 패스워드를 입력한다.
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovEmailEventNoticeTrigger</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovEventNoticeTrigger</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>SMTPAuthenticator</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>javax</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>mail</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>Authenticator</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PasswordAuthentication</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getPasswordAuthentication</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>username</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;****@****&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;********&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PasswordAuthentication</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>username</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>password</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><b>EgovEventNoticeCallProcessor 클래스를 확인한다.</b></p><p>이 클래스는 전자정부 표준프레임워크에서 제공하는 <a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-listener/#%ec%9e%91%ec%97%85-%ec%a0%84%ed%9b%84%ec%b2%98%eb%a6%ac-%ea%b4%80%eb%a6%ac-egovprepostprocessor>프로세서</a> 중 EgovStepPostProcessor 클래스를 상속받아 구현되었으며, afterStep 메소드를 통해 리스너가 Step수행 후에 Job과 관련된 정보(StepExecution)를 파라미터로 넘겨주며 EgovEmailEventNoticeTrigger.invoke 메소드를 호출한다.</p><p>EgovEventNoticeCallProcessor 내에서 호출되는 EgovEmailEventNoticeTrigger 클래스는 Job 설정에서 Bean으로 등록되어 있다. (Job 설정 참고)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovEventNoticeCallProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovStepPostProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>EgovEmailEventNoticeTrigger</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExitStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>afterStep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>StepExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>✔ 예제에서는 Job 설정파일에서 Step 내부에 Listener 를 설정하고, 여기에 해당하는 프로세서를 상속받아 사용하였으므로 Step과 관련된 작업만 수행되지만, 프로세서 상속 없이 사용자가 별도로 스프링에서 제공하는 <a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-listener/>리스너 관련 어노테이션</a>과 전자정부에서 제공하는 <a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-event_notice_template_mgmt/#egoveventnoticetrigger>이벤트알림 트리거 메소드</a>를 조합해 확장하여 사용하는 방법도 있다. 이는 아래 EventNoticeListener 클래스 예시를 참고한다. (마찬가지로 Job 설정에서 EventNoticeListener 가 빈으로 등록되어야 함)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EventNoticeListener</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>EgovEmailEventNoticeTrigger</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// Job 수행완료 후, 전자우편을 전송하기 위한 invoke를 수행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@AfterJob</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExitStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sendJobNotice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 전자우편서비스이용</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	 </span><span style=color:#8f5902;font-style:italic>// Step 수행 완료 후, 전자우편을 전송하기 위한 invoke를 수행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@AfterStep</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExitStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sendStepNotice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>StepExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 전자우편서비스이용</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// Read 중 Error 발생시, 전자우편을 전송하기 위한 invoke를 수행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@OnReadError</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sendErrorNotice</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 전자우편서비스이용</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>egovEmailEventNoticeTrigger</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>invoke</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>이벤트알림 템플릿(Template) 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/eventNoticeTriggerJob.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovEventNoticeTriggerFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// 실제 웹페이지에서 메일 수신여부로 성공여부 판단 할 것</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;COMPLETED&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>이 예제의 테스트 결과는 배치수행 결과만 반영하므로, 이벤트알림의 성공여부는 실제 메일계정에 접속하여 Email 수신여부로 판단한다.</p><p><img src=../images/eventnoticetrigger1.png alt=eventnoticetrigger1></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-event_notice_template_mgmt/>이벤트알림 템플릿 관리</a></li><li>SMTP 서버<ul><li>naver SMTP 서버 : smtp.naver.com</li><li>daum SMTP 서버 : smtp.hanmail.net</li><li>Google SMTP 서버 : smtp.google.com</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5441cca89412c710c7e640579b683102>7.4 - 배치 템플릿을 이용한 EgovCommandLineRunner 예제</h1><div class=lead>CommandLine 배치 템플릿 프로젝트를 이용하여 EgovCommandLineRunner의 사용법을 보여주는 예제이다.</div><h1 id=배치-템플릿을-이용한-egovcommandlinerunner-예제>배치 템플릿을 이용한 EgovCommandLineRunner 예제</h1><h2 id=개요>개요</h2><p>CommandLine 배치 템플릿 프로젝트를 이용하여 EgovCommandLineRunner의 사용법을 보여주는 예제이다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=commandline-배치-템플릿-프로젝트-생성>CommandLine 배치 템플릿 프로젝트 생성</h4><p><strong>아래를 참고하여 File(SAM) / DB 타입의 CommandLine 배치 템플릿 프로젝트 를 생성한다.</strong></p><ol><li><a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:bdev:imp:batch_template_wizard:sam_commandline_template_mgmt">File(SAM)타입</a></li><li><a href="./https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:bdev:imp:batch_template_wizard:db_commandline_template_mgmt">DB타입</a></li></ol><h4 id=commandline-배치-템플릿-전체-설정>CommandLine 배치 템플릿 전체 설정</h4><p><strong>CommandLine 배치 템플릿 설정 파일인 context-commandline.xml을 확인한다.</strong></p><p>✔ CommandLine 배치 템플릿 실행에 필요한 xml 정보가 기술되어 있다.<br>✔ Job 관련 xml의 경우 특정 폴더 밑에 Job당 하나의 xml 파일로 나누어져 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/batch/context-batch-datasource.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/batch/context-batch-job-launcher.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/batch/context-batch-sqlmap.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/batch/job/*.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p><strong>CommandLine 배치 템플릿 설정 파일인 context-batch-datasource.xml을 확인한다.</strong></p><p>✔ datasource 관련 정보가 기술되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;egov.propertyConfigurer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;locations&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;value&gt;</span>classpath:/egovframework/batch/properties/globals.properties<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>	DBMS별 설정
</span></span><span style=display:flex><span>         ...
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span> <span style=color:#c4a000>lazy-init=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.support.lob.DefaultLobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;customEditorConfigurer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.beans.factory.config.CustomEditorConfigurer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customEditors&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;map&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;int[]&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.springframework.batch.support.IntArrayPropertyEditor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/map&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p><strong>CommandLine 배치 템플릿 설정 파일인 context-batch-job-launcher.xml을 확인한다.</strong></p><p>✔ JobLauncher, JobOperator, JobRepository, JobRegistry, JobExplorer 정보가 기술되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.JobRegistryBeanPostProcessor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>p:lobHandler-ref=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobOperator&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobOperator&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:jobLauncher-ref=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>p:jobExplorer-ref=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:jobRepository-ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>p:jobRegistry-ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.explore.support.JobExplorerFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.MapJobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p><strong>CommandLine 배치 템플릿 설정 파일인 context-batch-sqlmap.xml을 확인한다.</strong></p><p>✔ SQLMapClient 정보가 기술되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/sqlmap/brte/sql-map-config.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=egovcommandlinejobrunner-구성-및-수행>EgovCommandLineJobRunner 구성 및 수행</h3><h4 id=egovcommandlinejobrunner-구성>EgovCommandLineJobRunner 구성</h4><p><strong>EgovCommandLineJobRunner는 CommandLine 상에서 실행되어야 하기 때문에 main() 메소드를 지니고 있다. 이 메소드 안에서 EgovCommandLineRunner를 이용하여 Job을 실행한다.</strong></p><p>CommandLine상에서 실행하기 위해서는 jobPath와 jobIdentifier을 인수로 받아야 하며, 추가적으로 jobParameter를 인수로 전달 받아서 실행 가능하다.</p><p>✔ EgovCommandLineJobRunner의 main() 메소드내에는 main() 메소드가 받아들인 args에서 jobPath, jobIdentifier, jobParameters, option을 분리하는 기능이 구현되어 있다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>EgovCommandLineRunner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>command</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovCommandLineRunner</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>중략</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobPath</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>||</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobIdentifier</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>==</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>message</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;At least 2 arguments are required: JobPath and jobIdentifier.&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>logger</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>error</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>command</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>setMessage</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>command</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>parameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>params</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toArray</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>params</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>result</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>command</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>start</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobPath</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobIdentifier</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>parameters</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>opts</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>command</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=egovcommandlinejobrunner-수행>EgovCommandLineJobRunner 수행</h4><ol><li>CommandLine 배치 템플릿 프로젝트를 선택한다.</li></ol><p><img src=../images/commandling1.png alt=commandling1></p><ol start=2><li>메뉴 표시줄에서 Run > Run Configuration 을 선택한다.</li></ol><p><img src=../images/commandling2.png alt=commandling2></p><ol start=3><li>Argument 탭을 선택하여 아래와 같이 <strong>jobPath</strong>와 <strong>jobIdentifier</strong>를 입력한다. <strong>jobIdentifier</strong> 뒤에 붙은 Argument는 <strong>Job Parameter</strong>로 사용되며, 여러 개의 Argument를 넣을 수 있다.</li></ol><p>/egovframework/batch/context-commandline.xml delimitedToDelimitedJob inputFile=egovframework/batch/data/inputs/csvData.csv</p><p><img src=../images/commandling3.png alt=commandling3></p><p>✔ 위 화면처럼 Argument와 Argument 사이는 반드시 스페이스로 구분해야 한다.<br>✔ CommandLine 배치 템플릿 프로젝트에서 기본적으로 제공하는 jobIdentifier(<strong>Job의 이름</strong>)는 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:bdev:imp:batch_template_wizard:sam_commandline_template_mgmt#%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD">File(SAM) 타입에서 제공하는 Job의 종류</a> 와 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:bdev:imp:batch_template_wizard:sam_commandline_template_mgmt#%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD">DB 타입에서 제공하는 Job의 종류</a> 를 참고한다.</p><ol start=4><li>메뉴 표시줄에서 <strong>Run</strong> > <strong>Run</strong> 을 선택한다.</li></ol><p><img src=../images/commandling4.png alt=commandling4></p><h3 id=결과-확인>결과 확인</h3><p>Console 창에서 Job이 실행되어 <strong>Completed</strong>로 종료되었음을 확인한다.</p><p><img src=../images/commandling5_red.png alt=commandling5_red></p></div><div class=td-content style=page-break-before:always><h1 id=pg-828ebe16571756869b9c94ef8b1ec3d0>7.5 - 배치 템플릿을 이용한 EgovSchedulerRunner 예제</h1><div class=lead>Scheduler 기반의 배치 템플릿 프로젝트를 이용하여 EgovSchedulerRunner의 사용법을 보여주는 예제이다.</div><h1 id=배치-템플릿을-이용한-egovschedulerrunner-예제>배치 템플릿을 이용한 EgovSchedulerRunner 예제</h1><h2 id=개요>개요</h2><p>Scheduler 기반의 배치 템플릿 프로젝트를 이용하여 EgovSchedulerRunner의 사용법을 보여주는 예제이다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=scheduler-배치-템플릿-프로젝트-생성>Scheduler 배치 템플릿 프로젝트 생성</h4><p><strong>아래를 참고하여 File(SAM) / DB 타입의 Scheduler 배치 템플릿 프로젝트 를 생성한다.</strong></p><ol><li><a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:bdev:imp:batch_template_wizard:sam_scheduler_template_mgmt">File(SAM)타입</a></li><li><a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:bdev:imp:batch_template_wizard:db_scheduler_template_mgmt">DB타입</a></li></ol><h4 id=scheduler-배치-템플릿-전체-설정>Scheduler 배치 템플릿 전체 설정</h4><p><strong>Scheduler 배치 템플릿 설정 파일인 context-scheduler.xml을 확인한다.</strong></p><p>✔ Scheduler 배치 템플릿 실행에 필요한 xml 정보와 Scheduler의 Trigger 정보가 기술되어 있다.<br>✔ Trigger에 jobDetail(JobDetailBean)과 cronExpression를 설정한다. 기본적으로 매 10초 주기로 jobDetail을 실행하도록 설정되어 있다.<br>✔ 다른 Trigger의 사용방법을 알기 위해서는 <a href=../foundation-layer/scheduling-service.md>Scheduling 서비스</a> 를 참고한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;context-batch-datasource.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;context-batch-job-launcher.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;import</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;context-batch-sqlmap.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.scheduling.quartz.SchedulerFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;triggers&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;cronTrigger&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.scheduling.quartz.CronTriggerBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobDetail&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobDetail&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;cronExpression&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;0/10 * * * * ?&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p><strong>Scheduler 배치 템플릿 설정 파일인 context-scheduler-job.xml을 확인한다.</strong></p><p>✔ context-scheduler.xml에서 사용한 jobDetail의 클래스(EgovJobLauncherDetails) 정보가 기술되어 있다.<br>✔ jobDetail의 jobDataAsMap에 필수적으로 jobName, jobLocator, jobLauncher 등의 세가지 정보를 기술한다.<br>✔ 위에 기술한 세가지 정보 외에 jobDataAsMap에 기술하는 값은 Job Parameter를 생성하는데 이용된다.</p><p>예) Input File 경로 , Output File 경로</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobDetail&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.scheduling.quartz.JobDetailBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobClass&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.scheduler.support.EgovJobLauncherDetails&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;group&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;quartz-batch&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobDataAsMap&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;map&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;jobName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;fixedToIbatisJob&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;jobLocator&#34;</span> <span style=color:#c4a000>value-ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>value-ref=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;inputFile&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/batch/data/inputs/txtData.txt&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;outputFile&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:./src/main/resources/egovframework/batch/data/outputs/txtOutput.txt&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/map&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p><strong>Scheduler 배치 템플릿 설정 파일인 context-batch-datasource.xml을 확인한다.</strong></p><p>✔ datasource 관련 정보가 기술되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;egov.propertyConfigurer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;locations&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;value&gt;</span>classpath:/egovframework/batch/properties/globals.properties<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span>	DBMS별 설정
</span></span><span style=display:flex><span>         ...
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.datasource.DataSourceTransactionManager&#34;</span> <span style=color:#c4a000>lazy-init=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.support.lob.DefaultLobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;customEditorConfigurer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.beans.factory.config.CustomEditorConfigurer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;customEditors&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;map&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;int[]&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;org.springframework.batch.support.IntArrayPropertyEditor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/map&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p><strong>Scheduler 배치 템플릿 설정 파일인 context-batch-job-launcher.xml을 확인한다.</strong></p><p>✔ JobLauncher, JobOperator, JobRepository, JobRegistry, JobExplorer 정보가 기술되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.JobRegistryBeanPostProcessor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>p:lobHandler-ref=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobOperator&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobOperator&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:jobLauncher-ref=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>p:jobExplorer-ref=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:jobRepository-ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>p:jobRegistry-ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.explore.support.JobExplorerFactoryBean&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.MapJobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><p><strong>Scheduler 배치 템플릿 설정 파일인 context-batch-sqlmap.xml을 확인한다.</strong></p><p>✔ SQLMapClient 정보가 기술되어 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;egov.dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:/egovframework/sqlmap/brte/sql-map-config.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=egovschedulerjobrunner-구성-및-수행>EgovSchedulerJobRunner 구성 및 수행</h3><h4 id=egovschedulerjobrunner-구성>EgovSchedulerJobRunner 구성</h4><p>EgovSchedulerJobRunner의 main() 메소드에서 Scheduler의 jobDetail 클래스(EgovJobLauncherDetails)를 실행하기 위한 순서는 아래와 같다.</p><ol><li>실행할 Job이 기술된 xml 파일 경로를 jobPaths 변수에 지정한다.</li><li>Scheduler 정보가 기술된 xml파일(context-scheduler.xml)의 경로, jobDetail 클래스가 정의된 xml 파일(context-scheduler-job.xml)의 경로, jobPaths 그리고 지연시간(기본: 30초)을 지정한다.</li><li>start() 메소드를 이용하여 Scheduler를 실행한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobPaths</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * 1. SAM 실행 예제(File To File)에서 사용 할 Batch Job이 기술 된 xml파일 경로들((jobPaths)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>jobPaths</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/egovframework/batch/job/delimitedToDelimitedJob.xml&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>jobPaths</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/egovframework/batch/job/fixedToFixedJob.xml&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * 2. SAM 실행 예제(File To DB)에서 사용 할 Batch Job이 기술 된 xml파일 경로들((jobPaths)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>jobPaths</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/egovframework/batch/job/fixedToIbatisJob.xml&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>jobPaths</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/egovframework/batch/job/fixedToJdbcJob.xml&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * EgovSchedulerRunner에 contextPath, schedulerJobPath, jobPaths를 인수로 넘겨서 실행한다.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * contextPath: Batch Job 실행에 필요한 context 정보가 기술된 xml파일 경로
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * schedulerJobPath: Scheduler의 Trigger가 수행할 SchedulerJob(ex: QuartzJob)이 기술된 xml파일 경로
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * jobPaths: Batch Job이 기술 된 xml 파일 경로들
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * delayTime: Scheduler 실행을 위해 ApplicationContext를 종료를 지연시키는 시간(실행시간)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 *            (기본 30000 milliseconds: 30초) 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>EgovSchedulerRunner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>egovSchedulerRunner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovSchedulerRunner</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;/egovframework/batch/context-batch-scheduler.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;/egovframework/batch/context-scheduler-job.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>					
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>jobPaths</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>30000</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>	
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>egovSchedulerRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>start</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>실행된 Scheduler는 context-scheduler.xml에서 설정한 주기, 시간에 맞추어 jobDetail 클래스(EgovJobLauncherDetails)의 executeInternal() 메소드를 호출한다. 메소드 내의 동작은 아래와 같다.</p><ol><li>jobDataMap에서 jobName, jobParameters(jobDataMap에 설정된 key중 jobName, jobLocator, jobLauncher를 제외한 나머지)를 분리한다.</li><li>주기적으로 실행되는 Job의 Job Parameter 유일성을 보장하기 위해 Job Parameter의 timestamp 값을 갱신한다.</li><li>jobLauncher를 통해 Job을 실행한다.</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executeInternal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecutionContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>context</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Long</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>timestamp</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Object</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobDataMap</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getMergedJobDataMap</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobDataMap</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JOB_NAME</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>/* 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * 주기적으로 실행가능하도록 하기 위해, JobParamter의 timestamp 값을 갱신한다. 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobDataMap</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>jobDataMap</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>timestamp</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Date</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>jobDataMap</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>timestamp</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>warn</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Quartz trigger firing with Spring Batch jobName=&#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getJobParametersFromJobMap</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobDataMap</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>jobLauncher</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobLocator</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>catch</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecutionException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>error</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Could not execute job.&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=egovschedulerjobrunner-수행>EgovSchedulerJobRunner 수행</h4><p>메뉴 표시줄에서 <strong>Run</strong> > <strong>Run</strong> 을 선택한다.</p><p><img src=../images/commandling4.png alt=commandling4></p><h3 id=결과-확인>결과 확인</h3><p>Console 창에서 Scheduler가 생성되었고, Scheduler의 실행 시간이 30초 임을 확인한다.</p><p><img src=../images/scheduler2-red.png alt=scheduler2-red></p><p>Scheduler가 매 10초 간격으로 jobDetail을 실행하여, Spring 배치 Job이 실행되었음을 확인한다.</p><p><strong>11시 6분 50초</strong></p><p><img src=../images/scheduler5-red.png alt=scheduler5-red></p><p><strong>11시 7분 00초초</strong></p><p><img src=../images/scheduler6-red.png alt=scheduler6-red></p><p><strong>11시 7분 10초</strong></p><p><img src=../images/scheduler4-red.png alt=scheduler4-red></p></div><div class=td-content style=page-break-before:always><h1 id=pg-bd480298ae108e178aef847ad1ae3133>7.6 - 작업 전후처리 예제</h1><div class=lead>전자정부 표준프레임워크에서 배치 수행시, Core에서 제공하는 Processor 클래스를 이용하여 Job과 그 하위 구성요소인 Step, Chunk 전후에 적절한 선행/후행 처리 과정을 보여주는 예제이다.</div><h1 id=작업-전후처리-예제>작업 전후처리 예제</h1><h2 id=개요>개요</h2><p>전자정부 표준프레임워크에서 배치 수행시, Core에서 제공하는 Processor 클래스를 이용하여 Job과 그 하위 구성요소인 Step, Chunk 전후에 적절한 선행/후행 처리 과정을 보여주는 예제이다.</p><h2 id=설명>설명</h2><p>예제는 작업 전처리 과정을 보여주는 EgovPreProcessorFunctionalTests 와 작업 후처리 과정을 보여주는 EgovPostProcessorFunctionalTests로 구성되어 있다. 전처리, 후처리에 따른 일부 메소드명을 제외한 대부분의 설정과 내용이 같으므로 작업 전처리 예제(EgovPreProcessorFunctionalTests)위주로 설명한다.</p><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>작업 전처리 예제의 Job 설정 파일인 preProcessorJob.xml을 확인한다.</b></p><p>작업 전처리 예제, 작업 후처리 예제에서는 &lt;listener>를 적절히 이용하여 Pre/PostProcessor를 사용한다. 여기서 빈으로 등록된 각 SampleXXXProcessor 클래스들은 전자정부 표준프레임워크의 Processor를 상속받아 구현하였으며, 관련된 상세 내용은 <a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-listener/>작업 전후처리 관리</a>에서 확인할 수 있다.</p><p>✔ &lt;listeners> 설정위치는 관련된 태그 안에 설정하는 것을 권장한다. (ex. Job과 관련된 Listener는 Job 태그 내부에서 사용하고, Step과 관련된 Listener는 Step 태그 내부에서 사용한다.)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;preProcessorJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobPreListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;preProcessorStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;chunkPreListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;stepPreListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobPreListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovSampleJobPreProcessor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;stepPreListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovSampleStepPreProcessor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;chunkPreListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovSampleChunkPreProcessor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><p><b>전자정부 표준프레임워크에서 제공하는 Processor를 구성요소(Job, Step, Chunk)별로 상속받아 간단한 로그를 찍는 SampleProcessor를 만들었다. 로그 출력위치를 보면서 리스너의 수행시점을 확인할 수 있다.</b></p><p>✔ 전자정부 표준프레임워크에서 제공하는 Processor 는 코어의 작업 전후처리(Pre Processor / Post Processor)관리 참고한다.</p><ul><li>Job 수행 이전에 호출되는 메소드</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSampleJobPreProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovJobPreProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLog</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>beforeJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; beforeJob :::  Start &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobInstance</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getJobName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Job 수행 이후에 호출되는 메소드</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSampleJobPostProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovJobPostProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLog</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>afterJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; afterJob :::  Finish &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobInstance</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getJobName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Step 수행 이전에 호출되는 메소드</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSampleStepPreProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovStepPreProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLog</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>beforeStep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>StepExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; beforeStep ::: start &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStepName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Step 수행 이후에 호출되는 메소드</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSampleStepPostProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovStepPreProcessor</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>T</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>S</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLog</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExitStatus</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>afterStep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>StepExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; afterStep ::: finish &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStepName</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Chunk 수행 이전에 호출되는 메소드</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSampleChunkPreProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovChunkPreProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLog</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>beforeChunk</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; beforeChunk :::&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><ul><li>Chunk 수행 이후에 호출되는 메소드</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSampleChunkPostProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovChunkPostProcessor</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>log</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>LogFactory</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLog</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getClass</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>afterChunk</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>info</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; afterChunk :::&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>preProcessorJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.</p><p>✔ getUniqueJobParameters에서 JobParameter에 배치에 필요한 입력 리소스, 출력 리소스 위치정보를 넘긴다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/preProcessorJob.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovPreProcessorFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 콘솔창의 Job,Step,Chunk의 이벤트 처리 출력여부로 성공여부 판단 할 것	</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;COMPLETED&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	* 잡파라미터를 설정하기 위한 메소드 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	*/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>())</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;/egovframework/data/input/delimited.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/delimitedOutput.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>이 예제의 테스트 결과는 배치수행 결과만 반영하므로, 전처리/후처리 성공여부는 콘솔창에서 로그내용을 검색하여 해당 로그의 출력여부로 확인할 수 있다.</p><p><img src=../images/preprocessor1.png alt=preprocessor1></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-listener/>Listener</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-896f8f7a80e7d6cf14eb68c02781f643>7.7 - 재시도(Retry) 예제</h1><div class=lead>배치 수행 시, 데이터를 처리하는 과정에서 실패한 데이터처리를 재시도하는 과정을 보여주는 예제이다. EgovRetrySampleFunctionalTests 예제는 ItemProcessing, ItemWriting 에서 발생한 예외상황에 대해 정해진 설정대로 Retry를 수행하는 과정을 보여준다. 설정된 retry-limit 만큼 재시도를 허용함으로써 Job 전체의 실패를 줄일 수 있다.</div><h1 id=재시도retry-예제>재시도(Retry) 예제</h1><h2 id=개요>개요</h2><p>배치 수행 시, 데이터를 처리하는 과정에서 실패한 데이터처리를 재시도하는 과정을 보여주는 예제이다. EgovRetrySampleFunctionalTests 예제는 ItemProcessing, ItemWriting 에서 발생한 예외상황에 대해 정해진 설정대로 Retry를 수행하는 과정을 보여준다. 설정된 retry-limit 만큼 재시도를 허용함으로써 Job 전체의 실패를 줄일 수 있다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>재시도(Retry) 예제의 Job 설정 파일인 retrySample.xml을 확인한다.</b></p><p>Job 의 구성을 보면 Chunk 설정에 아래와 같은 설정이 있다.</p><ul><li>retry-limit : Retry 할 수 있는 최대 횟수를 지정한다.</li><li>&lt;retryable-exception-classes> : Exception 범위를 지정한다. Rollback을 유발하므로, 너무 많은 retry 는 성능저하를 주의해야 한다.</li></ul><pre tabindex=0><code>  &lt;include&gt; : retry 해야하는 Exception 지정
  &lt;exlclude&gt; : include로 지정한 exception의 하위 exception 중, retry 하지 않을 Exception 지정
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;retrySample&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemGenerator&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> 
</span></span><span style=display:flex><span>		               <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#c4a000>retry-limit=</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			    <span style=color:#204a87;font-weight:700>&lt;retryable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>			    	<span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;java.lang.Exception&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			    <span style=color:#204a87;font-weight:700>&lt;/retryable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>retrySample 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(itemGenerator.getLimit()+2, itemProcessor.getCounter()) : 두 번의 재시도가 일어나도록 설정되어 있으므로, 전체 Process 처리 수가 reader에서 읽힌 데이터 수보다 2가 커야한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/retrySample.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovRetrySampleFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//items processed = items read + 2 exceptions</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemGenerator</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLimit</span><span style=color:#000;font-weight:700>()</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getCounter</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-skip_repeat_retry/>Retry</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4a993b020dd5ef3e1b671c72df792ce7>7.8 - 저장소(Repository) 예제</h1><div class=lead>배치 수행 시, 데이터 처리 대상(DB,File등)에 대한 설정을 보여주는 예제이다. EgovRepositoryFunctionalTests 예제는 리소스가 DB 인 jdbcCursorIoJob 과 리소스가 File인 delimitedIoJob의 수행과정을 보여주면서, 데이터가 DB에서 DB로 File 에서 File로 처리 된다.</div><h1 id=저장소repository-예제>저장소(Repository) 예제</h1><h2 id=개요>개요</h2><p>배치 수행 시, 데이터 처리 대상(DB,File등)에 대한 설정을 보여주는 예제이다. EgovRepositoryFunctionalTests 예제는 리소스가 DB 인 jdbcCursorIoJob 과 리소스가 File인 delimitedIoJob의 수행과정을 보여주면서, 데이터가 DB에서 DB로 File 에서 File로 처리 된다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>저장소(Repository) 예제의 Job 설정 파일인 repositoryJob.xml 을 확인한다.</b></p><p>Job 의 구성을 보면 리소스 타입에 따라 두 개의 Job으로 구성되어 있고, 각 타입에 따른 Reader와 Writer를 사용하게 된다.</p><ul><li>jdbcCursorIoJob : 리소스가 DB인 Job</li><li>delimitedIoJob : 리소스가 파일인 Job</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!--resource가 DB일 경우 xml에 등록 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jdbcCursorIoJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jdbcCursorIoStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReaderDB&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriterDB&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!--resource가 파일일 경우 xml에 등록 또는 JobParameter에 등록 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delimitedIoJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delimitedIostep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReaderFile&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriterFile&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>repositoryJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()) : 배치수행결과가 COMPLETED 인지 확인</p><p>✔ jobLauncher.run(jobRegistry.getJob(“jdbcCursorIoJob”), getUniqueJobParameters(“jdbcCursorIoJob”)) : 이름이 jdbcCursorIoJob 인 Job을 수행</p><p>✔ getUniqueJobParameters에서 JobParameter에 배치에 필요한 입력 리소스, 출력 리소스 위치정보를 넘김</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/repositoryJob.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovRepositoryFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// 1. resource가 DB인 Job 실행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncher</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobRegistry</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jdbcCursorIoJob&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jdbcCursorIoJob&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// 2. resource가 file 인 Job 실행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncher</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>run</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobRegistry</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;delimitedIoJob&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;delimitedIoJob&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   * 잡파라미터를 설정하기 위한 메소드
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobName</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>JobParametersBuilder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>builder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// Job 파라미터로 등록 가능</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>builder</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#4e9a06>&#34;/egovframework/data/input/delimited.csv&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>builder</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addParameter</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameter</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Date</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#000;font-weight:700>()));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>builder</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><ul><li>DB의 CUSTOMER 테이블을 보면 Repository 타입이 DB인 데이터 처리 결과를 확인할 수 있다.</li></ul><p><img src=../images/repository_exam_result_db.png alt=repository_exam_result_db></p><ul><li>delimitedOutput.csv 파일을 보면 Repository 타입이 File인 데이터 처리 결과를 확인할 수 있다.</li></ul><p><img src=../images/repository_exam_result_file.png alt=repository_exam_result_file></p><h2 id=참고자료>참고자료</h2><ul><li><a href=../../../egovframe-runtime/batch-layer/batch-execution-job-repository.md>JobRepository</a></li><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-item_reader/>ItemReader</a></li><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-item_writer/>ItemWriter</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-406d221d8294605e3bc69a3f0a6bb0e7>7.9 - 작업그룹 예제</h1><div class=lead>배치 수행 시, 업무에 따라 필요한 일련의 Job들을 구분하기 위해서 이를 카테고리화 하여 관리 하는 기능을 보여주는 예제이다.</div><h1 id=작업그룹-예제>작업그룹 예제</h1><h2 id=개요>개요</h2><p>배치 수행 시, 업무에 따라 필요한 일련의 Job들을 구분하기 위해서 이를 카테고리화 하여 관리 하는 기능을 보여주는 예제이다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>작업그룹 예제에서는 다른 예제에서 사용되는 delegatingJob 을 사용한다.</b></p><p>Job 의 구성은 일반적인 Chunk 설정이 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h4 id=launcher-설정>Launcher 설정</h4><p><b>작업그룹 예제의 Launcher 설정 파일인 group-job-launcher-context 를 확인한다.</b></p><p>✔ Job 그룹기능을 사용하기 위해서는 JobRegistryBeanPostProcessor 클래스와 관련한 빈에 ‘groupName’ 이라는 프로퍼티로 그룹명을 추가하면 된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.JobRegistryBeanPostProcessor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;groupName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;testJobGroup&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.JobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>p:transactionManager-ref=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span> <span style=color:#c4a000>p:lobHandler-ref=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;lobHandler&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.jdbc.support.lob.DefaultLobHandler&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;mapJobRepository&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.repository.support.MapJobRepositoryFactoryBean&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#c4a000>lazy-init=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>autowire-candidate=</span><span style=color:#4e9a06>&#34;false&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobOperator&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobOperator&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#c4a000>p:jobLauncher-ref=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>p:jobExplorer-ref=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#c4a000>p:jobRepository-ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>p:jobRegistry-ref=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobExplorer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.explore.support.JobExplorerFactoryBean&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#c4a000>p:dataSource-ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobRegistry&#34;</span>	<span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.configuration.support.MapJobRegistry&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>group-job-launcher-context 설정과 수행할 배치 Job인 delegatingJob 설정들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(”[testJobGroup.delegateJob]”,jobRegistry.getJobNames().toString()) : Job 이름이 [그룹명.Job 이름] 형식으로 저장됨을 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/group-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/delegatingJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovJobGroupDelegatingJobFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReceivedCount</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[testJobGroup.delegateJob]&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>jobRegistry</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobNames</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>콘솔창의 로그를 확인하면 Launcher 설정파일에서 지정한 groupName(testJobGroup)이 Job 이름 앞에서 식별되는 카테고리명으로 쓰이는 것을 확인할 수 있다.</p><p><img src=../images/jobgroup1.png alt=jobgroup1></p><h2 id=참고자료>참고자료</h2><ul><li><a href=../../egovframe-runtime/batch-layer/batch-core-job_registry.md>JobRegistry</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5aae2f35fc195becfc6bdd28a54f33f1>7.10 - 단순처리(Tasklet) 예제</h1><div class=lead>배치 수행 시, Job의 실행중 itemReader와 ItemWriter 등의 인터페이스 사용이 필요없는 단순처리되는 작업(파일이동 등)을 보여주는 예제이다.</div><h1 id=단순처리tasklet-예제>단순처리(Tasklet) 예제</h1><h2 id=개요>개요</h2><p>배치 수행 시, Job의 실행중 itemReader와 ItemWriter 등의 인터페이스 사용이 필요없는 단순처리되는 작업(파일이동 등)을 보여주는 예제이다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><strong>단순처리(Tasklet) 예제의 Job 설정 파일인 taskletJob.xml 을 확인한다.</strong></p><p>Job 의 구성을 보면 다른 Job과 달리 Chunk 설정이 없고, &lt;tasklet>에서 참조하는 adapter 빈에서 jobParameters로 설정된 값을 targetObject 프로퍼티 값으로 넘겨주는 것을 확인할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;loopJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;adapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;transaction-attributes</span> <span style=color:#c4a000>propagation=</span><span style=color:#4e9a06>&#34;REQUIRED&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;adapter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.step.tasklet.MethodInvokingTaskletAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;value&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;execute&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;value&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.test.EgovTaskletJobFunctionalTests$TestBean&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;value&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[value]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>taskletJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ TestBean 클래스의 assertEquals(“foo”, value) : jobParameter에 value 로 저장한 “foo” 와 문자열 “foo” 가 같은지 판단한다. (jobParameter로 넣어준 값이 사용자가 지정한 값과 같은지 단순비교)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/taskletJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovTaskletJobFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;value&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addParameter</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameter</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Date</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#000;font-weight:700>())).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>TestBean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//String value</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>       		</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>setValue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>execute</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h2 id=참고자로>참고자로</h2><ul><li><a href=../../egovframe-runtime/batch-layer/batch-core-step-#taskletstep>TaskletStep</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-9d9d8329e5dee1341b8ac6bbe6ee7e46>7.11 - 배치 실행로그 예제</h1><div class=lead>배치 수행 시, 처리되는 배치관련 정보들에 대한 기록(Log)을 Registry 와 DB에 저장되고 이를 확인하는 과정을 보여주는 예제이다.</div><h1 id=배치-실행로그-예제>배치 실행로그 예제</h1><h2 id=개요>개요</h2><p>배치 수행 시, 처리되는 배치관련 정보들에 대한 기록(Log)을 Registry 와 DB에 저장되고 이를 확인하는 과정을 보여주는 예제이다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>배치 실행로그 예제의 Job 설정 파일인 logManagementJob.xml을 확인한다.</b></p><p>배치 실행로그 예제를 위해 특별히 Job을 설정하는 내용은 없다. 이 예제에서 제공하는 Job의 상세 내용은 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-skip_mgmt/>건너뛰기(Skip)기능 예제</a>의 Job 설정과 같으므로 이를 참고한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;logManagementJob&#34;</span> <span style=color:#c4a000>incrementer=</span><span style=color:#4e9a06>&#34;incrementer&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;baseStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;fileItemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;tradeProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;tradeWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#c4a000>skip-limit=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileParseException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.WriteFailedException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;COMPLETED WITH SKIPS&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;errorPrint&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;fail</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>exit-code=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;errorPrint&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;errorLogTasklet&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>logManagementJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()) : 배치수행결과가 COMPLETED 인지 확인한다.</p><p>✔ assertEquals(”[logManagementJob]”, jobRegistry.getJobNames().toString()) : Registry에 저장된 JobName 확인한다.</p><p>✔ assertEquals(“3 records were skipped!”, simpleJdbcTemplate.queryForObject(“SELECT MESSAGE from ERROR_LOG where JOB_NAME = ?”, String.class, “logManagementJob”)): DB에 저장된 ERROR_LOG 테이블 정보 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/logManagementJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovLogManagementFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// Registry : Job 정보에 대한 로그기록</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;[logManagementJob]&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobRegistry</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobNames</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toString</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// DB : ERROR_LOG 테이블의 로그 수</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>countRowsInTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ERROR_LOG&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// DB : ERROR_LOG 테이블의 로그 데이터</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;3 records were skipped!&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#4e9a06>&#34;SELECT MESSAGE from ERROR_LOG where JOB_NAME = ?&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;logManagementJob&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>DB의 ERROR_LOG 테이블을 보면 데이터를 실제로 확인할 수 있다.</p><p><img src=../images/logmanagement1.png alt=logmanagement1></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-job_registry/>JobRegsitry</a></li><li><a href=../../../egovframe-runtime/batch-layer/batch-execution-job-repository.md>JobRepository</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0d9983b8aa0369d904ed805819f46e63>7.12 - 대용량 처리를 위한 멀티스레드 기반의 병행처리 예제</h1><div class=lead>배치 수행 시, 대용량 처리를 위해 Job을 멀티스레드 기반으로 병행처리하는 과정을 보여준다. 실행 유형별로 멀티쓰레드 방식, Parallel 방식, 파티셔닝 방식 등이 있다.</div><h1 id=대용량-처리를-위한-멀티스레드-기반의-병행처리-예제>대용량 처리를 위한 멀티스레드 기반의 병행처리 예제</h1><h2 id=개요>개요</h2><p>배치 수행 시, 대용량 처리를 위해 Job을 멀티스레드 기반으로 병행처리하는 과정을 보여준다. 실행 유형별로 멀티쓰레드 방식, Parallel 방식, 파티셔닝 방식 등이 있다.</p><h2 id=설명>설명</h2><h3 id=멀티쓰레드multi-threaded-step-예제>멀티쓰레드(Multi-threaded Step) 예제</h3><p>병행처리멀티스레드(Multi-threaded Step)은 하나의 step을 멀티쓰레드로 처리하는 방식이다. chunk단위로 각 쓰레드에서 병행으로 처리한다.</p><h4 id=job설정>Job설정</h4><p><strong>병행처리멀티스레드 예제의 Job 설정파일인 parallelJob.xml을 확인한다.</strong></p><p>멀티스레드 처리를 원하는 step의 tasklet에 비동기 설정을 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;parallelJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;staging&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;loading&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;fileItemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;validatingProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;stagingItemWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;loading&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;stagingReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;stagingProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;tradeWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SimpleAsyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h4><h5 id=junittest-구성>JunitTest 구성</h5><p>병행처리멀티스레드 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(BatchStatus.COMPLETED, execution.getStatus()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ assertEquals(after - before, execution.getStepExecutions().iterator().next().getReadCount()) : BATCH_STAGING의 data와 stepexcution의 결과를 비교하여 staging의 step의 결과를 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/parallelJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovParallelJobFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//DB 사용을 위한  SimpleJdbcTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTemplate</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jdbcTemplate</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>before</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>countRowsInTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jdbcTemplate</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;BATCH_STAGING&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>execution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>after</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>countRowsInTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jdbcTemplate</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;BATCH_STAGING&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>execution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>after</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>before</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>execution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStepExecutions</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>iterator</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>next</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getReadCount</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h5 id=junittest-수행>JunitTest 수행</h5><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h4 id=결과확인>결과확인</h4><p><strong>멀티쓰레드로 병행처리한 setp은 쓰레드마다의 처리 속도차이에 의해 순차적인 처리가 되지 않는다. loading의 step 결과인 TRADE의 data를 보면 확인할 수 있다.</strong></p><p><img src=../images/multithread-data.png alt=multithread-data></p><h3 id=parallel-예제>Parallel 예제</h3><p>parallelStep이란 분리된 flow을 각 thread에서 병행으로 처리하는 방식이다. 두 개의 flow1, flow2 는 각각 thread에서 병행으로 처리된다.</p><h4 id=job설정-1>Job설정</h4><p><strong>ParallelStep 예제의 Job 설정파일인 parallelStep.xml을 확인한다.</strong></p><p>✔ split 태그에 비동기 설정이 있어야 병행처리가 가능하다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;parallelStep&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;split</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;split1&#34;</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step4&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;flow&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter1&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter2&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;flow&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step3&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter3&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/flow&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/split&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step4&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter4&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SimpleAsyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=junittest-구성-및-수행-1>JunitTest 구성 및 수행</h4><h5 id=junittest-구성-1>JunitTest 구성</h5><p>parallelstep 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.<br>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ getUniqueJobParameters에서 JobParameter에 배치에 필요한 입력 리소스, 출력 리소스 위치정보를 넘긴다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/parallelStep.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovParallelStepFunctionalTests</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// /target/test-outputs/parallelStep폴더의 output파일 확인</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * 잡파라미터를 설정하기 위한 메소드 
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * @return jobParameters
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;/egovframework/data/input/delimited.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile1&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/parallelStep/delimitedOutput1.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile2&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/parallelStep/delimitedOutput2.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile3&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/parallelStep/delimitedOutput3.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile4&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/parallelStep/delimitedOutput4.csv&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addParameter</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;timestamp&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameter</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Date</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getTime</span><span style=color:#000;font-weight:700>())).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h5 id=junittest-수행-1>JunitTest 수행</h5><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h4 id=결과확인-1>결과확인</h4><p>split된 두 개의 flow가 멀티쓰레드(SimpleAsyncTaskExecutor-1,SimpleAsyncTaskExecutor-2)로 실행한 결과는 콘솔창의 로그내용으로 확인할 수 있다. step1과 step3은 서로 다른 쓰레드에서 실행한 사실을 확인할 수 있다.</p><p><img src=../images/parallelstep-step1.png alt=parallelstep-step1></p><p>&mldr;</p><p><img src=../images/parallelstep-step3.png alt=parallelstep-step3></p><h3 id=파티셔닝partitioning-예제>파티셔닝(Partitioning) 예제</h3><p>파티션 정의 File, DB의 데이터를 처리하는 병행처리 방법의 하나로 File 데이터, DB 데이터를 Partition 하여 멀티쓰레드 방식으로 처리한다. 입력리소스에 따라 DB 파티셔닝예제와 과 File 파티셔닝예제를 보여주고, 여러리소스를 읽어 하나의 타켓파일에 쓰는 SingleFile 파티셔닝 예제를 보여준다.</p><table><thead><tr><th>입력 리소스 타입</th><th>관계</th><th>예제</th></tr></thead><tbody><tr><td>DB</td><td></td><td><a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-db_partition/>DB Partition 예제</a></td></tr><tr><td>File</td><td>N:N</td><td><a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-file_partition/>N:N Partition 예제</a></td></tr><tr><td>File</td><td>N:1</td><td><a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-single_file_partition/>N:1 Partition 예제</a></td></tr></tbody></table><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-parallel_process/>병행처리</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b1ced86ad25da16943289800fd3bbc28>7.13 - DB 파티셔닝 예제</h1><div class=lead>DB 파티셔닝 예제에서 EgovColumnRangePartitioner를 사용해 지정된 gridSize만큼 Master Step을 파티셔닝하며, fileNameListener는 입력 리소스명을 기반으로 출력 리소스명을 설정한다. 입력 리소스가 없을 경우 기본값으로 출력 위치와 파일명을 지정한다.</div><h1 id=db-파티셔닝-예제>DB 파티셔닝 예제</h1><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><strong>DB 파티셔닝 예제의 Job 설정 파일인 partitionJdbcJob.xml을 확인한다.</strong></p><ul><li>partitioner : gridSize 수 만큼 Master Step을 파티셔닝하는 EgovColumnRangePartitioner</li><li>grid-size : 생성할 Context 수</li><li>fileNameListener : 입력 리소스명과 같은 이름의 출력리소스명을 설정하고, 입력 리소스가 없다면 설정된 기본값을 이용해 출력위치 및 출력파일명을 지정한다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;partitionJdbcJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;partition</span> <span style=color:#c4a000>step=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>partitioner=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;handler</span> <span style=color:#c4a000>grid-size=</span><span style=color:#4e9a06>&#34;4&#34;</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/partition&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.support.EgovColumnRangePartitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;table&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;CUSTOMER&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;column&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;ID&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span>  <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;fileNameListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;fileNameListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovOutputFileListener&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;path&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/partition/db/&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><h5 id=partitioner>Partitioner</h5><p>EgovColumnRangePartitioner는 gridSize 만큼 테이블 영역을 나누고 영역 수 만큼 Context를 생성하여, 각 영역의 시작열(min)과 마지막열 (max)을 구해 각 Context에 셋팅하는 역할을 한다.<br>(결론적으로, gridSize 만큼 Context가 생성되어 여러 Slave Step 들을 사용할 수 있게 됨)</p><ul><li>gridSize : Job 설정파일에서 프로퍼티로 받아온다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovColumnRangePartitioner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>implements</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Partitioner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>partition</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gridSize</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 테이블의 특정컬럼의 가장 작은 값</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>min</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT MIN(&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>column</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;) from &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>table</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//  테이블의 특정컬럼의 가장 큰 값</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>max</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT MAX(&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>column</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;) from &#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>table</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 하나의 Execution에서 지정될 Data의 범위(크기)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>targetSize</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>max</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>min</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>/</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gridSize</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>result</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>number</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>min</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// targetSize 만큼 의 Data</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>end</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>targetSize</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 파티션된 범위의 수만큼 ExecutionContext를 생성하고 minVlaue 와 maxValue를 셋팅 </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>while</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>max</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>ExecutionContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>result</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;partition&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>number</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>end</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>max</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>end</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>max</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>putInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;minValue&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>start</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>value</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>putInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;maxValue&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>end</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>start</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>targetSize</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>end</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>targetSize</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>result</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h5 id=egovoutputfilelistener>EgovOutputFileListener</h5><p>EgovOutputFileListener 는 <a href>File Partitioner 의 관련 클래스</a>에서 상세히 설명되어 있으므로 참조한다.</p><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>partitionJdbcJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>✔ JunitTest 클래스의 구조는 배치실행환경 예제 Junit Test 설명을 참고한다.<br>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ 데이터처리 결과를 확인하기 위해, 배치수행과 개별적으로 배치수행전 후의 inputs, outputs을 생성하여 비교한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputReader</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>applicationContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getBean</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputTestReader&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과확인>결과확인</h3><p>생성된 파일의 결과를 확인한다.
배치 수행 결과, DB 데이터를 gridSize로 나뉘어 처리된 결과를 확인할 수 있다.</p><p><img src=../images/dbpartition1.png alt=dbpartition1></p></div><div class=td-content style=page-break-before:always><h1 id=pg-f67fc8795d9639524f06c77d5b761772>7.14 - N:N 파일 Partition 예제</h1><div class=lead>파일 파티셔닝 예제에서는 MultiResourcePartitioner를 사용해 입력 리소스 수만큼 Master Step을 파티셔닝하며, grid-size는 생성할 Context 수를 지정한다. fileNameListener는 입력 리소스명과 동일한 출력 리소스명을 설정하고, 입력 리소스가 없을 경우 기본값으로 출력 파일명을 지정한다.</div><h1 id=nn-파일-partition-예제>N:N 파일 Partition 예제</h1><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><strong>File 파티셔닝 예제의 Job 설정 파일인 partitionFileJob.xml을 확인한다.</strong></p><ul><li>ppartitioner : 입력리소스 수 만큼 Master Step을 파티셔닝하는 MultiResourcePartitioner</li><li>grid-size : 생성할 Context 수</li><li>fileNameListener : 입력 리소스명과 같은 이름의 출력리소스명을 설정하고, 입력 리소스가 없다면 설정된 기본값을 이용해 출력위치 및 출력파일명을 지정한다.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;partitionJob&#34;</span> <span style=color:#c4a000>restartable=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;partition</span> <span style=color:#c4a000>step=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>partitioner=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;handler</span> <span style=color:#c4a000>grid-size=</span><span style=color:#4e9a06>&#34;4&#34;</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/partition&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.partition.support.MultiResourcePartitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resources&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:egovframework/data/input/delimited*.csv&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;listeners&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;listener</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;fileNameListener&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/listeners&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;fileNameListener&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.listener.EgovOutputFileListener&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;path&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/partition/file/&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><h5 id=multiresourcepartitioner>MultiResourcePartitioner</h5><p>스프링에서 제공하는 MultiResourcePartitioner 를 사용하며 입력리소스의 수(입력파일 수)만큼 Context를 생성하고 출력위치를 셋팅하는 역할을 한다.(Context 생성으로 여러 Slave Step들을 사용할 수 있게 됨)</p><ul><li>gridSize : Job 설정파일에서 프로퍼티로 받아온다. (예제에서는 4로 지정되어 있지만, 입력리소스의 수(3개)를 기준으로 Context가 생기므로 총 3개의 SalveStep이 생긴다.)</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>MultiResourcePartitioner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>implements</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Partitioner</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>partition</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gridSize</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Map</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>map</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>HashMap</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>gridSize</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>Resource</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resource</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resources</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>ExecutionContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>context</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ExecutionContext</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>Assert</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>state</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>resource</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>exists</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Resource does not exist: &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>resource</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>try</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>putString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>keyName</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>resource</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getURL</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>toExternalForm</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>catch</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>IOException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#204a87;font-weight:700>throw</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IllegalArgumentException</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;File could not be located for: &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>resource</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>map</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>PARTITION_KEY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>context</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>map</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h5 id=egovoutputfilelistener>EgovOutputFileListener</h5><p>Step 수행 이전에 호출이 되며, 입력리소스의 정보를 이용하여 출력파일에 대한 정보를 생성 및 저장한다.
✔ 출력은 path의 기본값인 “file:./target/output/” 이하에 생성이 되며, 이 경로는 Job 설정파일(path 프로퍼티)에서 변경할 수 있다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovOutputFileListener</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// outputKeyName</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputKeyName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;outputFile&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// inputKeyName</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputKeyName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;fileName&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// path</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;file:./target/output/&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@BeforeStep</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>createOutputNameFromInput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>StepExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>ExecutionContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executionContext</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExecutionContext</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>stepExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStepName</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>replace</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;:&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;-&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>executionContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputKeyName</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>inputName</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>executionContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputKeyName</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>executionContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>containsKey</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputKeyName</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>executionContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>putString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputKeyName</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FilenameUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getBaseName</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputName</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;.csv&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>partitionFileJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ 데이터처리 결과를 확인하기 위해, 배치수행과 개별적으로 배치수행전 후의 inputs, outputs을 생성하여 비교한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//Job 의 output 자료들을 얻음</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//Job 수행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//Job 의 output 자료들을 얻음</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputReader</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>applicationContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getBean</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputTestReader&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//input과 output 의 자료중 credit 의 값 비교</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과확인>결과확인</h3><p>생성된 파일의 결과를 확인한다. 배치 수행 결과, 세개의 입력파일을 읽고 처리해 각각의 새로운 파일에 쓰여진 것을 확인할 수 있다.</p><p><img src=../images/filepartition1.png alt=filepartition1></p></div><div class=td-content style=page-break-before:always><h1 id=pg-838ff7e2cabac4767a433c609d8ca979>7.15 - N:1 파일 Partition 예제</h1><div class=lead>싱글 파일 파티셔닝 예제에서는 MultiResourcePartitioner를 사용해 입력 리소스 수만큼 Master Step을 파티셔닝하며, grid-size는 생성할 Context 수를 지정한다. 출력 대상 파일이 하나이므로 여러 Slave Step이 공유하는 EgovPartitionFlatFileItemWriter를 사용하고, 출력 정보를 다루는 EgovOutputFileListener 설정은 필요 없다.</div><h1 id=n1-파일-partition-예제>N:1 파일 Partition 예제</h1><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><strong>N:1 Partition 예제의 Job 설정 파일인 partitionFileToOneFileJob.xml을 확인한다.</strong></p><ul><li>partitioner : 입력리소스 수 만큼 Master Step을 파티셔닝하는 MultiResourcePartitioner</li><li>grid-size : 생성할 Context 수</li><li>writer : scope=“step” 설정 해지로 여러 Slave Step 들이 공유하는 EgovPartitionFlatFileItemWriter 사용(타겟파일이 하나이므로, 다른 파티셔닝과 달리 출력정보를 다루는 EgovOutputFileListener 설정이 필요 없음)</li></ul><p>✔ 이 예제는 여러 Slave Step 들이 하나의 Writer를 공유하는 과정에서 Thread Safe 하도록 구성되어 있다</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;partitionJob&#34;</span> <span style=color:#c4a000>restartable=</span><span style=color:#4e9a06>&#34;true&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>		
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;partition</span> <span style=color:#c4a000>step=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>partitioner=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;handler</span> <span style=color:#c4a000>grid-size=</span><span style=color:#4e9a06>&#34;4&#34;</span> <span style=color:#c4a000>task-executor=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/partition&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;partitioner&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.partition.support.MultiResourcePartitioner&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resources&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;classpath:egovframework/data/input/delimited*.csv&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>transaction-manager=</span><span style=color:#4e9a06>&#34;transactionManager&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriterPartition&#34;</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader commit-interval=&#34;</span><span style=color:#a40000>3&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span> <span style=color:#c4a000>autowire-candidate=</span><span style=color:#4e9a06>&#34;false&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;itemReaderParent&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{stepExecutionContext[fileName]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriterPartition&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.example.support.EgovPartitionFlatFileItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/partition/file/delimitedOneFile.csv&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><h5 id=multiresourcepartitioner>MultiResourcePartitioner</h5><p>스프링에서 제공하는 MultiResourcePartitioner 를 사용하며 입력리소스의 수(입력파일 수)만큼 Context를 생성하고 출력위치를 셋팅하는 역할을 한다.(Context 생성으로 여러 Slave Step들을 사용할 수 있게 됨)</p><p>✔ 이 예제에서 는 File 파티셔닝 예제에서 사용하는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-file_partition/#multiresourcepartitioner>MultiResourcePartitioner</a>와 동일하므로 해당부분을 참고한다.</p><h5 id=egovoutputfilelistener>EgovOutputFileListener</h5><p>Step 수행 이전에 호출이 되며, 입력리소스의 정보를 이용하여 출력파일에 대한 정보를 생성 및 저장한다.</p><p>✔ 출력은 path의 기본값인 “file:./target/output/” 이하에 생성이 되며, 이 경로는 Job 설정파일(path 프로퍼티)에서 변경할 수 있다.</p><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>partitionFileToOneFileJob 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ 데이터처리 결과를 확인하기 위해, 배치수행과 개별적으로 여러 입력파일의 데이터 합과 단일 출력파일의 데이터 합을 비교하여 정상수행여부를 판단한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputReader</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>applicationContext</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getBean</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputTestReader&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>outputReader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// inputFile 과 outputFile 에 포함된 line 수 비교</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// inputFile 과 outputFile 에 포함된 모든 credit 의 합을 비교</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputCredit</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputCredit</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//input 파일들에서 Credit 의 합</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>iterator</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>inputCredit</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//output 파일들에서 Credit 의 합</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>j</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>j</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>j</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>outputCredit</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>j</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputCredit</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputCredit</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과확인>결과확인</h3><p>생성된 파일의 결과를 확인한다.
배치 수행 결과, 세개의 입력파일을 읽고 처리하여 하나의 파일에 쓰여진 것을 확인할 수 있다.</p><p><img src=../images/filepartition2.png alt=filepartition2></p></div><div class=td-content style=page-break-before:always><h1 id=pg-bac8feaf27b1061d73b2707f792057bc>7.16 - 건너뛰기(Skip) 기능 예제</h1><div class=lead>배치 수행 중, 데이터를 처리하는 과정에서 에러가 발생한 데이터를 건너뛰고 다음 데이터를 처리하는 기능을 보여주는 예제이다. EgovSkipSampleFunctionalTests 예제는 ItemReading,ItemProcessing, ItemWriting 에서 발생한 예외상황에 대해 정해진 설정대로 Skip을 수행되는 과정을 보여준다.</div><h1 id=건너뛰기skip-기능-예제>건너뛰기(Skip) 기능 예제</h1><h2 id=개요>개요</h2><p>배치 수행 중, 데이터를 처리하는 과정에서 에러가 발생한 데이터를 건너뛰고 다음 데이터를 처리하는 기능을 보여주는 예제이다. EgovSkipSampleFunctionalTests 예제는 ItemReading,ItemProcessing, ItemWriting 에서 발생한 예외상황에 대해 정해진 설정대로 Skip을 수행되는 과정을 보여준다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>건너뛰기(Skip) 기능 예제의 Job 설정 파일인 skipSample.xml을 확인한다.</b></p><p>✔ skipSample의 Step 흐름 참고</p><p><img src=../images/skip1.png alt="skipSample의 Step 흐름"></p><p>Job 의 구성을 보면 Chunk 설정에 아래와 같은 설정이 있다.</p><ul><li>skip-limit : Skip 할 수 있는 최대 횟수를 지정한다.</li><li>&lt;skippable-exception-classes> : Exception 범위를 지정한다.</li></ul><pre tabindex=0><code>  &lt;include&gt; : skip 해야하는 Exception 지정
  &lt;exclude&gt; : include로 지정한 exception의 하위 exception 중, skip 하지 않을 Exception 지정
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;skipJob&#34;</span> <span style=color:#c4a000>incrementer=</span><span style=color:#4e9a06>&#34;incrementer&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step1&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;baseStep&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;fileItemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;tradeProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;tradeWriter&#34;</span> 
</span></span><span style=display:flex><span>				<span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#c4a000>skip-limit=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileParseException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		  			<span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.WriteFailedException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>		
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;COMPLETED WITH SKIPS&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;errorPrint1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;fail</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>exit-code=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;errorPrint1&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;errorLogTasklet&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;step2&#34;</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;baseStep&#34;</span> <span style=color:#c4a000>next=</span><span style=color:#4e9a06>&#34;skipCheckingDecision&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;tradeSqlItemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;tradeProcessorFailure&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemTrackingWriter&#34;</span> 
</span></span><span style=display:flex><span>				<span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#c4a000>skip-limit=</span><span style=color:#4e9a06>&#34;10&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;skippable-exception-classes</span> <span style=color:#c4a000>merge=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.validator.ValidationException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;java.io.IOException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/skippable-exception-classes&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;no-rollback-exception-classes&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;include</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.validator.ValidationException&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/no-rollback-exception-classes&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;decision</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;skipCheckingDecision&#34;</span> <span style=color:#c4a000>decider=</span><span style=color:#4e9a06>&#34;skipCheckingDecider&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;end</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;*&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;next</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;COMPLETED WITH SKIPS&#34;</span> <span style=color:#c4a000>to=</span><span style=color:#4e9a06>&#34;errorPrint2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;fail</span> <span style=color:#c4a000>on=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#c4a000>exit-code=</span><span style=color:#4e9a06>&#34;FAILED&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/decision&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;errorPrint2&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;errorLogTasklet&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span> 
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>simple-job-launcher-context.xml 설정과 skipSample.xml 설정으로 이루어진 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.</p><p>✔ 다음 Tests 클래스의 주석을 참고하여 Step의 흐름에 따라 Skip이 일어나는 과정을 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/skipSampleJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSkipSampleFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testJobIncrementing</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>		
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>execution1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExplorer</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJobExecution</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id1</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>execution1</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>validateLaunchWithSkips</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>execution1</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>validateLaunchWithSkips</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// Step1: 10 input 레코드, READ 에서 2건 SKIP (ROW:5,10), WRITE 1 건 SKIP =&gt; OUTPUT 결과 7건</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>7</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>countRowsInTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;TRADE&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// Step2: 7 input 레코드, PROCESS 에서 1건 SKIP, WRITE에서 1건 SKIP =&gt; OUTPUT 결과 5건</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT COUNT(*) from TRADE where VERSION=?&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 두번째 스텝에서 1건의 SKIP 발생</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovSkipCheckingListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getProcessSkips</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>// 두 스텝 모두 ERROR_LOG 테이블에 정보 찍힘</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>2</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>countRowsInTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;ERROR_LOG&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//Step1 에서 3건 SKIP 되었다는 정보 확인</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;3 records were skipped!&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;SELECT MESSAGE from ERROR_LOG where JOB_NAME = ? and STEP_NAME = ?&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;skipJob&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;step1&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//Step2 에서 2건 SKIP 되었다는 정보 확인</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;2 records were skipped!&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForObject</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;SELECT MESSAGE from ERROR_LOG where JOB_NAME = ? and STEP_NAME = ?&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;skipJob&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;step2&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과확인>결과확인</h3><p>EgovErrorLogTasklet 에서 처리된 Skip에 대한 간단한 정보를 ERROR_LOG 테이블에서 확인할 수 있다.</p><p><img src=../images/skip2.png alt="ERROR_LOG TABLE"></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-skip_repeat_retry/>Retry</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-be38c8154de58ec7d82a4e6cd989d8d9>7.17 - 동기/비동기 처리 예제</h1><div class=lead>일괄(배치)처리 작업 수행 시, 작업처리가 종료될 때까지 대기하는 동기방식 처리와 작업처리의 종료를 Callback매커니즘을 이용하여 전달받는 비동기처리에 대한 예제를 보여준다.</div><h1 id=동기비동기-처리-예제>동기/비동기 처리 예제</h1><h2 id=개요>개요</h2><p>일괄(배치)처리 작업 수행 시, 작업처리가 종료될 때까지 대기하는 동기방식 처리와 작업처리의 종료를 Callback매커니즘을 이용하여 전달받는 비동기처리에 대한 예제를 보여준다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=launcher-설정>Launcher 설정</h4><p><strong>동기/비동기 처리 예제의 Launcher 설정파일인 skipSample-job-launcher-context.xml 을 확인한다.</strong></p><ul><li>sync : 동기처리시 사용할 클래스 설정</li><li>async : 비동기처리시 사용할 클래스 설정</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;jobLauncher&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.core.launch.support.SimpleJobLauncher&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;jobRepository&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;taskExecutor&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sync&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>  <span style=color:#8f5902;font-style:italic>&lt;!-- 비동기시 ref=&#34;async&#34; --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 동기 처리시  sync --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sync&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!-- 비동기  처리시 async --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;async&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.core.task.SimpleAsyncTaskExecutor&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=job-설정>Job 설정</h4><p><strong>동기/비동기 처리 예제의 Job 설정 파일인 delegatingJob.xml을 확인한다.</strong></p><p>동기/비동기 처리 예제를 위해 특별히 Job을 설정하는 내용은 없다. 이 예제에서 제공하는 Job의 상세 내용은 기존 업무 재사용 예제의 Job 설정과 같으므로 이를 참고한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;3&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.adapter.ItemReaderAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;getData&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.adapter.PropertyExtractingDelegatingItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;processPerson&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldsUsedAsTargetMethodArguments&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;value&gt;</span>firstName<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;value&gt;</span>address.city<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.person.PersonService&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>sync-job-launcher-context설정과 delegatingJob설정으로 구성된 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</strong></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.<br>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.<br>✔ Thread.sleep(4000) : 비동기로 배치를 수행 시, DB에 배치상태(UNKNOWN)를 셋팅하고 DB연결이 종료되어 Job이 정상적으로 수행되더라도 종료상태(COMPLETED,FAILED)를 확인할 수 없다. 예제에서는 Job결과를 확인하기 위해 Thread를 적정시간동안 정지시켜 인위적으로 종료상태를 확인하도록 설정하였다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/sync-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/delegatingJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovSyncDelegatingJobFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>try</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			   </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			   </span><span style=color:#8f5902;font-style:italic>//Async 로 수행되는 경우 Exit Status는 UNKNOWN으로 설정 됨</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			   </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;UNKNOWN&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			   </span><span style=color:#000>Thread</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>sleep</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>4000</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		   </span><span style=color:#000;font-weight:700>}</span><span style=color:#204a87;font-weight:700>catch</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>InterruptedException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ie</span><span style=color:#000;font-weight:700>){</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			   </span><span style=color:#000>ie</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>printStackTrace</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		   </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		 </span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		 </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReceivedCount</span><span style=color:#000;font-weight:700>())</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		 </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;COMPLETED&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getExitStatus</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>getExitCode</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>	
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-execution-job_launcher/>JobLauncher</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-235588e9a696b5530e09ffa735be374b>7.18 - 기존 업무 재사용 예제</h1><div class=lead>기존 업무를 배치의 ItemReader나 ItemWriter로 사용한 예제이다. 스프링 배치에서 제공하는 Item의 Adapter를 사용하면 XML설정만으로도 기존 업무를 손쉽게 사용할 수 있다. 스프링 배치에서 제공하는 Adapter 중에 ItemReaderAdapter와 PropertyExtractingDelegatingItemWriter클래스를 사용하여 기존 업무를 사용하는 기능을 예제로 제공한다.</div><h1 id=기존-업무-재사용-예제>기존 업무 재사용 예제</h1><h2 id=개요>개요</h2><p>기존 업무를 배치의 ItemReader나 ItemWriter로 사용한 예제이다. 스프링 배치에서 제공하는 Item의 Adapter를 사용하면 XML설정만으로도 기존 업무를 손쉽게 사용할 수 있다. 스프링 배치에서 제공하는 Adapter 중에 ItemReaderAdapter와 PropertyExtractingDelegatingItemWriter클래스를 사용하여 기존 업무를 사용하는 기능을 예제로 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>기존 업무 재사용 예제의 Job 설정파일인 delegatingJob.xml을 확인한다.</b></p><p>아래의 예제에서는 targetObject로 정의된 기존 업무인 PersonService를 재사용한다. read시에는 targetMethod로 정의된 getData 메소드를 실행하고, write시에는 targetMethod로 정의된 processProcessPerson 메소드를 실행한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;reader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.adapter.ItemReaderAdapter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;getData&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;writer&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.adapter.PropertyExtractingDelegatingItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetObject&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetMethod&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;processPerson&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>       <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldsUsedAsTargetMethodArguments&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;value&gt;</span>firstName<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;value&gt;</span>address.city<span style=color:#204a87;font-weight:700>&lt;/value&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateObject&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.person.PersonService&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span></code></pre></div><h4 id=클래스-설정>클래스 설정</h4><p><b>위에서 정의된 기존 업무의 클래스를 확인한다.</b></p><p><b>주의</b> : reader의 역할을 하는 targetMethod는 다음과 같은 ItemReader의 동작방식을 만족해야 한다.</p><p>✔ 메소드 호출시 하나의 Item(Object)을 반환한다.</p><p>✔ 더 이상 반환할 Item(Object)이 없는 경우 null을 반환한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//reader의 역할을 하는  getData() 호출시 generatedCounter가 1씩 증가하며 하나의 person이라는 Object를 반환한다. </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>//또한  읽기 횟수에 제한을 두어 null을 반환하여 더이상 반환한 Item이 없다는 것을 알린다.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>PersonService</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>final</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GENERATION_LIMIT</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>generatedCounter</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>//read</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Person</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getData</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>generatedCounter</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GENERATION_LIMIT</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>Person</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>person</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Person</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>generatedCounter</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>person</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>//write</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>processPerson</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>city</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	        </span><span style=color:#000>processedCounter</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>기존 업무 재사용 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()) : 배치수행결과가 COMPLETED 인지 확인한다.</p><p>✔ assertTrue(personService.getReturnedCount() > 0), assertEquals(personService.getReturnedCount(), personService.getReceivedCount()) :기존 업무재사용 여부를 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/delegatingJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovDelegatingJobFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//배치작업에 사용된 기존 업무 클래스</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PersonService</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testLaunchJob</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReceivedCount</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; readCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReturnedCount</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>System</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; writeCount = &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>personService</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getReceivedCount</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>콘솔창의 로그를 통해 배치 작업시 기존업무를 재사용한 결과를 확인할 수 있다.</p><p><img src=../images/delegate_output.png alt=delegate_output></p><h2 id=참고자료>참고자료</h2><ul><li><a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#reusingExistingServices>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#reusingExistingServices</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-cf888a2f3e65f04d734975b13db9bf5c>7.19 - MultiResource 예제</h1><div class=lead>한 step에서 여러개의 파일을 처리하는 기능을 예제로 제공한다. 스프링 배치에서는 MultiResourceItemReader와 MultiResourceItemWriter를 제공한다.</div><h1 id=multiresource-예제>MultiResource 예제</h1><h2 id=개요>개요</h2><p>한 step에서 여러개의 파일을 처리하는 기능을 예제로 제공한다. 스프링 배치에서는 MultiResourceItemReader와 MultiResourceItemWriter를 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>MultiResource 예제의 Job 설정파일인 multiResourceIoJob.xml을 확인한다.</b></p><p>MultiResourceItemReader는 resources로 정의된 파일들을 읽어와서, 파일 한 개씩 delegate로 정의된 reader가 read하도록 전달한다.</p><p>아래의 예제는 실제로 파일을 read하는 reader는 delegate로 정의된 FlatFileItemReader이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.MultiResourceItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delegate&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resources&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[&#39;input.file.path&#39;]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>MultiResourceItemWriter는 itemCountLimitPerResource로 정의된 수보다 write할 item이 넘어가면 새 output파일을 생성하고, delegate로 정의된 writer가 write하도록 전달한다.</p><p>아래의 예제는 FlatFileItemWriter가 write한 item이 6이 되면 MultiResourceItemWriter가 새 output 파일을 생성하여 다시 FlatFileItemWriter가 write도록 전달한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.MultiResourceItemWriter&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[&#39;output.file.path&#39;]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;itemCountLimitPerResource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;6&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delegate&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;delegateWriter&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;delegateWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=resource-설정>Resource 설정</h4><p>Job 설정의 xml를 살펴보면 MultiResourceReader의 resources는 input.file.path의 키값으로 지정된 jobParameter의 value이다. 해당 값은 아래의 Junit 테스트케이스 파일에서 확인할 수 있다.</p><pre tabindex=0><code>JobParameter
key: input.file.path 
value : /egovframework/data/input/delimited*.csv&#34;
</code></pre><p><img src=../images/mutiresource.png alt=mutiresource></p><p>Job 설정의 xml를 살펴보면 MultiResourceWriter의 resource는 output.file.path의 키값으로 지정된 jobParameter의 value이다. 해당 값은 아래의 Junit 테스트케이스 파일에서 확인할 수 있으며, 파일들은 테스트 후에 확인할 수 있다.</p><pre tabindex=0><code>  JobParameter
  key : output.file.path
  value : file:./target/test-outputs/multiResourceOutput.csv
</code></pre><h3 id=junit-구성-및-수행>Junit 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>MutiResource 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ getUniqueJobParameters에서 JobParameter에 배치에 필요한 입력 리소스, 출력 리소스 위치정보를 넘긴다.</p><p>✔ EgovAbstractIoSampleTests에서는 배치를 수행하고 배치작업 전후의 데이터를 비교확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()):배치수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>*/</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/multiResourceIoJob.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovMultiResourceFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobParametersBuilder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>builder</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>builder</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;input.file.path&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/data/input/delimited*.csv&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#4e9a06>&#34;output.file.path&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;file:./target/test-outputs/multiResourceOutput.csv&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과확인>결과확인</h3><p>MultiReourceWriter의 결과로 여러 파일이 생성되었는지를 확인한다.</p><p><img src=../images/mutiresource_output.png alt=mutiresource_output></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-multidata_process/>multidata_process</a></li><li><a href=./http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#multiFileInput>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#multiFileInput</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3fdf9f0116508caa2e388d1b14eb18ed>7.20 - JdbcPaging 예제</h1><div class=lead>DB를 페이지단위로 읽어서 데이터처리를 수행하는 기능을 예제로 제공한다. 스프링 배치에서는 JdbcPagingItemReader,JpaPagingItemReader등을 제공한다.또한 paging쿼리를 제공하는 인터페이스 PagingQueryProvider를 제공하며 각 DB종류별로 OraclePagingQueryProvider, HsqlPagingQueryProvider, MySqlPagingQueryProvider, SqlServerPagingQueryProvider, SybasePagingQueryProvider 등의 구현클래스를 제공한다.</div><h1 id=jdbcpaging-예제>JdbcPaging 예제</h1><h2 id=개요>개요</h2><p>DB를 페이지단위로 읽어서 데이터처리를 수행하는 기능을 예제로 제공한다. 스프링 배치에서는 JdbcPagingItemReader,JpaPagingItemReader등을 제공한다.또한 paging쿼리를 제공하는 인터페이스 PagingQueryProvider를 제공하며 각 DB종류별로 OraclePagingQueryProvider, HsqlPagingQueryProvider, MySqlPagingQueryProvider, SqlServerPagingQueryProvider, SybasePagingQueryProvider 등의 구현클래스를 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>JdbcPaging 예제의 Job 설정파일인 jdbcPagingIoJob.xml을 확인한다.</b></p><p>JdbcPagingItemReader는 아래와 같은 설정들을 포함한다.</p><ul><li>dataSource : 데이터베이스</li><li>rowMapper : SQL의 실행 결과인 ResultSet와 객체를 매핑 시키는 역할</li><li>queryProvider : 페이징 처리를 위한 쿼리를 제공하는 역할</li><li>pageSize : 한 페이지의 DATA 수</li><li>parameterValues : 쿼리의 파라미터 값을 Map으로 지정</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.JdbcPagingItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;rowMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCreditRowMapper&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;queryProvider&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.support.SqlPagingQueryProviderFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sortKey&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;ID&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>&lt;!-- Intentionally put sort key second in the query list as a test --&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;selectClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;select NAME, ID, CREDIT&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fromClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;FROM CUSTOMER&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;whereClause&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;WHERE CREDIT &gt; :credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;pageSize&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;parameterValues&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;map&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;statusCode&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;PE&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;credit&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[credit]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>&lt;entry</span> <span style=color:#c4a000>key=</span><span style=color:#4e9a06>&#34;type&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;COLLECTION&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;/map&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>Delimited 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=../../runtime-example/individual-example/batch-layer/batch-example-run_junit_test.md>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ getUniqueJobParameters에서 JobParameter에 쿼리에 필요한 파라미터 정보를 넘긴다.</p><p>✔ EgovAbstractIoSampleTests에서 배치작업을 수행하고 배치작업 전후의 데이터를 비교확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.</p><p>✔ altibase를 사용 할 경우, altibase 버전이 6.1.1일경우에만 정상동작한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/jdbcPagingIoJob.xml&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovJdbcPagingFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>// SimpleJdbcTemplate</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTemplate</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * 배치작업 테스트 전에 DB관련 작업
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Before</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>setUp</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;DELETE from CUSTOMER&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (1, 0, &#39;customer1&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (2, 0, &#39;customer2&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (3, 0, &#39;customer3&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (4, 0, &#39;customer4&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>())</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>addDouble</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;credit&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>10000</span><span style=color:#000;font-weight:700>.).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>1.DB의 페이징 처리는 콘솔로그의 쿼리를 통해 확인할 수 있다. 위의 설정에서 pagesize가 2이므로, reader가 DB로 부터 데이터를 읽을 때 하나의 데이터가 아닌 2개의 데이터를 읽어온다.</p><p><img src=../images/jdbcpaging_cs.png alt=jdbcpaging_cs></p><p>2.DB의 Customer 테이블의 credit의 값을 살펴보면 Job이 실행되면서 수정된 것을 확인 할 수 있다.</p><p><img src=../images/jdbcpaging_data.png alt=jdbcpaging_data></p><h2 id=참고자료>참고자료</h2><ul><li><a href=./batch-core-item_reader.md>JdbcPagingItemReader</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f8ee4514fcc55e2f6e42f15dc9d17b81>7.21 - JdbcCursor 예제</h1><div class=lead>DB를 한 행씩 읽어서 데이터처리를 수행하는 기능을 예제로 제공한다. 스프링 배치에서는 JdbcCursorItemReader, HibernateCursorItemReader를 제공한다.</div><h1 id=jdbccursor-예제>JdbcCursor 예제</h1><h2 id=개요>개요</h2><p>DB를 한 행씩 읽어서 데이터처리를 수행하는 기능을 예제로 제공한다. 스프링 배치에서는 JdbcCursorItemReader, HibernateCursorItemReader를 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>JdbcCursor 예제의 Job 설정파일인 jdbcCursorIoJob.xml을 확인한다.</b></p><p>JdbcCursorItemReader는 아래와 같은 설정들을 포함한다.</p><ul><li>dataSource : 데이터베이스</li><li>sql : 실행할 쿼리</li><li>verifyCursorPosition : 커서위치 확인여부</li><li>rowMapper : SQL의 실행 결과인 ResultSet와 객체를 매핑 시키는 역할</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.JdbcCursorItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sql&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;select ID, NAME, CREDIT from CUSTOMER&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;verifyCursorPosition&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;rowMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCreditRowMapper&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>JdbcCursor 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ EgovAbstractIoSampleTests에서 배치작업을 수행하고 배치작업 전후의 데이터를 비교확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>   */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>1.DB의 cursor 처리는 콘솔로그의 쿼리를 통해 확인할 수 있다. reader가 DB로 부터 데이터를 읽을 때 하나의 데이터를 읽어온다.</p><p><img src=../images/jdbccursor.png alt=jdbccursor></p><p>2.DB의 Customer 테이블의 credit의 값을 살펴보면 Job이 실행되면서 수정된 것을 확인 할 수 있다.</p><p><img src=../images/jdbccursor_data.png alt=jdbccursor_data></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-item_reader/>JDBCCursorItemReader</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-496f2c27cf8aa0f13bfe25ff1a08fab4>7.22 - Ibatis 예제</h1><div class=lead>iBatis를 사용하여 Database의 데이터를 읽고 쓰는 기능에 대한 예제를 제공한다. 스프링 배치에서는 IbatisPagingItemReader와 IbatisBatchItemWriter를 제공한다.</div><h1 id=ibatis-예제>Ibatis 예제</h1><h2 id=개요>개요</h2><p>iBatis를 사용하여 Database의 데이터를 읽고 쓰는 기능에 대한 예제를 제공한다. 스프링 배치에서는 IbatisPagingItemReader와 IbatisBatchItemWriter를 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><strong>Ibatis 예제의 Job 설정파일인 ibatisIoJob.xml을 확인한다.</strong></p><p>Ibatis 를 연동을 위해 Spring의 SqlMapClientFactoryBean을 통해 sql-map-config 설정 파일과 Ibatis 에 제공될 dataSource 설정한다. IbatisPagingItemReader와 IbatisBatchItemWriter는 sqlMapClient의 value값으로 정의된 설정파일을 통해 각각 queryId와 statementId의 value값으로 정의된 ID와 동일한 쿼리를 수행한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span><span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.IbatisPagingItemReader&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;queryId&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;getAllCustomerCredits&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.database.IbatisBatchItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;statementId&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;updateCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;sqlMapClient&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.orm.ibatis.SqlMapClientFactoryBean&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;configLocation&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;ibatis-config.xml&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h4 id=ibatis-설정>Ibatis 설정</h4><p><strong>Ibatis사용을 위한 기본 설정을 확인한다.</strong></p><p><strong>sql-map-config</strong></p><p>ibatis-config.xml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;sqlMapConfig&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&lt;sqlMap</span> <span style=color:#c4a000>resource=</span><span style=color:#4e9a06>&#34;ibatis-customer-credit.xml&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/sqlMapConfig&gt;</span>
</span></span></code></pre></div><p><strong>sql-map</strong></p><p>ibatis-customer-credit.xml</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;resultMap</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;result&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;NAME&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>&lt;result</span> <span style=color:#c4a000>property=</span><span style=color:#4e9a06>&#34;credit&#34;</span> <span style=color:#c4a000>column=</span><span style=color:#4e9a06>&#34;CREDIT&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/resultMap&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;select</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;getAllCustomerCredits&#34;</span> <span style=color:#c4a000>resultMap=</span><span style=color:#4e9a06>&#34;result&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>    select ID, NAME, CREDIT from CUSTOMER
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/select&gt;</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><strong>ibatisIo예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</strong></p><p>✔ JunitTest 클래스의 구조는 <a href=../../runtime-example/individual-example/batch-layer/batch-example-run_junit_test.md>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ EgovAbstractIoSampleTests에서 배치작업을 수행하고 배치작업 전후의 데이터를 비교확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/ibatisIoJob.xml&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovIbatisFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Before</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>setUp</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;DELETE from CUSTOMER&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (1, 0, &#39;customer1&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (2, 0, &#39;customer2&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (3, 0, &#39;customer3&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (4, 0, &#39;customer4&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * 배치결과를 다시 읽을 때  reader 설정하는 메소드
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#8f5902;font-style:italic>// no-op</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>DB의 Customer 테이블의 credit의 값을 살펴보면 Job이 실행되면서 수정된 것을 확인 할 수 있다.</p><p><img src=../images/jdbccursor_data.png alt=jdbccursor_data></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/persistence-layer/dataaccess-configuration_xml/>iBATIS Configuration</a></li><li><a href=../persistence-layer/dataaccess-ibatis.md>Data Access</a></li><li><a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#IbatisPagingItemReader>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#IbatisPagingItemReader</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6a7f565ebdc4f1d625ec027f3da0db4b>7.23 - FixedLength 예제</h1><div class=lead>플랫 파일의 데이터를 고정된 길이만큼 처리하는 기능을 예제로 제공한다. 스프링 배치에서는 플랫 파일을 처리하기 위해 FlatFileItemReader와 FlatFileItemWriter를 제공한다.</div><h1 id=fixedlength-예제>FixedLength 예제</h1><h2 id=개요>개요</h2><p>플랫 파일의 데이터를 고정된 길이만큼 처리하는 기능을 예제로 제공한다. 스프링 배치에서는 플랫 파일을 처리하기 위해 FlatFileItemReader와 FlatFileItemWriter를 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>FixedLength 예제의 Job 설정파일인 fixedLengthIoJob.xml을 확인한다.</b></p><p>FlatFileItemReader는 아래와 같은 설정들을 포함한다.</p><ul><li>resource : 처리해야 할 파일</li><li>lineMapper : 파일의 한 Line씩 처리하는 역할. lineTokenizer와 fieldSetMapper로 구성<ul><li>lineTokenizer : FixedLengthTokenizer을 통해 각 Line을 읽어 고정된 위치로 분리하여 fieldSet객체로 만들어 줌</li><li>fieldSetMapper : FieldSet을 다시 객체로 매핑시켜줌</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[inputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.FixedLengthTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;columns&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;1-9,10-11&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>추가로 FlatFileItemWriter설정에 대해서 설명하면 아래와 같다.</p><ul><li>resource : 결과파일</li><li>lineAggregator : 객체를 파일에 쓸 String으로 변환함. FieldSetCreator에서 객체를 FieldSet으로 변환하고 FormatterLineAggregator를 통해 정의된 format에 따라 String으로 변환함.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[outputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.FormatterLineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;format&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;%-9s%-2.0f&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>FixedLength 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=../../runtime-example/individual-example/batch-layer/batch-example-run_junit_test.md>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ getUniqueJobParameters에서 JobParameter에 쿼리에 필요한 파라미터 정보를 넘긴다.</p><p>✔ EgovAbstractIoSampleTests에서 배치작업을 수행하고 배치작업 전후의 데이터를 비교확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/fixedLengthIoJob.xml&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovFixedLengthFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()).</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#4e9a06>&#34;/egovframework/data/input/fixedLength.txt&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#4e9a06>&#34;file:./target/test-outputs/fixedLengthOutput.txt&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>fixedlengthJob의 결과로 아래의 파일이 생성되었는지를 확인한다. Job이 실행되면서 데이터가 수정된 것을 확인 할 수 있다.</p><p><img src=../images/fixedlength_data.png alt=fixedlength_data></p><h2 id=참고자료>참고자료</h2><ul><li><a href=../../egovframe-runtime/batch-layer/batch-core-item_reader.md>FlatFileItemReader</a></li><li><a href=../../egovframe-runtime/batch-layer/batch-core-item_writer.md>FlatFileItemWriter</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0360b2dd700867a0ecef9bc5a412f789>7.24 - Delimited 예제</h1><div class=lead>플랫 파일의 데이터를 구분자(delimiter)로 구분하여 처리하는 기능을 예제로 제공한다. 스프링 배치에서는 플랫 파일을 처리하기 위해 FlatFileItemReader와 FlatFileItemWriter를 제공한다.</div><h1 id=delimited-예제>Delimited 예제</h1><h2 id=개요>개요</h2><p>플랫 파일의 데이터를 구분자(delimiter)로 구분하여 처리하는 기능을 예제로 제공한다. 스프링 배치에서는 플랫 파일을 처리하기 위해 FlatFileItemReader와 FlatFileItemWriter를 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>Delimited 예제의 Job 설정파일인 delimitedIoJob.xml을 확인한다.</b></p><p>FlatFileItemReader는 아래와 같은 설정들을 포함한다.</p><ul><li>resource : 처리해야 할 파일</li><li>lineMapper : 파일의 한 Line씩 처리하는 역할. lineTokenizer와 fieldSetMapper로 구성<ul><li>lineTokenizer : DelimitedLineTokenizer을 통해 각 Line을 읽어 구분자로 분리하여 fieldSet객체로 만들어 줌</li><li>fieldSetMapper : FieldSet을 다시 객체로 매핑시켜줌</li></ul></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemReader&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.DefaultLineMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineTokenizer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.mapping.BeanWrapperFieldSetMapper&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;targetType&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.CustomerCredit&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>	
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[inputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><p>추가로 FlatFileItemWriter설정에 대해서 설명하면 아래와 같다.</p><ul><li>resource : 결과파일</li><li>lineAggregator : 객체를 파일에 쓸 String으로 변환함. FieldSetCreator에서 객체를 FieldSet으로 변환하고 DelimitedLineAggregator를 통해 정의된 구분자로 구분하는 String으로 변환함.</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span> <span style=color:#c4a000>scope=</span><span style=color:#4e9a06>&#34;step&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;#{jobParameters[outputFile]}&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.DelimitedLineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delimiter&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;,&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;fieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.BeanWrapperFieldExtractor&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;names&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;name,credit&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>					
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>Delimited 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=../../runtime-example/individual-example/batch-layer/batch-example-run_junit_test.md>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ getUniqueJobParameters에서 JobParameter에 쿼리에 필요한 파라미터 정보를 넘긴다.</p><p>✔ EgovAbstractIoSampleTests에서 배치작업을 수행하고 배치작업 전후의 데이터를 비교확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, jobExecution.getStatus()): 배치수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/delimitedIoJob.xml&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovDelimitedFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>protected</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>return</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobParametersBuilder</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>()).</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;inputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;/egovframework/data/input/delimited.csv&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>addString</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;outputFile&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;file:./target/test-outputs/delimitedOutput.csv&#34;</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>toJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@TestExecutionListeners</span><span style=color:#000;font-weight:700>(</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DependencyInjectionTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>StepScopeTestExecutionListener</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Qualifier</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;jobLauncherTestUtils&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업의  reader</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ItemReader</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>pointReaderToOutput</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>getCredits</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>reader</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertTrue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>itemCount</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>itemCount</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCreditIncreaseProcessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FIXED_AMOUNT</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>).</span><span style=color:#c4a000>getCredit</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>intValue</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>위의 테스트 결과로 아래의 파일이 생성되었는지를 확인한다. Job이 실행되면서 데이터가 수정된 것을 확인 할 수 있다.</p><p><img src=../images/delimited_data.png alt=delimited_data></p><h2 id=참고자료>참고자료</h2><ul><li><a href=../../egovframe-runtime/batch-layer/batch-core-item_reader.md>FlatFileItemReader</a></li><li><a href=../../egovframe-runtime/batch-layer/batch-core-item_writer.md>FlatFileItemWriter</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e98a7f3a955b08499c9428646f8c0584>7.25 - CompositeItem 예제</h1><div class=lead>서로 다른 유형으로 업무 처리하는 예제로 스프링 배치에서는 CompositeItemProcessor와 CompositeItemWriter를 제공한다. CompositeItemWriter를 사용하여 서로 다른 타입의 writer로 업무를 처리하는 기능을 예제로 제공한다.</div><h1 id=composititem-예제>CompositItem 예제</h1><h2 id=개요>개요</h2><p>서로 다른 유형으로 업무 처리하는 예제로 스프링 배치에서는 CompositeItemProcessor와 CompositeItemWriter를 제공한다. CompositeItemWriter를 사용하여 서로 다른 타입의 writer로 업무를 처리하는 기능을 예제로 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>CompositeItem 예제의 Job 설정파일인 compositeItemWriterSampleJob.xml을 확인한다.</b></p><p>CompositeItemWriter는 Item을 delegetes으로 정의된 writer에게 각각 전달하여 처리하도록 한다. 아래의 예제에서는 tradeDao, fileItemWriter1, fileItemWriter2 총 3개의 writer로 설정되어 있다.</p><p>✔CompositeItemWriter 사용시에는 step에 delegetes으로 정의된 writer들은 streams로 설정하여야 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemWriterJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span> <span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeItemWriterStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;fileItemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;processor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;compositeWriter&#34;</span> <span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;streams&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;stream</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;fileItemReader&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;stream</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;fileItemWriter1&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>					<span style=color:#204a87;font-weight:700>&lt;stream</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;fileItemWriter2&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;/streams&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/chunk&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;compositeWriter&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.support.CompositeItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;delegates&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;list&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.TradeWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dao&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;tradeDao&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;fileItemWriter1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;ref</span> <span style=color:#c4a000>bean=</span><span style=color:#4e9a06>&#34;fileItemWriter2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/list&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;tradeDao&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;egovframework.brte.sample.common.domain.trade.JdbcTradeDao&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#c4a000>ref=</span><span style=color:#4e9a06>&#34;dataSource&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;incrementer&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>parent=</span><span style=color:#4e9a06>&#34;incrementerParent&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;incrementerName&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;TRADE_SEQ&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;fileItemWriter1&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;fw1&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:target/test-outputs/CustomerReport1.txt&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.PassThroughLineAggregator&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;fileItemWriter2&#34;</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.FlatFileItemWriter&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;fw2&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;resource&#34;</span> <span style=color:#c4a000>value=</span><span style=color:#4e9a06>&#34;file:target/test-outputs/CustomerReport2.txt&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;property</span> <span style=color:#c4a000>name=</span><span style=color:#4e9a06>&#34;lineAggregator&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>	       <span style=color:#204a87;font-weight:700>&lt;bean</span> <span style=color:#c4a000>class=</span><span style=color:#4e9a06>&#34;org.springframework.batch.item.file.transform.PassThroughLineAggregator&#34;</span> <span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/property&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;/bean&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>CompositeItem 설정과 관련 클래스들로 Junit Test를 수행한다. 이 때 배치가 수행되고, 관련된 내용을 확인할 수 있다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=../../runtime-example/individual-example/batch-layer/batch-example-run_junit_test.md>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ assertEquals(“COMPLETED”, jobExecution.getExitStatus().getExitCode()) : 배치수행결과가 COMPLETED 인지 확인한다.</p><p>✔ checkOutputFile,checkOutputTable 메소드: 배치 수행후 compositeItemWriter에 설정된 writer들이 배치를 실행하였는지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/compositeItemWriterSampleJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                               </span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovCompositeItemWriterSampleFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//Trade 테이블의 데이트를 가져오는 쿼리 </span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>final</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>GET_TRADES</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;SELECT isin, quantity, price, customer FROM TRADE order by isin&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//파일에 예상되는 결과값</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>final</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>EXPECTED_OUTPUT_FILE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Trade: [isin=UK21341EAH41,quantity=211,price=31.11,customer=customer1]&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Trade: [isin=UK21341EAH42,quantity=212,price=32.11,customer=customer2]&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Trade: [isin=UK21341EAH43,quantity=213,price=33.11,customer=customer3]&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Trade: [isin=UK21341EAH44,quantity=214,price=34.11,customer=customer4]&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;Trade: [isin=UK21341EAH45,quantity=215,price=35.11,customer=customer5]&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testJobLaunch</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>before</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT COUNT(*) from TRADE&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>checkOutputFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;target/test-outputs/CustomerReport1.txt&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>checkOutputFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;target/test-outputs/CustomerReport2.txt&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>checkOutputTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>before</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 후 Trade 테이블의 데이터 확인
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * @param 배치작업 전 Trade의 데이터 갯수
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>checkOutputTable</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>before</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>final</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Trade</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>trades</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ArrayList</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>Trade</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Trade</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;UK21341EAH41&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>211</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BigDecimal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;31.11&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;customer1&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Trade</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;UK21341EAH42&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>212</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BigDecimal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;32.11&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;customer2&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Trade</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;UK21341EAH43&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>213</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BigDecimal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;33.11&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;customer3&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Trade</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;UK21341EAH44&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>214</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BigDecimal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;34.11&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;customer4&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Trade</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;UK21341EAH45&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>215</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>BigDecimal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;35.11&#34;</span><span style=color:#000;font-weight:700>),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;customer5&#34;</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>};</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>after</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>queryForInt</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;SELECT COUNT(*) from TRADE&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>before</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>after</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getJdbcOperations</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>query</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>GET_TRADES</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RowCallbackHandler</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>int</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>activeRow</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>processRow</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ResultSet</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rs</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SQLException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>Trade</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>trade</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>trades</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>get</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>activeRow</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>trade</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getIsin</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>1</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>trade</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getQuantity</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getLong</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>2</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>trade</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getPrice</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getBigDecimal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>3</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>trade</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getCustomer</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>4</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>});</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * 배치작업 후 file의 데이터 확인
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * @param fileName
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * @throws IOException
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>checkOutputFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>fileName</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IOException</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#5c35cc;font-weight:700>@SuppressWarnings</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;unchecked&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputLines</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>IOUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>readLines</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FileInputStream</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fileName</span><span style=color:#000;font-weight:700>));</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>output</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>line</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputLines</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000>output</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>+=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>line</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>EXPECTED_OUTPUT_FILE</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>output</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>위의 테스트의 결과인 DB의 Trade테이블과 파일들이 생성되었는지를 확인한다.</p><p><img src=../images/compositewriter_datadb.png alt=compositewriter_datadb></p><h2 id=참고자료>참고자료</h2><ul><li><a href=../../egovframe-runtime/batch-layer/batch-core-multidata_process.md>multidata_process</a></li><li><a href=http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#delegatePatternAndRegistering>http://static.springsource.org/spring-batch/reference/html/readersAndWriters.html#delegatePatternAndRegistering</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-05b0e597490042b6f6f8b178ac61bfd4>7.26 - 재시도(Restart) 예제</h1><div class=lead>Job이 restart 되는 기능을 예제로 제공한다.</div><h1 id=restart-예제>Restart 예제</h1><h2 id=개요>개요</h2><p>Job이 restart 되는 기능을 예제로 제공한다.</p><h2 id=설명>설명</h2><h3 id=설정>설정</h3><h4 id=job-설정>Job 설정</h4><p><b>Restart 예제의 Job 설정파일인 restartFileSampleJob.xml을 확인한다.</b></p><p>job을 재실행할 수 있는지 여부를 Job 설정시 지정할 수 있다. 디폴트는 true이고 아래와 같이 restartable 설정에 따라 지정할 수 있다.</p><p><b>재실행 가능</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;restartFileSampleJob&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;restartFileSampleStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span>
</span></span><span style=display:flex><span>					<span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><p><b>재실행 불가능</b></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;job</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;restartFileSampleJob&#34;</span> <span style=color:#c4a000>restartable=</span><span style=color:#4e9a06>&#34;false&#34;</span> <span style=color:#c4a000>xmlns=</span><span style=color:#4e9a06>&#34;http://www.springframework.org/schema/batch&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;step</span> <span style=color:#c4a000>id=</span><span style=color:#4e9a06>&#34;restartFileSampleStep1&#34;</span><span style=color:#204a87;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;tasklet&gt;</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&lt;chunk</span> <span style=color:#c4a000>reader=</span><span style=color:#4e9a06>&#34;itemReader&#34;</span> <span style=color:#c4a000>processor=</span><span style=color:#4e9a06>&#34;itemProcessor&#34;</span> <span style=color:#c4a000>writer=</span><span style=color:#4e9a06>&#34;itemWriter&#34;</span>
</span></span><span style=display:flex><span>					<span style=color:#c4a000>commit-interval=</span><span style=color:#4e9a06>&#34;5&#34;</span><span style=color:#204a87;font-weight:700>/&gt;</span>
</span></span><span style=display:flex><span>			<span style=color:#204a87;font-weight:700>&lt;/tasklet&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&lt;/step&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&lt;/job&gt;</span>
</span></span></code></pre></div><h3 id=junittest-구성-및-수행>JunitTest 구성 및 수행</h3><h4 id=junittest-구성>JunitTest 구성</h4><p><b>Restart 예제를 수행하고 배치작업 결과에 대한 검증을 위해 다음과 같이 @Test를 구성하였다.</b></p><p>✔ JunitTest 클래스의 구조는 <a href=/egovframe-docs/runtime-example/individual-example/batch-layer/batch-example-run_junit_test/>배치실행환경 예제 Junit Test 설명</a>을 참고한다.</p><p>✔ CustomerCreditFlatFileItemWriter 클래스 : 배치수행시 failed를 발생시킨다.</p><p>✔ assertEquals(BatchStatus.FAILED, je1.getStatus()); : 배치 첫수행결과가 FAILED 인지 확인한다.</p><p>✔ assertEquals(BatchStatus.COMPLETED, je2.getStatus()); : 배치 재수행결과가 COMPLETED 인지 확인한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@RunWith</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>SpringJUnit4ClassRunner</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>class</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/restartFileSampleJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovRestartFileSampleFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업의 outputResource</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Resource</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputResource</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>//배치작업을  test하기 위한 JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 * 배치작업 테스트
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>	 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>runTest</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobParameters</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>je1</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>FAILED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>je1</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>AssertFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>assertLineCount</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>10</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputResource</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>je2</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>jobParameters</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>je2</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000>AssertFile</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>assertLineCount</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>20</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputResource</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    *  restart기능 테스트를 위해 작업중간에 failed 발생시키는 writer 클래스
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * @author 배치실행개발팀
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * @since 2012. 06.27
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * @version 1.0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    * @see
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>     */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>static</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>CustomerCreditFlatFileItemWriter</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>FlatFileItemWriter</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>//failed를 발생시키기 위한 플래그</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>boolean</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>failed</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 * write 함
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>		 */</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#5c35cc;font-weight:700>@Override</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;?</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CustomerCredit</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arg0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>for</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>CustomerCredit</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cc</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>arg0</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#204a87;font-weight:700>if</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>failed</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>&amp;&amp;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cc</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getName</span><span style=color:#000;font-weight:700>().</span><span style=color:#c4a000>equals</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;customer13&#34;</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#000>failed</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>					</span><span style=color:#204a87;font-weight:700>throw</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>RuntimeException</span><span style=color:#000;font-weight:700>();</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>			</span><span style=color:#204a87;font-weight:700>super</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arg0</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>		</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=junittest-수행>JunitTest 수행</h4><p>수행방법은 <a href=./batch-example-junit.md#Junit-Test-%EC%8B%A4%ED%96%89>JunitTest 실행</a>을 참고한다.</p><h3 id=결과-확인>결과 확인</h3><p>JobExecution을 살펴보면, failed된 Job을 restart하여 Complited된 결과를 확인할 수 있다.</p><p><img src=../images/restart_jobdata.png alt=restart_jobdata></p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-step/>restart를 위한 Step 설정</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a689ba90df1c4caa531f7a39f2d8d4ea>7.27 - 배치실행환경 예제 JUnit Test 설명</h1><div class=lead>배치실행환경 예제에서는 JUnit을 이용하여 배치를 수행하고 성공여부 판단 및 테스트 내용 확인을 한다. 초보 사용자의 이해를 돕기위해 예제에서 공통으로 사용하는 JUnitTest의 기본설정과 테스트 수행방법을 설명한다.</div><h1 id=배치실행환경-예제-junit-test-설명>배치실행환경 예제 JUnit Test 설명</h1><h2 id=개요>개요</h2><p>배치실행환경 예제에서는 JUnit을 이용하여 배치를 수행하고 성공여부 판단 및 테스트 내용 확인을 한다. 초보 사용자의 이해를 돕기위해 예제에서 공통으로 사용하는 JUnitTest의 기본설정과 테스트 수행방법을 설명한다.</p><h2 id=설명>설명</h2><h3 id=예제-junit-test-기본-구조>예제 JUnit Test 기본 구조</h3><h4 id=contextconfiguration>@ContextConfiguration</h4><p>ContextConfiguration 은 컨텍스트를 얻어 그 내용을 참조하는 역할을 하며, 배치실행환경 예제에서는 배치수행에 필요한 설정파일들을 여기서 참조하도록 설정되어 있다.</p><p>✔ Launcher설정파일, Job설정파일, JobLauncherTestUtils를 사용하기 위한 별도의 설정파일(ex.job-runner-context.xml) 등이 명시된다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/parallelJob.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovParallelJobFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>✔ 공통으로 사용되는 설정파일이 있을 경우, 다음과 같이 부모클래스에 담고 이를 상속받아 사용할 수 있다.</p><pre tabindex=0><code>  부모클래스 : EgovAbstractIoSampleTests
  자식클래스 : EgovPreProcessorFunctionalTests
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/simple-job-launcher-context.xml&#34;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>				</span><span style=color:#4e9a06>&#34;/egovframework/batch/job-runner-context.xml&#34;</span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>abstract</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@ContextConfiguration</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>locations</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/egovframework/batch/jobs/preProcessorJob.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>})</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>EgovPreProcessorFunctionalTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>extends</span><span style=color:#f8f8f8;text-decoration:underline> 	</span><span style=color:#000>EgovAbstractIoSampleTests</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=joblaunchertestutils>JobLauncherTestUtils</h4><p>Spring 에서 제공하는 클래스로 배치수행에 필요한 메소드들이 포함되어 있다.</p><p>✔ JobLauncherTestUtils 클래스를 사용할 경우 ContextConfiguration 에서 job-runner-context.xml을 설정한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>JobLauncherTestUtils</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=setdatasourcedatasource-datasource>setDataSource(DataSource dataSource)</h4><p>배치 수행 시, DB 연결을 위한 dataSource 정보를 셋팅하는 부분이다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// simpleJdbcTemplate 설정</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>private</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTemplate</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>// dataSource 설정</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#5c35cc;font-weight:700>@Autowired</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>setDataSource</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>DataSource</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>dataSource</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>simpleJdbcTemplate</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>new</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SimpleJdbcTemplate</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>dataSource</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=setup>setUp()</h4><p>예제에서 DB 관련한 데이터처리에 앞서 초기값을 셋팅하는 부분이다. 주로 테이블의 기존 내용을 Delete 하고 초기값을 Insert 한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Before</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>setUp</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;DELETE from CUSTOMER&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (1, 0, &#39;customer1&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (2, 0, &#39;customer2&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (3, 0, &#39;customer3&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>simpleJdbcTemplate</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>update</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;INSERT INTO CUSTOMER (ID, VERSION, NAME, CREDIT) VALUES  (4, 0, &#39;customer4&#39;, 100000)&#34;</span><span style=color:#000;font-weight:700>);</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h4 id=test>@Test</h4><p>배치를 실제로 수행하고, 테스트해야 하는 내용이 포함된 부분으로 예제별로 그 내용이 상이하다.</p><p>✔ 테스트 내용을 구성하는 방법은 참고차료를 활용한다.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#5c35cc;font-weight:700>@Test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>public</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>void</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>testUpdateCredit</span><span style=color:#000;font-weight:700>()</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>throws</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Exception</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>{</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// 배치 수행</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>JobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobLauncherTestUtils</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>launchJob</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>getUniqueJobParameters</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline> 
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#8f5902;font-style:italic>// 테스트 내용 및 결과 확인</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>BatchStatus</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>COMPLETED</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>jobExecution</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>getStatus</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>	</span><span style=color:#000>assertEquals</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>inputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>(),</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>outputs</span><span style=color:#000;font-weight:700>.</span><span style=color:#c4a000>size</span><span style=color:#000;font-weight:700>());</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000;font-weight:700>}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=예제-junit-test-수행-방법>예제 JUnit Test 수행 방법</h3><h4 id=junit-수행>JUnit 수행</h4><p>수행방법은 <a href="https://www.egovframe.go.kr/wiki/doku.php?id=egovframework:dev2:tst:test_case">JunitTest 실행</a>을 참고한다.</p><h2 id=참고자료>참고자료</h2><ul><li><a href=/egovframe-docs/egovframe-runtime/batch-layer/batch-core-skip_repeat_retry/>Retry</a></li></ul></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/eGovFramework/egovframe-docs aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2016&ndash;2024
<span class=td-footer__authors>eGovFrame | <a href="https://www.egovframe.go.kr/home/sub.do?menuNo=23">Apache 2.0</a> |</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href="https://www.egovframe.go.kr/home/sub.do?menuNo=77" target=_blank rel=noopener>개인정보 보호 정책</a></span></div></div></div></footer></div><script src=/egovframe-docs/js/main.min.7b0f8c565cd2776889815bd3a0546285c2310b049c9276b8cd7f6eb3787eb28a.js integrity="sha256-ew+MVlzSd2iJgVvToFRihcIxCwSckna4zX9us3h+soo=" crossorigin=anonymous></script><script defer src=/egovframe-docs/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/egovframe-docs/js/tabpane-persist.js></script></body></html>